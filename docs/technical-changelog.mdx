# Technical Changelog

This page documents all notable changes to Sourcegraph. For more detailed changelog posts, please [read here](https://sourcegraph.com/changelog/). 

{/* CHANGELOG_START */}

# 5.11 Patch 3

## v5.11.4013

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.11.4013)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.11.4013)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.11.4013)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.11.4013)

### Features

#### Security

- Sign release images `(PR #2703)`
  - Publish signatures for release containers.  Backport c11764be4adb377521e4067c4852953d7c434e24 from #2697

#### Others

- Allow single container server to run postgresql-16 `(PR #2714)`
  - server: runs postgresql from /var/run/postgresql instead of /run/postgresql
 Backport 36c78cdf596e1b22079512931fa526346c2ec821 from #2711

### Fix

#### Release

- recover from unclean database shutdowns in pgsql entrypoint `(PR #2706)`
  - fix(rel): fix issue with Postgres docker container failing upgrades after an unclean database shutdown.
  Backport ca5185ce2528b67e1ce6bcb5170f96d3699e11e0 from #2660

### Reverts

  There were no reverts for this release

### Uncategorized

#### Others

- [Backport 5.11.x] fix(Bitbucket Cloud): Fix pagination logic for bitbucket cloud permissions `(PR #2700)`
  - Fixed an issue where Bitbucket Cloud permission syncs could produce incomplete results, resulting in lacking permissions.  Backport 389661481f0f0a2385ef4f78f4113ab6ba14f4d5 from #2699

{/* RSS={"version":"v5.11.4013", "releasedAt": "2025-01-11"} */}


# 5.11 Patch 2

## v5.11.3601

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.11.3601)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.11.3601)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.11.3601)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.11.3601)

### Features

#### Code Intelligence

- Make syntactic indexing write partial index to disk already GZIP compressed `(PR #2646)`

### Reverts

  There were no reverts for this release

{/* RSS={"version":"v5.11.3601", "releasedAt": "2025-01-08"} */}


# 5.11 Patch 1

## v5.11.2732

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.11.2732)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.11.2732)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.11.2732)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.11.2732)

### Fix

#### Search

- propagate disk space to NewFirecrackerWorkspace `(PR #2574)`
  - Addresses errors similar to: `failed to prepare workspace: failed to create ext4 filesystem in backing file: &quot;mke2fs 1.45.5 (07-Jan-2020)\nThe file losetup: /var/lib/firecracker/loop-devices/workspace-loop-47749-3763347387: Warning: file is smaller than 512 bytes; the loop device may be useless or invisible for system tools.\n/dev/loop13 does not exist and no size was specified.\n&quot;: exit status 1`
  - Affects reading and using the environment variable `EXECUTOR_FIRECRACKER_DISK_SPACE`  Backport 22db2a97a0393cdd233a92da7ade96cd59bb99ef from #2562

### Chore

#### Security

- Auto-update all packages in Sourcegraph base images (5.11.x) `(PR #2494)`

### Reverts

  There were no reverts for this release

{/* RSS={"version":"v5.11.2732", "releasedAt": "2025-01-03"} */}


# 5.11 Patch 0

> Warning: This release updates the database container images from Postgres 12 to Postgres 16, and begins using Wolfi based images. Customers are advised to have a database backup before upgrading! See our [postgres 12 end of life](https://sourcegraph.com/docs/admin/postgres12_end_of_life_notice#postgres-12-end-of-life) notice!
>
> Also be sure to check your deployment type's [upgrade notes](http://sourcegraph.com/docs/admin/updates#instance-specific-procedures)!

## v5.11.0

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.11.0)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.11.0)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.11.0)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.11.0)

### Features

#### Ci

- add bazel mod tidy to ci steps [#1661](https://github.com/sourcegraph/sourcegraph/pull/1661)

#### Cloud

- add tag field to mt config [#2035](https://github.com/sourcegraph/sourcegraph/pull/2035)

#### Code Intelligence

- Pass limits to scip-syntax and collect summary from it [#2058](https://github.com/sourcegraph/sourcegraph/pull/2058)
- configurable time and size limits for scip-syntax [#1947](https://github.com/sourcegraph/sourcegraph/pull/1947)
  - Adds configurable limits for file size and parsing time for syntactic indexing

#### Cody

- update cody web to 0.20.0 [#2396](https://github.com/sourcegraph/sourcegraph/pull/2396)
- update cody-web to 0.18.0 [#2365](https://github.com/sourcegraph/sourcegraph/pull/2365)
- add autoedits models to models.json [#1873](https://github.com/sourcegraph/sourcegraph/pull/1873)
- Add `UserShouldUseEnterprise` to `/.api/client-config` (PRIME-596) [#1872](https://github.com/sourcegraph/sourcegraph/pull/1872)

#### Cody-Gateway

- add Gemini 2.0 Flash experimental model [#2309](https://github.com/sourcegraph/sourcegraph/pull/2309)
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)

#### Codygateway

- expand flagging to workspaces actors [#2290](https://github.com/sourcegraph/sourcegraph/pull/2290)
- off-by-default workspaces actor source [#1941](https://github.com/sourcegraph/sourcegraph/pull/1941)

#### Database

- support drift detection of policies [#2000](https://github.com/sourcegraph/sourcegraph/pull/2000)
  - drift detection now detects missing table policies.
- include policies in schema md and json [#1999](https://github.com/sourcegraph/sourcegraph/pull/1999)
  - schema.md and schema.json now include table policies.

#### Dev

- Adding wait option to sg access command [#1930](https://github.com/sourcegraph/sourcegraph/pull/1930)

#### Gateway

- Add v2 endpoint stubs [#1526](https://github.com/sourcegraph/sourcegraph/pull/1526)

#### Gating

- extract license validity checks to gating.Provider.CheckGrant [#2018](https://github.com/sourcegraph/sourcegraph/pull/2018)
- replace licensing.Check with gating.GetGlobalProvider().Check [#2009](https://github.com/sourcegraph/sourcegraph/pull/2009)
- allow gating.Provider to be global [#2008](https://github.com/sourcegraph/sourcegraph/pull/2008)
- extract into standalone package, stub out CodyGatewayAuthenticator [#2007](https://github.com/sourcegraph/sourcegraph/pull/2007)

#### Graphql

- multitenant: add repository restriction validation when adding repos [#2017](https://github.com/sourcegraph/sourcegraph/pull/2017)

#### Local

- use mac/linux keystores to store secrets instead of plain text file on disk [#2001](https://github.com/sourcegraph/sourcegraph/pull/2001)
- store entitle token in sg secrets [#1856](https://github.com/sourcegraph/sourcegraph/pull/1856)

#### Memcache

- add tenancy-friendly LRU memory cache [#1934](https://github.com/sourcegraph/sourcegraph/pull/1934)

#### Msp

- introduce simple telemetry recorder for managed services [#2146](https://github.com/sourcegraph/sourcegraph/pull/2146)

#### Multi-Tenant

- add "add repositories" setup flow step [#2112](https://github.com/sourcegraph/sourcegraph/pull/2112)
- Add first UI implementation of GitHub connect setup page [#1966](https://github.com/sourcegraph/sourcegraph/pull/1966)

#### Multi-Tenant/Workspaces

- add support to query ws by name in integrations svc [#2321](https://github.com/sourcegraph/sourcegraph/pull/2321)

#### Multitenant

- Set maximum repos size to 500mb [#2027](https://github.com/sourcegraph/sourcegraph/pull/2027)

#### Rbac

- add separate permission for viewing exported telemetry [#1989](https://github.com/sourcegraph/sourcegraph/pull/1989)

#### Release

- run `sg cut` in buildkite to automate nightly pipeline test [#2116](https://github.com/sourcegraph/sourcegraph/pull/2116)
  - release: nightly release pipeline is working
- backcompat test use release registry [#1202](https://github.com/sourcegraph/sourcegraph/pull/1202)

#### Search

- correctly lower repo name regexes [#2209](https://github.com/sourcegraph/sourcegraph/pull/2209)
  - Special uppercase regex tokens are no longer inverted for repository name search. eg `repo:foo\B` correctly interprets `\B` as `not at ASCII word boundary`. Previously it would transform the expression into `repo:foo\b`.
- use pattern optimizations for repo ExcludePattern [#2186](https://github.com/sourcegraph/sourcegraph/pull/2186)
  - Searches which exclude repositories are faster on larger instances. We now use the same performance optimizations as repo inclusion.

#### Security

- Add access token ID to audit events [#2034](https://github.com/sourcegraph/sourcegraph/pull/2034)

#### Sg

- add 'sg user metadata' commands [#2261](https://github.com/sourcegraph/sourcegraph/pull/2261)

#### Source

- MT GitHub App  connections now use generic App connection [#2338](https://github.com/sourcegraph/sourcegraph/pull/2338)
- Add App-level GitHub App code host connections [#2127](https://github.com/sourcegraph/sourcegraph/pull/2127)
  - Sourcegraph now supports App-level GitHub App connections that aren't tied to a specific Installation ID.
- Add maxDeletions option to code host connections [#2003](https://github.com/sourcegraph/sourcegraph/pull/2003)

#### Telemetry

- include SAMS user ID if monolithsams is configured [#1936](https://github.com/sourcegraph/sourcegraph/pull/1936)
- propagate x-requested-with headers to request client… [#1775](https://github.com/sourcegraph/sourcegraph/pull/1775)

#### Workspaces

- add metric to count number of unseen instances [#2303](https://github.com/sourcegraph/sourcegraph/pull/2303)
- report instances and workspaces status [#2262](https://github.com/sourcegraph/sourcegraph/pull/2262)
- add features to workspace results [#2171](https://github.com/sourcegraph/sourcegraph/pull/2171)

#### Others

- extend prompt tags with pagination and increased limit [#2344](https://github.com/sourcegraph/sourcegraph/pull/2344)
  - feat: extend prompt tags with pagination and increased limit
- editing tags on prompts [#2278](https://github.com/sourcegraph/sourcegraph/pull/2278)
  - feat: editing tags on prompts
- (multi-tenant): add invite users and final setup step [#2211](https://github.com/sourcegraph/sourcegraph/pull/2211)
- management page prompt categories [#2178](https://github.com/sourcegraph/sourcegraph/pull/2178)
  - feat: management page prompt categories
- prompt categories nav for web [#2177](https://github.com/sourcegraph/sourcegraph/pull/2177)
  - feat: add tags as filter to prompts and their navigation
- add prompt labels to the GraphQL API [#2131](https://github.com/sourcegraph/sourcegraph/pull/2131)
  - feat: add prompt labels to the GraphQL API
- Call new intent detection model via Gateway [#2113](https://github.com/sourcegraph/sourcegraph/pull/2113)
- add CommitsIter to `GitserverClient` [#2080](https://github.com/sourcegraph/sourcegraph/pull/2080)
- New intent detection API on Gateway [#2016](https://github.com/sourcegraph/sourcegraph/pull/2016)
- more telemetry for batch changes [#2014](https://github.com/sourcegraph/sourcegraph/pull/2014)
  - feat(batches): more telemetry events
- add support to `patterntype:nls` for `type:code` and `type:text` [#1961](https://github.com/sourcegraph/sourcegraph/pull/1961)
- add OR support for text search pattern types [#1915](https://github.com/sourcegraph/sourcegraph/pull/1915)
- collect contributor data [#1765](https://github.com/sourcegraph/sourcegraph/pull/1765)
  - feat: calculate contributor stats

### Fix

#### Code Intelligence

- reports symbols for TypeScript type aliases [#2339](https://github.com/sourcegraph/sourcegraph/pull/2339)
  - Properly report symbols for TypeScript type aliases

#### Cody

- update cody web to 0.19.0 [#2376](https://github.com/sourcegraph/sourcegraph/pull/2376)
- add cody.notices to json schema [#2373](https://github.com/sourcegraph/sourcegraph/pull/2373)
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- fix prompt library UI layouts [#2288](https://github.com/sourcegraph/sourcegraph/pull/2288)
- fix prompt avatar for generated initials avatar [#2239](https://github.com/sourcegraph/sourcegraph/pull/2239)
- switch to Snowball stopwords [#2223](https://github.com/sourcegraph/sourcegraph/pull/2223)
  - Narrowed down the stopwords list used in Cody context, to fix an issue where we could miss highly relevant files.
- disable reranking for airgapped instances [#2168](https://github.com/sourcegraph/sourcegraph/pull/2168)
  - Fixes a bug in Cody context where airgapped instances would attempt to use the reranker model, which increased the context retrieval latency.
- fix prompt creation telemetry [#2057](https://github.com/sourcegraph/sourcegraph/pull/2057)

#### Codyauditlog

- inline audit log entry for consistency [#2072](https://github.com/sourcegraph/sourcegraph/pull/2072)

#### Codygateway

- configurable workspace user ban state cache, lower default [#2357](https://github.com/sourcegraph/sourcegraph/pull/2357)
- fix listing flagged prompts from workspaces users [#2354](https://github.com/sourcegraph/sourcegraph/pull/2354)

#### Dev

- Fix window context extraction logic for multitenant [#1998](https://github.com/sourcegraph/sourcegraph/pull/1998)

#### Dev/Codygateway

- partially fix Cody Gateway QA suite [#2005](https://github.com/sourcegraph/sourcegraph/pull/2005)

#### Dev/Msp

- remove actual interval from error message to fix flakey months [#2031](https://github.com/sourcegraph/sourcegraph/pull/2031)

#### Gateway

- benchmark: various fixes [#2119](https://github.com/sourcegraph/sourcegraph/pull/2119)

#### Msp

- fix error message for image tag resolution [#2283](https://github.com/sourcegraph/sourcegraph/pull/2283)

#### Msp/Operationdocs

- update Entitle request links [#2281](https://github.com/sourcegraph/sourcegraph/pull/2281)

#### Mulitenant

- add rote tests for repositoryChecker implementations [#2258](https://github.com/sourcegraph/sourcegraph/pull/2258)
  - N/A
- add rote test for workspaceGitHubAppAccountResolver [#2257](https://github.com/sourcegraph/sourcegraph/pull/2257)
  - N/A
- add test suite for (s *serviceImpl) listRepositoriesSearch [#2255](https://github.com/sourcegraph/sourcegraph/pull/2255)
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- add test suite for (r *workspaceGitHubAppResolver) ListUserGitHubRepositories [#2199](https://github.com/sourcegraph/sourcegraph/pull/2199)
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)

#### Multitenant

- enable workspace specific routes only for workspace instance [#2287](https://github.com/sourcegraph/sourcegraph/pull/2287)
- add rote tests for workspaceGitHubAppRepositoryResolver [#2259](https://github.com/sourcegraph/sourcegraph/pull/2259)
  - N/A
- add test suite for (r *workspaceGitHubAppResolver) ListPublicGitHubRepositories [#2198](https://github.com/sourcegraph/sourcegraph/pull/2198)
  - N/A
- graphql: add installation repos test suite [#2174](https://github.com/sourcegraph/sourcegraph/pull/2174)

#### Release

- Fix regressions from 5.10 release process [#2405](https://github.com/sourcegraph/sourcegraph/pull/2405)
  - refactor and fix bugs in release test&lt;details&gt;

#### Sams

- fix notification handlers [#1990](https://github.com/sourcegraph/sourcegraph/pull/1990)

#### Search

- fix small svelte UI paper cuts [#2317](https://github.com/sourcegraph/sourcegraph/pull/2317)
- Executors: set the user/group on the job spec only if configured. [#2203](https://github.com/sourcegraph/sourcegraph/pull/2203)
  - Also validates `KUBERNETES_RUN_AS_USER` and `KUBERNETES_RUN_AS_GROUP`.
  - Must be integers in the range [0, 2147483647].
- fix fuzzy finder layout in Safari 18.1 [#2061](https://github.com/sourcegraph/sourcegraph/pull/2061)

#### Source

- Use GitHub GraphQL client to do repo searches [#2340](https://github.com/sourcegraph/sourcegraph/pull/2340)
- Decode installationRepos' args.After correctly [#2126](https://github.com/sourcegraph/sourcegraph/pull/2126)
- Fix layout on repo admin search box [#1960](https://github.com/sourcegraph/sourcegraph/pull/1960)

#### Telemetry

- include anonymous user ID in externalAuthSignup events [#2074](https://github.com/sourcegraph/sourcegraph/pull/2074)

#### Telemetrygateway

- update generated bindings [#1939](https://github.com/sourcegraph/sourcegraph/pull/1939)

#### Worker/Sams

- fix userRolesStrings [#1992](https://github.com/sourcegraph/sourcegraph/pull/1992)

#### Workspaces

- handle missing class name in instances [#2286](https://github.com/sourcegraph/sourcegraph/pull/2286)
- create: improve cancellation handling [#2167](https://github.com/sourcegraph/sourcegraph/pull/2167)
- CodeUnauthenticated for missing session ID, dont include trace ID in log message [#2032](https://github.com/sourcegraph/sourcegraph/pull/2032)

#### Workspaces/Integrations

- do not list billing subscriptions if no workspaces [#2233](https://github.com/sourcegraph/sourcegraph/pull/2233)

#### Others

- set high match limit for NLS [#2352](https://github.com/sourcegraph/sourcegraph/pull/2352)
- remove surplus typename [#2265](https://github.com/sourcegraph/sourcegraph/pull/2265)
  - fix: remove surplus typename
- use byte columns for contributors to support non-utf8 characters [#2122](https://github.com/sourcegraph/sourcegraph/pull/2122)
- skip revision if not found instead of throwing error [#2121](https://github.com/sourcegraph/sourcegraph/pull/2121)
- slow down contributor jobs [#2120](https://github.com/sourcegraph/sourcegraph/pull/2120)
- add internal actor to contributor job [#2101](https://github.com/sourcegraph/sourcegraph/pull/2101)
- Correctly handle overlapping paths in Perforce protection rules [#1745](https://github.com/sourcegraph/sourcegraph/pull/1745)

### Chore

#### Ci

- Enable svelte-check in CI for multi-tenant [#2242](https://github.com/sourcegraph/sourcegraph/pull/2242)
- skip license-check workflow on draft prs [#2087](https://github.com/sourcegraph/sourcegraph/pull/2087)
- add -x flag to the script [#2029](https://github.com/sourcegraph/sourcegraph/pull/2029)
- bazel - pull static psql as tool dep [#1970](https://github.com/sourcegraph/sourcegraph/pull/1970)
- pg-utils - upload static psql [#1969](https://github.com/sourcegraph/sourcegraph/pull/1969)

#### Cloud

- switch ephemerals to dev enterprise portal [#2090](https://github.com/sourcegraph/sourcegraph/pull/2090)

#### Code Intelligence

- Remove EMPTY_STATS_JSON object [#2363](https://github.com/sourcegraph/sourcegraph/pull/2363)
- Fix incorrect error handling [#2316](https://github.com/sourcegraph/sourcegraph/pull/2316)
- Move cursor last for consistency [#2311](https://github.com/sourcegraph/sourcegraph/pull/2311)
- Refactor uploadhandler logic for clarity [#2086](https://github.com/sourcegraph/sourcegraph/pull/2086)
- Update scip version and use faster parsing API [#2085](https://github.com/sourcegraph/sourcegraph/pull/2085)
- Simplify code to avoid single-implementation interfaces [#2046](https://github.com/sourcegraph/sourcegraph/pull/2046)
- Fix incorrect test inputs [#2043](https://github.com/sourcegraph/sourcegraph/pull/2043)
- Simplify SyntacticIndexingJobStore [#2042](https://github.com/sourcegraph/sourcegraph/pull/2042)
- Remove RepositorySchedulingService [#2041](https://github.com/sourcegraph/sourcegraph/pull/2041)
- Remove IndexEnqueuer interface with a single implementation [#2040](https://github.com/sourcegraph/sourcegraph/pull/2040)

#### Cody

- Add QA's test domain to the enterprise domain list [#2392](https://github.com/sourcegraph/sourcegraph/pull/2392)
- monitor completions latency by feature [#2345](https://github.com/sourcegraph/sourcegraph/pull/2345)
- remove retired claude models [#2047](https://github.com/sourcegraph/sourcegraph/pull/2047)
- Fix typos and minor warnings around Cody Gateway [#2025](https://github.com/sourcegraph/sourcegraph/pull/2025)
- migrate code completion model resolution to use models.json [#1980](https://github.com/sourcegraph/sourcegraph/pull/1980)
- Make LegacyModelRedirects public [#1951](https://github.com/sourcegraph/sourcegraph/pull/1951)

#### Cody-Gateway

- log model capability mismatch [#2181](https://github.com/sourcegraph/sourcegraph/pull/2181)

#### Dev

- Replace cmp.Diff -> check.(Must)?NoDiff (part 3) [#2154](https://github.com/sourcegraph/sourcegraph/pull/2154)
- Replace cmp.Diff -> check.(Must)?NoDiff (part 2) [#2151](https://github.com/sourcegraph/sourcegraph/pull/2151)
- Replace cmp.Diff -> check.(Must)?NoDiff (part 1) [#2150](https://github.com/sourcegraph/sourcegraph/pull/2150)
- Introduce more type safe testing package [#2049](https://github.com/sourcegraph/sourcegraph/pull/2049)

#### Dotcom

- UI copy, list by instance domain, correctly return invalid argument on update [#1916](https://github.com/sourcegraph/sourcegraph/pull/1916)

#### Gateway

- Fix logged model name format in "not allowed" errors [#2056](https://github.com/sourcegraph/sourcegraph/pull/2056)
- Don't ignore API version when comparing modelRefs for RateLimit filtering [#2024](https://github.com/sourcegraph/sourcegraph/pull/2024)
- Use `models.json` in Cody Gateway (PRIME-600, PRIME-612) [#1759](https://github.com/sourcegraph/sourcegraph/pull/1759)

#### Graphqlbackend

- remove deprecated monitoring queries [#2075](https://github.com/sourcegraph/sourcegraph/pull/2075)

#### Local

- pg_version_check - force db to be postgres [#1979](https://github.com/sourcegraph/sourcegraph/pull/1979)

#### Monolithsams

- migrate to official SAMS SDK [#1987](https://github.com/sourcegraph/sourcegraph/pull/1987)

#### Plg

- Add Cody Pro upgrade script [#1903](https://github.com/sourcegraph/sourcegraph/pull/1903)

#### Sams

- enable SDK caching for authentication middleware clients [#1988](https://github.com/sourcegraph/sourcegraph/pull/1988)

#### Search

- Upgrade prettier for web-sveltekit [#2221](https://github.com/sourcegraph/sourcegraph/pull/2221)
- Add private metadata for language on code nav events [#2190](https://github.com/sourcegraph/sourcegraph/pull/2190)
- (new web ui) Upgrade to Svelte 5 [#2183](https://github.com/sourcegraph/sourcegraph/pull/2183)
- Update client side code intel telemetry to include provenance and tab [#2142](https://github.com/sourcegraph/sourcegraph/pull/2142)

#### Security

- Pin otel-collector package version [#2452](https://github.com/sourcegraph/sourcegraph/pull/2452)
- Update src-cli to version 5.11.1 [#2447](https://github.com/sourcegraph/sourcegraph/pull/2447)
  - Update src-cli version to 5.11.1  Backport 2721fd9106eb033afe4cca96164f7ecc5e0b6f88 from #2444
- Update src-cli to version 5.11.0 [#2366](https://github.com/sourcegraph/sourcegraph/pull/2366)
  - Update src-cli version to 5.11.0
- Auto-update package lockfiles for Sourcegraph base images [#2302](https://github.com/sourcegraph/sourcegraph/pull/2302)

#### Source

- Use sghttp CloneURL to make a copy of a URL [#2315](https://github.com/sourcegraph/sourcegraph/pull/2315)
- simplify oauth middleware [#1946](https://github.com/sourcegraph/sourcegraph/pull/1946)

#### Telemetry

- remove example values, deprecate SafeAction [#2107](https://github.com/sourcegraph/sourcegraph/pull/2107)

#### Workspace

- Update picker with small changes for current link [#2227](https://github.com/sourcegraph/sourcegraph/pull/2227)

#### Workspaces

- add seats metadata by listing subscriptions in bulk [#2189](https://github.com/sourcegraph/sourcegraph/pull/2189)
- make openfga cancelled errors easier to detect [#2117](https://github.com/sourcegraph/sourcegraph/pull/2117)
- ListWorkspaces: concurrently fetch membership [#2104](https://github.com/sourcegraph/sourcegraph/pull/2104)
- set workspace ID on create span [#2084](https://github.com/sourcegraph/sourcegraph/pull/2084)
- UX Updates for Workspaces service [#2078](https://github.com/sourcegraph/sourcegraph/pull/2078)
- mark emails as transactional [#1984](https://github.com/sourcegraph/sourcegraph/pull/1984)
- add tracing on Cloudflare KV ops, improve retry policies [#1957](https://github.com/sourcegraph/sourcegraph/pull/1957)

#### Workspaces/Billing

- add rehttp on stripe 429 [#2079](https://github.com/sourcegraph/sourcegraph/pull/2079)
- add traced HTTP client to Stripe SDK [#1962](https://github.com/sourcegraph/sourcegraph/pull/1962)

#### Others

- Update Calendar Release Notifications [#2230](https://github.com/sourcegraph/sourcegraph/pull/2230)
  - N/A
- add CODENOTIFY files for Cody Prime team [#2185](https://github.com/sourcegraph/sourcegraph/pull/2185)
- Avoid materializing set values just for iteration [#2045](https://github.com/sourcegraph/sourcegraph/pull/2045)
- Enable exhaustruct on syntactic_indexing folder [#2044](https://github.com/sourcegraph/sourcegraph/pull/2044)
- cleanup stale branches [#1977](https://github.com/sourcegraph/sourcegraph/pull/1977)
- Remove unreferenced scripts [#1942](https://github.com/sourcegraph/sourcegraph/pull/1942)
- update repo not found for dotcom [#1940](https://github.com/sourcegraph/sourcegraph/pull/1940)
- Cleanup some local dev things [#1906](https://github.com/sourcegraph/sourcegraph/pull/1906)
- Address Gazelle deprecation warnings [#1789](https://github.com/sourcegraph/sourcegraph/pull/1789)
- Use enum for executor runtime instead of boolean flags [#1788](https://github.com/sourcegraph/sourcegraph/pull/1788)
- Rename executor Config fields & simplify code [#1787](https://github.com/sourcegraph/sourcegraph/pull/1787)
- Use collections.Set for marking allowed RepoID values. [#1743](https://github.com/sourcegraph/sourcegraph/pull/1743)
- Move license check types to handler [#1697](https://github.com/sourcegraph/sourcegraph/pull/1697)

### Refactor

#### Ci

- add DefaultQueue for the default queue to use [#2096](https://github.com/sourcegraph/sourcegraph/pull/2096)

### Reverts

- Revert "feat(cody-gateway): add Gemini 2.0 Flash experimental model  [#-1](https://github.com/sourcegraph/sourcegraph/pull/2326)
- Revert "completions: Use authenticator interface for access token" [#1694](https://github.com/sourcegraph/sourcegraph/pull/2169)
- Revert "chore(ci): temporary exclude diff tests (#1923)" [#1923](https://github.com/sourcegraph/sourcegraph/pull/1926)

### Uncategorized

#### Others

- [Backport 5.11.x] bitbucketcloud: Fix repo perms syncing for inherited permissions and groups [#2399](https://github.com/sourcegraph/sourcegraph/pull/2399)
  - Fixed an issue with Bitbucket Cloud permission syncing where inherited permissions and group permissions were not correctly reflected.
- worker: Disable routines for codeintel inside routines logic [#2386](https://github.com/sourcegraph/sourcegraph/pull/2386)
- tenant: Prevent in-app deadlock while initializing globalstate [#2383](https://github.com/sourcegraph/sourcegraph/pull/2383)
- tenant: Mark tenant as last seen async [#2381](https://github.com/sourcegraph/sourcegraph/pull/2381)
- nls: add ability to boost results from a repo [#2375](https://github.com/sourcegraph/sourcegraph/pull/2375)
- Intent detection: add heuristics  [#2364](https://github.com/sourcegraph/sourcegraph/pull/2364)
- autoedits: remove rewrite speculation field for the chat endpoint [#2361](https://github.com/sourcegraph/sourcegraph/pull/2361)
- Hitesh/change direct route method [#2351](https://github.com/sourcegraph/sourcegraph/pull/2351)
- change deepseek model for autoedits [#2350](https://github.com/sourcegraph/sourcegraph/pull/2350)
- Reapply "feat(cody-gateway): add Gemini 2.0 Flash experimental model" [#2348](https://github.com/sourcegraph/sourcegraph/pull/2348)
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)Cody Gateway: add support to Google's Gemini 2.0 Flash Experimental model.
- auth: Simplify middlewares [#2336](https://github.com/sourcegraph/sourcegraph/pull/2336)
- http: Refactor HTTP_TRACE to use Sourcegraph logger [#2335](https://github.com/sourcegraph/sourcegraph/pull/2335)
- http: Drop Blackhole middleware [#2334](https://github.com/sourcegraph/sourcegraph/pull/2334)
- editor: Add missing Gerrit remoteURL resolution [#2332](https://github.com/sourcegraph/sourcegraph/pull/2332)
- gitserver: Fix input parsing issue in diff searches [#2331](https://github.com/sourcegraph/sourcegraph/pull/2331)
- tenant: Mention repos that were not found [#2328](https://github.com/sourcegraph/sourcegraph/pull/2328)
- tenant: Use SiteID for workspace management API interaction [#2327](https://github.com/sourcegraph/sourcegraph/pull/2327)
- NLS: use reranker in batch search too [#2325](https://github.com/sourcegraph/sourcegraph/pull/2325)
- NLS: only rerank keyword matches [#2324](https://github.com/sourcegraph/sourcegraph/pull/2324)
- NLS: fix bug where we could skip reranking [#2320](https://github.com/sourcegraph/sourcegraph/pull/2320)
- bugfix: anchor include patterns for symbol tree [#2319](https://github.com/sourcegraph/sourcegraph/pull/2319)
  - Fixed a web app bug that could cause symbols to be shown in the symbol tree for files that share a name with the viewed file
- NLS: initial reranker integration [#2298](https://github.com/sourcegraph/sourcegraph/pull/2298)
- Redis: remove unused rcache methods [#2292](https://github.com/sourcegraph/sourcegraph/pull/2292)
- chore(workspaces) Ensure an api error populating list of workspaces do… [#2291](https://github.com/sourcegraph/sourcegraph/pull/2291)
- gomod: bump Zoekt for BM25 improvement [#2282](https://github.com/sourcegraph/sourcegraph/pull/2282)
- tenant: Indicate to webapp that workspaces UIs should be shown [#2279](https://github.com/sourcegraph/sourcegraph/pull/2279)
- repoupdater: Fix panic when traversing public repos [#2273](https://github.com/sourcegraph/sourcegraph/pull/2273)
- dev/workspaces: get local o11y working again [#2263](https://github.com/sourcegraph/sourcegraph/pull/2263)
- tenant: Use workspace ID as site id [#2256](https://github.com/sourcegraph/sourcegraph/pull/2256)
- tenant: Fix missing tenant context in conf validation [#2247](https://github.com/sourcegraph/sourcegraph/pull/2247)
- ranking: revert changes to concurrency limits [#2236](https://github.com/sourcegraph/sourcegraph/pull/2236)
- NLS: initial support for type:path [#2234](https://github.com/sourcegraph/sourcegraph/pull/2234)
- enable predicted outputs for S2 instance for fireworks models [#2226](https://github.com/sourcegraph/sourcegraph/pull/2226)
- dev(search): (new web ui) Upgrade svelte-check [#2220](https://github.com/sourcegraph/sourcegraph/pull/2220)
- add deepseek completions model for autoedits [#2219](https://github.com/sourcegraph/sourcegraph/pull/2219)
- workspaces/billing: implement payment charge for purchase extra seats [#2217](https://github.com/sourcegraph/sourcegraph/pull/2217)
- Reranker: make sure to record telemetry [#2188](https://github.com/sourcegraph/sourcegraph/pull/2188)
- tenant/worker: Add tenant to context for worker in ST mode [#2184](https://github.com/sourcegraph/sourcegraph/pull/2184)
- tenant: Implement dynamic limits for GitHub App [#2172](https://github.com/sourcegraph/sourcegraph/pull/2172)
- repo: Drop next_sync_at prioritization [#2160](https://github.com/sourcegraph/sourcegraph/pull/2160)
- gateway: benchmark: fix http-then-websocket initial request failures [#2159](https://github.com/sourcegraph/sourcegraph/pull/2159)
- repoupdater: Fix interval out of range [#2155](https://github.com/sourcegraph/sourcegraph/pull/2155)
- pings: Remove hubspot integration [#2144](https://github.com/sourcegraph/sourcegraph/pull/2144)
- workspace-reconciler: update tenant name and display name [#2141](https://github.com/sourcegraph/sourcegraph/pull/2141)
- repoupdater: Make backoff after failure to fetch/clone more exponential [#2140](https://github.com/sourcegraph/sourcegraph/pull/2140)
- gitserver: Record LastError, LastOutput when hitting a timeout [#2139](https://github.com/sourcegraph/sourcegraph/pull/2139)
- gitserver: Simpify repo state syncer [#2138](https://github.com/sourcegraph/sourcegraph/pull/2138)
- tenant: Add context to OIDC verifier [#2137](https://github.com/sourcegraph/sourcegraph/pull/2137)
- tenant: Fix missing tenant in oauth requests [#2136](https://github.com/sourcegraph/sourcegraph/pull/2136)
- tenant: Expose configured limits in GQL API [#2123](https://github.com/sourcegraph/sourcegraph/pull/2123)
- add colorful icons for gitlab and bitbucket [#2114](https://github.com/sourcegraph/sourcegraph/pull/2114)
- chore(workspaces) Remove an extra quote [#2111](https://github.com/sourcegraph/sourcegraph/pull/2111)
- tenant: Temporarily bump limit to 10GB again [#2110](https://github.com/sourcegraph/sourcegraph/pull/2110)
- tenant: Fix multitenant repo selection update [#2109](https://github.com/sourcegraph/sourcegraph/pull/2109)
- NLS: boost literal matches [#2108](https://github.com/sourcegraph/sourcegraph/pull/2108)
- bug(multitenant): Fix GraphQL resolvers for repo search [#2098](https://github.com/sourcegraph/sourcegraph/pull/2098)
- batches: Fix trigger function with tenancy [#2092](https://github.com/sourcegraph/sourcegraph/pull/2092)
- Deprecate unused pings, reducing load on local PG instances [#2082](https://github.com/sourcegraph/sourcegraph/pull/2082)
- NLS: perform single search for code and text results [#2081](https://github.com/sourcegraph/sourcegraph/pull/2081)
- fix cookie name [#2077](https://github.com/sourcegraph/sourcegraph/pull/2077)
- NLS: created dedicated search job [#2076](https://github.com/sourcegraph/sourcegraph/pull/2076)
- appliance: Remove from UserNav [#2069](https://github.com/sourcegraph/sourcegraph/pull/2069)
- repo: Fix race condition in code host syncer [#2060](https://github.com/sourcegraph/sourcegraph/pull/2060)
- authz: Adjust default settings for perms syncing [#2052](https://github.com/sourcegraph/sourcegraph/pull/2052)
  - The default values for repo permission syncing have been adjusted. If you specified overrides, this means no change on your instance.Adjusted defaults:`permissions.syncScheduleInterval` is now 60s instead of 15s, in favor of scheduling more jobs at once (see below).`permissions.syncOldestUsers` and `permissions.syncOldestRepos` have been adjusted to `100` from `10` to schedule pending permission sync jobs faster.`permissions.syncJobCleanupInterval` has been bumped from every minute to every hour. Cleaning completed jobs is purely to prevent unbounded growth and every minute was more aggressive than necessary.The default concurrency for repo- and user-centric sync jobs has been bumped from 1 to 5 to account for larger instances. Historically, GitHub prevented concurrent API access in secondary rate limiting but this has been lifted to be much more lenient long ago. `permissions.syncReposMaxConcurrency` has also been introduced to compliment `permissions.syncUsersMaxConcurrency`.
- tenant: Fix concurrent creation in DB [#2039](https://github.com/sourcegraph/sourcegraph/pull/2039)
- tenant: Do not fail on startup [#2038](https://github.com/sourcegraph/sourcegraph/pull/2038)
- add code_completion feature flag for autoedit model [#2037](https://github.com/sourcegraph/sourcegraph/pull/2037)
- pings: Move handler code into cmd/pings [#2021](https://github.com/sourcegraph/sourcegraph/pull/2021)
- authz: Remove unused iteration over authProviders [#2019](https://github.com/sourcegraph/sourcegraph/pull/2019)
- cody: Fix incorrect language in Cody auth dialog [#2013](https://github.com/sourcegraph/sourcegraph/pull/2013)
- auth: Bring auth.Providers reads further up [#2011](https://github.com/sourcegraph/sourcegraph/pull/2011)
- tenant: Restructure multitenant GitHub app implementation [#2010](https://github.com/sourcegraph/sourcegraph/pull/2010)
- deps: upgrade SAMS SDK [#2006](https://github.com/sourcegraph/sourcegraph/pull/2006)
- repo: NeedsRepositoryConfiguration is independent of permissions [#1981](https://github.com/sourcegraph/sourcegraph/pull/1981)
- repoupdater: Enable dbbacked scheduler by default [#1975](https://github.com/sourcegraph/sourcegraph/pull/1975)
- repoupdater: Split dbworker for clones and fetches [#1974](https://github.com/sourcegraph/sourcegraph/pull/1974)
- repoupdater: Introduce higher priority for clones [#1972](https://github.com/sourcegraph/sourcegraph/pull/1972)
- gitserver: Increase duration buckets [#1971](https://github.com/sourcegraph/sourcegraph/pull/1971)
- Added option to create search job from action menu in the results page [#1968](https://github.com/sourcegraph/sourcegraph/pull/1968)
- tenant: Return multitenantGitHubApp for all users [#1967](https://github.com/sourcegraph/sourcegraph/pull/1967)
- workspaces: use `time.Now` as the modtime for "index.html" [#1956](https://github.com/sourcegraph/sourcegraph/pull/1956)
- workspaces: add a quick log to show the modtime of index.html [#1953](https://github.com/sourcegraph/sourcegraph/pull/1953)
- Redis: add warning about using KEYS command [#1913](https://github.com/sourcegraph/sourcegraph/pull/1913)
- remove debugging code [#1909](https://github.com/sourcegraph/sourcegraph/pull/1909)
- auth: Craft GatingProvider interface and use in AuthProviders [#1892](https://github.com/sourcegraph/sourcegraph/pull/1892)
- auth: Small code cleanup [#1891](https://github.com/sourcegraph/sourcegraph/pull/1891)
- events: Deprecate hashedLicenseKey in events from client [#1887](https://github.com/sourcegraph/sourcegraph/pull/1887)
- llms: Fixup and streamline cody rate limits [#1700](https://github.com/sourcegraph/sourcegraph/pull/1700)
- licensing: Implement NonAdmins feature [#1699](https://github.com/sourcegraph/sourcegraph/pull/1699)
- licensing: Simplify free tier logic a bit [#1695](https://github.com/sourcegraph/sourcegraph/pull/1695)
- enterprise-portal: add RegisterRoleResources background routine [#1687](https://github.com/sourcegraph/sourcegraph/pull/1687)
- enterprise-portal: add SAMS notification handler for UserRolesUpdated [#1686](https://github.com/sourcegraph/sourcegraph/pull/1686)
- security: Auto-update package lockfiles for Sourcegraph base images [#1678](https://github.com/sourcegraph/sourcegraph/pull/1678)
- workerutil: Move into tenant package [#1533](https://github.com/sourcegraph/sourcegraph/pull/1533)
- dbworker: RFC for tenant-aware, fast dequeues [#1487](https://github.com/sourcegraph/sourcegraph/pull/1487)

### Untracked

The following PRs were merged onto the previous release branch but could not be automatically mapped to a corresponding commit in this release:

- [Backport 5.10.x] Context: switch to Snowball stopwords (#2223) [#2225](https://github.com/sourcegraph/sourcegraph/pull/2225)
  - Narrowed down the stopwords list used in Cody context, to fix an issue where we could miss highly relevant files.Backports [https://github.com/sourcegraph/sourcegraph/pull/2223](https://github.com/sourcegraph/sourcegraph/pull/2223)

{/* RSS={"version":"5.11 Patch 0", "releasedAt": "2024-12-19"} */}


# 5.10 Patch 3

> Warning: This release updates the database container images from Postgres 12 to Postgres 16, and begins using Wolfi based images. Customers are advised to have a database backup before upgrading! See our [postgres 12 end of life](https://sourcegraph.com/docs/admin/postgres12_end_of_life_notice#postgres-12-end-of-life) notice!
>
> Also be sure to check your deployment type's [upgrade notes](http://sourcegraph.com/docs/admin/updates#instance-specific-procedures)!

## v5.10.3940

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.10.3940)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.10.3940)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.10.3940)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.10.3940)

### Features

#### Security

- introduce UntrustedExternalClient [#2433](https://github.com/sourcegraph/sourcegraph/pull/2433)
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
  Backport 3f079a57978179aa2ad3f310195346a8c574f9ce from #2349

### Fix

#### Database

- do not log DSN secrets when changed [#2434](https://github.com/sourcegraph/sourcegraph/pull/2434)
  - We no longer log the postgresql DSN when it changes. Previously this could contain the secret PGPASSWORD.
  Backport 2bd9c09969fff536c6fb29108656658d3f875047 from #2272

### Reverts

  There were no reverts for this release

{/* RSS={"version":"5.10 Patch 3", "releasedAt": "2024-12-19"} */}


# 5.10 Patch 2

> Warning: This release updates the database container images from Postgres 12 to Postgres 16, and begins using Wolfi based images. Customers are advised to have a database backup before upgrading! See our [postgres 12 end of life](https://sourcegraph.com/docs/admin/postgres12_end_of_life_notice#postgres-12-end-of-life) notice!
>
> Also be sure to check your deployment type's [upgrade notes](http://sourcegraph.com/docs/admin/updates#instance-specific-procedures)!

## v5.10.2832

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.10.2832)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.10.2832)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.10.2832)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.10.2832)

### Features

#### Cody

- update cody web to 0.17.0 version `(PR #2285)`
- update cody web to 0.16.0 version `(PR #2284)`  Backport 964eceae584e4eff56df9711da68fef7047cbc40 from #2254

### Fix

#### Bazel

- syft checksum update `(PR #2218)`

#### Cody

- disable reranking for airgapped instances `(PR #2194)`

#### Release

- Remove `--link` and add optional args env var `(PR #2216)`
  - fix(rel): change `pg_upgrade` behavior to use copy instead of hard links  Backport 13caa807d96dd4b5dd872fec2a38322d1888134a from #2192
- remove -x flag in readiness check on database containers `(PR #2135)`
  - fix(rel): address issue with readiness check outputting passwords to logs.
  Backport 655a739e8e791d7aab1977d2c26543a3a4871809 from #2132

### Chore

#### Ci

- bzlmod migration for rules_syft `(PR #2193)`
  -  Backport fbf92aedbb81f00766d7107015b7697352b5c482 from #1812

### Reverts

  There were no reverts for this release

### Uncategorized

#### Others

- [Backport 5.10.x] Context: switch to Snowball stopwords (#2223) `(PR #2225)`
  - Narrowed down the stopwords list used in Cody context, to fix an issue where we could miss highly relevant files.Backports [https://github.com/sourcegraph/sourcegraph/pull/2223](https://github.com/sourcegraph/sourcegraph/pull/2223)
- [Backport 5.10.x] bugfix: do not load commit history eagerly `(PR #2201)`
  - Fixes a bug where the new web app may consume an outsized amount of backend resources when browsing large repositories.  Backport 79546146e2bfa4e3fcee1a8e825ad48823c8cd77 from #2197
- [Backport 5.10.x] Cody context: clean up resolvers `(PR #2187)`

{/* RSS={"version":"v5.10.2832", "releasedAt": "2024-12-12"} */}


# 5.10 Patch 1

> Warning: This release updates the database container images from Postgres 12 to Postgres 16, and begins using Wolfi based images. Customers are advised to take a database backup before upgrading! See our [Postgres 12 end of life](https://sourcegraph.com/docs/admin/postgres12_end_of_life_notice#postgres-12-end-of-life) notice!
>
> Warning: `automatic` upgrades will require setting the environment variable `SRC_AUTOUPGRADE_IGNORE_DRIFT=true` on the `sourcegraph-frontend` deployment/container.
>
> Also be sure to check your deployment type's [upgrade notes](http://sourcegraph.com/docs/admin/updates#instance-specific-procedures)!

## v5.10.1164

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.10.1164)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.10.1164)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.10.1164)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.10.1164)

### Fix

#### Database

- remove 5.10 deprecation dates on out of band migrations `(PR #1996)`
  - We are removing the deprecation dates on out of band migrations which deprecated in 5.10. This is to unblock MVU and autoupgrades which are encountering a bug with deprecated out of band migrations.  Backport f654dcc9200e2dda2deddc8f98bcd972e6a873fd from #1995

#### Search

- disable zoekt go-git optimization by default `(PR #2051)`
  - Disabled an indexed search optimization which would skip files accidentally (`ZOEKT_DISABLE_GOGIT_OPTIMIZATION=true`).  Backport 34ada948bdcee3d75499c98f4db5c32986943e88 from #2050

### Reverts

  There were no reverts for this release

### Uncategorized

#### Others

- [Backport 5.10.x] oob: Actually run for all tenants `(PR #1994)`

{/* RSS={"version":"v5.10.1164", "releasedAt": "2024-12-03"} */}


# 5.10 Patch 0

> Warning: Admins are advised to upgrade directly to v5.10.1164 circumventing this release.
>
> Warning: This release updates the database container images from Postgres 12 to Postgres 16, and begins using Wolfi based images. Customers are advised to have a database backup before upgrading! See our [postgres 12 end of life](https://sourcegraph.com/docs/admin/postgres12_end_of_life_notice#postgres-12-end-of-life) notice!
>
> Warning: `automatic` and migrator `upgrade` command will not work for this release, please upgrade directly to `v5.10.1164`, or to a 5.9 version and conduct a standard upgrade using migrator's default `up` command!
>
> Also be sure to check your deployment type's [upgrade notes](http://sourcegraph.com/docs/admin/updates#instance-specific-procedures)!

## v5.10.0

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.10.0)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.10.0)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.10.0)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.10.0)

### Features

#### Autoedit

- add autoedit model to use chat completions end point `(PR #1809)`

#### Ci

- move rules_pkg to MODULE.bazel `(PR #1660)`

#### Cody

- fix ootb prompt details page `(PR #1902)`
- update cody web to 0.14.0 version `(PR #1895)`
- add support for out-of-the-box prompts `(PR #1726)`
- support openai predicted outputs `(PR #1625)`
  - Cody Gateway: add support for OpeanAI predicted outputs
- added `systemPreInstruction` (CODY-4032) `(PR #1402)`
  - adds `systemPreInstruction` to the `modelConfiguration` key in site admin config that allows injecting a prelude prompt into every chat request for an enterprise

#### Cody-Gateway

- add gpt-4o-mini model `(PR #1591)`
  - Cody Gateway: add `gpt-4o-mini` to Cody Gateway allow list
  - Cody Gateway: add `gpt-4o-mini` to DotCom models list

#### Conf/Deploy

- add 'workspace' deploy type `(PR #1710)`

#### Dev

- use svelte-dev for multi-tenant `(PR #1843)`
- add alias 'sg bz cf' for 'sg bz configure' `(PR #1827)`
- add '-open=false' option for 'sg sams login' `(PR #1498)`
- Adding sg command to request Entitle bundles `(PR #1370)`

#### Gateway

- Add `/models.json` endpoint (PRIME-601) `(PR #1728)`
- Disable flagged model blocking for enterprise (PRIME-602, PRIME-605) `(PR #1659)`

#### Github

- add client ID support for GitHub App authentication `(PR #1622)`
  - The GitHub app authentication package now supports authenticating a GitHub app via the OAuth client ID following the announcement of [https://github.blog/changelog/2024-05-01-github-apps-can-now-use-the-client-id-to-fetch-installation-tokens/](https://github.blog/changelog/2024-05-01-github-apps-can-now-use-the-client-id-to-fetch-installation-tokens/)

#### Graphql

- add support for reading GitHub App Installation repos from GitHub REST API `(PR #1711)`
  - A new GraphQL query, `GithubAppRepositoriesForInstallation`, has been added that provides a paginated list of all the GitHub repositories that are accessible to the GitHub app with the provided installation id.
- add endpoint for getting github app installations scoped by user `(PR #1606)`
  - A new graphql endpoint has been added, GithubAppInstallationsForUser, that returns installation information for the global GitHub multi tenant app when running in multitenant mode.

#### Internal/Github

- add pagination support and test for GetUserInstallations `(PR #1572)`
  - The Github API client's [GetUserInstallations](https://docs.github.com/en/rest/reference/apps#list-app-installations-accessible-to-the-user-access-token) route, which lists of GitHub App installations the user has access to, now has pagination support.

#### Lib/Cloudapi

- add support for workload identity to auth roundtripper `(PR #1623)`

#### Local

- add bazel mod tidy to `sg bazel configure` step `(PR #1656)`

#### Msp

- apply default max DB conns of 8*CPU `(PR #1394)`

#### Msp/Cloudsql

- annotate cloudsql trace spans with target database `(PR #1398)`

#### Mt-Router

- add support for SOAP redirect `(PR #1510)`

#### Multi-Tenant

- redirect to workspaces/join on user-not-found `(PR #1604)`

#### Multitenant

- Rework GraphQL resolvers and add back App installation link `(PR #1819)`
- Add temporary UI for workspace repository management `(PR #1791)`
- add helper routine for instantiating github app from multitenant credentials `(PR #1758)`
  - A simple helper routine to the multitenantenv package that automatically populates a github app struct with the provided validated credentials.
- use default cookie for github app oauth login `(PR #1571)`
  - The routing logic for multitenant mode now has a new route that uses the "last seen tenant" cookie to route github app login authorization callbacks to the appropriate tenant.

#### Release

- add pg16 and pg16 codeinsights to published images `(PR #1731)`
  - feat(rel): Add Postgresql 16 and Postgresql 16 codeinsights images to published image list.
- add pg 16 codeinsights entrypoint and tests `(PR #1730)`
  - feat(rel): Add self updating to Postgres 16 codeinsights db image.
- add pg 16 entrypoint and tests `(PR #1718)`
  - feat(rel): Add self updating to Postgres 16 container image.
- Add wolfi postgres 16 codeinsights-db base image `(PR #1619)`
  - feat(rel): Add Postgres 16 CodeInsights Wolfi image
- Add wolfi postgres 16 base image `(PR #1617)`
  - feat(rel): Add Postgres 16 Wolfi image

#### Release

- Handle postgres version upgrades in upgrade test `(PR #1918)`
  - refactor upgradetest
  - introduce proper handling of the postgres version upgrade
 Backport 9ccdf4200e3e08cea56bffe5779ca8a6cda2909c from #1894

#### Search

- include file paths in reranker items `(PR #1866)`
  - Cody context now incorporates filename information in reranking, improving context quality when the reranker is enabled.
- (new web ui) Add 'open in code host' button to repo root and folder pages `(PR #1776)`
- (new web ui) Copy URL to clipboard when clicking 'Permalink' `(PR #1774)`
- (new web ui) Show file/folder name in title instead of full path `(PR #1735)`
- (new web ui) Add survey toast `(PR #1453)`
- (new web ui) Show loading indicator when navigating up the file tree `(PR #1465)`

#### Sg

- add workspaces common operations `(PR #1845)`
  - support `get`, `list`, and `delete` workspaces to `sg`

#### Source

- Allow GitHub code host connections to specify an external account as the authenticator `(PR #1842)`
- multitenant: add worker job for inserting github multitenant app credentials `(PR #1668)`
  - A new worker job has been added that updates the database with the credentials for the global github app when running in multitenant mode.

#### Telemetry

- Add request client name and version to telemetry gateway payload `(PR #1607)`

#### Tenant/Reconciler

- report backpressure when tenants > 0.85*targetMaxTenants `(PR #1719)`
- exclude DESTROY_SUCCESS from global reconcile `(PR #1534)`

#### Workspaces

- check basic email validity to create invite `(PR #1849)`
- always set displayName=name if displayName is not set `(PR #1838)`
- email all workspace admins when a user joins a workspace `(PR #1824)`
- add CheckWorkspaceName RPC `(PR #1822)`
- Initial iteration of new creation flow `(PR #1806)`
- check billing seats when joining and inviting `(PR #1770)`
- always apply DEFAULT_WORKSPACE_INSTANCE_CLASS on workspace create `(PR #1763)`
- accept instance class `(PR #1752)`
- list eligible-to-join workspaces in UI `(PR #1672)`
- explicit invites POC `(PR #1624)`
- error-log illegal state transitions for Sentry `(PR #1616)`
- list includes workpsaces a user can join via open invite `(PR #1586)`
- make membership limits configurable `(PR #1584)`
- name, display name, and open invite email domain blocklists `(PR #1539)`
- free up assigned workspace slot when workspace is DESTROY_SUCCESS `(PR #1535)`
- prevent management API from reading workspaces in deletion state `(PR #1508)`
- prune iam store on deletion `(PR #1504)`
- implement router pruning, add 'pruned_router_at', 'pruned_iam_at' `(PR #1480)`
- delete and reconcile routes `(PR #1440)`

#### Workspaces/Blocklists

- improve heuristics and errors `(PR #1801)`

#### Workspaces/Instances

- add UNAVAILABLE, CAPACITY_PRESSURE states `(PR #1712)`

#### Workspaces/Integrations

- provide workspace uri `(PR #1477)`

#### Workspaces/Web

- as-you-type name validation POC `(PR #1858)`

#### Others

- switch to buildkite for nightly release pipeline `(PR #1690)`
  - N/A
- add new telemetry v2 events for server side batch changes `(PR #1666)`
- add events for interactions with search input toggle buttons `(PR #1469)`
- add events for codenav actions `(PR #1441)`
- make filters sidebar collapsible `(PR #1437)`
  - Search filters sidebar is now collapsible
- add dynamic filters and aggregation for repo metadata and topics `(PR #1420)`
  - Added dynamic filters and the ability to aggregate by repo metadata and repo topic
- render mdx as markdown `(PR #1392)`
  - Render .mdx files as markdown

### Fix

#### Batch Changes

- titles now break over multiple lines if they are too long `(PR #1582)`
  - fix(batches): titles now break over multiple lines if they are too long
- do not ignore bool env var parsing error `(PR #1537)`

#### Client

- address pnpm lint:js:web issues and add job in CI `(PR #1520)`

#### Code Intelligence

- Align repo batch settings between syntactic and precise indexing `(PR #1663)`
- Fix wrong offset in policy iteration `(PR #1546)`

#### Cody

- use models from model config for PLG chat `(PR #1870)`
- sync allowed models in dotcom user rate limits with models.json `(PR #1864)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- filter allowed models based on subscription tier `(PR #1636)`

#### Database

- drop unique slug contraint from github app table `(PR #1689)`
  - The github_apps table has removed an erroneous unique constraint that accidentally incorporated an app's slug (which is mutable) as part of the unique identifier for an app.

#### Database

- update generated squash and schemas `(PR #1917)`

#### Dev

- fix kill pubsubemulator `(PR #1850)`
- correctly pick up error message from 'sg sams login' `(PR #1482)`

#### Enterpriseportal

- allow list to accept display name query of 2 characters `(PR #1603)`

#### Gateway

- add blocked phrase if request was blocked due to flagged models list (PRIME-603) `(PR #1670)`
- Make model cost a pointer (CODY-4007) `(PR #1427)`

#### Graphql

- refactor getGithubAppFromEnvvar to use multitenantEnv.Config.AsGithubApp `(PR #1767)`
  - The logic in the new multitenant GraphQL resolvers has been reworked to use the new helper methods introduced in the Multitenant GitHub app configuration logic introduced in [https://app.graphite.dev/github/pr/sourcegraph/sourcegraph/1758/](https://app.graphite.dev/github/pr/sourcegraph/sourcegraph/1758/).

#### Insights

- Fix incorrect line counts in non-default config `(PR #1517)`
  - Code insights should show correct line counts when enhanced language detection is turned off (note: this setting is on by default).

#### Local

- display external env overrides when displaying environment variables `(PR #1595)`
- sg - fix images query to point to correct rule `(PR #1430)`

#### Release

- fix oob migrations hanging `(PR #1959)`
  - NA
  Backport a943412a99852332f921b52a0ee3179dc3331d20 from #1958
- add vacuum after reindex in Postgres upgrade script `(PR #1779)`
  - fix(rel): Add vacuum to Postgres upgrade process
- install `sg` in the nightly pipeline GHA `(PR #1675)`
  - N/A

#### Release

- correct views drift in postgres 16 `(PR #1878)`
  - add migrations to handle database drift caused during postgres 12 to postgres 16 upgrade
- fix drift check in local upgradetest `(PR #1832)`
  - Fix bug in local upgrade test preventing final stage drift check via private monorepo

#### Search

- consistently marshal SearchTypeRegex as regexp `(PR #1919)`
  - We sometimes would emit `patternType:regex` instead of `patternType:regexp`. We now always do regexp as well as treating regex as an alias for regexp.
  Backport a095b39ac39cfcbe3526ecf85ed6d50cb5fa3d9d from #1808
- Executors on Kubernetes: propagate user and group from Executor env vars to batch change job pod `(PR #1863)`
  - The environment variables `KUBERNETES_RUN_AS_USER` and `KUBERNETES_RUN_AS_GROUP` contribute to the Job `PodSpec`'s `SecurityContext`.
  - The default value for those variables is `-1`, which could cause errors with some Kubernetes clusters.
- (new web app) Only update user activity data once on load `(PR #1797)`
- (new web ui) Respect 'window.context.disableFeedbackSurvey' flag `(PR #1778)`
- (search input) Treat not, and, or as keywords regardless of case `(PR #1733)`
- (new web ui) Fix dimensions of line selection marker `(PR #1417)`
- (new web ui) Add rollover effect to RadioButtonGroup `(PR #1416)`
- (new web ui) Fix duplicate lint suggestion insertion `(PR #1413)`
- (new web ui) Remove unintentional vertical scrollbars `(PR #1411)`
- (new web ui) Only show specific repo menu items when features are enabled `(PR #1401)`

#### Security

- Do not expand env vars in executor logs `(PR #1811)`
  - This change reduces the risk of secrets being emitted in executor logs even if there are bugs in the secret redaction logic.

#### Sg

- remove noop -d declaration for psql `(PR #1455)`
- specify postgres database for psql commands `(PR #1450)`

#### Source

- p4-fusion now decodes encode file paths from Perforce `(PR #1347)`
  - When cloning Perforce depots, Sourcegraph will now decode encoded paths correctly (paths that include characters like `@` and `#`)

#### Tenant/Reconciler

- do not check dormancy if still in PROVISION states, only check if needed `(PR #1605)`
- on getTenantErr, report destroy state if in destroy state `(PR #1563)`

#### Workspaces

- properly represent workspace state to management API `(PR #1816)`
- fix DESTROY_PENDING proto adapter, improve handling of unknown states `(PR #1814)`
- improve CreateWorkspace resilience `(PR #1773)`
- remove broken down-migration statements `(PR #1754)`
- support creating workspaces over API `(PR #1714)`
- do not list all workspaces if user has no memberships `(PR #1671)`
- tidy up email-disabled error log `(PR #1667)`

#### Workspacesreconciler

- fix double-counting of checked workspaces `(PR #1753)`

#### Others

- Prompt page tweaks `(PR #1899)`
- revision picker growth `(PR #1875)`
- more contrast updates `(PR #1871)`
- Reranker: recreate from config on every call `(PR #1865)`
- prompt library visual updates `(PR #1852)`
- Use standard protojson library for reducing memory `(PR #1846)`
- Increase contrast everywhere `(PR #1840)`
- make owner nullable in prompts `(PR #1746)`
- only retry queries `(PR #1706)`
- Reranker: listen to config changes, do not mutate config `(PR #1705)`
- retry graphql on 502 errors `(PR #1683)`
  - fix(web): retry graphql requests on network errors
- styling changes to explore panel and badges `(PR #1528)`
- increase contrast of highlighted code background and line numbers in selected area `(PR #508)`

### Chore

#### Ci

- container structure test bzlmod migration `(PR #1818)`
- migrate protobuf and rules_proto rules to bzlmod `(PR #1749)`
- move buildifier prebuilt to bzlmod `(PR #1709)`
- increase buildifier timeout to 6m `(PR #1658)`
- move bazel_skylib to bzlmod `(PR #1654)`
- bazel - remove build_tests_only flag for db tests `(PR #1610)`
- bazel - add config settings to switch between pg-12 and pg-16 binaries `(PR #1601)`
- refactor bazel migrations `(PR #1583)`
- update github workflow for pg-12 and pg-16 package variants `(PR #1580)`
- upgrade aspect bazel lib `(PR #1425)`
- Upgrade to latest rules proto grpc `(PR #1424)`
- enable db tests task to run on ci agents with postgres 16 `(PR #1293)`
- upgrade rules_pkg `(PR #976)`
- upgrade aspect cli `(PR #975)`

#### Code Intelligence

- Remove unused return value & pass TraceLogger `(PR #1551)`
- Enable exhaustruct for more subfolders (part 2) `(PR #1547)`
- Document why RepositoryID field is nil `(PR #1545)`
- Add helper types for relationships `(PR #1542)`

#### Dev

- Delete tracking-issue package `(PR #1556)`
- Add iterator helper for pagination `(PR #1555)`
- Fix links to sg monorepo in Markdown `(PR #1554)`
- Add more helper functions to iterext `(PR #1549)`
- Enable exhaustruct for more subfolders `(PR #1544)`
- Add helper package for property-based testing `(PR #1540)`
- Introduce helper package for iter.Seq `(PR #1522)`
- Fix links to sg monorepo `(PR #1519)`
- Simplify language detection code in inventory `(PR #1518)`
- Flip polarity of boolean for language detection `(PR #1516)`
- Use a lazyFile type to consolidate lazy file content fetching `(PR #1515)`
- Rename functions for clarity `(PR #1514)`
- Remove direct usages of enry.IsVendor `(PR #1513)`
- Simplify sorting logic `(PR #1512)`
- Rename type Lang -> LanguageStats `(PR #1511)`
- Migrate from sync.WaitGroup to conc APIs `(PR #1495)`
- Fix warning about missing integrity field `(PR #1494)`
- Update for loops for newer syntax `(PR #1488)`
- Factor out offset & limit logic `(PR #1486)`
- Switch to alternate orderedmap library `(PR #1414)`
- Clarify docs & naming in debugserver code `(PR #1384)`

#### Dev/Mt-Router

- silence cache miss on default `(PR #1565)`

#### Dotcom

- rename 'cody services' to just 'cody gateway' `(PR #1466)`

#### Frontend

- Store model config in global var `(PR #1805)`

#### Gateway

- A few small docs fixes `(PR #1751)`
- Make provider type more specific `(PR #1750)`

#### Local

- small improvements to sg entitle `(PR #1794)`

#### Msp/Iam

- suggest standard IAM_MAX_DB_CONNS as env var `(PR #1499)`

#### Release

- remove postgres-12 wolfi from published images `(PR #1737)`
  - chore(rel): remove unused Postgres 12 images
- remove appliance from published images and codebase `(PR #1732)`
  - chore(rel): remove appliance from published images

#### Release

- remove check against latest full version in `--post-release-version` code path `(PR #1585)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)

#### Search

- (new web ui) Improve search home page SG logo rendering `(PR #1813)`
- add NodeJS 20 to the Bundled Executor image `(PR #1569)`
- Update search web app title and description for SEO on dotcom `(PR #1509)`
- Add JDK 17 and 21 to the Bundled Executor image `(PR #1502)`
- (new web ui) Remove beta badge from search progress popover `(PR #1418)`
- update CPU and MEM panels for zoekt `(PR #1368)`
  - We have updated the CPU and MEM monitoring panels for Zoekt on Grafana. The new panels reduce redundancy and provide more insight into MEM distribution.

#### Source

- simplify oauth middleware `(PR #1876)`
- Update the gitserver image lockfile to contain the latest p4-fusion `(PR #1410)`
- Default perforce changelist mapping to enabled `(PR #1376)`

#### Telemetry

- align billing metadata values with 'sourcegraph/cody' `(PR #1396)`

#### Telemetry/Geolocation

- update DB-IP Lite database `(PR #1468)`
  - The local geolocation inference database used in telemetry and audit logs has been updated.

#### Telemetrygateway

- bump slow-request threshold `(PR #1647)`

#### Tenant/Reconciler

- add some additional diagnostics `(PR #1795)`

#### Workspaces

- include longer s&p500 names for fuzzy matching `(PR #1844)`
- make unexpected errors more friendly `(PR #1821)`
- add spans on write interactions `(PR #1807)`
- instantiate large blocklists once in store `(PR #1562)`

#### Workspaces/Web

- use unified client constructor `(PR #1828)`

#### Others

- Rename method to indicate lack of redaction clearly `(PR #1790)`
- Reorder fields in executor Config `(PR #1785)`
- Remove custom Set type `(PR #1742)`
- Rename Set.Values() -> ValuesNonDet() for clarity `(PR #1741)`
- Avoid materializing Set Values() just for length `(PR #1739)`
- Add env var to disable precise & syntactic `(PR #1707)`
- Bump autoindexing image SHAs `(PR #1703)`
- Move CodyGatewayRateLimit calculation to where it's used `(PR #1693)`
- remove env lock mechanism `(PR #1593)`
  - fix(dev): remove env.Get lock that could cause a runtime panic
- update event names `(PR #1500)`
- remove robert from many CODENOTIFYs `(PR #1421)`
- update new search events to make them easier to use `(PR #1395)`

### Refactor

#### Local

- move reset-pg to internal/db `(PR #1573)`

### Reverts

- Revert "chore/dev: upgrade aspect_bazel_lib to 2.9.4 (#1713)" `(PR #1713)`

### Uncategorized

#### Others

- [Backport 5.10.x] Revert "chore(source): simplify oauth middleware" `(PR #1928)`
- githubapp: Expose monolith GitHub app ClientID `(PR #1904)`
- pnpm: Remove leftover appliance links in workspace `(PR #1900)`
- core: Fixup pnpm lockfile `(PR #1886)`
- tenant: Hide unlink button for SAMS external accounts `(PR #1885)`
- auth: Hide unlink button for external accounts that cannot be unlinked `(PR #1884)`
- svelte: Correctly hide navbar entries `(PR #1883)`
- svelte: Add back settings link `(PR #1882)`
- workspaces/billing: attach metadata and context without cancel whenever possible `(PR #1881)`
- web: respect `expanded` in the search results URL `(PR #1880)`
  - Fixed an issue where searches from saved URLs may now show aggregations by default
- add timeout to gateway calls `(PR #1879)`
- workspaces: Align styling for join page `(PR #1860)`
- workspaces: Add tables for listing workspaces `(PR #1857)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- workspaces: Slightly tweak style `(PR #1851)`
- workspaces: Directly link to installation target `(PR #1848)`
- tenant: Suppress some irrelevant missing_context pprof traces `(PR #1847)`
- Workspaces: Fix workspace picker rendering in React `(PR #1841)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- fix permissions connection resolver ordering `(PR #1839)`
- workspaces: Add seat selector on plan page `(PR #1835)`
- workspaces/billing: create RPC for purchasing seats `(PR #1831)`
- workspaces/billing: extract subscription attribute computation into a `Plan` helper `(PR #1830)`
- workspaces: Add updated workspace pickers for tenant `(PR #1829)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- workspaces: Add field to pre-purchase extra seats `(PR #1826)`
- workspaces/billing: implement periodic workers for subscription renewal `(PR #1823)`
- auth: Fix background contexts in validate authz provider `(PR #1802)`
- redispool: support more configuration options `(PR #1799)`
- workspaces/billing: add tests to `cmd/workspaces/internal/billing` `(PR #1786)`
- workspaces/billing: update test for `ManagementService.CreateWorkspace` `(PR #1784)`
- workspaces/billing: add database tests for customers `(PR #1783)`
- workspaces/billing: add database tests for transactions `(PR #1782)`
- Require `X-Requested-With` for Cody API (CODY-4209) `(PR #1781)`
  - `X-Requested-With` is now a required HTTP header for Cody API calls
- Context: narrow down stopwords list `(PR #1780)`
- workspaces/billing: ignore invoices that are not for the current instance `(PR #1777)`
- workspaces/billing: support soft-deleting subscriptions `(PR #1772)`
- feature/internal: upsert github credentials on tenant creation `(PR #1769)`
  - The multitenant reconciler now proactively inserts the credentials for the shared multitenant GitHub app whenever a new tenant is created.
- lib/cloudapi: add mt instance type `(PR #1766)`
- tenant: Add configuration for MT GitHub App to localdev `(PR #1756)`
- Seed builtin prompts `(PR #1755)`
  - Prompts including "Document Code", "Explain Code", "Generate Unit Tests", "Find Code Smells"
- tenant: Enable onebox on tenant creation `(PR #1748)`
- Onebox: introduce 'nls' patterntype `(PR #1744)`
- workspaces/billing: implement Stripe webhook handler `(PR #1740)`
- cody-gateway: update deployment id for model `(PR #1729)`
- workspaces/billing: implement seat purchase and consumption `(PR #1723)`
- localdev: Disable precise, syntactic codeintel in multitenant mode `(PR #1720)`
- workspaces/billing: use the "correct" way to list customer payment methods `(PR #1717)`
- `sg start sveltekit-minimal` for quickly running the new UI `(PR #1702)`
- conf: Move more types to conftypes `(PR #1692)`
- Remove experimental admin onboarding v2 `(PR #1691)`
- telemetry: Implement telemetry exports for workspaces `(PR #1677)`
- autoedit: add speculative decoding `(PR #1673)`
  - autoedit: Add speculative decoding support from fireworks
- fix `marketingTracking` sending null `(PR #1669)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- Prompts: fix prompt name validation and prompts migration  `(PR #1664)`
- Add GraphQL resolvers to read and set a list of repositories for a GH App installation ID `(PR #1657)`
- fixup: remove Git conflict marks in `sg.config.yaml` `(PR #1649)`
- Require prompt field before successful submission `(PR #1639)`
- Add builtin prompts field to prompts `(PR #1633)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- Zoekt: refactor memory dashboards `(PR #1618)`
- workspaces: add billing prototype for subscription creation `(PR #1611)`
- admin: Update report an issue link `(PR #1608)`
- change default autoedit model `(PR #1589)`
- feat(cloud) sg cloud eph deploy: support ms env `(PR #1581)`
- add Cody.promptLibrary telemetry `(PR #1568)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- worker: Group tasks by purpose `(PR #1566)`
- Improve policy iterator tests to not rely on SQL for insertion `(PR #1560)`
- repoupdater: Fix slow scheduling of cloned->uncloned repos `(PR #1552)`
- repoupdater: Fix reporting of background routines `(PR #1550)`
- Update Prompts Library UI (list page) `(PR #1548)`
- Update prompt detail header UI `(PR #1538)`
- Context: remove experimental intent routing `(PR #1536)`
- Add 'recommended' checkbox to new creation UI. `(PR #1531)`
- dormancy: Also fall asleep tenants that never see traffic `(PR #1530)`
- Fix reranker not being applied `(PR #1529)`
- sg: Fix local dev pguser setup `(PR #1506)`
- Context: ensure we propagate timeouts and missing repos `(PR #1505)`
- Make Visual Studio Experimental `(PR #1503)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- Context: always use more items for reranker `(PR #1476)`
- Remove insert prompt mode `(PR #1475)`
- Add missing Cody Web Alert CSS variable override `(PR #1474)`
- repoupdater: Fix no rows returned error `(PR #1472)`
- add autoedits to cody gateway `(PR #1459)`
- ci: bump go-mod-tidy step timeout `(PR #1452)`
- Add commands to prompts migration `(PR #1449)`
- repoupdater: Speed up repo_update_job dequeues `(PR #1448)`
- repoupdater: Clean up metrics `(PR #1447)`
- repoupdater: Speed up and simplify not fetched metric `(PR #1446)`
- migration: Checkpoint new repo_update_jobs migration `(PR #1445)`
- gomod: bump Zoekt for query perf fix `(PR #1438)`
- Implement prompt detail page re-design `(PR #1423)`
  - Re-designed prompt detail page.
- Add page faults to Zoekt memory metrics `(PR #1422)`
- chore/source Update src-cli version to 5.8.2 `(PR #1415)`
  - chore/source Update src-cli version to 5.8.2
- siteadmin: Reset pagination cursors after filter change `(PR #1404)`
- bugfix: fix settings link `(PR #1393)`
- gomod: bump Zoekt for go-git optimization `(PR #1391)`
- Update Marketing URLs in the site footer links `(PR #1390)`
- Soft delete prompts `(PR #1386)`
- Widen blocked phrases, but only confine blocked phrases to expensive (aka flagged) models `(PR #1344)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
- repoupdater: Drop support for gitUpdateInterval `(PR #1339)`
  - The site config setting `gitUpdateInterval` has been deprecated and removed. We are removing it in favor of smarter heuristics like webhooks, user traffic, and repo staleness.
- repoupdater: Remove total from schedule and update queue state `(PR #1338)`
- Add system workspace admin role `(PR #1327)`
- Add syntactic worker to images so it gets updated in helm charts `(PR #1323)`
- feature/source: adjust exclude definition in github schema to disallow using name, id with other filter conditions `(PR #1250)`
  - The github code host connection schema for `exclude` has been updated to enforce that the name and id fields can't be combined with any other fields.
- Add gitSSHCipher for git code hosts `(PR #1175)`
- RFC: Dormancy and tenant states `(PR #756)`
- web telemetry: update `marketingTracking` to retrieve latest cookies set on web `(PR #460)`

### Untracked

The following PRs were merged onto the previous release branch but could not be automatically mapped to a corresponding commit in this release:

- Fix wrong offset in policy iteration `(PR #1559)`
- Release: Prep stitched migration graph for release (#1388) `(PR #1389)`
  - n/a

{/* RSS={"version":"v5.10.0", "releasedAt": "2024-11-27"} */}


# 5.9 Patch 3

## v5.9.1590

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.9.1590)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.9.1590)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.9.1590)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.9.1590)

### Fix

#### Code Intelligence

- Fix wrong offset in policy iteration `(PR #1559)`

#### Cody

- fix broken homepage redirect for cody only plans `(PR #1626)`
  - When using an instance with a Cody-only license, accessing the home page now correctly redirects you to /cody/dashboard, instead of a non-existent /cody page.
  Backport a4cb5a0723bad18e1c215d81231db457d1abfbdb from #1621

#### Search

- (new web ui) Disable persistence for history/explore panel `(PR #1614)`

### Chore

#### Release

- remove extra v identifier for version in artifact exporter `(PR #1594)`
  - OPTIONAL; info at [https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c](https://www.notion.so/sourcegraph/Writing-a-changelog-entry-dd997f411d524caabf0d8d38a24a878c)
  Backport c4b838103ce2f71e7591ade720e8bdf17f9a5b39 from #1490

### Reverts

  There were no reverts for this release

### Uncategorized

#### Others

- [Backport 5.9.x] azure: Add support for repositoryPathPattern `(PR #1629)`
  - Added support for the `repositoryPathPattern` property to Azure DevOps code host connections.
  - Fixed an issue where Azure DevOps repo names included a port number - aligning with other code host connection implementations  Backport 762bd89a12825ff05de98d9c2d8adfcf1ef5bf4a from #1543

{/* RSS={"version":"v5.9.1590", "releasedAt": "2024-11-13"} */}


# 5.9 Patch 2

## v5.9.347

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.9.347)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.9.347)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.9.347)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.9.347)

### Fix

#### Dev

- hoist env vars init to avoid repo-updater panic `(PR #1527)`

### Reverts

  There were no reverts for this release

{/* RSS={"version":"v5.9.347", "releasedAt": "2024-11-06"} */}


# 5.9 Patch 1

## v5.9.45

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.9.45)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.9.45)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.9.45)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.9.45)

### Reverts

  There were no reverts for this release

### Uncategorized

#### Others

- "Add syntactic worker to images so it gets updated in helm charts"" `(PR #1483)`

{/* RSS={"version":"v5.9.45", "releasedAt": "2024-11-05"} */}


# 5.9 Patch 0

## v5.9.0

- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.9.0)

- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.9.0)

- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.9.0)

- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.9.0)

### Features

#### Api

- Added a better error message for 429 errors for `/.api/cody/completions` (CODY-4097) `(PR #1380)`

#### Audit

- add tenant to audit logs, fix log stack `(PR #960)`

#### Batch Changes

- show name of additional fields that cause errors `(PR #799)`
  - feat(batches): show name of additional fields that cause errors

#### Ci

- generate frozen files as part of stich_migration_graph generation `(PR #957)`
- record Test infrastructure failures `(PR #884)`
  - add library that writes to TEST_INFRASTRUCTURE_FAILURE_FILE if it is defined for test failures

#### Cloud

- allow monolithsams instances to have no conf auth providers `(PR #1247)`
- add support to override target managed service endpoints `(PR #1238)`
- add support to override license generation public key from cloud site config `(PR #1193)`

#### Code Intelligence

- Syntactic indexing grafana monitoring dashboard `(PR #1263)`

#### Cody

- add more API docs content `(PR #1378)`
- add CLI tool to compute PCW `(PR #1349)`
- Add Claude 3.5 Sonnet (Latest) & Claude 3 Opus (Latest) `(PR #1244)`
- add Cody Audit Log `(PR #1232)`
- add cody audit log table and store `(PR #1182)`
- Expose token usage in the LLM API `(PR #1070)`
  - The `/.api/completions/stream` API now includes used input/output tokens and the upstream model name in the response body when using the query parameter `api-version=5` or higher. Does not apply to: Vertex Anthropic, Azure OpenAI (mo model name, and no token usage in streaming response), Gemini (no model name in streaming response)
  - LLM chat completions now support `stream: false` when using Azure OpenAI and OpenAI-compatible providers.
- update telemetry feature prefix for Cody API `(PR #1023)`
- add embedded API docs via OpenAPI/Redocly `(PR #1014)`
  - New OpenAPI API docs within the instance at the URL `$SRC_ENDPOINT/api/openapi/public`. Alternatively, reach the page at "User > Settings > OpenAPI Reference".
- add basic telemetry recording for Cody API `(PR #943)`
- add support to format raw API responses for Cody `(PR #877)`
  - The raw HTTP API now accepts the query paramter `format=cody` or header `Accept: application/cody` to render files and directories as context items for Cody. Example request path: `/github.com/sourcegraph/cody/-/raw/agent/src/index.ts?format=cody`.

#### Cody-Gateway

- add new claude-3-5-haiku-latest model `(PR #1471)`
Cody Gateway: add new claude-3-5-haiku-latest dotcom models list  Backport 11e7481ba3c810ae5b47d32b8cf32066e2f0b2bb from #1470
- deprecate old claude 3.5 sonnet `(PR #1248)`

#### Dev

- add externalSecret support for commandsets `(PR #1027)`
- sg sams login and cookie-less workspace creation `(PR #913)`

#### Graphql

- upload graphql schemas to GCS bucket `(PR #1245)`

#### Internal/Requestclient

- have HTTP middleware populate all response headers with observed X-Forwarded-For and calculated IP for debugging purposes `(PR #524)`
  - All of Sourcegraph's HTTP responses now contain two new headers for easier debugging purposes.
- `Observed-X-Forwarded-For`: echos the `X-Forwarded-For` header
that we observed on the user's incoming request
- `Observed-Calculated-IP-From-Forwarded-For`: indicates the IP address that we derived from the user's `X-Forwarded-For` header

#### Local

- use pending spinner for build waiting in cloud ephemeral `(PR #1039)`
- add format for displaying env `(PR #918)`

#### Monitoring

- set decimals to 1 for standard heatmap `(PR #1361)`

#### Monolithsams

- load SAMS provider and creds from env `(PR #1024)`

#### Msp

- package 'auditlog' `(PR #1223)`

#### Msp/Pg

- updated o11y for pool acquire, add overrides for pgxpool.Config `(PR #1375)`

#### Search

- (new web ui) Show loading feedback for hovercards `(PR #1239)`
- (new web ui) Add ability so switch search scope in fuzzy finder `(PR #1201)`
- (new web ui) Make view modes available when opening a file at a commit `(PR #1090)`
- (new web ui) Render relative images in rich text documents `(PR #841)`

#### Sg

- make workspaces endpoint configurable `(PR #998)`
- implement show-env flag `(PR #883)`

#### Site Admin

- site config 'telemetry: \{ disableLocalEventLogs \}' to disable event_logs `(PR #1275)`
  - Long-term local retention of user telemetry as 'event logs' can now be disabled entirely via the `telemetry: { disableLocalEventLogs }` site configuration.

#### Sub_repo_perms

- add conditional logging for seeing if sub_repo_permisisons are working `(PR #673)`
  - The sub repository permissions implementation now emits logs that describe the rules that were evaluated for a given request whenever tracing is enabled. (We limit these logs for only when tracing is enabled since they can be quite verbose).

#### Telemetry

- Log estimated LLM cost telemetry (CODY-4007) `(PR #1312)`
  - Adds cost estimates to the ModelConfiguration returned by `.api/llm/supported-models.json`
  - Adds `llmTokenUsageCostEstimate` telemetry value with estimates of each requests LLM cost in pennies
- Add check for PGDATASOURCE `(PR #1281)`
- Add source.server.server_client.user_agent to telemetry payload `(PR #1120)`
  - Add the sourcegraph API client user-agent to telemetry payload types under `source.server.server_client.user_agent`.
- check for external dbs `(PR #1083)`
- propagate new x-sourcegraph-api-client-* headers to request clients `(PR #1025)`
  - Propagates new X-Sourcegraph-API-Client-Name and X-Sourcegraph-API-Client-Version headers to request clients

#### Telemetry-Gateway

- improve logging on processing done `(PR #1252)`

#### Telemetrygateway

- implement publishusermetadata RPC `(PR #1095)`
- spec PublishInstanceUserMetadata and pubsub format `(PR #1053)`

#### Telemetrygatewayexporter

- log export duration, use better duration buckets `(PR #1305)`

#### Tenant/Reconciler

- full membership reconcile `(PR #953)`
- handle tenant-exists, new-tenant, and error combination paths `(PR #895)`

#### Worker

- delete legacy event_logs exporter `(PR #859)`

#### Worker/Telemetrygatewayexporter

- opt-in user metadata exporter `(PR #1096)`

#### Workspaces

- notify user state updates `(PR #1316)`
- allow join-by-email to be provided on creation `(PR #1280)`
- add management GetWorkspace that allows view-by-email-domain `(PR #1277)`
- guard against excessive join-workspaces `(PR #1251)`
- restrict memberships/admins before allowing workspace creation `(PR #1212)`
- join by email domain POC `(PR #1162)`
- configure join by email domains `(PR #1158)`
- only recently seen instances are candidates for hosting workspace `(PR #1031)`
- ban 'default' as a workspace name `(PR #992)`
- forbid 'src-'-prefix workspace names `(PR #920)`
- refactor workspace states with reconcile and dormancy `(PR #819)`

#### Workspaces/Management

- always return roles `(PR #1358)`
- provide workspace URI `(PR #1055)`

#### Workspacesreconciler

- add WORKSPACESRECONCILER_INSTANCE_STATE_OVERRIDE and 'AT_CAPACITY' state `(PR #1297)`
- global periodic reconciler `(PR #997)`

#### Others

- surface result precision in the explore panel `(PR #1359)`
- more complete search backend events `(PR #1257)`
- add embedded file snippet page `(PR #1196)`
  - Added embeddable page for file snippets
- add embedded file snippet component `(PR #1122)`
- add search aggregations to svelte webapp `(PR #1093)`

### Fix

#### Api-Docs

- Added OpenAPI Urls to static page info `(PR #1379)`

#### Batch Changes

- enable request splitting by default `(PR #1229)`
  - fix(batches): enable request splitting by default
- handle spec being nil for suffix salt `(PR #1228)`
  - fix(batches): handle spec being nil for suffix salt
- enable GQL request splitting via BATCH_CHANGES_REQUEST_SPLITTING `(PR #1150)`
  - fix(batches): enable GQL request splitting via BATCH_CHANGES_REQUEST_SPLITTING
- display "Deleted Namespace" instead of throwing an error `(PR #778)`
  - fix(batches): display "Deleted Namespace" instead of throwing an error

#### Ci

- remove dependsOn key for PG16 step `(PR #1295)`
- disable db test task temporarily `(PR #1292)`
- generate coreos iptable BUILD.bazel file `(PR #1230)`
- cap branch names in image tags `(PR #1103)`

#### Code Monitor

- fail monitors with missing/unverified primary email address `(PR #938)`
  - fix(code-monitor): fail monitors with missing/unverified primary email address

#### Code Intelligence

- Add more limits in auto-indexing inference code `(PR #1170)`
  - Introduces new limits for auto-indexing inference to reduce the risk of continuously growing auto-indexing queues.
  - The number of jobs spawned per round of auto-indexing inference per repo is capped (default: 100) to reduce risk of clogging of auto-indexing queues. Excess jobs will be discarded.
  - The number of paths inspected for a single round of auto-indexing inference per repo is capped (default: 500) to reduce risk of timeouts. Excess paths will be discarded.
- Handle annotated tag hashes passed as 'commit' for uploads `(PR #1135)`
  - Fixes handling of SCIP uploads when the hash passed to the `-commit` flag of `src-cli` corresponds to the hash of an annotated tag instead of the hash of a commit. Previously, these uploads were not accessible for code navigation.
- Propagate error collector to fix retention tab GraphQL API call `(PR #847)`
  - Fixes a bug where the retention tab for precise indexes would show
a nil pointer exception instead of retention information.

#### Code Nav

- Trigger hovers for all programming languages `(PR #1076)`
  - Fixes a bug where hovers were not triggered for less mainstream languages like F#,
Standard ML, Visual Basic, Pkl, Hack, MATLAB etc.

#### Cody

- convert nil message content parts for OpenAI compatability `(PR #1467)`
- guard against completion usage missing (CODY-4135) `(PR #1218)`
- API telemetry `(PR #1026)`
- reset usage when rate limit value or interval decreased `(PR #1015)`
- fix CodyLLMConfiguration resolver `(PR #839)`

#### Codyapi

- Restrict audit log retrieval to site admins only `(PR #1285)`
- Add usage to completions/chat (CODY-3498) `(PR #1131)`
  - Added token usage information to `.api/llm/chat/completions`

#### Completions

- clear out usage information on the completions API when version < 5 (CODY-4114) `(PR #1153)`

#### Dev

- Correctly propagate error key-value pairs `(PR #1258)`
  - Fixes a bug where logs and traces were sometimes missing key-value pairs recorded alongside errors.
- fix sg db reset-pg PGUSER overwrite `(PR #1220)`
- fix secrets deadlock `(PR #1032)`
- fix workspaces client in local dev `(PR #1028)`
- (new web ui) Properly initialize local dev defaults `(PR #961)`
- remove removed table from MT migration `(PR #910)`
- report warning if workspace creation failed `(PR #909)`
- fix workspaces flakey test `(PR #862)`

#### Frontend

- place requestclient as one of the first middleware `(PR #1215)`

#### Local

- move env into correct grouping `(PR #1332)`
- specify default database when checking psql version in `sg setup` `(PR #924)`
- fix issue with sg start monitoring ignoring dockerCommands `(PR #848)`

#### Mt-Router

- prevent infinite oauth redirect `(PR #1118)`

#### Release

- rename generated changelog file `(PR #1136)`
- Add stitched migration graph override (#935) `(PR #941)`
  - NA

#### Search

- disable hybrid search with index:no `(PR #1462)`
  - `index:no` will now avoid the index completely. Previously it would still consult the index via a process called hybrid search. Search jobs always uses `index:no`, so if you notice a performance problem please reach out to Sourcegraph support. Setting `SRC_DISABLE_RESPECT_INDEX_FIELD` environment variable on the frontend and worker pods will disable this new behaviour in 5.9.x only.Stacked on `(PR #1456)` Closes [https://linear.app/sourcegraph/issue/SPLF-663/disable-hybrid-search-for-search-jobs](https://linear.app/sourcegraph/issue/SPLF-663/disable-hybrid-search-for-search-jobs)  Backport 7aced46a7bc3526695a77e492ee69ad2cfa7bb17 from #1460
- (new web ui) Render submodules differently in file trees `(PR #1377)`
- Fix document highlights in certain situations `(PR #1343)`
- (new web ui) Fix relative links to folders `(PR #1331)`
- (new web ui) Fix file tree sidebar not staying at top level directory `(PR #1328)`
- (new web ui) Show informative message when repo has no README or description `(PR #1240)`
- (new web ui) Fix linkifying files `(PR #1236)`
- (new web ui) Make blob view readonly `(PR #1234)`
  - Prevents default browser shortcuts from modifying the file content locally.
- (new web ui) Prevent uncaught error when navigating back to file page `(PR #1199)`
- (new web ui) Show helpful message for root commit/change list page `(PR #1138)`
- (new web ui) Do not show loading spinner for empty commit ranges on compare page `(PR #1126)`
- (new web ui) Fix search aggregation styles `(PR #1125)`
- exclude content filters from phrase boosting `(PR #1038)`
  - This fixes a bug where we would apply a phrase boost if a `content:` filter was specified with keyword search enabled. This led to inconsistent behavior (regexp vs keyword search) and it also rendered the `content:` filter ineffective, because we ran a general text search instead of a just a content search.
- (new web ui) 'File not found' when quickly navigating between files `(PR #959)`
- (new web ui) Blame view not visible for files that use `\r` as line separators `(PR #929)`
- (new web ui) Show settings link to site admins when repo error occurs `(PR #817)`

#### Sg

- workaround dangling dev resources `(PR #1048)`

#### Source

- correct Name() documentation for gitserver's ReadDirIterator `(PR #1278)`
  - The documentation for gitserver's ReadDir method has been clarified to reflect that the return iterator's Name() method returns the full path of the file, as opposed to just the basename.
- multiple GitHub external accounts to the same URL now refresh correctly `(PR #1260)`
  - When there are multiple auth providers configured that point to the same GitHub URL, as can be the case when using private GitHub Apps, user external account tokens will now refresh correctly.
- clarify exclude docs in github connection schema to say that individual expressions within block are `and`-ed together `(PR #1249)`
  - The documentation for the "exclude" section in the github code host connection schema has been clarified to explain that each block is OR'd together, and the expressions within each block are AND'd together.
- Fix Azure Devops OnPrem connection editing and repo name `(PR #1184)`
- The sync of a GitHub repositoryQuery failing will no longer cause repos to be deleted `(PR #1177)`
  - GitHub code host connections using `repositoryQuery` will no longer delete repositories if the sync fails for reasons like a GitHub outage or a token expiring.

#### Sourcegraphaccounts

- use native openidconnect provider `(PR #1030)`

#### Telemetry

- only log Cody API events to a remote data store, do n… `(PR #1304)`

#### Telemetry-Gateway

- fix configuration `(PR #1129)`

#### Tenant/Reconciler

- avoid illegal state transitions `(PR #1133)`
- double-check assigned instance ID `(PR #1092)`
- try to audit log after tenant context creation `(PR #1051)`

#### Workspaces

- build full redirect_to URL `(PR #1315)`
- apply 'secure headers' to SPA `(PR #1313)`

#### Others

- copy changes to prompt settings `(PR #1286)`
- remove call to possibly nil error `(PR #973)`

### Chore

#### Ci

- add TAG_DB_TEST to all go_tests that depends on dbtest `(PR #1288)`
- add test task in workflows for dbtest to run on postgres 16 agents `(PR #1287)`
- use bazel 7.4.0 `(PR #1284)`
- nix - update pg-utils for patch renames `(PR #1172)`
- Move //client/svelte:e2e_test to Integration/E2E_test step `(PR #1148)`
- upgrade platform rules `(PR #1020)`
- move rustfmt flags to ci bazelrc `(PR #1017)`
- upgrade rules_ts and rules_js `(PR #1006)`
- upgrade aspect rules swc `(PR #988)`
- update rules rust v0.52.2 `(PR #985)`
- set test label prefix for backcompat tests `(PR #984)`
- upgrade rules_buf `(PR #974)`
- skip check if author is sg teammate `(PR #969)`
- bazel skylib 1.7.1 `(PR #936)`
- Upgrade rules_go, gazelle, buildifier_prebuilt & rules_proto `(PR #791)`

#### Code Intelligence

- Remove unused parameter `(PR #1204)`
- Rename flag -update -> -update-jobs-snapshots `(PR #1203)`
- Use HTTPError type in uploadhandler code paths `(PR #1174)`
- Remove unused parameters `(PR #1166)`
- Introduce new FileContentsMap type for clarity `(PR #828)`
- Use consistent casing for op strings `(PR #789)`
- Clarify state transitions in GetUsages `(PR #755)`

#### Database

- remove residual event_logs export stuff `(PR #864)`
- drop product_licenses and product_subscriptions `(PR #264)`

#### Database

- OOB migration for setting non-null columns via page `(PR #885)`
  - An out of band migration is introduced to set slowly set the value of a new column on all tables. If you have a large postgres database for Sourcegraph (1tb+) please ensure you deploy 5.9 instead of doing a multi-version upgrade past it.

#### Dev

- Use clearer names in health server initialization `(PR #1383)`
- Make syntactic-code-intel-worker config uniform `(PR #1382)`
- Enable metrics for precise-code-intel-worker in dev `(PR #1365)`
- Merge fileutil package into fsext `(PR #1351)`
- Migrate gitserver APIs from fs.FileInfo to fsext.FileInfo `(PR #1318)`
- Introduce new package with FileInfo type `(PR #1317)`
- Document footguns around escaping trace data writers `(PR #1291)`
- Rename errors.ErrCollector -> errors.Collector `(PR #1265)`
- Introduce new o11y-friendly RichError interface `(PR #1264)`
- Replace WithErrors -> With for simplicity `(PR #1261)`
- Generalize 'observation.With' for custom errors `(PR #1233)`

#### Gitserver

- Inline one-liner for error checking `(PR #1108)`

#### Msp

- upgrade openfga dependency `(PR #1357)`

#### Mt-Router

- disable proxy for s2 `(PR #1186)`
- use bazel to run generator `(PR #1065)`
- setup sentry for stage environment `(PR #1064)`
- add scripts to interact with local kv `(PR #1056)`

#### Search

- (new web ui) Enable new web UI by default `(PR #1373)`
- fix description for KUBERNETES_JOB_STEP_IMAGE `(PR #1360)`
- Remove all non-single job pod code from Executors on Kubernetes. `(PR #1163)`
  - The environment variable `KUBERNETES_SINGLE_JOB_STEP_IMAGE` is now `KUBERNETES_JOB_STEP_IMAGE`.
  - Both environment variables are read, with preference given to `KUBERNETES_JOB_STEP_IMAGE`, to preserve backward compatibility, but reading of `KUBERNETES_SINGLE_JOB_STEP_IMAGE` may be removed in a future version.
- (new web ui) Improve search input CSS `(PR #962)`

#### Security

- Update rules_apko and fix issues with sg wolfi v2 `(PR #901)`
  - Build containers using latest version of apko and rules_apko

#### Telemetry

- report token usage per request to telemetry `(PR #1165)`
  - Added LLM token usage telemetry

#### Telemetrygatewayexporter

- bump default TELEMETRY_GATEWAY_EXPORTER_EXPORT_INTERVAL `(PR #1303)`

#### Telemetrytest

- add working example `(PR #1274)`

#### Others

- fix storybook `(PR #1335)`
- add searchSource to new search events `(PR #1306)`
- make core-services internal/telemetry codeowners `(PR #1272)`
- upgrade Mocha from 8.3.4 to ^10 `(PR #1246)`
- move web app into child layout group to make room for embedded pages `(PR #1128)`
- run prettier `(PR #906)`
- Upgrade hermetic cc toolchain `(PR #844)`
- upgrade rules_oci `(PR #818)`

### Test

#### Others

- implement structure for e2e tests `(PR #108)`

### Refactor

#### Cody-Gateway

- support max_completion_tokens for o1 models `(PR #947)`
  - refactor(cody-gateway): support max_completion_tokens for o1 models

#### Search

- (new web ui) Update folder page table styling `(PR #1221)`

#### Others

- move all business logic out of context resolvers `(PR #821)`

### Reverts

- revert filtering out deprecated models on server `(PR #1276)`

### Uncategorized

#### Others

- [Backport 5.9.x] oob: Run without tenant iterator for older versions `(PR #1429)`
- Release: Prep stitched migration graph for release (#1388) `(PR #1389)`
  - n/a
- Move cody.serverSideContext out of experimentalFeatures in site config `(PR #1385)`
- bugfix: add key to search result file header `(PR #1374)`
- gitserver: Parse LastChanged, LastFetched as nulltime `(PR #1372)`
- add code llama 7B model for ab test `(PR #1371)`
  - adding code llama 7B for completions
- Hide auto submit checkbox and add promoted badge `(PR #1367)`
- Enable reranker by default if Gateway is enabled `(PR #1366)`
  - Cody Chat: the context engine now uses the reranker by default everywhere where Cody Gateway is enabled.
- db: Set default permissions to RLS user as well `(PR #1362)`
- Remove promote-to-public dependency on bazel-push-images step `(PR #1356)`
- release: Only fail SBOM step if all uploads fail `(PR #1355)`
- source: Fix code host connection editor validation `(PR #1354)`
- bugfix: fix symbol tree hover selector `(PR #1353)`
- dev: Exclude generated code from prettier `(PR #1341)`
- Prompt library: fix input description for prompt name `(PR #1337)`
- workspaces: Various mini fixes and a landing page `(PR #1336)`
- tenant: Fix gRPC in local dev `(PR #1334)`
- Reapply "worker: Fix configuration error reporting" `(PR #1311)`
- Search: document choice for ZoektScoreBoost `(PR #1310)`
- bugfix: escape file paths `(PR #1308)`
- Change clickable elements to buttons `(PR #1298)`
- Allow users to insert chips according to cursor position `(PR #1296)`
- Change prompt creation flow feature flag name `(PR #1294)`
- Pass Context to scip-syntax invocation to propagate cancellation `(PR #1290)`
- gomod: bump Zoekt for metrics improvement `(PR #1276)`
- Redis: rename RedisWrapper `(PR #1273)`
- connectutil: UnexpectedError handler `(PR #1271)`
- Add recommended flag to Prompt Templates `(PR #1268)`
  - Adds ability to mark prompts as recommended and then sort the recommended prompts at the top.
- bugfix: remove possibility of infinite recursion from the symbol tree `(PR #1256)`
- Update cody web to 0.10.0 `(PR #1254)`
- bugfix: use short OID for file popover `(PR #1242)`
- Remove outdated install instructions for sg `(PR #1227)`
- site: Fix missing unredaction in site config `(PR #1226)`
- Update the sg docs link `(PR #1225)`
- multi-tenant: support synchronized user sign-out `(PR #1222)`
- sg: Fix db reset with default local settings `(PR #1217)`
- db: Improve error message for failed version update `(PR #1216)`
- Only push final images on specific default runtypes `(PR #1211)`
- OpenaI completions response type fixing for gpt-3.5-turbo-instruct and gpt-4o-mini `(PR #1207)`
- sg: Always run with lower privileges in dev `(PR #1197)`
- tenant: Deactivate OOB migrations `(PR #1192)`
- Update Enterprise footer link on dotcom `(PR #1191)`
- bugfix: escape spaces in repo filter names `(PR #1187)`
  - Fixed a bug that would cause filters added from the search sidebar to not be correctly escaped
- Attempt to fix flaky database test `(PR #1181)`
- chore/search - Remove runner.Spec.Image and use command.Spec.Image instead `(PR #1161)`
- dev: Disable otel in MT dev `(PR #1157)`
- bug(release): remove semver check for release branch in `sg backport`  `(PR #1156)`
- Make GetCodyContextAlternatives usable for evals `(PR #1152)`
- multi-tenant: list workspaces for the authenticated user `(PR #1146)`
- saml: Prevent logspam from context cancel `(PR #1143)`
- sg: Update localdev migration `(PR #1132)`
- tenant: Exclude product subscription tables from OOB migrator `(PR #1124)`
- Add prompt mode `(PR #1123)`
  - Adds mode (CHAT, EDIT, INSERT) to prompt.
- gitserver: Clarify annotated tags behavior in ResolveRevision `(PR #1107)`
- Rate limit: rename GlobalLimiter to DistributedLimiter `(PR #1100)`
- Rate limit: make GlobalLimiter tenant-aware `(PR #1099)`
- saml: Fix nil panic `(PR #1098)`
- tenant: Disable migrator for ranking tables `(PR #1097)`
- Rate limit: avoid using KeyValue within GlobalLimiter `(PR #1082)`
- Rate limit: simplify inMemoryLimiter `(PR #1081)`
- tenant: Use frozen schema for OOB migration `(PR #1077)`
- Make user emails soft-deletable `(PR #1071)`
- Fix prompt duplication name `(PR #1067)`
- sg: Add no-open flag to workspaces create `(PR #1057)`
- Creating/Editing Prompts Re-design `(PR #1054)`
  - The prompt creation/edit page has been redesigned.
- GraphQL: remove anonymous rate limiter `(PR #1052)`
- oob: Make out of band migration runner tenant-aware `(PR #1047)`
- Fix the CTA to point to chat `(PR #1044)`
- Fix bug where text pushed buttons out of the container `(PR #1043)`
- dev: Implement wrangler router provider `(PR #1035)`
- router: Ensure HTTPS protocol on auth redirect `(PR #1034)`
- workspaces: Fix race condition registering state listener `(PR #1033)`
- dev: Introduce devDNS helper to resolve testdomains `(PR #1029)`
- Add ability to duplicate existing prompts `(PR #1022)`
  - Users can now duplicate existing prompts.
- GraphQL: simplify rate limit interface `(PR #1021)`
- Add autoSubmit & includeViewerDrafts to Cody prompts `(PR #1003)`
  - Adds options to set prompts to "Auto Submit", which would automatically execute the prompts in one-click.
- vsce: patch release v2.2.19 `(PR #1002)`
- workspacesreconciler: fix grpc tls transport `(PR #1000)`
- tenant: Move externalhttp to separate package `(PR #996)`
- goroutine: reenable recording when multitenancy is enabled `(PR #995)`
- Rename globaldbtenant to servicetenant `(PR #994)`
- ci/mt-router: add bazel build `(PR #990)`
- Search: populate rev in select repo `(PR #989)`
- Search: correct has.commit.after query example `(PR #987)`
- mt-router: import repo `(PR #986)`
- tenant: add mt-router to local dev `(PR #968)`
- tenant: Remove tenant auth redirect in monolith `(PR #967)`
- Do not fail if link parsing fails in relative fix processing `(PR #966)`
- dev/msp: improve tfc creation error message `(PR #964)`
- goroutine: remove unused support for concurrency `(PR #963)`
- ci: Bump backcompat test target to 5.8.0 `(PR #954)`
- tenant: Mark tenant as initialized in db `(PR #950)`
- bug(release): workspace cash time dance `(PR #948)`
- tenant: Fix missing tenant in auth check `(PR #933)`
- db: Use non-superuser in DB tests `(PR #930)`
- db: Migrator can provision RLS user permissions `(PR #919)`
- ci: Bump backcompat target to 5.7 `(PR #916)`
- sg: Add default tenant to hosts `(PR #915)`
- remove "Don't commit private code yet" from PR template `(PR #908)`
- "Prompt Library" in navbar (capitalize the L for consistency) `(PR #907)`
- Blob View: Ensure copy button copies full path and not displayed path `(PR #903)`
  - Fixes a bug where certain copy path buttons were only copying the visible path and not the full path of a file.
- sg: Fix reference to deleted table in localdev MT migration `(PR #898)`
- tenant: Separate store package and create tenant1, tenant2 via workspaces `(PR #897)`
- Tenant: skip some global Prometheus metrics `(PR #892)`
- sg: Fix startup of workspaces service `(PR #891)`
- ci: do not run executors e2e for eph `(PR #886)`
- Perforce IP enforcement integration test `(PR #876)`
- goroutine: Make iterator required `(PR #875)`
- dev/msp: add project id validation `(PR #874)`
- db: Drop unused user_public_repos table `(PR #873)`
- Deprecate long-running OOB migrations `(PR #872)`
- lib/cloudapi: add support for multi tenant mode `(PR #871)`
- event_logs: add new `aggregatedMetrics` ping `(PR #869)`
- Redis: refactor rcache interface `(PR #860)`
- Add extra reranker metrics to Gateway events `(PR #838)`
- Sourcegraph teammate approval GH action `(PR #824)`
- Redis: remove KEYS call in completions token usage `(PR #820)`
- tenant: Properly initialize RBAC `(PR #754)`
- sg: Provision RLS user during setup `(PR #749)`
- tenant: Add database migration to enable RLS policies `(PR #743)`
- tenant: Add workspace ID and display name `(PR #741)`
- tenant: Check that all tables have RLS policy set `(PR #734)`
- tenant: Simplify dev migration `(PR #726)`
- db: Mark tenant_id columns as non-nullable `(PR #707)`
- feature: add internal/tracelog: a log.Logger that only logs if tracing is enabled `(PR #634)`
  - Added a new `internal/tracelog` package that provides a conditional logger for tracing. This logger only logs when tracing is enabled, improving performance by reducing unnecessary logging.
- Hackathon: SBOMs feat. bazel `(PR #566)`
  - feature(security): Publish SBOMs for Sourcegraph releases
- tenant: Unique constraint migration `(PR #430)`
- security: Auto-update package lockfiles for Sourcegraph base images `(PR #246)`
- (feature): site-config: add ipParseCacheSize to schema for enforce IP restrictions schema `(PR #220)`
  - Added a new `ipParseCacheSize` configuration option for sub-repo permissions to control the caching of Perforce "Host" to IP address translations.
- feature/source: implement core logic for parsing / evaluating Perforce IP addresses for sub repo permissions `(PR #46)`
  - For the Perforce IP permissions implementation, this PR introduces machinery that implements the ability to parse the [IP address expressions from the perforce protections table](https://www.perforce.com/manuals/p4sag/Content/P4SAG/protections.set.html#IP_address) and compare them against the user's IP address (that's advertised from the incoming X-FORWARDED-FOR header.Namely, this PR:
  - Introduced parsePerforceIPString, which parses Perforce IP strings (e.g., CIDR expressions, specific IP addresses) into an ipMatcher for IP validation.
  - Implemented multiple ipMatcher types, including:
    - addrMatcher for exact IP matches.
    - cidrMatcher for checking IPs within a CIDR range.
    - alwaysTrueMatcher for wildcard * expressions.
  - Added toggleableIPMatcher, which either enables or disables IP enforcement based on site configuration settings.
  - Created matcherCache for caching recent IP string to ipMatcher translations, improving efficiency.
  - Updated NewRequestClientIPSource to properly derive IP from the x-forwarded-for header.
- feature/site-config: add site configuration setting for enforcing IP restrictions `(PR #45)`
  - Added enforceIPRestrictions setting to the SubRepoPermissions section in site configuration, allowing IP-based enforcement using the X-FORWARDED-FOR header.Updated JSON schema to require SubRepoPermissions to be enabled when enforceIPRestrictions is enabled.Added validation in Perforce external service configuration to ensure IgnoreRulesWithHost and enforceIPRestrictions cannot be enabled simultaneously.Updated internal implementation to associate each Perforce rule with an IPMatcher for IP-based rule enforcement.
- feature/plumbing: sub_repo_perms: do pumbling to thread comparing IP addresses alongside paths `(PR #23)`
  -

### Untracked

The following PRs were merged onto the previous release branch but could not be automatically mapped to a corresponding commit in this release:

- check for external dbs (#1083) `(PR #1121)`
- bug(release): workspace cash time dance (#948) `(PR #949)`

{/* RSS={"version":"v5.9.0", "releasedAt": "2024-11-04"} */}



# 5.8 Patch 1

## v5.8.1579
- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.8.1579)
- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.8.1579)
- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.8.1579)
- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.8.1579)

### Features

#### Telemetry

- check for external dbs (#1083) `(PR #1121)`

### Fix

#### Search

- Fix Apollo related error in Safari `(PR #1016)`

#### Others

- Fix OOB migration for batch changes table `(PR #1113)`

### Chore

#### Security

- upgrade src-cli version to address CVE `(PR #1117)`
  - Upgrade src-cli version to 5.8.1 to address CVE-2024-24788, CVE-2024-24790, CVE-2024-34156 Backport b8da20f6fa148f30fe97d9267a536bd5a84502f1 from #1112

### Reverts

  There were no reverts for this release

### Uncategorized

#### Others

- Backport 566 to 5.8.x: SBOMs with Bazel `(PR #1089)`
  - feature(security): Publish SBOMs for Sourcegraph releases
- [Backport 5.8.x] Update src-cli MinimumVersion from 5.5.0 to 5.8.1 `(PR #1087)`
  - chore(release): Update minimum supported version of src-cli to 5.8.1 Backport 8f039bdcb5425071dd6e4dfddfb2cb436e124b05 from #1079

{/* RSS={"version":"sourcegraph 5 Release 8 Patch 1", "releasedAt": "2024-10-16"} */}

# 5.8 Patch 0

## v5.8.0
- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.8.0)
- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.8.0)
- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.8.0)
- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.8.0)

### Features

#### Accessrequests

- Allow to file another request when original one has been processed `(PR #416)`

#### Appliance

- refactor install flow, status, state, stage `(PR #352)`

#### Batch Changes

- verbose error logging for batch syncer with BATCH_CHANGES_SYNCER_VERBOSE_ERROR_LOGGING `(PR #639)`
  - feat(batches): verbose error logging for batch syncer with BATCH_CHANGES_SYNCER_VERBOSE_ERROR_LOGGING
- add experimental feature to add a fork name suffix to avoid name collisions `(PR #230)`
  - feat(batches): add experimental feature to add a fork name suffix to avoid name collisions

#### Ci

- enable workflows telemetry `(PR #774)`
  - enable aspect workflows ci telemetry
- convert onconflict gen to bazel `(PR #486)`
  - generate `constraints.go` using bazel for onconflict linter

#### Search

- (new web ui) Prefill search input with selected text when pressing '/' `(PR #577)`

#### Code Intelligence

- Updates the autoindexing images for TypeScript and Ruby `(PR #805)`
  - TypeScript: Fixes references to object properties in various places
  - Ruby: Fixes references to `Opus::` in Ruby tests
- Syntactic indexing go evaluation suite and fix tests on CI in general `(PR #482)`

#### Cody

- update public OpenAPI spec `(PR #796)`
- add basic support for server-rendered prompts `(PR #723)`
  - `/.api/completions/stream` endpoint now accepts `"file"` and `"repo"` parts alongside `"text"` and `"image_url"`
- add vision support `(PR #546)``/.api/completions/stream` now supports vision using the OpenAI-compatible base64 encoding of images. Example `"content": [{"type": "image_url", "image_url": { "url": "data:image/png;base64,{{IMAGE_BASE64}}" } }]`. Requires the query parameter `api-version=3` or higher.
- document internal APIs with TypeSpec/OpenAPI `(PR #505)`

#### Cody-Gateway

- log requestinteraction in events `(PR #814)`

#### Database

- bestEffortForce will kill blocking transactions in migrator `(PR #781)`
  - DB Migrator is given the ability to automatically run pg_terminate_backend on transactions blocking a migration. This is done best effort and is opt-in per migration.

#### Dev

- (new web UI) Make it easier to run tests without proxying `(PR #798)`
- add obvious 'target service' notice to `sg msp` commands `(PR #725)`

#### Local

- add cody-gateway version endpoints `(PR #685)`
  - add cody-gateway environments for subcommand `live`
- sg - install pgvector `(PR #520)`
  - mac: install pgvector from sourcegraph/pgvector-12
  - ubuntu: install postgresql-12-pgvector

#### Msp

- make databasetest shared `(PR #393)`

#### Msp/Databaseutil

- make 'upsert' package shared `(PR #394)`

#### Release

- remove test from promotion ci during release pipeline `(PR #495)`
  - Remove upgradetest from the release promotion ci
- Stop releases from going out if there's a PR with the release-blocker label `(PR #472)`
  - Allow PRs to block a release from going out 😈
- use releaseregistry for release banner [REL-145] `(PR #429)`
  - implement using the release-registry for the banner

#### Search

- bump Zoekt for ranking and memory improvements `(PR #816)`
  - Reduce peak memory required for Zoekt indexing
  - Improve search ranking by using repo freshness as a scoring signal
- (new web ui) Add split view support to commit page `(PR #775)`
- enable similarity search by default `(PR #772)`
  - With this change we rank repository search results by similarity. Before, repository search results were ordered by star count instead. This affects suggestions and repository search results. To disable this feature and return to the previous behavior, set `{ "experimentalFeatures": { "disableOrderBySimilarity": true}}` in global settings.
- (new web ui) Add /cody/dashboard page `(PR #764)`
- (new web ui) Add account connection modal `(PR #731)`
- (new web ui) Image previews `(PR #623)`
- respect match order for search.results.repositories resolver `(PR #575)`
  - The GraphQL endpoint `search.results.repositories` now returns the list of repositories in the order of the matches we
found. Before, repositories were sorted by id.
- remove fzf star tiebreaker for repo suggestions `(PR #541)`
- preserve ranking for repo suggestions `(PR #447)`
- (Svelte) open documentation links in new tabs `(PR #401)`
- Open documentation links in a new tab `(PR #359)`

#### Source

- add ssh auth support for more code hosts `(PR #615)`
  - BitBucket Cloud, BitBucket Server,  GitLab, Gerrit, Gitolite, AWS CodeCommit Azure DevOps code host connections now support configuring SSH key authentication from the UI instead of mounting from disk.
- add support for ssh auth to github `(PR #597)`
  - GitHub and generic Git code host connections now support configuring SSH key authentication from the UI instead of mounting from disk.
- Support Azure Devops Server (onPrem) with NTLM authentication `(PR #217)`

#### Tenant

- allow configuring host instance id `(PR #826)`
- add initial Workspaces reconciler `(PR #594)`

#### Wolfi

- update server + postgresql-12 images `(PR #519)`
  - add pgvector to server and postgresql-12 images
- add pgvector-12 package `(PR #513)`
  - build and add pgvector extension

#### Workspaces

- implement integrations listworkspaces `(PR #794)`
- implement management listworkspaces `(PR #793)`
- delete workspace RPC `(PR #729)`
- add DB list workspaces `(PR #728)`
- add destroy state internally `(PR #644)`
- init database schemas, add Workspaces store handler `(PR #395)`
- add and demo notifications SDK `(PR #356)`

#### Others

- add reranker support to Cody Gateway `(PR #670)`
- Embeddings: v2 `(PR #507)`
  - Introduce a new experimental embeddings index and context retriever.
- make scip-syntax process multiple languages in a single invocation `(PR #364)`
- add OpenAI o1 models and early-access models support to Cody Gateway `(PR #323)`
  - [feat(code gateway): add support for OpenAI o1 models and early-access models handling.](feat: add OpenAI o1 models and early-access models support to Cody Gateway)
- implements pagination for syntactic usages `(PR #310)`

### Fix

#### Batch Changes

- stamp the executor binary with version information `(PR #665)`
  - override `internal/version.version` with `x_defs` at build time in executor
- disabled "select all" checkbox if all nodes are already disabled `(PR #483)`
  - fix(batches): disabled "select all" checkbox if all nodes are already disabled

#### Ci

- add runfile initialization to upgradetest file `(PR #890)`
- use generated json in migrations filegroup `(PR #802)`

#### Search

- (new web ui) Show correct document highlights when codegraph data is available `(PR #620)`
- 'Save search' action on search results page does not navigate to the saved search creation page `(PR #549)`

#### Code Intelligence

- Correctly escape special characters in repo names and identifiers `(PR #710)`
  - The new usagesForSymbol API correctly searches repos whose names contain spaces or other special characters.
- Use multiple language: filters for search-based usages in case of ambiguity `(PR #708)`
- cleanup button title `(PR #581)`
- Fetch tags for scip-go auto-indexing jobs `(PR #371)`
  - Go cross-repo navigation for tagged versions should work better when using scip-go for auto-indexing. Navigation based on SCIP indexes generated using scip-go in CI or cron jobs should be unaffected.

#### Cody

- return client-side model config via API `(PR #713)`
- Disable ModelAPIEnabled for Dotcom `(PR #678)`
  - `modelsAPIEnabled` is always false for dotcom
- allow accuracy category in JSON site config `(PR #641)`
- use "balanced" instead of "accuracy" category for SOTA models `(PR #640)`
- allow empty `finish_reason` in `/.api/llm/chat/completions` `(PR #539)`
  - The `/.api/llm/chat/completions` endpoint will now return an empty string `""` for `finish_reason` instead of the string `"unknown_please_report_bug()"`.

#### Database

- use native UUID in telemetry export queue `(PR #669)`

#### Database

- correctly find CreateIndexConcurrentlyPhases in migrator `(PR #809)`
  - INFO logs for migrations that create index concurrently will always correctly report the phase we are in. Previously we sometimes would report a phase of -1.

#### Dev

- use 9002 for pubsubemulator, simplify shutdown `(PR #780)`
- give pubsub pings a more generous timeout locally `(PR #732)`
- use key value for PGDSN in SAMS, EP `(PR #689)`

#### Graph

- Prevent duplicate results when performing find references `(PR #497)`

#### Local

- add no-xattrs when running schema descriptions target locally `(PR #905)`
- sg - return the error when checking for remote branch/commits `(PR #485)`
  - dump more information out about the branch if it is out of sync

#### Release

- remove embeddings from promotion script (#360) `(PR #361)`
  - remove embeddings in promotion script

#### Sams-Notifications

- make subscriber tenant-aware `(PR #668)`

#### Search

- (new web UI) Fix cody dashboard background colors in dark mode `(PR #845)`
- (new web ui) Fix list styles in rich text documents `(PR #835)`
- (new web ui) Fix styling of rich text documents `(PR #834)`
- (new web ui) Show added lines content `(PR #832)`
- fix client-side query validation for rev: filters `(PR #810)`
  - We have updated the client-side query validation to allow combining `rev:` filters with query-based search contexts.
- (new web ui) Clicking 'Code search' in then navbar of the old UI does not redirect to the new UI `(PR #761)`
- (new web ui) Use a Map to group symbol names `(PR #721)`
- VSCode Search extension: Update bug-reporting URL `(PR #693)`
- VSCode Search extension: fix and improve proxy settings `(PR #679)`
- in search jobs, don't time out fetches `(PR #666)`
  - For very large repositories, search jobs could time out while fetching the repository. Now, search jobs can fetch and search over repositories, even if they take a long time to fetch.
- (new web ui) Use CodeGraph data to validate hover occurence `(PR #656)`
- (new web ui) User menu feature parity `(PR #628)`
- add index for search jobs janitor `(PR #624)`
  - We added a new database index to speed up a janitor job which is run as part of Search Jobs. Before, the janitor job might have significantly delayed migrations during an upgrade.
- (new web ui) Respect 'experimentalFeatures.structuralSearch' setting `(PR #621)`
- VSCode Search extension forgetting endpoint URL and PAT `(PR #560)`
- fix logo links in the VSCode Search extension `(PR #547)`
- Update help router for local development `(PR #271)`

#### Sg

- Config.GetEnv uses GetEnv for os.Expand `(PR #380)`

#### Sg/Msp

- make embed template fmt-compliant, add docstring `(PR #412)`

#### Telemetry

- ensure telemetry export only occurs once at a time `(PR #565)`
  - Fix an issue where duplicate telemetry can be exported when the `worker` service is scaled horizontally

#### Tenant

- prevent race condition in MockEnforceTenant `(PR #837)`
- stop Iterate if it breaks `(PR #387)`

#### Test

- make workspaces waitforupdate test more reliable `(PR #813)`

#### Others

- make rerank metric name distinguishable `(PR #846)`
- Use correct label in splitting metric in embeddings indexing `(PR #771)`
- Add rerank API token variable to sg.config.yaml `(PR #716)`
- adjust formatting when using unix sockets `(PR #653)`
  - fix PGDATASOURCE format when using unix sockets
- move deletion inside nil check `(PR #556)`
- incrementally updating embeddings index `(PR #555)`
- Decrease parallelism in embeddings indexing `(PR #543)`
- Filter out empty context items in resolver `(PR #537)`
- VIP user access to allowed models in Cody Gateway `(PR #528)`
- properly escape email in URL query `(PR #426)`
- use preferred mermaid APIs `(PR #397)`
  - Fixes a bug that can cause errors when rendering many mermaid diagrams on a page.

### Chore

#### All

- use constraint names in ON CONFLICT statements `(PR #473)`

#### Batch Changes

- add description for env var `(PR #652)`

#### Ci

- Remove stale CODENOTIFY entries `(PR #439)`
- bump Go to 1.23.1 `(PR #391)`
- update gomod lint `(PR #382)`
  - remove lint that checks  for promotheus/common 0.32.1 since we are using 0.48
- upgrade golang.org/x/tools to 0.24 `(PR #373)`
  - address printf linter flagged issues
- add annotation for no merge base `(PR #345)`
  - post an annotation if there is no merge base

#### Code Intelligence

- Bump autoindexing image SHAs `(PR #831)`
  - Upgrades default auto-indexing images to the latest versions (1) scip-go to v0.1.21 (2) scip-typescript to v0.3.14
- Initialize test to consistent state `(PR #825)`
- Unify GetUsages logic at Service level `(PR #752)`
- Unify local phase usage extraction logic `(PR #748)`
- Document code nav logic & limitations `(PR #742)`
- Factor out & document package mentions code `(PR #740)`
- Bump autoindexing image SHAs `(PR #681)`
  - Upgrades the default scip-go auto-indexing image to v0.1.20
- Log number of paths in auto-inference logic `(PR #635)`
- Add context to timeout error for commit listing `(PR #607)`
- Clarify doc comment for NewCanonicalDocument `(PR #480)`
- Document scip.Document and range canonicalization code `(PR #459)`
- Split inverted ranges extraction code & add comments `(PR #458)`
- Use UploadRelPath instead of string `(PR #438)`
- Bump auto-indexing image SHAs `(PR #403)`
  - Bumps default auto-indexing scip-go image to use Go 1.23.1 and scip-go v0.1.19

#### Cody

- add HTTP record/replay test case for AWS Bedrock backend `(PR #452)`
- add HTTP record/replay test case for Anthropic LLM backend `(PR #448)`
- add HTTP record/replay test case for Azure OpenAI `(PR #446)`
- add HTTP record/replay test case for OpenAI LLM backend `(PR #445)`
- add HTTP record/replay test case for Fireworks LLM backend `(PR #441)`
- add HTTP record/replay test case for Google LLM backend `(PR #410)`

#### Database

- set app.current_tenant outside of multitenant `(PR #502)`

#### Database

- remove unused redis_key_value table `(PR #688)`
- update oobmigration min version to 4.0 `(PR #540)`
- getRepositoriesForIndexScanQuery uses constraint `(PR #534)`
- handle failed transactions in setTenant `(PR #533)`
- use new constraints for on conflict `(PR #510)`
- constraint for unique indexes used in on conflict `(PR #504)`

#### Dev

- Bump Go version to 1.23.2 `(PR #830)`

#### Frontend

- sync.Once to sync.OnceValue in service connections `(PR #376)`

#### Gomod

- update zoekt's dependencies `(PR #462)`

#### Local

- Fix ill-formed go.mod file `(PR #434)`
- update sg installation docs `(PR #390)`

#### Release

- prepare stitch graph for 5.8 `(PR #852)`
  -  Backport 6b58d4b62bba8f558c097fa97a751e51b178c537 from #850

#### Release

- clarify backport error `(PR #784)`

#### Reranker

- clean up resolvers, improve perf, add more useful spans `(PR #776)`

#### Search

- (new web ui) Add telemetry for opt-out/in `(PR #766)`
- remove codeintel ranking code `(PR #719)`
- remove cursor based repo pagination `(PR #663)`
- VSCode Search extension: remove "SOURCEGRAPH SEARCH" stutter in favor of "Info" `(PR #559)`
- update wording from "Sourcegraph extension" to "Sourcegraph Search extension" `(PR #558)`

#### Semgrep

- add upload artifact step `(PR #616)`

#### Sg

- remove enforce-tenant-id --disable `(PR #705)`

#### Tenant

- restructure tenant package into internal subpackages `(PR #587)`

#### Trace

- prevent parallel calls to ConfigureStaticTracerProvider `(PR #467)`

#### Others

- enable reranker by default `(PR #804)`
  - Reranker for context retrieval is turned on by default
- disable IDF jobs `(PR #783)`
- Clean up visible uploads initialization `(PR #739)`
- Rename gatherLocations -> gatherUsages `(PR #737)`
- Cleanup metadata generation code in Gateway `(PR #714)`
- Remove unused endpoints from 969 prototype `(PR #712)`
- trigger changelog audit on label event `(PR #562)`

### Refactor

#### Svelte

- Introduce extensible GraphQL store `(PR #309)`

#### Others

- move cody context business logic outside of resolvers `(PR #647)`
- remove search mode `(PR #629)`
- rename NonLocal -> Global in scip_strict parser `(PR #366)`

### Reverts

- Revert "pgdsn: Allow to fall back to default variables and overwrite … `(PR #369)`

### Uncategorized

#### Others

- bug(release): workspace cash time dance (#948) `(PR #949)`
- [Backport 5.8.x] tenant: Improve OOB migration from learnings `(PR #939)`
- [Backport 5.8.x] Revert "migrator: Backfill IDs from overrides into right schema only" `(PR #914)`
- [Backport 5.8.x] migrator: Backfill IDs from overrides into right schema only `(PR #894)`
- [Backport 5.8.x] Revert "fix(migration-graph): add no op migration to backfill overrides" `(PR #888)`
- [Backport 5.8.x] Update lockfiles with newer version of apko `(PR #882)`
  -  Backport 7f2c3bacf6778fef5f2ef444db2ebd873903c5e6 from #881
- [Backport 5.8.x] Revert "Update rules_apko and fix issues with `sg wolfi` (#696)" `(PR #880)`
- [Backport 5.8.x] db: Bump date for schema migrations stitch date `(PR #878)`
- tenant: OOB migrator covers more tables `(PR #842)`
- tenant: Default to ID 1 for inserts `(PR #840)`
- migrator: Correctly render indexing progress `(PR #812)`
- adding code qwen 2p5 and deepseek long prompt optimized model `(PR #811)`
  - adding code qwen 2p5 and deepseek long prompt optimized model `(PR #811)`
- security: Update docker dind to latest release `(PR #808)`
- saml: Record requests `(PR #788)`
- saml: Return error instead of appending to it `(PR #787)`
- Add password for sourcegraph-rls `(PR #786)`
- cmd/workspaces: setup routes during ws creation `(PR #782)`
- db: Fix missing globaldbtenant `(PR #779)`
- trace: Fix span pollution in authenticateByCookie `(PR #753)`
- sg: Make sure sourcegraph_rls user also has permissions on future tables `(PR #750)`
- tenant: Fix license check missing tenant `(PR #747)`
- migration: Skip CREATE TABLE if possible `(PR #746)`
- tenant: Fix more tenant-less contexts `(PR #745)`
- tenant: Mark tenants tables as data tables `(PR #738)`
- feat(Cody Reranker): clean up site config and add license-based auth for Cody Gateway `(PR #724)`
- sg: Fix go generate `(PR #722)`
- tenant/db: Safer ordering of migration statements `(PR #718)`
- gitserver: Fix some missing tenant contexts `(PR #717)`
- refactor(cody gateway): update model list for autocompletes `(PR #711)`
- db: Add tenant_id to last remaining columns `(PR #709)`
- db: Add OOB migration to backfill tenant ID `(PR #706)`
- tenant: pass correct context to SetCloneStatus `(PR #701)`
- sg: Reject empty workspace names `(PR #700)`
- sg: Fix enforce-tenant-id after redis_key_value was dropped `(PR #697)`
- Update rules_apko and fix issues with `sg wolfi` `(PR #696)`
- Redis: don't check tenant for system commands `(PR #695)`
- tenant: only skip goroutine recording if tenancy is enabled `(PR #694)`
- Search jobs: set high timeout to protect against stuck jobs `(PR #692)`
- tenant: fix remaining goroutine recorder errors `(PR #691)`
- Reapply "feat(cody): add vision support (#546)" (#686) `(PR #687)`
- Add detailed intent-score pairs to chat intent response `(PR #682)`
- Jsm/disable model api `(PR #680)`
- Site admin: simplify goroutine recording `(PR #677)`
- Update client/vscode/CHANGELOG.md for PR #560 `(PR #676)`
- tenant: Mapper returns more precise error `(PR #675)`
- tenant: add missing IteratorFactory `(PR #674)`
- tenant: Make migrations on startup pass in local dev `(PR #667)`
- msp: report error when PGDSN does not have expected template variable `(PR #664)`
- final ranker config for context v2 `(PR #659)`
  - Changing the ranker configuration -- number of items fetched from zoekt
- sg: Make enforce-tenant-id idempotent again `(PR #655)`
- refactor(cody gateway): add deprecated models back to dotcom model list `(PR #649)`
- gomod: bump Zoekt for memory debugging `(PR #646)`
- Dev: ensure multi-tenant migration has been run `(PR #645)`
- refactor(cody gateway): update dotcom models list `(PR #643)`
  - Cody Gateway: update default model list for dotcom.
- Bump Cody Web to 0.9.0 version `(PR #642)`
- sg cloud eph deploy:  --wait flag `(PR #637)`
- executors: Check for rows affected instead of running into unique constraint error `(PR #632)`
- Symbols: hide scary error messages from users `(PR #631)`
- Add postgres as datasource for Grafana `(PR #627)`
- add time to first token for upstream as header `(PR #618)`
- workspaces: implement `managementv1.UpdateWorkspaceMembership` RPC `(PR #613)`
- ci: add cloud ephemeral pipeline `(PR #611)`
- add sourcegraph ranker `(PR #610)`
- workspaces: implement GetWorkspaceMembership rpc `(PR #609)`
- workspaces: implement `ReportInstanceState` RPC `(PR #604)`
- workspaces: implement `ListWorkspaceMemberships` RPC `(PR #603)`
- tenant: Add method to create a new tenant in database `(PR #593)`
- workspaces: support []iam.Role in WorkspaceMembership `(PR #590)`
- Cody Web: bump cody web to 0.8.3 `(PR #589)`
- Cody context: fix bug in 'archived' change `(PR #588)`
- workspaces: Add WorkspaceState to GetWorkspace rpc `(PR #585)`
- tenant: Add support for reading tenant by hostname from database instead of hard-coded `(PR #580)`
- workspaces: implement user `CreateWorkspace` API `(PR #574)`
- workspaces: implement GetWorkspace RPC `(PR #573)`
- gomod: bump Zoekt for indexing memory optimization (again) `(PR #572)`
- use direct routing by default if present in the backend `(PR #571)`
- workspaces: database get/upsert instances `(PR #568)`
- workspaces: implement `ReportWorkspaceState` RPC `(PR #564)`
- gomod: bump Zoekt for indexing memory optimization `(PR #557)`
- Bump Cody Web to 0.8.2 version `(PR #545)`
- clean up rerankers for Cody Context `(PR #544)`
- sg(tenant): Add migration for constraints to local dev `(PR #542)`
- rockskip: use full ctx from emitIndexRequest `(PR #532)`
- Add billing metadata for core search, batch, and insights events `(PR #529)`
- Cody context: support archived and forked repos `(PR #527)`
- vsce: patch release v2.2.18 `(PR #526)`
- fix context v2 zoekt subqueries `(PR #523)`
- Repo-updater: continue start-up if hydration fails `(PR #521)`
- Cody Web: bump cody web to 0.8.1 `(PR #518)`
- cody-gateway: do not PING Redis too often `(PR #517)`
- rockskip: Remove another duplicative BTREE index `(PR #516)`
- rockskip: Remove duplicative BTREE index `(PR #515)`
- db(tenant): lock between setTenant and exec to ensure session variable is set atomically `(PR #512)`
- perf: reduce allocations in `evalKeywordExpansions` `(PR #506)`
- local/nix: add pgvector extension `(PR #503)`
  - enable pgvector in nix managed postgres db
- redispool: allow call sites to custmoize their `TestOnBorrow` and `Dial` `(PR #499)`
- cody-gateway: wait for Redis connection `(PR #498)`
- cody-gateway: set `MaxActive` for Redis `(PR #496)`
- Bump Cody Web to 0.8.0 version `(PR #492)`
- Recorder: remove RegistrationDone method `(PR #489)`
- Repo-updater: add tenancy `(PR #479)`
- tenant: Basic support in worker `(PR #476)`
- Cody context: return matched ranges of chunks `(PR #474)`
- add(cody): `api-version=2` for incremental streaming LLM responses `(PR #470)`
  - The `/.api/completions/stream` endpoint now accepts an `api-version=2` query parameter that returns incremental text text responses when using `"stream": true` to improve performance and reduce bandwidth.
- Remove Neovim from Cody dashboard `(PR #469)`
- Fix flaky test by bringing down memory utilization of POS filter `(PR #468)`
- msp/iam: fixup checks for `ErrNoRows` `(PR #465)`
- gomod: bump Zoekt for zoekt-git-index profiling `(PR #453)`
- worker: Make resetter a periodic goroutine `(PR #450)`
- gomod: bump Zoekt for index optimization `(PR #449)`
- http: Add context to more requests `(PR #437)`
- conf: Remove alias for ExternalURL `(PR #436)`
- frontend: Drop unused orgs_open_beta_stats table `(PR #435)`
- msp/iam: do not close connection pool on startup `(PR #433)`
- Filter out terms based on POS and expand Zoekt queries `(PR #432)`
- authn: Create providers on the fly with current request context `(PR #424)`
- tenant: Use request context when creating OIDC provider `(PR #422)`
- redis: Add optional tenant isolation `(PR #421)`
- tenant: Add context to LogBackendEvent `(PR #420)`
- Remove debug log statement `(PR #418)`
- minor doc change `(PR #413)`
- sg: Use custom site-config for multitenant runset `(PR #405)`
- Retrieve and display change log during upgrades. `(PR #400)`
  - [Appliance] Retrieve live changelog and display information about the release to be upgraded.
- Svelte: fix text wrapping for file popover `(PR #399)`
  - Fixed a bug in the web app rewrite where long paths would cause file popovers to wrap
- Svelte: fix loading for ref panel `(PR #398)`
  - Fix loading behavior for the reference panel in the web app rewrite
- gomod: bump Zoekt for index optimization `(PR #389)`
- Svelte: SymbolTree followups `(PR #388)`
- repo-updater: hack so it uses tenant 1 for now `(PR #386)`
- gitserver: inherit tenant for repoUpdateOrClone `(PR #385)`
- Chore: close rows `(PR #379)`
- database: use keyword value format if connecting via unix socket `(PR #378)`
- frontend: always use DSN from ServiceConnections `(PR #375)`
- Reapply "pgdsn: Allow to fall back to default variables and overwrite..." `(PR #374)`
- postgresdsn: support PGHOST as a filepath `(PR #372)`
- release: specifiy download directory for changelog `(PR #365)`
  - specify download directory for changelog
- frontend: Don't double-close readiness channel during auto upgrades `(PR #358)`
- workspaces: initial IAM schema and implement `iam.Store` `(PR #353)`
- enterprise-portal: implement `iam.Store` and add tests `(PR #351)`
- enterprise-portal: create `internal/iam` package and run schema tests in CI `(PR #350)`
- tenant: Add tenants 1 and 2 in localdev `(PR #340)`
- sg: Introduce first multitenant runset `(PR #335)`
- pgdsn: Allow to fall back to default variables and overwrite frontend `(PR #332)`
- Remove k8s utils dependency `(PR #320)`
- msp/iam: fixup migration PG 12 compatibility and sanity test migrations `(PR #301)`
- Tree-sitter based chunker for embeddings indexing `(PR #298)`
- Context: return multiple chunks per file from Zoekt results `(PR #294)`
  - We can improve recall by fetching multiple chunks per file from Zoekt results by turning on the `cody-reranker` feature flag.
- add(cody): `api-version=2` incremental streaming LLM response `(PR #293)`
  - The `/.api/completions/stream` endpoint now accepts an `api-version=2` query parameter that returns incremental text text responses when using `"stream": true` to improve performance and reduce bandwidth.
- Context: improve ranker integration + loosen the tap `(PR #291)`
  - Ranker for chat context is now available behind `use-reranker` feature flag.
- Hook Upgrade page to Release Registry API `(PR #276)`
- Move IDF repository stats into Postgres and compute them with the background worker `(PR #270)`
- Svelte: add symbol tree `(PR #209)`
  - Adds a symbol tree to file page in the experimental webapp
- Redis: respect context when connecting `(PR #194)`
- Appliance Admin UI `(PR #168)`
  - [Appliance]: Adds the upgrade path for the Appliance Admin UX

### Untracked

The following PRs were merged onto the previous release branch but could not be automatically mapped to a corresponding commit in this release:

- remove the other embedding reference `(PR #362)`
  - n/a

{/* RSS={"version":"v5.8.0", "releasedAt": "2024-10-08"} */}

# 5.7 Patch 1

## v5.7.2474
- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.7.2474)
- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.7.2474)
- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.7.2474)
- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.7.2474)

### Fix

#### Batch Changes

- workaround for a bug in GitHub `(PR #584)`
  - fix(batches): workaround for a bug in GitHub
  Backport aad3a04f8c93561a61c404e69132e70a22d0acba from #576

#### Release

- remove the other embedding reference `(PR #362)`
  - n/a

#### Search

- remove query expansion `(PR #586)`
  - This fixes a bug where we added &quot;readme&quot; too often to the context.    Backport 28ff196a663f537c6cb6340f976a91431509a90e from #582

### Reverts

  There were no reverts for this release

### Uncategorized

#### Others

- [Backport 5.7.x] Search: allow queries with only lang filters `(PR #583)`

{/* RSS={"version":"v5.7.2474", "releasedAt": "2024-09-18"} */}

# 5.7 Patch 0

## v5.7.0
- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.7.0)
- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.7.0)
- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.7.0)
- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.7.0)

### Features

#### Appliance

- enable frontend form and stub out, no backend routes yet `(PR #80)`

#### Batch Changes

- Add a container registry deny list `(PR #109)`
  - Add a container registry deny list to complement the allow list.
  - Configure in site config via `"batchChanges.containerRegistryDenylist"`.
  - Mutually exclusive with `"batchChanges.containerRegistryAllowlist"`.
- add support for registry allowlist `(PR #105)`
  - Add support to configure container registry allowlist for containers use from batch changes via `batchChanges.containerRegistryAllowlist` in Site Configuration.

#### Cody

- add `/.api/cody/context` API `(PR #66)`
  - New `POST /.api/cody/context` REST endpoint to retrieve a list of relevant source locations given a natural language query.

#### Dotcom

- add account ID in subscriptions list view `(PR #192)`
- forward license check to Enterprise Portal `(PR #19)`

#### Enterpriseportal

- use file-based migrations with `goose` `(PR #216)`
- add Salesforce Account ID `(PR #176)`
- internal instances record detected instance `(PR #139)`
- return unknown license as result `(PR #134)`

#### Licensecheck

- check against Enterprise Portal directly `(PR #22)`

#### Msp/Runtime

- standardised migrations `(PR #242)`
- first-class redis support `(PR #241)`

#### Releases

- scoped releases `(PR #33)`
  - feat(release): scoped releases

#### Sg

- MSP database migrations with `goose` `(PR #215)`

#### Site Admin

- monitoring/telemetry: add v1 teestore write alerts and v2 export queue write alerts `(PR #321)`

#### Svelte

- Add repository sync status indicator to search results `(PR #260)`
- Sentry: Ignore errors from third party scripts `(PR #171)`
- Add status notifications `(PR #141)`
- Add support for indent-based code folding `(PR #75)`

#### Telemetry/Sensitivemetadataallowlist

- allow string list and nulls `(PR #27)`

#### Others

- Syntactic support for go `(PR #328)`

### Fix

#### Batch Changes

- omit headRepositoryId if empty `(PR #200)`
- avoid "Name already exists on this account" from creating fork by fetching the repo when the error happens `(PR #159)`
  - fix(batches): avoid "Name already exists on this account" from creating fork by fetching the repo when the error happens

#### Code Intelligence

- ensure syntactic worker marks itself as "ready" on startup `(PR #341)`

#### Code Nav

- Return ALL references in the same file as the definition `(PR #240)`

#### Cody

- correctly parse queries containing 'or' `(PR #267)`
  - Fixes a regression in Cody context where questions containing the word 'or' could return noisy or no results.
- use reverse proxy for Gemini API `(PR #208)`
- address critical bug from code review `(PR #179)`
- return valid `finish_reason` in `/.api/llm/chat/completions` `(PR #154)`
  - LLM API `/.api/chat/completions` now returns OpenAI-compatible `finish_reason`.
- fix error handling in LLM API `(PR #153)`
  - LLM API endpoints (`/.api/llm`) now return JSON-encoded HTTP bodies for non-200 status codes.
- use `testdata` instead of `golly-recordings` directory name `(PR #152)`
- give names to LLM API handlers `(PR #151)`
- allow `Bearer TOKEN` header for all LLM APIs `(PR #150)`
  - For compatibility with OpenAI clients, it's possible to use `Bearer TOKEN` header with all API endpoints that start with the prefix `/.api/llm`.
- deepseek-coder-v2-lite-base model name mapping for dotcom users `(PR #135)`

#### Cody-Gateway

- ignore schema errors on otel init `(PR #237)`

#### Enterpriseportal

- normalize instance domain on create subscription `(PR #163)`
- add subscription ID to trace, other diagnostics improvements `(PR #130)`

#### Enterpriseportal/E2e

- fix test case for check license `(PR #162)`

#### Frontend

- Do not sign-out users when accessing a file path containing /login `(PR #57)`

#### Local

- check for rogue files and folders in svelte routes `(PR #337)`
  - prevent `web-sveltekit` commands from running if there are untracked files under src/routes
- expand _after_ accumulating the whole env `(PR #257)`

#### Oobmigration

- remove migrations targeting licenses/subscriptions `(PR #263)`

#### Repo-Updater

- add WARN level logs every time we sync a code host `(PR #44)`
  - repo-updater now emits logs that log the result of every code host sync.

#### Sams-Notifications

- mockrequire.Values incorrectly used `(PR #315)`

#### Search

- skip if git diff not found in hybrid `(PR #333)`
  - When searching an unindexed commit we would consult indexed commits for speeding up results. If our index contained a commit that no longer existed in git we would error out due to a regression in v5.4.5099. This is now fixed.
- add "Create batch change" back to Actions dropdown in search results `(PR #143)`

#### Sg

- make start commands cancel fn be sync.OnceFunc `(PR #319)`
  - the cancel funcs used by sg commands are now wrapped in `sync.OnceFunc` to prevent duplicate execution
- add deprecation notice to sg wolfi update-hashes `(PR #289)`
  - sg: fix panic when using `wolfi update-hashes`
  - sg: add deprecation notice for `wolfi update-hashes`
- check if we are ephemeral before getting lease time `(PR #256)`
  - sg - fix panic in Cloud Ephemeral listing when listing instances that are not Ephemeral
- clamp deployment name consistently in cloud ephemeral `(PR #117)`
  - ensure deployment / instance names are clamped in all places for cloud ephemeral
- implement env priority to improve env var ordering `(PR #31)`

#### Svelte

- Preserve history panel scroll position after selecting an entry `(PR #251)`
- Update existing query filters when including suggested filters `(PR #115)`
- Remove 'Code Ownership' top navigation `(PR #87)`
- Update main navigation to match React app `(PR #74)`
- Fix regex generation for routes that contain parameters `(PR #73)`
- Fix Bazel production build `(PR #43)`
- Workaround for handling client-side redirections in production `(PR #14)`

#### Others

- Switch to larger runner for scip-go jobs `(PR #221)`
- add deepseek virtual model string `(PR #211)`
- set webRoot to /client/web in launch.json `(PR #83)`
- Speed up auto-index job expiration query `(PR #3)`

### Chore

#### Dotcom

- fix typo in subscriptions page `(PR #195)`
- delete subscriptions, licensing, and cody gateway usage `(PR #21)`

#### Dotcom/Subscriptions

- minor UX tweaks `(PR #175)`

#### Embedding

- delete cmd/embeddings `(PR #181)`

#### Enterpriseportal

- declare required scopes in schema and use schema-based enforcement `(PR #305)`
- add Cody Access override case to manual E2E tests `(PR #224)`
- improve formatting of duplicate usage message `(PR #177)`
- remove dotcomdb connection and testing infra `(PR #20)`

#### Gomod

- update for a bunch of CVEs `(PR #343)`

#### Local

- stop using deprecated `docker-compose` command `(PR #206)`

#### Pubsub

- upgrade to disable OpenTelemetry tracing `(PR #210)`

#### Pubsubemulator

- init tool `(PR #272)`

#### Release

- simplify changelog download in release `(PR #227)`
  - simplify `changelog` cli download by using `gh` cli

#### Search

- Tell EditorConfig to stop messing with snapshot files `(PR #275)`
- Remove Beta label from code monitors webhooks option. `(PR #274)`

#### Search-Jobs

- deprecate experimental site setting `(PR #122)`
  - The site setting `experimentalFeatures.searchJobs` is not read anymore. To disable Search Jobs, set `DISABLE_SEARCH_JOBS=true` for the "frontend" and "worker" services.
- remove EXPERIMENTAL from gql API `(PR #116)`
- remove beta badge `(PR #114)`

#### Svelte

- Upgrade dependencies and cleanup configs `(PR #279)`
- Fix type import `(PR #277)`
- Reduce build log noise `(PR #252)`
- Ingore 'RepoNotFoundError's in Sentry `(PR #113)`

#### Tenant

- Iterate does not enforce no tenant unlike Inherit `(PR #334)`

#### Tooling

- bump Go to 1.23.0 `(PR #126)`

#### Wofli

- update images `(PR #290)`
  - update images to use latest p4-fusion binary

#### Workspaces

- define initial Workspaces proto schemas `(PR #262)`
- stub service and directory `(PR #244)`

#### Others

- fix onUserRolesChanged `has SiteAdmin role` test name `(PR #314)`
- update github.com/openfga/openfga to v1.6.0 `(PR #295)`
- updates Rust toolchain to 1.80.1 `(PR #287)`
- Re-enable SCIP uploads to Demo `(PR #222)`
- create github action for changelog audit `(PR #198)`
- undo unneeded upgrades `(PR #164)`
- upgrade sourcegraph-accounts-sdk-go version `(PR #160)`
- Simplify semaphore-based code using conc.Iterator `(PR #146)`
- Bump autoindexing image SHAs `(PR #131)`
- migrate httpserver to use sg/log `(PR #112)`
  - update httpserver to use sourcegraph/log instead of log15
- Updates tree-sitter version `(PR #93)`
- Delete a bunch of unused LSIF-related code `(PR #77)`
- clean up CODENOTIFY for Joe `(PR #28)`

### Refactor

#### Svelte

- Make repo page integration test setups reusable `(PR #249)`
- Refactor temporary settings to remove Apollo dependency `(PR #156)`
- Lazy load mermaid `(PR #16)`

### Reverts

- revert reverse proxy usage to access Gemini API `(PR #236)`

### Uncategorized

#### Others

- Bump Cody Web to 0.7.7 version `(PR #347)`
- bug: fix slice init length `(PR #339)`
- Add migration to create sourcegraph_rls user in local dev `(PR #331)`
- Add tenant1 and tenant2 hostnames to caddy setup `(PR #330)`
- Deglobalize SiteID `(PR #329)`
- gomod: bump zoekt for indexing observability improvements `(PR #327)`
- searcher: check for zoekt empty repo commit in hybrid search `(PR #326)`
- conf: do not log missing tenant `(PR #318)`
- database: introduce globaldbtenant package `(PR #317)`
- database: rm unused Transact, Done, ShareableStore from ConfStore `(PR #316)`
- [perforce] Store label cache file in .p4home `(PR #308)`
- Convert trivial chunk/batching functions to use slices.Chunk `(PR #307)`
- Bump cody web to 0.7.6 `(PR #304)`
- handle error case where anthropic api returns an empty response `(PR #303)`
- msp/iam: use runtime standardized migrations mechanism `(PR #300)`
- frontend: update permissions runs per tenant `(PR #299)`
- tenant: avoid FromContext logging in Inherit `(PR #297)`
- validation: pass in ctx for validateAuthzProviders `(PR #296)`
- siteadmin: Make recoverUsers idempotent `(PR #292)`
  - The recoverUsers endpoint failed with a spurious error when some of the given users were already active. It is now idempotent.
- Remove (old friend) storm project `(PR #286)`
- all: skip slow tests when -short `(PR #284)`
- licensing: fix flaky uses of MockGetConfiguredProductLicenseInfo `(PR #283)`
- gitserver: fix RemoveBadRefs on darwin `(PR #280)`
- Cody Web: Remove old cody web logic `(PR #273)`
- Move package `(PR #269)`
- add unit test for idf index `(PR #268)`
- Worker: fix flake in repo syncer test `(PR #266)`
- clean unused flag `(PR #265)`
- Bump own and repos test timeouts to long `(PR #258)`
- Upgrade SCIM package to allow Microsoft Entra string values `(PR #253)`
- add(cody): support for Sonnet 3.5 "fast edit" model `(PR #250)`
- Enable route outside Site Admin into Appliance service. `(PR #247)`
- add common access token for direct routing `(PR #245)`
- Redis: pass context through remaining methods `(PR #239)`
- Bump Cody Web to 0.7.3 for react version `(PR #238)`
- dev: remove compare-hash.sh `(PR #234)`
- doc: update search links for monorepo to be on s2 `(PR #233)`
- change the default model from starcoder to deepseek `(PR #232)`
- database: capture missing tenant for queries `(PR #231)`
- goroutine: support tenants `(PR #229)`
- Rearrange auth provider middlewares `(PR #228)`
- Add option to cache label data with p4-fusion `(PR #225)`
  - Perforce connections now support a `cacheLabels` option to cache Perforce label data from the server, speeding up consecutive syncs on systems with a large number of labels.
- lib/cloudapi: introduce features config `(PR #223)`
- lib/cloudapi: add auth pkg `(PR #214)`
- shortcut noop `(PR #213)`
- dev/msp: expose more runtime values to gotmpl `(PR #212)`
- worker: add OnUserRolesUpdated SAMS notification handler `(PR #204)`
- tenant: use marshal method instead of strconv `(PR #203)`
- [fix] Perforce auth provider panics when only IP is provided `(PR #199)`
- Redis: pass context to hash and ttl methods `(PR #196)`
- Redis: introduce KeyValue.Info() `(PR #193)`
- Respect context in Stop methods `(PR #191)`
- telemetry: wait for v1 writes in tests on teestore `(PR #190)`
- tenant: factor out marshalling `(PR #189)`
- Allow AWS tokens in the repository `(PR #188)`
  -
- tenant: prevent parallel test runs when mocking enforcement `(PR #187)`
- Configure and activate Admin UI `(PR #186)`
  - [Appliance] Activate appliance updates on Code Search admin UI
- sg: skip dev-private check if OFFLINE set `(PR #185)`
- Updating owner tag `(PR #183)`
- security: Ensure sourcegraph will run with uid randomisation `(PR #182)`
- tenant: add context to gitserver's filesystem interface `(PR #178)`
- change re-ranking method from public to private `(PR #173)`
- Web: encode file path for blame `(PR #172)`
  - Fixes an issue that would cause blame view to fail on files that contain some special characters.
- Fix main lint `(PR #169)`
  - [Fix] code linting
- Redis: add context to httpcache and rcache `(PR #167)`
- fixing the limit text for autocompletes `(PR #166)`
- Bug: Fix file/directory popover regression `(PR #165)`
  - Fix File and directory popovers in the file tree when code search is scoped to a perforce depot.
- ci/srcgql-compat: fix workflow `(PR #161)`
- guardrails: temporary cache for incident `(PR #158)`
- security: Remove root from some containers, and make it clearer which containers run as root `(PR #157)`
- Update site.schema.json `(PR #155)`
- all: update OWNERS and CODENOTIFY to match new team names `(PR #148)`
- migrations: remove read on pg_attribute for tenant_id `(PR #147)`
- Cody Web: Update cody web to 0.7.1 `(PR #144)`
- dev/cloud-relay: add msp delivery target for rollout `(PR #142)`
- Cody Web: fix cody web in svelte safari `(PR #138)`
- Instrument request latency in Cody Gateway `(PR #136)`
- dev/cloud-relay: import repo `(PR #132)`
- all: upgrade staticcheck and unparam `(PR #128)`
- Cody Web: Update cody web to 0.6.1 (svelte and react) `(PR #127)`
- ci/cloud-gql-compat: only report error on remote workflow failure `(PR #125)`
- add perforce support for git references table and labels `(PR #124)`
  - Code Search now supports labels for Perforce Depots
- iterator: add Map function `(PR #123)`
- symbols: skip rockskipintegration on dev if missing binaries `(PR #121)`
- syntactic-indexing: skip tests on dev if scip-syntax is missing `(PR #120)`
- keyring: t.Parallel safe MockDefault `(PR #119)`
- appliance: inject os.Getenv to ensure clean environment `(PR #118)`
- db: add event_logs_export_allowlist and own_signal_configurations to DataTables `(PR #111)`
- expand special case handlers for context endpoint `(PR #110)`
- More context improvements `(PR #104)`
- adding cohere reRanker in the cody context `(PR #102)`
- Don't use markdown header symbols in graphql docs `(PR #99)`
- appliance: check ShouldRunSetupEnvTests in integrationtest `(PR #97)`
- Fix hardcoded version number in security release approval message `(PR #96)`
- blobstore: support tenant isolation `(PR #94)`
- Make syntactic indexing policies non exclusive to precise indexing `(PR #92)`
- Add --build flag to `sg cloud ephemeral upgrade` `(PR #91)`
- Turn off minification for cody web worker `(PR #90)`
- Redis: add context arg for list methods `(PR #89)`
- Basic custom context handler `(PR #86)`
- security: Auto-update package lockfiles for Sourcegraph base images `(PR #85)`
- React: Bump Cody Web to 0.5.1 `(PR #79)`
- lib/cloudapi: restructure pkg to reduce nesting `(PR #68)`
- nix flake update to go 1.23 `(PR #62)`
- nix: local is a string for GOTOOLCHAIN `(PR #61)`
- sg CLI: Use correct pipeline when retrieving annotations `(PR #60)`
- security: Auto-update package lockfiles for Sourcegraph base images `(PR #56)`
- nix: set GOTOOLCHAIN=local `(PR #55)`
- Search: improve indexing delay dashboards `(PR #54)`
- telemetry: always best-effort write to v1 store `(PR #53)`
- database: limit concurrent event log inserts `(PR #52)`
- Only commits in policy commitmap `(PR #49)`
- lib/cloudapi: import cloud-api proto def `(PR #40)`
- ctags/6.1.0 package update `(PR #38)`
- redis_exporter/1.62.0 package update `(PR #37)`
- docker-client/27.1.2 package update `(PR #36)`
- p4-fusion/1.13 package update `(PR #35)`
- jaeger/1.60.0 package update `(PR #34)`
- [Stream API]: Add external_service_type field to the SearchedRepo type `(PR #32)`
  - Searched repo, commit, path, symbol and file match responses will now include external service type.
-  Directory mentions: extract and test buildKeywordQuery `(PR #30)`
- lib/background: fix flaky test of monitor routines with context cancel `(PR #29)`
- direct route for fireworks models `(PR #26)`
- repos: use passed in ctx for SystemsInfo `(PR #18)`
- Removing featureflag for expanded audit logs `(PR #15)`
  - More auditlogs for sensitive admin actions will be automatically logged.
- Perforce UI Elements: Add perforce UI elements to history panel `(PR #12)`
- Add typescript parser for SCIP symbols `(PR #10)`
- migrations: run squash targetting v5.3.0 `(PR #9)`

### Untracked

The following PRs were merged onto the previous release branch but could not be automatically mapped to a corresponding commit in this release:

- Support SAST Scanning with both GHAS and Custom post processing scrip… `(PR #67)`
  - sast scans are reported without any issues
- added better GHAS check (#64537) `(PR #65)`
  - chore(security): Fix GHAS check as non-zero exit code

{/* RSS={"version":"v5.7.0", "releasedAt": "2024-09-04"} */}

# 5.6 Patch 2

## v5.6.2535
- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.6.2535)
- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.6.2535)
- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.6.2535)
- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.6.2535)

{/* RSS={"version":"v5.6.2535", "releasedAt": "2024-08-22"} */}

### Chore


#### Security

- security: added better GHAS check (#64537) `(PR #65)`
  - chore(security): Fix GHAS check as non-zero exit code

### Uncategorized

- Support SAST Scanning with both GHAS and Custom post processing scrip… `(PR #67)`
  - sast scans are reported without any issues
- [Backport 5.6.x] fix(search): fix query parsing bug around quoted phrases #59 `(PR #70)`
- [Backport 5.6.x] fix(batches): fix broken forking workflow `(PR #81)`fix(batches): fix broken forking workflow
  Backport f833c4a3bf2210c127ffbf1146be69e1f461a449 from #48
- [Backport 5.6.x] svelte: add slash to path scope `(PR #98)`
  - Fixes a bug in the new web app that causes incorrect links to be generated for collapsed file names
 Backport 23dad06bb2af1e7eb6a2f3847ad7f2c76c2a89a5 from #95
- [Backport 5.6.x] feat(cody): add deepseek-coder-v2-lite-base support `(PR #103)` Backport f71fe081aa43ca40fef66c067c8eaf49d62d491e from #4
- backporting #106 `(PR #107)`

# 5.6 Patch 1

## v5.6.185
- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.6.185)
- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.6.185)
- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.6.185)
- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.6.185)

{/* RSS={"version":"v5.6.185", "releasedAt": "2024-08-08"} */}

### Uncategorized

- [Backport 5.6.x] Changing azureUseDeprecatedCompletionsAPIForOldModels to default to true [#64371](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64371) Backport 3b16059588e5eff69e00ed56a489ac8560a70d8e from #64347
- [Backport 5.6.x] Fix Cody Web CSS [#64373](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64373)
  - Make Cody Web styles more accessible.  Backport 2dd38b3ffd828a1596249c2780ca91bf4bce4bdd from #64370

# 5.6 Patch 0

## v5.6.0
- [sourcegraph](https://github.com/sourcegraph/sourcegraph/releases/tag/v5.6.0)
- [docker-compose](https://github.com/sourcegraph/deploy-sourcegraph-docker/releases/tag/v5.6.0)
- [helm](https://github.com/sourcegraph/deploy-sourcegraph-helm/releases/tag/v5.6.0)
- [kustomize](https://github.com/sourcegraph/deploy-sourcegraph-k8s/releases/tag/v5.6.0)

{/* RSS={"version":"v5.6.0", "releasedAt": "2024-08-07"} */}

### Feature

#### Codenav

- codenav: Add symbol support for the Hack language [#64015](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64015)

#### Frontend

- frontend: do not embed frontend assets anymore [#63946](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63946)
  - frontend: assets are no longer bundled with binary through `go:embed`. Instead assets are now added to the frontend container at `assets-dist`.

#### Local

- local: sg tail  [#64146](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64146)
  - Adds a new `sg tail` command that provides a better UI to tail and filter log messages from `sg start --tail`.

#### Appliance

- appliance: implement re-direct on all unknown endpoints [#64059](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64059)
  - feat(appliance): implement re-direct on all unknown endpoints
- appliance: Adopt Frontend Service + Ingress [#63893](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63893)
  - feat(appliance): Appliance adopts Frontend's `Ingress` + `Service`
- appliance: Merge unstructured objects from helm serialization and appliance cfg defaults [#64021](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64021)
  - feat/appliance: Include existing objects when constructing Frontend's `Service` & `Ingress`
- appliance: self-update [#63780](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63780)
  - Appliance can automatically self-update up to 2 minor revisions beyond the currently-deployed sourcegraph version.
- appliance: introduce mock up database configuration step in install flow [#64162](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64162)
- appliance: self-update can update multiple deployments [#64132](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64132)
- Appliance: Frontend Pulls Version Info from RelReg [#64089](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64089)
  - feat(appliance): frontend pulls versions from relreg
- appliance: Change site-admin updates button to point to Appliance based on env var [#64167](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64167)
  - feat(appliance): change update endpoint based on env var
  - misc: add type to storybook

#### Enterpriseportal

- enterpriseportal: db layer for cody gateway access [#63737](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63737)
- enterpriseportal: support DevOnly in list subscriptions [#63837](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63837)
- enterpriseportal: db layer for subscription licenses [#63792](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63792)
- enterpriseportal: db layer for subscription conditions [#63812](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63812)
- enterpriseportal: ignore context cancellation error in GetCodyGatewayUsage [#64016](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64016)

#### Search

- search: remove smart search logic [#64215](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64215)Smart search is no longer supported in the Sourcegraph backend. Old searches that specify 'smart search' mode will be run in the default 'precise' mode. If your query now doesn't behave as expected, you can update it to use the new `patterntype:keyword`.
- search: update Zoekt [#64238](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64238)
  - added support for all Apex language extensions
  - shard merging for Zoekt is now enabled by default. This reduces MEM requirements for Zoekt webserver and improves performance for some queries. See our [documentation](https://sourcegraph.com/docs/admin/search#shard-merging) for more information.  
- search: Add support to all Apex language extensions [#64194](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64194)
- search: Enable improved symbol parsing for large repos (when using Rockskip) [#63988](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63988)

#### Svelte

- svelte: Improve commit page layout on mobile [#63920](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63920)
- svelte: Change branch and tags page design, including mobile [#63914](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63914)
- svelte: Add support for creating search jobs from search results [#64308](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64308)
- svelte: Improve small screeen behavior [#63859](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63859)
- svelte: Add compare page [#63850](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63850)
- svelte: Add search query syntax introduction [#63753](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63753)
- svelte: Add 'y' shortcut to navigate to permalink  [#63719](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63719)

#### Dotcom

- dotcom: use Enterprise Portal for Cody Gateway usage [#63653](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63653)

#### Build

- build: Add exhaustruct linter (codeintel POC) [#63965](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63965)

#### Others

- Add support for precise usagesForSymbol [#64126](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64126)
  - Adds support for precise code navigation to the experimental `usagesForSymbol` API,
which can be used to implement a reference panel or similar functionality.
- order search filters alphabetically [#63976](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63976)
- show current email during password reset and auto-populate text-box after successful completion [#59645](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59645)

#### Bazel

- bazel: read binary version info from accompanying files in OCI images instead of stamping //internal/version [#63977](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63977)

#### Sg

- sg: prototype 'sg start sourcegraph-accounts' [#63894](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63894)
- sg: add 'sg sams client create' [#63885](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63885)
  - `sg sams client create` can now be used to create IdP clients for SAMS.
- sg: support correct completions on 'sg start -cmd' [#63861](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63861)
  - Completions for `sg start -cmd` now offer valid suggestions.
- sg: report user os information via analytics [#64280](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64280)
- sg: do not persist external secrets [#63890](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63890)
- sg: allow sg commands to default to local-dev SAMS-dev credentials [#63883](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63883)
  - `sg` commands requiring SAMS client credentials now load shared SAMS-dev client credentials by default.

#### Cody

- cody: Refactor completions API to use new modelconfig (support more models) [#63797](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63797)Update the Cody APIs for chat or code completions to use the "new style" model configuration. This allows for great flexibility in configuring LLM providers and exposing new models, but also allows Cody Enterprise users to select different models for chats.This will warrant a longer, more detailed changelog entry for the patch release next week. As this unlocks many other exciting features.
- cody: add circuit breaker to handle timed-out requests and rate limit hits [#64133](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64133)

#### Requestclient

- requestclient: propagate original User-Agent as X-Forwarded-For-User-Agent [#64113](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64113)

### Fix


#### Appliance

- appliance: don't include is_development builds in list of versions [#64138](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64138)
  - fix(appliance): don't allow installation of development builds
- appliance: Make Appliance URL envvars strings [#64227](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64227)
  - fix(appliance): make environment variables strings to be passed around

#### Own

- own: Prevent infinite UI update loop in own pages [#64312](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64312)

#### Docs

- docs: update quickstart guide links [#64202](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64202)

#### Cody

- cody: use client-provided timeout for completions requests [#63875](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63875)
  - Use the provided timeout from request parameters if available; otherwise use the default maximum request duration (8 minutes)
- cody: allow pre-release versions for clients [#63913](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63913)
- cody: remove client check for context filters [#63855](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63855)

#### Search

- search: correctly handle select:symbol.enum [#64170](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64170)Fix a bug in `select:symbol.enum` filters where they returned no results

#### Bazel

- bazel: surface error message when gazelle cant process glob expression [#64214](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64214)

#### Search_jobs

- search_jobs: prevent job state flip-flopping between 'queued' and 'processing' [#64098](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64098)
- search_jobs: remove trailing `*` from URL [#63821](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63821)
- search_jobs: progress reporting [#64287](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64287)
  - Show detailed progress only while job is in status "processing"
  - Remove dependency of download links on job state
- search_jobs: fail validation for repo searches [#64300](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64300)
- search_jobs: flickering placeholder component [#64009](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64009)

#### Enterpriseportal

- enterpriseportal: drop old gorm fk constraints [#63864](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63864)

#### Svelte

- svelte: Properly redirect to cody marketing page [#64331](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64331)
- svelte: Make /cody/dashboard work with the new web app [#64295](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64295)
- svelte: Show correct line numbers in unified diff [#63778](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63778)
- svelte: Fix and cleanup compare page [#63928](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63928)
- svelte: Update top-level route list [#64272](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64272)
- svelte: Ctrl+backspace in fuzzy finder [#63804](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63804)
- svelte: respect default pattern type in toggles [#63795](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63795)
- svelte: Better preloading in file tree [#64327](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64327)
- svelte: Center file tree loading indicator [#64309](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64309)

#### Ci

- ci: reduce push_all concurrency even further due to ratelimits [#64111](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64111)
- ci: check command out for error when git fails [#63993](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63993)
- ci: reduce push_all concurrency due to ratelimits [#64106](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64106)
- ci: only emit bazel execlog artifact for 'test' commands [#63916](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63916)

#### Release

- release: check for marker in container files instead of binary [#64205](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64205)
  - release: check contiainer directory `/assets-dist` for marker instead of frontend binary


#### Sg

- sg: cloud ephemeral - do no trigger builds on main-dry-run [#64190](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64190)
  - sg: deny deployment of `main-dry-run` branches on Cloud Ephemeral.
- sg: better err msg for when we fail to insert to bigquery [#63873](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63873)
  - sg: provide a better error message when we fail to insert into bigquery
  - sg: stop puslishing to bigquery if we get 3 errors in a row
- sg: do not try to publish analytics when it is disabled [#63800](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63800)
  - sg - only start the analytics background publisher when analytics are enabled
- sg: return different error types depending on secret failure [#63779](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63779)
- sg: provide suggestions we fail to get local gcp account email address [#64325](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64325)sg - provide steps a user can follow if we fail to get the local gcp email address
- sg: acknowledge command execution state to avoid recursion when executing short running commands [#64181](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64181)

#### Batches

- batches: switch github app installation handling from redirect flow to webhooks [#64036](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64036)
  - When installing a GitHub app for batch changes, the instance now waits for a callback from GitHub to complete the installation to avoid issues from eventual consistency.
- batches: don't request unnecessary info that's likely to cause GH errors [#64299](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64299)
  - fix(batches): improve GitHub Apps integration reliability by simplifying the data requested from GitHub
- batches: show warning instead of error when the changeset status is not FAILED [#64243](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64243)
  - Batch changes that are still retrying now show a warning instead of an error.

#### Others

- Try workaround for bad index choice when updating execution logs [#64328](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64328)
- block URLs without a hostname [#64248](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64248)
- uses the same base64 for decoding we use for encoding the UsageCursor [#64290](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64290)
- Don't propagate un-translated source ranges [#64263](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64263)
- Handle sub-repo permissions in CodeGraphData API [#64241](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64241)
- Fixes incorrect highlighting for comments at the start of a file [#64235](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64235)Fixes incorrect syntax highlighting when a comment is present at the start of a file.
- connection pending alert and alert content alignment [#64120](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64120)
- set timeout for web-sveltekit/unit_tests to moderate [#63879](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63879)
- Add Exists method to dbworker Store to avoid COUNT(*) [#64297](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64297)
- Prefer SCIP uploads over LSIF uploads [#64217](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64217)Fixes a bug where old LSIF uploads would also be used for code
navigation even when newer SCIP uploads were available for the
same language, potentially leading to duplicate results in the reference
panel. With this change, scip-go uploads shadow the uploads
for lsif-go, and similarly for other indexers following the scip-X/lsif-X naming
convention.
- Synchronize access to reads of fields in retry test [#63967](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63967)
- add extra check for code intelligence inference [#64083](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64083)
- De-dup and concurrent-ify file content requests & splitting [#64169](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64169)
- Handle potential nil reference properly [#64265](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64265)
- add commit signing filter to `credentialForGitHubAppExists` [#64128](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64128)
- make invalid token error message visible while adding external services [#60876](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60876)

#### Telemetry

- telemetry: silence invalid events that we already know about [#64084](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64084)

### Chore


#### Others

- Mark flaky web-sveltekit tests as manual [#63874](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63874)
- Frontend does not need disk [#64273](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64273)
- Make return type more obvious [#63651](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63651)
- Update main occurrence extraction code to allow for symbol-based matching [#64082](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64082)
- Rename Index -> AutoIndexJob [#63955](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63955)
- Reduce frequency of COUNT(*) on lsif_indexes [#64288](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64288)
- Bump version of sourcegraph/log library [#64233](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64233)
- Remove cmd/frontend/external/app [#64054](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64054)
- Remove redis init side-effect of app.NewHandler [#64062](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64062)
- Don't pass nil context [#64055](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64055)
- Move codenav types to lower-level package [#64141](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64141)
- Replace 'dumps' terminology in comments [#63775](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63775)
- Change some APIs to use symbols instead of monikers [#64029](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64029)
- Rename uploadstore packages for clarity [#63931](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63931)
- Remove incorrectly logged warning [#64267](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64267)
- Use binary search over symbols array [#64240](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64240)
- De-duplicate CTE for visible uploads [#64232](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64232)
- Remove unused loghandlers package [#64067](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64067)
- move internal/conf/validation to cmd/frontend [#64064](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64064)
- Init userpasswd provider where we initialize every other authn provider [#64061](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64061)
- remove flaky flag from svelte e2e_test [#64123](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64123)
- Mark flaky test as manual [#63968](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63968)
- Factor out sub-query for locating nearest uploads [#64210](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64210)
- Remove global externalURL watcher [#64058](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64058)
- re-enable e2e tests for web-sveltekit [#63910](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63910)
- Replace QueuedCount -> CountByState with bitset parameter [#64302](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64302)
- Deglobalize oneclickexporter instance [#64066](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64066)
- Make location fetching queries more uniform [#64026](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64026)
- Document tech debt wrt multiple doc traversals [#64006](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64006)
- Unify LsifStore.*SymbolUsages APIs into one [#64076](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64076)
- Add docs for RepoStore methods [#64283](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64283)
- Rename URI -> DocumentPath [#63979](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63979)
- Remove unused TTL in object.Storage config [#63947](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63947)
- Move cmd/frontend/webhooks to cmd/frontend/internal [#64157](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64157)
- Rename type Bytes -> Size [#64183](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64183)
- Unconditionally call endObservation [#64150](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64150)
- move internal/highlight to cmd/frontend [#64065](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64065)
- Bubble precise Usages instead of Locations [#64118](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64118)
- Switch over to fake RepoStore in codenav tests [#64284](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64284)
- move internal/suspiciousnames to cmd/frontend/internal [#64071](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64071)
- Simplify license routines [#64068](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64068)
- Use Option type and rename API [#63820](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63820)
- Bump autoindexing image SHAs [#63801](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63801)
- Move and clean up test code for syntactic usages [#64318](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64318)
- Remove unnecessary _ imports [#64158](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64158)
- remove cmd/frontend/external redirection package [#64070](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64070)
- Consolidate mocks for dbworker/store.Store type [#64294](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64294)
- Consolidate mocks for uploads's Store type [#64286](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64286)
- move cmd/frontend/oneclickexport to cmd/frontend/internal/oneclickexport [#64069](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64069)
- Move authn into cmd/frontend [#63648](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63648)GitLab code host connections were [able to sync permissions by mapping Sourcegraph users to GitLab users via the username property of an external OIDC or SAML provider](https://sourcegraph.com/docs/admin/code_hosts/gitlab#administrator-sudo-level-access-token) that is shared across Sourcegraph and GitLab. This integration stopped working a long time ago, and it has been removed in this release.
- Replace calls to deprecated ioutil.TempFile [#64177](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64177)

#### Svelte

- svelte: Add manual entries for repo sub pages to development proxy [#64313](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64313)
- svelte: Disable tests which time out [#63844](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63844)
- svelte: Refactor infinity query implementation [#63824](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63824)
- svelte: fix test by removing duplicate aria-label [#63942](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63942)
- svelte: Commit/diff style and behavior tweaks [#63785](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63785)
- svelte: Refactor repo loaders [#63828](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63828)
- svelte: Clean up dependencies [#63777](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63777)

#### Enterpriseportal

- enterpriseportal: rewrite subscriptions API tests to be table-driven [#63831](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63831)
- enterpriseportal: simplify display_name constraint [#63835](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63835)

#### Telemetrygateway

- telemetrygateway: gracefully handle sams introspectToken cancelation [#63809](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63809)

#### Bazel

- bazel: re-enable remote caching of Copy&#123File,Directory,ToDirectory&#125 actions [#64153](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64153)
- bazel: emit json profile for image push jobs [#64188](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64188)
- bazel: rework push_all to improve concurrency by avoiding bazel server lock (round 2) [#64079](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64079)
- bazel: emit json profile for image push jobs (properly) [#64189](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64189)
- bazel: disable stamping on rust_binary targets [#64007](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64007)

#### Config

- config: clarify env var already registered panic [#63784](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63784)
  - When conflicting env var are detected, print the two to ease debugging.

#### Executors

- executors: Native Kubernetes Executors default to use single job pod [#64088](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64088)

#### Codeintel

- codeintel: Derive TargetPathWithoutRoot dynamically [#63986](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63986)
- codeintel: Move mock generation near interface package [#64000](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64000)
- codeintel: Simplify code using upload filtering [#63997](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63997)
- codeintel: Pass UsageKind instead of raw column names [#64003](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64003)
- codeintel: replaces lsp.Range uses with scip.Range [#64178](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64178)
- codeintel: Rename local variables for clarity [#63983](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63983)
- codeintel: Move RequestState construction to separate func [#63998](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63998)
- codeintel: Rename uploads/../Store -> codegraph/../DataStore [#64001](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64001)

#### Search

- search: update search API call sites to set the version explicitly [#63782](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63782)
- search: update logging of search durations [#64269](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64269)

#### Local

- local: clear ambiguity in between sg version|live [#64122](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64122)
  - `sg version` explicitly mentions that it's the CLI version that's printed out, not any instance version.
- local: use //cmd/frontend:frontend_nobundle for bazel commandsets [#64085](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64085)

#### Search_jobs

- search_jobs: add janitor job [#64186](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64186)The new background job drastically reduces the size of the `exhaustive_*` tables and improves performance of the Search Jobs GQL API.
- search_jobs: improve description on main page [#63992](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63992)
- search_jobs: remove label "admin" from contact card [#63823](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63823)

#### Cody

- cody: allow setting "cody.contextFilters" in site config without feature flag [#63881](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63881)

#### Frontend

- frontend: use explicit cache for admin analytics [#64077](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64077)

#### Worker

- worker: move aggregated user stats job to worker [#64033](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64033)
- worker: disable jobs based on ENVs [#63853](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63853)
- worker: move event_logs janitor routines to worker [#63981](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63981)
- worker: move llm token counter to worker [#64008](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64008)
- worker: move refreshAnalyticsCache to worker [#64041](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64041)

#### Log

- log: remove use of log15 in ghe-feeder [#64131](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64131)

#### Ci

- ci: emit execlog for image push jobs [#64130](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64130)

#### Sg

- sg: remove 'sg telemetry' and related docs [#63763](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63763)
  - `sg`: the deprecated `sg telemetry` command for allowlisting export of V1 telemetry from Cloud instances has been removed. Use telemetry V2 instead.
- sg: clean up help formatting [#63860](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63860)

### Ci


#### Others

- add cloud controller gql compat test [#64092](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64092)
- automatic retry push images job at least 1 [#64145](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64145)

### Perf


#### Others

- Find syntactic matches concurrently [#63937](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63937)

### Refactor


#### Github

- github: Have a dedicated PublicRepository type [#63607](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63607)

#### Codeintel

- codeintel: Extracts a MappedIndex abstraction over uploads [#63781](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63781)

#### Others

- steps the usage cursor provenance state in a single place [#64321](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64321)
- handles Cursor uniformly over all usage provenances [#64319](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64319)
- renames usage cursor and adds fields for future syntactic cursor [#64208](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64208)

#### Svelte

- svelte: Reduce logo complexity [#64274](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64274)

### Reverts

- Revert "Cody: add support for neovim, cody-cli, eclipse, and visualstudio clients [#63854](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63854)
- Revert "chore(ci): post instructions for PR sections in a comment" [#64176](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64187)

### Uncategorized

- feat(code insights): language stats speed improvements by using archive loading [#62946](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62946)
  - Language stats queries now request one archive from gitserver instead of individual file requests. This leads to a huge performance improvement. Even extra large repositories like chromium are now able to compute within one minute. Previously they timed out.
- various improvements to saved searches [#63539](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63539)
  - Improved the saved searches feature, which lets you save search queries to easily reuse them later and share them with other people in an organization.
  - Added the ability to transfer ownership of a saved search to a user's organizations or from an organization to a user's account.
  - Removed a long-deprecated and ineffective settings `search.savedQueries` field. You can manage saved searches in a user's or organization's profile area (e.g., at `/user/searches`).
- Correctly re-map source ranges in new SCIP-based APIs [#63630](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63630)
- Move internal/session into cmd/frontend/internal [#63649](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63649)
- subrepo: More explicitly define supported hosts [#63650](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63650)
- licensecheck: Make proper goroutine [#63655](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63655)
- Remove old reference to env var that no longer exists [#63656](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63656)
- schema: Remove unused extension schema file [#63657](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63657)
- dotcom: Remove dotcom on-by-default Cloudflare trust mode [#63658](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63658)
- webhooks: Polish UI components [#63664](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63664)
- webhooks: Deterministically match webhook events to repos [#63668](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63668)
- gating: Add individual switches for disabling tools features [#63686](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63686)
- Svelte: implement new reference panel against new Usages API [#63724](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63724)
- Usages API: implement surroundingContent [#63730](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63730)
- authz: Drop requirement for installing authz providers in every service [#63743](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63743)
- make pagination hooks store filter & query params in URL, not just pagination params [#63744](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63744)
- Update comment and decode bytes instead [#63754](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63754)
- Svelte: some unrelated cleanups [#63757](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63757)
- fix/internal/txemail: add timeout for SMTP connection establishment [#63759](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63759)
  - Instead of waiting forever, we wait at most 30 seconds before giving up when trying to connect to the configured mail server when sending an email.
- feat/graphql/access_tokens: send access token creation/deletion emails in background and create special message for dial errors [#63760](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63760)
  - When creating or deleting an access token, we no longer wait for the email to be sent before returning to the caller. Instead, we now send it in the background.
- Add more Completions handler tests [#63761](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63761)NA
- Search: make 'exclude tests' more general [#63762](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63762)
- Minor refactoring, fixes [#63766](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63766)NA
- Svelte: add more general shrinkable path [#63770](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63770)
- feature/db/sub_repo_perms: add IPs column to sub repo perms [#63771](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63771)
  - The sub_repo_permissions table now has an ips column to store the associated IP address associated with each path rule.
- security: Auto-update package lockfiles for Sourcegraph base images [#63776](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63776)
- gateway: Don't panic because of duplicate env var registration [#63787](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63787)
- RFC 969 API boilerplate [#63789](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63789)
- Structural search: fix precise lang filtering [#63791](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63791)
- feature: update `sg release cut` to automate stitch graph gen and release branch creation [#63794](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63794)
- Wolfi image for Sourcegraph Frontend [#63798](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63798)
- fix(nix/p4-fusion): update p4-fusion helix-api hashes [#63805](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63805)
- Move Cody Web to beta [#63806](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63806)
- feat/lib/telemetrygateway: expose simple Dial [#63810](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63810)
- internal/database/sub_repo_permissions: modify store to be able to insert ip based permissions [#63811](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63811)The sub_repositorypermissions database store can now save and retrieve the IP addresses associated with each path rule.
- Several fixes around merging modelconfig, and the current Cody Gateway data [#63814](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63814)NA
- Svelte: optimize `observeIntersection` [#63816](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63816)
- change model identifier for finetuned deepseek model [#63817](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63817)
- Syntactic indexing non local refs java [#63822](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63822)
- feat/sg/msp: helpful error on cloudsqlproxy port conflict [#63830](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63830)
- feat/sg/enterprise: add 'sg enterprise set-name' [#63832](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63832)
- updated error messaging for blocked requests due to abuse [#63836](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63836)
- gitserver: Add option to allow setting custom context line count [#63840](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63840)
- misc saved searches followups [#63841](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63841)
- gitserver: Add OctopusMergeBase RPC method [#63842](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63842)
- pr-auditor: use pr-auditor from devx-service [#63847](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63847)
- Cody: add access token callback pages for CLI, Eclipse and VS [#63849](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63849)
- Cody: add support for neovim, cody-cli, eclipse, and visualstudio clients [#63851](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63851)
  - Fix HTTP 406 error when using the Neovim Cody plugin with Enterprise instances

- chore/lib/telemetrygateway: fixup Dial helper [#63862](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63862)
- Blame: fix some issues with the stream [#63865](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63865)
  - Fixed an issue with blame view that can cause retry loops and error pages that block interaction with the rest of the UI
- docs: Add alternate names and links in GraphQL docs [#63867](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63867)
- show saved searches in new global navbar [#63868](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63868)
- factor out PatternConstrainedInput [#63869](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63869)
- Add configuration for Intent Detection API [#63871](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63871)
- Prompt Library [#63872](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63872)
  - The Prompt Library lets you create, share, and browse chat prompts for use with Cody. Prompts are owned by users or organizations, and site admins can make prompts public so that all users on the instance can see and use them. To use a prompt from your Prompt Library in Cody, select it in the Prompts dropdown in the Cody chat message field.
- Integrate Cohere re-ranking API [#63877](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63877)
- Special oauth containers [#63880](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63880)
- Feature: db connection pinger and validator [#63884](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63884)
- Update CodyLLMConfiguration GraphQL object to be modelconfig aware [#63886](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63886)NA
- sg: check for nil multiError [#63889](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63889)
- Search: add regex support to `repo:has.meta()` [#63891](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63891)
  - `repo:has.meta()` predicate now supports regex patterns for keys and values
- Fixes re: Cody Pro x Sourcegraph-supplied models [#63892](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63892)NA
- cody-gateway: handle missing Google response [#63895](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63895)cody-gateway: log missing Google response as warning
- Svelte: fix css selector [#63896](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63896)
- self hosted models [#63899](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63899)Cody Enterprise: added a new configuration for self-hosting models. Reach out to support if you would like to use this feature as it is in early access.
- Adds unit tests for syntactic usages [#63900](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63900)
- [sg] Make rfc command use private RFCs by default [#63902](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63902)
- Unify naming of used/ignored context [#63903](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63903)
- track usage stats for saved searches in UTC day increments [#63904](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63904)
- query Repository.id to support Apollo Client caching [#63905](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63905)
- withAuthenticatedUser: use react-router-dom hooks & add test [#63906](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63906)
- show org name not displayName in most places [#63907](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63907)
  - The user menu and other filter menus now show the names of organizations, not their "display names", to avoid ambiguity. For example, these menus will now show `abc-corp` not `ABC Corp` (if the latter was the `abc-corp`'s display name).
- add saved search visibility, draft, and timestamps [#63909](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63909)
  - Saved searches can now be made public (by site admins), which means all users can view them. This is a great way to share useful search queries with all users of a Sourcegraph instance.
  - Saved searches can be marked as a "draft", which is a gentle indicator that other people shouldn't use it yet.
- fix(build-tracker): Failed back-compat doesn't count towards branch-locking quota [#63911](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63911)
- sg: enable alerting by default for production projects [#63912](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63912)
- Add separate shadow value for hovercards [#63918](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63918)
- GraphQL: improve query cost violation message [#63921](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63921)
- fix/frontend/httpapi: improve request reader [#63923](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63923)
- saved searches & prompt library fixes [#63930](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63930)
- remove "organizations aren't supported" page on dotcom [#63932](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63932)
- prevent orgs from being named "global" on dotcom [#63933](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63933)
- allow non-site admins to list their orgs' members on dotcom [#63934](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63934)
- show "Copied" indicator when copying an access token [#63936](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63936)
- codeintel: GitTreeTranslator rewrite [#63938](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63938)
- repoupdater: Make batches init jobs dependent on batches.IsEnabled [#63939](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63939)
- [update] Remove sleep in goroutine for webhook handlers [#63940](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63940)
- support getting other orgs on dotcom from the GraphQL API [#63941](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63941)
- misc improvements to graphqlbackend [#63943](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63943)
- explicitly check viewer access to settings in GraphQL API [#63945](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63945)
- use the viewerSettings GraphQL API instead of the 5y+-deprecated viewerConfiguration API [#63949](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63949)
- upgrade vitest to latest [#63951](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63951)
- Add counter for traced requests to Fireworks [#63953](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63953)
- Remove references to modelconfig.sourcegraph.pollingInterval [#63956](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63956)NA
- fix/database/sub_repo_perms: don't mark TestSubRepoPermsStore_GetByUserWithIPs as Parallel [#63958](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63958)
  - A race condition in the sub_repo_permissions database store test suite has been fixed.
- Svelte rollout: add toggles for svelte-enabled pages [#63960](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63960)
- fix saved searches and prompts list page for anon users [#63961](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63961)
- various OrgArea fixes [#63962](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63962)
- allow site admins to list org members & view user/org settings on dotcom [#63963](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63963)
- Svelte: Fix Safari 17.3 groupBy usage [#63964](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63964)
- finish removing chromatic [#63966](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63966)
- cody: correct link to emacs-cody [#63974](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63974)
- Implement server-side single-repo context fetching for RFC 969 [#63980](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63980)
- [fix] Fix being unable to add batch changes credentials when rate limited [#63984](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63984)
  - Fixed an issue where, when Sourcegraph is applying rate limits, batch change credentials could not be added. Sourcegraph now waits a maximum of 10 seconds to update credentials, and if it times out, it saves the credentials regardless and displays a warning to the user.
- fix incorrect URL (/new) on saved search and prompt library pages [#63995](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63995)
- feature/worker/permission syncer: perforce: sync HOST field using IP addresses [#64010](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64010)
  - The perforce permissions syncer has been updated to save the IP address associated with each sub_repository_permissions rule.
- Bring back post-sign-up route to the backend router [#64011](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64011)
- authz: Compute providers on the fly [#64012](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64012)
- feat/frontend/dotcom: add toggles for various online license checks [#64013](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64013)
- Update the legacy link to sg doc [#64017](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64017)
- Update the outdated link to #dev-experience to #discuss-dev-infra [#64018](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64018)
- Maintenance Splash Page [#64019](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64019)
- codeintel: returns surroundingContent from search result [#64022](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64022)
- codeintel: runs occurrence and symbol search in parallel [#64023](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64023)
- codeintel: allows batch retrieval of SCIP documents [#64024](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64024)
- codeintel: fetches diffs from gitserver in batches [#64025](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64025)
- Removes the old GitTreeTranslator API [#64027](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64027)
- Remove dead collaborators invite code [#64039](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64039)
- Make cody gateway usage worker a periodic routine [#64040](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64040)
- Unpin openjdk-11 version in blobstore package [#64045](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64045)
- bug: update version consts in updatecheck handler [#64052](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64052)
- cleanup: Move azure openai provider config validation to right place [#64056](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64056)
- security: Auto-update package lockfiles for Sourcegraph base images [#64060](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64060)
- auth: Fix Found page response when redis is down [#64063](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64063)
- codeintel: Adds a batch api for fetching multiple documents to MappedIndex [#64073](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64073)
- Syntactic indexing policy toggle: UI and supporting APIs (with backcompat) [#64075](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64075)
  - In site-admin APIs for updating code intelligence policies:
    - field `indexingEnabled` is renamed to `preciseIndexingEnabled`
    - a required `syntacticIndexingEnabled` is added (only takes effect if experimental feature is enabled)
    - field `forIndexing` is renamed to `forPreciseIndexing`
- codeintel: Speed up syntactic and search-based usages using batch APIs [#64078](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64078)
- scip-syntax: uses `.starts_with` to check reference capture [#64081](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64081)
- feat/worker/permission syncing: make sub repo permissions re-insertion fall back to original paths if ips not added yet [#64086](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64086)
- Enable p4-fusion by default for Perforce code host connections [#64101](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64101)
  - For Perforce code host connections, `p4-fusion` is now always enabled and the option for the much slower and unreliable `git p4` no longer exists.
- gerrit: Add support for repositoryPathPattern [#64102](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64102)Added support for the `repositoryPathPattern` setting for Gerrit code host connections.
- msp: use BUILDKITE_BUILD_CREATOR as fallback [#64104](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64104)
- msp: remove old author variable [#64107](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64107)
- Blob search: Fix incorrect icons in the blob search bar [#64108](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64108)
- gomod: update zoekt for guardrails perf experiment [#64109](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64109)
- Svelte Navigation: hide teams when own is not enabled [#64110](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64110)
- search-blitz: adjust limit for snippetAttribution to match gateway [#64119](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64119)
- observability: Adds useful data to traces from gosyntect.Highlight [#64121](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64121)
- scip-syntax: Simplifies to two visibilities [#64124](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64124)
- gomod: update zoekt to include improvement to experiment [#64125](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64125)
- Support detecting search and edit intent [#64129](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64129)
- SvelteKit: Add 'Tools' Menu item back to global navigation [#64134](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64134)
- Svelte: do not show path section if empty [#64135](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64135)
- SvelteKit: fix issue where clicking link with no href refreshed the page [#64136](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64136)
- fix/internal/requestclient: read all instances of x-forwarded-for header, not just the first [#64137](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64137)
- bug: parse v in target versions [#64139](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64139)
- codeintel: document that pagination for usages might return extra results [#64142](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64142)
- bug: fix default version [#64143](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64143)
- chore(syntax-highlighter): Some cleanup for locals detection [#64144](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64144)
- Bump cody web to most recent package @sourcegraph/cody-web [#64149](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64149)
- docs: Specify matching behavior for usagesForSymbol(range:) [#64151](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64151)
- Svelte: Bump cody web to most recent package @sourcegraph/cody-web [#64152](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64152)
- Nit: adds space between tools menu item and dropdown icon [#64154](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64154)
- frontend: Remove global conf server variable [#64155](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64155)
- frontend: Consolidate remaining registry packages [#64156](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64156)
- Add unit test for modelconfig converting starcoder completion model [#64160](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64160)NA
- Relax modelconfig name restrictions [#64161](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64161)NA.
- Svelte: add welcome introduction when enabling svelte for the first time [#64163](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64163)
- replace modelOverridesRecommendedSettings with selfHostedModels [#64164](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64164)Improved configuration functionality for Cody Enterprise with Self-hosted models.
- fix autocomplete regression in `main` ("various" provider issue) [#64165](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64165)N/A
- Expose ranker relevance score in GraphQL API [#64172](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64172)
- Policy patch - leave fields unchanged if they're missing from request [#64174](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64174)
- docs: Weaken guarantees for Usage cursor [#64185](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64185)
- Code intel: respect provenance when getting usages [#64193](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64193)
- Bump @sourcegraph/cody-web to 0.3.2 [#64195](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64195)
- Don't block `frontend` initialization with invalid modelconfig [#64200](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64200)NA
- security: Auto-update package lockfiles for Sourcegraph base images [#64204](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64204)
- search: apply phrase boosting to more queries [#64207](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64207)
- sg cloud eph: simplify status [#64209](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64209)
- Styling updates throughout [#64221](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64221)
- Svelte: welcome banner followups [#64222](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64222)
- Cody web: add server-side fetching for URL mentions [#64223](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64223)
- Bump @sourcegraph/cody-web to 0.3.4 [#64224](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64224)
- Chore: remove enablePreciseOccurrences feature flag [#64229](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64229)
- Web: fix git blame for files that have `/stream/` in their path [#64230](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64230)
  - Fixed an issue where blame view would error when the file contains the path element `/stream/`
- codeintel: make usage-range non-optional [#64236](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64236)
- ephemerals: fix feature flag name [#64237](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64237)
- Reapply "soap: Fix auto-redirect to IdP when SOAP is enabled" (#64234)  [#64244](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64244)
- gitserver: RawDiff checks if commits exist [#64245](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64245)Fixes a bug where a force push on HEAD of a repository might lead to our unindexed search failing until the indexed search had updated.
- servicecatalog: remove searcher dep on database [#64247](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64247)
- Chore: remove non-null assertions [#64249](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64249)
- Svelte: fix welcome banner flashing on reload [#64251](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64251)
- Cody Web: Update Cody Web to 0.3.6 [React version] [#64254](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64254)
- Svelte: make closing the welcome overlay more obvious [#64256](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64256)
- gomod: update zoekt for shard scanning improvement [#64264](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64264)
- Update p4-fusion-sg wolfi-package [#64266](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64266)
- Return 'sourcegraph' as the CodyLLMConfigurationResolver.Provider [#64276](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64276)NA
- Svelte: remove site admin gate on code intel preview [#64277](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64277)
- Improving Azure errors for customer containers [#64278](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64278)
- Update the default Sourcegraph-supplied LLM models [#64281](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64281)NA?
- Enable SCIP based APIs by default [#64285](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64285)
- Update wolfi hashes [#64289](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64289)
- searcher: fix benchmarks [#64292](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64292)
- Search: re-add support for 'lucky' patterntype [#64293](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64293)
- Update Cody Web to 0.3.7 [#64296](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64296)
- Search: boost matches on quoted terms [#64298](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64298)
- Return model IDs from GraphQL, not model Names [#64307](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64307)NA
- Svelte: more welcome banner behavior updates [#64311](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64311)
- Fix Cody Web Svelte Sidebar [#64320](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64320)
- Center align Cody logo in Cody Web Sidebar [#64324](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64324)
- upgrade Cody Web, always create a new chat [#64334](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64334)
- Svelte: enable toggle by default [#64340](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64340)

### Untracked

The following PRs were merged onto the previous release branch but could not be automatically mapped to a corresponding commit in this release:
- [Backport-5.5.x]: Move Cody Web to beta (#63806) [#63808](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63808)
- Backport: Blame: fix some issues with the stream (#63865) [#63929](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63929)
- security: Auto-update package lockfiles for Sourcegraph base images [#64035](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64035)
- security: Bump openjdk-11 version in blobstore image [#64047](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64047)
- appliance: backport all recent appliance changes [#64182](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64182)
  - Backport all recent appliance changes. The appliance is still pre-release.
- cherry-pick 856e41e with resolved conflicts [#64228](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64228)

# v5.5.3956

{/* RSS={"version":"v5.5.3956", "releasedAt": "2024-08-02"} */}

### Reverts

### Uncategorized

- [Backport-5.5.x]: Move Cody Web to beta (#63806) [#63808](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63808)
- [Backport 5.5.x] fix(batches): the baseURL for github instance is now updated when creating a GitHub app [#63833](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63833) Backport 1c40c9e5bccd4f6265945bd3449b70a648022e60 from #63803
- [Backport 5.5.x] Upgrade cody web experimental package to 0.2.5 [#63856](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63856)
- Backport 63870 to 5.5.x [#63882](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63882)
  - Adds an experimental feature `commitGraphUpdates` to control how upload visibility is calculated.
- [Backport 5.5.x] Upgrade cody web experimental package to 0.2.7 (#63863) [#63901](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63901)
- Backport: Blame: fix some issues with the stream (#63865) [#63929](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63929)
- [Backport 5.5.x] [fix] Only trigger externalAcctSignup event when a new user is created [#63975](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63975)
  - Fixed an issue where the `http-header` auth would cause a massive amount of event logs spam Backport cd6595196177b3d307a4e8f76222c6d8c5c9b23f from #63843
- [Backport 5.5.x] Publish images for all commits on release branches [#63987](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63987) Backport b7242d280f37a4b9effebb52ac4301e59635d629 from #63985
- [Backport 5.5.x] [logging] Only record events if a new user was created [#64005](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64005) Backport 777c7a089956f1ad9c494ab55e8660bbdd781259 from #64004
- [Backport 5.5.x] Integrate security release approval into release pipeline [#64030](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64030) Backport 9dd901f3c957cf5bf83aa6ac41fc3c6b2744cfd3 from #63990
- security: Auto-update package lockfiles for Sourcegraph base images [#64035](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64035)
- [Backport 5.5.x] fix(source): Fix issue where worker would crash if a Bitbucket Cloud token couldn''t be refreshed [#64037](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64037)
  - Fixed an issue where a Bitbucket Cloud OAuth token failing to refresh would crash the `worker` service. Backport bc036ad2bafc9a09d80646d30d26335359a28fd1 from #64028
- security: Bump openjdk-11 version in blobstore image [#64047](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64047)
- [Backport 5.5.x] ci: make internal+promote release higher priority in runtypes [#64050](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64050) Backport 0309564f9362ea24e248aa5189d66f89826ccecf from #64049
- [Backport 5.5.x] fix: Fix Chrome stack overflow during highlighting [#64074](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64074)
  - Fixes a Chrome-specific stack overflow when highlighting large files.
 Backport 2644e242447ac355a415abec7af5cfb8d9849e75 from #64072
- Backport 5ce2eea to 5.5.x [#64166](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64166)
- security: Auto-update package lockfiles for Sourcegraph base images [#64180](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64180)
- [Backport 5.5.x] fix(appliance): cache authorization status [#64219](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64219) Backport 156aa5a0adec1bc7a1f2142878761d8993dd4c43 from #64213
- [Backport 5.5.x] fix(appliance): reliably redirect to site-admin post-install [#64220](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64220) Backport e54407d9f50ed11f1a7c27edbb5c42966070f236 from #64216
- cherry-pick 856e41e with resolved conflicts [#64228](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64228)

### Untracked

The following PRs were merged onto the previous release branch but could not be automatically mapped to a corresponding commit in this release:
- [Backport 5.5.x] release/bug: generate a new stitched migration graph [#63769](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63769) Backport cb19d6f0a98f7ecce65629bd117c34a8dc1db8e2 from #63764
- [Backport 5.5.x] Context: return lines around symbol match [#63788](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63788)
- [Backport 5.5.x] fix/alertmanager: downgrade prometheus/common to fix generated config [#63793](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63793)
  - Fix Prometheus Alertmanager configuration failing to apply `observability.alerts` from site config  Backport ffa873f3adb18e2c5807ca752115a70fcbc493c8 from #63790
- [Backport-5.5.x]: Move Cody Web to beta (#63806) [#63808](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63808)
- [Backport 5.5.x] fix(batches): the baseURL for github instance is now updated when creating a GitHub app [#63833](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63833) Backport 1c40c9e5bccd4f6265945bd3449b70a648022e60 from #63803
- [Backport 5.5.x] Upgrade cody web experimental package to 0.2.5 [#63856](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63856)
- Backport 63870 to 5.5.x [#63882](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63882)
  - Adds an experimental feature `commitGraphUpdates` to control how upload visibility is calculated.
- [Backport 5.5.x] Upgrade cody web experimental package to 0.2.7 (#63863) [#63901](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63901)
- Backport: Blame: fix some issues with the stream (#63865) [#63929](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63929)
- [Backport 5.5.x] [fix] Only trigger externalAcctSignup event when a new user is created [#63975](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63975)
  - Fixed an issue where the `http-header` auth would cause a massive amount of event logs spam Backport cd6595196177b3d307a4e8f76222c6d8c5c9b23f from #63843
- [Backport 5.5.x] Publish images for all commits on release branches [#63987](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63987) Backport b7242d280f37a4b9effebb52ac4301e59635d629 from #63985
- [Backport 5.5.x] [logging] Only record events if a new user was created [#64005](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64005) Backport 777c7a089956f1ad9c494ab55e8660bbdd781259 from #64004
- [Backport 5.5.x] Integrate security release approval into release pipeline [#64030](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64030) Backport 9dd901f3c957cf5bf83aa6ac41fc3c6b2744cfd3 from #63990
- security: Auto-update package lockfiles for Sourcegraph base images [#64035](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64035)
- [Backport 5.5.x] fix(source): Fix issue where worker would crash if a Bitbucket Cloud token couldn''t be refreshed [#64037](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64037)
  - Fixed an issue where a Bitbucket Cloud OAuth token failing to refresh would crash the `worker` service. Backport bc036ad2bafc9a09d80646d30d26335359a28fd1 from #64028
- security: Bump openjdk-11 version in blobstore image [#64047](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64047)
- [Backport 5.5.x] ci: make internal+promote release higher priority in runtypes [#64050](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64050) Backport 0309564f9362ea24e248aa5189d66f89826ccecf from #64049
- [Backport 5.5.x] fix: Fix Chrome stack overflow during highlighting [#64074](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64074)
  - Fixes a Chrome-specific stack overflow when highlighting large files.
 Backport 2644e242447ac355a415abec7af5cfb8d9849e75 from #64072
- Backport 5ce2eea to 5.5.x [#64166](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64166)
- security: Auto-update package lockfiles for Sourcegraph base images [#64180](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64180)

# v5.5.3738

{/* RSS={"version":"v5.5.3738", "releasedAt": "2024-07-31"} */}

### Feat

- appliance: backport all recent appliance changes [#64182](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64182)
  - Backport all recent appliance changes. The appliance is still pre-release.

### Reverts

### Uncategorized

- [Backport 5.5.x] fix: Fix Chrome stack overflow during highlighting [#64074](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64074)
  - Fixes a Chrome-specific stack overflow when highlighting large files.
 Backport 2644e242447ac355a415abec7af5cfb8d9849e75 from #64072
- Backport 5ce2eea to 5.5.x [#64166](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64166)

# v5.5.2463

{/* RSS={"version":"v5.5.2463", "releasedAt": "2024-07-24"} */}

### Uncategorized

- Backport: Blame: fix some issues with the stream (#63865) [#63929](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63929)
- [Backport 5.5.x] [fix] Only trigger externalAcctSignup event when a new user is created [#63975](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63975)
  - Fixed an issue where the `http-header` auth would cause a massive amount of event logs spam Backport cd6595196177b3d307a4e8f76222c6d8c5c9b23f from #63843
- [Backport 5.5.x] Publish images for all commits on release branches [#63987](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63987) Backport b7242d280f37a4b9effebb52ac4301e59635d629 from #63985
- [Backport 5.5.x] [logging] Only record events if a new user was created [#64005](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64005) Backport 777c7a089956f1ad9c494ab55e8660bbdd781259 from #64004
- [Backport 5.5.x] Integrate security release approval into release pipeline [#64030](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64030) Backport 9dd901f3c957cf5bf83aa6ac41fc3c6b2744cfd3 from #63990
- security: Auto-update package lockfiles for Sourcegraph base images [#64035](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64035)
- [Backport 5.5.x] fix(source): Fix issue where worker would crash if a Bitbucket Cloud token couldn''t be refreshed [#64037](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64037)
  - Fixed an issue where a Bitbucket Cloud OAuth token failing to refresh would crash the `worker` service. Backport bc036ad2bafc9a09d80646d30d26335359a28fd1 from #64028
- security: Bump openjdk-11 version in blobstore image [#64047](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64047)
- [Backport 5.5.x] ci: make internal+promote release higher priority in runtypes [#64050](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/64050) Backport 0309564f9362ea24e248aa5189d66f89826ccecf from #64049

# v5.5.1337

{/* RSS={"version":"v5.5.1337", "releasedAt": "2024-07-18"} */}

### Uncategorized

- [Backport 5.5.x] Upgrade cody web experimental package to 0.2.7 (#63863) [#63901](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63901)

# v5.5.1220

{/* RSS={"version":"v5.5.1220", "releasedAt": "2024-07-17"} */}

### Uncategorized

- [Backport-5.5.x]: Move Cody Web to beta (#63806) [#63808](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63808)
- [Backport 5.5.x] fix(batches): the baseURL for github instance is now updated when creating a GitHub app [#63833](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63833) Backport 1c40c9e5bccd4f6265945bd3449b70a648022e60 from #63803
- [Backport 5.5.x] Upgrade cody web experimental package to 0.2.5 [#63856](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63856)
- Backport 63870 to 5.5.x [#63882](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63882)
  - Adds an experimental feature `commitGraphUpdates` to control how upload visibility is calculated.

# v5.5.160

{/* RSS={"version":"v5.5.160", "releasedAt": "2024-07-11"} */}

### Uncategorized

- [Backport 5.5.x] Context: return lines around symbol match [#63788](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63788)
- [Backport 5.5.x] fix/alertmanager: downgrade prometheus/common to fix generated config [#63793](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63793)
- Fix Prometheus Alertmanager configuration failing to apply `observability.alerts` from site config  Backport ffa873f3adb18e2c5807ca752115a70fcbc493c8 from #63790

# v5.5.0

{/* RSS={"version":"v5.5.0", "releasedAt": "2024-07-11"} */}

### Chore

- Change errors.HasType to respect multi-errors [#63024](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63024)
- codenav: Resolve repo and commit in common code [#63072](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63072)
- graph: Add changelog entry for Python scip-ctags fix (second attempt) [#63106](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63106)
- search: Add test case covering hack lang detection behavior [#63136](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63136)
  - Add test case for coverage hack lang detection
- msp: document gRPC notes in spec docstrings [#63140](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63140)
- Fix lint error (unparam) [#63151](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63151)
- Validate driver type immediately [#63177](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63177)
- appliance: remove references to embeddings [#63185](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63185)
  - Remove references to embeddings from (still unreleased) appliance.
- security: update dependencies [#63197](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63197)
- ci: conditionally stamp genrules [#63204](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63204)
  - Avoid invalidating cache in stamped genrules on dev builds.
- schema: Add implementation status for codeGraphData [#63219](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63219)
- Add GitBlobResolver and GitTreeResolver for readability [#63223](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63223)
- Remove dead code for Rust crates [#63224](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63224)
- bazel: bump to 7.2.0 [#63226](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63226)
- changelog: advise contributors of new process [#63243](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63243)
  - Advise contributors of new changelog process.
- svelte: Migrate all icons to Lucide/custom icons [#63246](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63246)
- Add binary search function that returns range [#63248](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63248)
- Move deduplicateBy to collections package [#63249](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63249)
- codeintel: Use internal language detection package for insights [#63254](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63254)
  - Code clean up to use common language detection mechanism in more places
- remove broken link in README [#63256](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63256)
- Remove unused code paths in lsifstore package [#63259](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63259)
- Add more tests for GetLanguages API [#63260](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63260)
- Simplify location uniquing [#63263](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63263)
- Add specialized function for sorting primitive sets [#63269](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63269)
- Bump go-enry and Zoekt to handle new languages [#63281](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63281)
  - Updates the `lang:` filter to add support for languages such as Mojo, Roc, EdgeQL etc.
- ci: remove buildchecker sunday summary posts [#63289](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63289)
- Maintain consistency between languages functions [#63292](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63292)
- local: remove docsite from dotcom commandset [#63314](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63314)
- deps: upgrade grpc, prometheus/common [#63328](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63328)
- deps: upgrade alertmanager package dependency, improve logs and tests [#63329](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63329)
- Add more docs for occurrences GraphQL API [#63338](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63338)
- svelte: Simplify development for dotcom [#63341](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63341)
- svelte: Remove stub logger [#63342](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63342)
- plg: migrate invoices list to react-query [#63343](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63343)
- local: simplify 'sg db' inline help [#63344](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63344)
- ci: instrument push_all.sh commands in honeycomb [#63350](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63350)
- ci: mark web-sveltekit:e2e_test as flaky [#63351](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63351)
- svelte: Update fuzzy finder designs [#63354](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63354)
- Fix inaccurate error message [#63361](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63361)
- remove obsolete tracking code for Cody App downloads [#63364](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63364)
- centralize logic for disabling Batch Changes on dotcom [#63370](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63370)
- Add SymbolUsageKind to GraphQL API [#63371](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63371)
- Add doc comment for DiffOptions.Paths [#63385](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63385)
- deps: replace internal/slices [#63386](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63386)
  - Add a collections library to dependencies.
- Refactor and document GitTreeTranslator [#63390](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63390)
- batches: remove visibility options from create batch changes page [#63393](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63393)
  - remove visibility options from create batch change page
- enterpriseportal: only use 'revoke' verb for licenses [#63407](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63407)
- bazel: bump rules_js to address permissions denied warning [#63419](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63419)
- ci: emit compact executon log in CI [#63420](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63420)
- batches: remove beta badge from batch changes [#63423](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63423)
  - Remove Beta badge from Batch Changes pages.
- enterpriseportal: split database package [#63425](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63425)
- enterpriseportal: properly close DB handle [#63426](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63426)
- codeintel: Differentiate between paths relative to upload root vs repo root [#63437](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63437)
- batches: remove beta badge from Batch Changes page [#63441](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63441)
  - the Beta badge is now removed from Batch Changes
- plg: add useEmbeddedUI site config param [#63442](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63442)
- svelte: Properly route to revision agnostic pages [#63444](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63444)
- enterpriseportal: tweak maybeMigrate tracing [#63448](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63448)
- ci: emit compact executon log in CI for test + build commands only [#63451](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63451)
- enterpriseportal: propagate context to migration database context [#63455](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63455)
- svelte: Hide cody nav entries and upsell banner when cody isn't enabled [#63463](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63463)
- Add collection type - OrderedSet [#63469](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63469)
- bazel: don't stamp yq rule for wolfi base images [#63470](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63470)
- bazel: add client/backstage-frontend to bazelignore [#63471](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63471)
- svelte: Upgrade SvelteKit [#63490](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63490)
- enterpriseportal: rename customer admin role in API [#63501](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63501)
- enterpriseportal: add test for iam_model [#63503](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63503)
- codygatewayevents: extract into standalone package for reuse, split up internal/codygateway [#63528](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63528)
- local: add dotcom-cody-e2e commandset [#63548](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63548)
- linearhooks: use MSP rollouts [#63556](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63556)
- analytics: remove Cody characters events from inclusion in pin… [#63557](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63557)
- search: VSCode Search extension: Remove signup link for sourcegraph.com [#63558](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63558)
  - Remove links to create an account on sourcegraph.com because it no longer hosts private code.
- search: VSCode Search extension: Remove url and token from configuration [#63559](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63559)
  - Remove access token and URL from extension settings because they are managed in the extension now.
- preserve format imposed by bazel [#63561](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63561)
- Add feature flag for new SCIP-based GraphQL APIs [#63565](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63565)
- Simplify path trimming logic in perm checking [#63574](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63574)
- Set scipBasedAPIs to off by default [#63575](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63575)
- Use api.RepoID and api.CommitID in more places [#63596](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63596)
- local: sg warns about opposite default value on dev builds [#63612](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63612)
- local: make sg handle empty secret file gracefully [#63614](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63614)
- local: simplify sg teammate [#63667](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63667)
- svelte: Cleanup dependencies [#63691](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63691)
- drop isGitHubApp field from batch changes credentials [#63709](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63709)
- reword headline from tokens to credentials [#63714](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63714)
- redis: set max active redis connections to 1000 [#63718](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63718)
  - redis-pool: set max active clients to 1000
- security: Updated dind image to 27-0-3 [#63725](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63725)
  - Upgraded dind to 27.0.3 to patch CVE-2024-24790 vulnerability
- svelte: Update to latest cody web version [#63732](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63732)
- svelte: Use MDI icons for seach input pattern type toggles [#63733](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63733)
- svelte: Update cody web version [#63747](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63747)
- add changelog entry for Batch Changes - GitHub apps integration [#63756](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63756)
  - Batch Changes: GitHub apps can now be added as a credential for authentication and interacting with changesets. [#31533](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/31533)

### Feat

- ci: Adds playwright tests for sveltekit to bazel [#62560](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62560)
- search: Add Syntax Highlighting for Hack Language [#62770](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62770)
- search: Add Syntax Highlighting for Magik language [#62919](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62919)
  - Added syntax highlighting for the Magik programming language.
- msp: allow enablement of logical replication features for Datastream [#63092](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63092)
  - MSP services can now configure `postgreSQL.logicalReplication` to enable Data Analytics team to replicate selected database tables into BigQuery.
- search: Support Magik language file filter in search [#63110](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63110)
  - Added Magik language to language filters (`lang:magik`)
- sg: add command to generate a dotcom user gateway access token [#63125](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63125)
- appliance: deploy frontend [#63158](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63158)
  - Appliance (still unreleased) can deploy frontend.
- appliance: deploy searcher [#63191](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63191)
  - Appliance (as yet unreleased) can deploy Searcher.
- gitserver: don't log memoryObservation error if it occured b/c context cancellation [#63210](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63210)
  - Reduce logspam in the gitserver command functionality by ignoring memory observation errors if they occurred due to external context cancellation.
- plg: Add new Checkout flow that uses Stripe's `createToken` API [#63213](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63213)
- gitserver: avoid logspam from deadline exceeded memory tracking errors [#63215](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63215)
  - In the gitserver new command logic, logspam from the memory observer when the context error is deadline exceeded will no longer occur.
- plg: Add seats [#63227](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63227)
- Search: Add icon for the Hack language [#63233](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63233)
  - Adds icon for the Hack language
- plg: Apply designs to Cody Pro pages [#63244](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63244)
- plg: Use react-query for team management [#63267](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63267)
- ci: Trigger security scanner from release pipeline [#63280](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63280)
  - Added security scanner to the release pipeline
- plg: remove accept invite page [#63290](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63290)
- enterpriseportal: UpdateCodyGatewayAccess RPC definition [#63307](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63307)
- enterpriseportal: CreateEnterpriseSubscription RPC definition [#63308](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63308)
- enterpriseportal: add Salesforce metadata at subscription level [#63317](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63317)
- sg: command to add default site-admin with predefined access token  [#63320](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63320)
- enterpriseportal: CreateEnterpriseSubscriptionLicense RPC defininition [#63323](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63323)
- enterpriseportal: ArchiveEnterpriseSubscription RPC definition [#63330](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63330)
- enterpriseportal: RevokeEnterpriseSubscriptionLicense RPC definition [#63331](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63331)
- Add id for CodeGraphData [#63337](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63337)
- codeintel: Add precise auto-inferencing for dotnet [#63348](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63348)
  - Enable automatic precise indexing of .NET projects
- plg: Update Cody Pro badge deck [#63352](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63352)
- appliance: appliance docker container [#63357](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63357)
  - feat(appliance): create docker container
- plg: Tweak invite co-workers flow [#63374](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63374)
- plg: Invite users on Cody Dashboard [#63375](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63375)
- plg: require confirmation before removing user or revoking admin [#63388](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63388)
- svelte: Make fuzzy finder matching more reliable [#63397](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63397)
  - Add 'search all' tab
  - Support multi-word search
  - Support regular expression patterns
  - Fix matching reliability
- plg: remove seats from subscription [#63408](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63408)
- sg: add 'sg enterprise' commands for Cody Analytics [#63414](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63414)
- enterpriseportal: validate and normalize instance domains [#63415](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63415)
- appliance: local developer mode [#63417](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63417)
  - Local developer mode for appliance config authors.
- enterpriseportal: use UUID type for subscription ID [#63452](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63452)
- enterpriseportal: initialize subscriptions tables [#63453](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63453)
- enterpriseportal: init licenses tables [#63454](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63454)
- enterpriseportal: init Cody Gateway Access table [#63457](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63457)
- dotcom: show subscription UUID in Enterprise Portal format [#63482](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63482)
- sg: add -auto-approve option for 'sg enterprise' updates [#63500](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63500)
- enterpriseportal: make UpdateEnterpriseSubscriptionMembership authoritative [#63502](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63502)
- codeintel: Add scip-ctags support for Magik [#63504](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63504)
  - Add symbol browsing support for the Magik language
- enterpriseportal: define GetCodyGatewayUsage RPC, use uint64 for rate limits [#63531](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63531)
- remove experimental label from batches merge changesets action [#63542](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63542)
- enterpriseportal: implement GetCodyGatewayUsage RPC [#63555](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63555)
- search: Make search aware of perforce changelist id mapping [#63563](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63563)
  - For perforce depots, support searching within a specific changelist by specifying a ref like `context:global repo:^repo/name$@changelist/83854`
- introduce database fields for github apps - batch changes integration, and update database layer [#63577](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63577)
- sg: sqlite-backed local store for sg analytics [#63578](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63578)
- search: remove keyword toggle [#63584](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63584)The keyword search toggle has been removed from the search results page. [Keyword search](https://sourcegraph.com/docs/code-search/queries#keyword-search-default) is now enabled by default for all searches in the Sourcegraph web app.
- sg: one-time oauth login to persist user email for analytics [#63603](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63603)
- cody: Expose Sg modelconfig data via HTTP REST API [#63604](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63604)Sourcegraph instances how expose an HTTP endpoint that authenticated users can call to get a list of LLM models supported by the Sourcegraph instance. In the future this will be used to allow Cody users to select the LLM model dynamically, based on what is currently available.
- batches: use "keyword" as default pattern type [#63613](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63613)
  - The new (optional) field "version" of batch specs determines how the spec is processed. This allows us to introduce new features while maintaining backward compatability.
  - A new version `2` is introduced. Batch specs specifying `version: 2` will use keyword search as the default pattern type to determine repos/workspaces. Batch specs with `version: 1` or without version field keep using pattern type "standard".
- svelte: Make diff headers on commit page sticky [#63615](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63615)
- implement functionality to create credential GitHub apps [#63635](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63635)
- svelte: Add Cody chat sidebar [#63638](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63638)
- dotcom: add Enterprise Portal auth proxy [#63652](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63652)
- svelte: Add cody button to repo home page [#63684](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63684)
- dotcom: remove per-user Enterprise subscriptions UI [#63698](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63698)
- enterpriseportal: database layer for subscriptions upsert [#63703](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63703)
- svelte: Add reblame support to blame column [#63727](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63727)
- Source: Properly render multi-line changelist messages from Perforce [#63728](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63728)
  - Properly render multi-line perforce changelist descriptions

### Fix

- appliance: use version for image tags [#63075](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63075)
  - Appliance uses requested version as image tag, instead of requiring sha256 digests.
- sg: fix cloud eph suggested commands  [#63093](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63093)
  - fix suggested cloud ephemeral commands
  - show duration till expiry for cloud ephemeral
- release: remove generate-notes from github release creation [#63121](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63121)
  - remove `generate-notes` cli flag when promoting releases
  - push only a single tag
  - fix token name used in changelog generation
- search: Properly handle URLs with file paths that contain route segments [#63123](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63123)
- SCIM: don't allow SCIM users to change fields [#63130](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63130)
- highlighting: Update JSX/TSX highlighting to more properly label tag  delimiters [#63138](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63138)
  - Update highlighting of JSX/TSX Tags to correctly label delimiters
- highlighting: Improve highlighting for Magik language [#63155](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63155)
  - Correctly identify null and symbols in Magik language syntax highlighting
- search: Contributors page errors with empty date string [#63182](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63182)
- tests: Clean up mocks after test [#63201](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63201)
- local: disable bazel remote cache [#63203](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63203)
- search: Copy text from read-only code host configuration input [#63239](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63239)
- plg: Fix "Remove team member" feature [#63241](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63241)
- svelte: scrolling search input [#63261](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63261)
- search: VSCode Search extension: remove auth provider [#63262](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63262)
  - Remove interaction between the Sourcegraph Search extension and the Accounts menu.
- search: Better diagnostic message for invalid and incomplete select: filter value [#63266](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63266)
  - Show useful valid values when an invalid `select:` value is entered
  - Do not render empty hover tooltips
- search: Improve syntax highlighting of search history entries [#63271](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63271)
- search: Ignore *lock keys for keyboard shortcut matching [#63272](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63272)
- svelte: Add trailing slash to group and directory suggestions [#63273](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63273)
- Source: Fix documentation URLs for code hosts help pages [#63274](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63274)
  - Fix in-product documentation links for code hosts to point to updated docs location
- ci: remove broken glob [#63277](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63277)
- Don't mark references in import statements as definitions [#63284](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63284)
  - Fixes a bug where import statements in TypeScript code showed up in `type:symbol` search.
- plg: banner styles [#63287](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63287)
- svelte: Fix icon color in search sidebar [#63288](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63288)
- svelte: Open correct file from preview panel line number [#63309](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63309)
- svelte: Reference panel width [#63310](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63310)
- svelte: Fix reference panel loading/error state [#63316](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63316)
- svelte: Properly scope global CSS selector [#63332](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63332)
- svelte: Preserve selected lines in codehost URL [#63334](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63334)
  - Line selection is preserved when navigating to GitHub or GitLab external URLs
  - File actions are now available in the inline 'at commit' view
  - File icon is now rendered in the file header for the inline diff view
- svelte: History suggestions should show immediately when clicking the history button [#63335](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63335)
- batches: disallow retry on deleted changesets [#63336](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63336)
  - Disallow auto-retry when a changeset is deleted.
- svelte: Data/code preloading doesn't work when using panels [#63339](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63339)
- svelte: Use correct symbol icon color [#63355](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63355)
- api: only allow a user or site admin to view that user's usage stats [#63365](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63365)
- client: restore paths for extension bundles [#63402](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63402)
- sg: fix mangled log output from `sg start` and `sg run` [#63405](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63405)
- enterpriseportal: ListEnterpriseSubscriptions fixes [#63412](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63412)
- svelte: Properly rounded corner for file view hover cards [#63446](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63446)
- analytics: fix broken v1 codeintel event logging [#63449](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63449)
- plg: ensure invite flow is enabled only for embedded UI [#63466](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63466)
- Check (uploadID, path) pairs in bulk [#63485](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63485)
- search: remove "lucky" from default pattern types [#63486](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63486)
  - Removed experimental pattern type "lucky" from the list of supported default pattern types.
- sg: reduce max interrupt count and os.Exit always [#63516](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63516)
  - sg - Always os.Exit once shutdown hooks have completed
  - sg - Reduce max intterupt count from 5 to 2 to hard exit
- batches: remove leading and trailing spaces from batch changes credentials [#63517](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63517)
  - Whitespaces in Batch Changes credentials are trimmed before being saved to the database, this prevents 401 errors when using the token to construct an authenticated push URL.
- search: VSCode Search extension: bring back matched lines in search results.  [#63524](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63524)
- sg: fix 'sg enterprise' per-command flags [#63527](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63527)
- sg: conditionally show protips [#63541](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63541)
  - sg - conditionally show protips when running `sg bazel`
- search: Token decoration in keyword-enabled query input [#63543](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63543)
- svelte: Reference layout shift while loading data [#63546](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63546)
- batches: fix zero division error resulting in wrong stats computation [#63547](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63547)
- enterpriseportal: forcibly run gorm-incompatible migration in local dev [#63549](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63549)
- telemetrygateway: reduce context cancellation error reports [#63551](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63551)
- search: VSCode Search extension: hide file preview link [#63552](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63552)
- svelte: Fix unplugin icons usage in storybook [#63594](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63594)
- ci: panic using correct err [#63599](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63599)
  - ci - use correct err value to panic on
- svelte: Remove rogue console.log statement [#63600](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63600)
- search: Don't show inline cody widget when new cody web is enabled [#63608](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63608)
- actions: update pinned SHA for `pnpm/action-setup` action [#63632](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63632)
- batches: display failure alert depending on github app kind [#63633](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63633)
- svelte: Render correct error page [#63663](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63663)
- svelte: Use 'pointer' pointer for cody button [#63665](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63665)
- svelte: Respect cody ignore settings [#63677](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63677)
- svelte: Fixes excessive 'the hotkey ... has already been registered' messages [#63679](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63679)
- batches: fix broken credential validator [#63687](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63687)
- svelte: Properly load/serve version.json [#63688](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63688)
- codygateway: tweak enterprise-portal dial options [#63692](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63692)
- batches: fix broken `ghauth` import [#63693](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63693)
- svelte: Update cody web [#63710](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63710)
- better alignemnt of github credentials and check success notice [#63717](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63717)
- show success notice in the correct area [#63721](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63721)
- svelte: Prefill search home page query input with (default) context filter [#63740](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63740)
- remove watch path that's gone [#63746](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63746)
- batches: enable check for creating source as non credential [#63751](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63751)
- build: update wolfi image lock for otel [#63755](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63755)
  - fix(build): update wolfi lock for otel-collector

### Refactor

- cody: Reshape the `CompletionsClient` interface [#63358](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63358)NA, just some under the hood refactoring that shouldn't impact any functionality.

### Test

- cody: Add unit tests for the Completions API [#63434](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63434)NA. Just trivial changes and adding more tests.

### Reverts


### Uncategorized

- gitserver: Sunset Exec endpoint [#62774](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62774)
- gitserver: Cleanup CreateCommitFromPatch [#62781](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62781)
- [React]: Add initial usage of the new web worker-based cody web chat [#62792](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62792)
- gitserver: Framework to support integration testing against gitserver [#62801](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62801)
- feat/internal/memcmd: add internal/memcmd package to allow for memory tracking of exec.Cmd  processes [#62803](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62803)This feature adds a package that allows us to track the memory usage of commands invoked via exec.Cmd.
- feat(search/svelte): Add context specific suggestions to repo search input [#62880](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62880)
- feat/cody-gateway: use Enterprise Portal for actor/productsubscriptions [#62934](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62934)
- Reimplement license checks [#63068](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63068)
- Svelte: inject into primary `app.html` [#63088](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63088)
- Syntactic Indexing: add TAR archive indexing mode to scip-syntax CLI [#63097](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63097)
- Add Support for Counting Tokens for Azure Code and Update in Redis [#63100](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63100)
- enterprise-portal: update RPC for subscription domain and members [#63105](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63105)
- Cody Gateway embeddings: powering with generated metadata - take 2 [#63112](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63112)
- fix(Cody Gateway): add model field to Google completion request [#63113](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63113)
- feat/cmd/gitserver: add memory tracking for both linux and macos [#63114](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63114)Adds a new experimental feature to enable track of `git` command memory invocations when the `GITSERVER_MEMORY_OBSERVATION_ENABLED` environment variable is true (off by default).
- feat/sg-msp-pg: add suggestion to check msp-ops page on perms error [#63118](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63118)
  - `sg msp pg connect` will tell you about your service's generated Notion page if you run into a permissions-looking error during command setup, where there is guidance about the required Entitle requests.
- Svelte: add sentry [#63126](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63126)
- sg: deny cloud ephemeral builds from main [#63127](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63127)
  - deny cloud ephemeral deployments triggered from 'main'
- svelte: Add bottom panel close button [#63128](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63128)
  - Added bottom panel close button
  - Added 'text' variant to Button component
  - Added 'actions' slot to Tabs component
  - Added Button component stories
- svelte: Migrate repo sidebar toggle button to use lucide icon [#63129](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63129)
- bug: update hard coded consts [#63133](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63133)
  - tmp process: update release consts to 5.4.5099
- Reapply "gitserver(client): Reintroduce 500 maximum connections limit" [#63134](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63134)
- scim: Fix user updates when SCIM was previously enabled [#63135](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63135)
- enterprise-portal: rename "scope" to "permission" for query RPC [#63137](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63137)
- enterprise-portal: init database schema and handler store [#63139](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63139)
- Svelte: allow popovers to have external targets [#63141](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63141)
- feat/enterprise-portal: rudimentary audit logging [#63142](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63142)
- build: fixup custom eslint test rule after bump to rules_js 2 [#63143](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63143)
- Remove references to 'rate-limits-exceeded-for-testing' feature flag [#63144](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63144)
- security: Auto-update package lockfiles for Sourcegraph base images [#63145](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63145)
- Svelte: fix tests [#63146](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63146)
- gitserver: Remove comment about error checking [#63147](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63147)
- Adds stubs for usage connection resolver [#63156](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63156)
- feat/enterprise-portal: return all attributes, even when access is disabled [#63159](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63159)
- webhooks: Update payload testdata and type for Bitbucket Server push events [#63161](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63161)
- fix/enterprise-portal: ignore empty hashes for Cody Gateway access tokens [#63162](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63162)
- feat(cody-gateway): add Google Gemini stable models to allowed models [#63163](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63163)
- feat/msp/runtime: PG_QUERY_LOGGING=true for local dev query logging [#63164](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63164)
  - MSP runtime users can now set `PG_QUERY_LOGGING=true` to dump queries and arguments from database interactions at `DEBUG` level in local dev.
- msp: encode commit_message as base64 [#63165](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63165)
- Cody Gateway: Add support for Google non-streaming endpoint [#63166](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63166)
- Svelte: add Cody upsell banner [#63167](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63167)
- chore/cody-gateway: instrument removeUnseenTokens [#63169](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63169)
- Svelte: add footer links for dotcom [#63170](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63170)
- chore/otel-collector: upgrade to v0.103.0, remove jaegerexporter [#63171](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63171)
  - OpenTelemetry Collector: Upgraded OpenTelemetry Collector to v0.103.0
  - OpenTelemetry Collector: The [deprecated ](https://github.com/open-telemetry/opentelemetry-specification/pull/2858). Users of `exporter: { jaeger: ... }` in the OpenTelemetry Collector should use `exporter: { otlp/jaeger: ... }` to send traces directly to Jaeger via its OTLP receiver.
    - Users of the default Jaeger configurations now need to provide `JAEGER_OTLP_GRPC_PORT` as well as the existing `JAEGER_HOST` configuration.
- Cody Gateway: handle streams with trailing newline in Gemini response [#63172](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63172)
- enterprise-portal: implement basic MSP IAM and RPCs [#63173](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63173)
- Fix: auth issues with Sourcegraph VSCode extension [#63175](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63175)
  - Entering the URL and access token in the UI now works - no more manual editing of `settings.json`
- Adds a search client to the codenav service [#63180](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63180)
- feat(search/svelte): Support more file icons [#63181](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63181)
- dotcom: fix issue with dotcom emails [#63183](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63183)
- fix(search/svelte): Hide diff view when closing bottom panel [#63184](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63184)
- Extend instructions for running CG locally [#63186](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63186)
- enterprise-portal: temporarily disable local DB migrate [#63187](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63187)
- SSC: Fix "Make admin" and "Revoke admin" button actions [#63188](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63188)fix(plg): fixed "Make admin" and "Revoke admin" button actions
- Resolve syntactic symbol at request range [#63189](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63189)
- SSC: Fix checkout links [#63190](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63190)fix(plg): make upgrade links point to the right pages for Teams & Invites
- [Svelte]: Fix standard click-based popover flow [#63192](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63192)
- Fix: querying event logs breaks when "id" column value > int32 [#63193](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63193)
  - Address "value out of range" errors when querying the event logs
- sg: cloud eph - improve missing tag/version message [#63195](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63195)
  - sg - improve messaging when an image is missing from Cloud ephemeral registry
- Adds function to find candidate occurrences via search [#63196](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63196)
- webhooks: Add support for secrets for Bitbucket Cloud [#63198](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63198)
- context: detect if README is required [#63199](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63199)
- sg: cloud eph - set max deployment name [#63202](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63202)
  - sg - set a max length for cloud ephemeral deployment names
- fix/internal/memcmd: fix goroutine leak in linux observer [#63206](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63206)A goroutine leak in the experimental linux memory observation logic has been fixed.
- feat/internal/memcmd: ignore context cancellation errors from Stop() [#63208](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63208)
  - Slightly improve logspam from Linux memory observation logic by ignoring context cancellation errors that occur when the user explicitly stopped the observer.
- Use 8B version of llama3 in metadata generation [#63212](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63212)
- fix/internal/memcmd: close the explicit stop channel before cancelling context [#63214](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63214)This PR fixes a logspam bug in the linux memory observer that was due to do slightly faulty synchronizzation logic.
- internal: make adding EventsStore middleware easier [#63216](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63216)
- Codenav: use new occurrences API for symbol definitions [#63217](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63217)
- Svelte: remove v1 telemetry [#63220](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63220)
- Svelte: use Inter font for --font-family-base [#63221](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63221)
- Proof-of-concept for Intent detector API [#63228](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63228)
- Add unit test for saml requests with multiple certs [#63229](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63229)
- chore(search/svelte): Remove dependencies on barrel files to speed up dev build [#63230](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63230)
- PLG: Allow users who are already on a team accept invites [#63231](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63231)
- Svelte: use Roboto Mono as monospace font [#63247](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63247)
- Chore: disable flaky tests [#63251](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63251)
- Svelte: implement keyboard shortcut design [#63253](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63253)
- Svelte: add repo header dropdown menu [#63257](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63257)
- fix(cody-gateway): Improve prompt and request validation for gemini [#63258](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63258)
- Filters candidate matches against syntactic SCIP documents [#63268](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63268)
- PLG: encode URL search params [#63275](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63275)
- Chore: update goldmark [#63276](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63276)
- Cody Gateway: add gemini model to code completion list [#63278](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63278)
- Adding Anthropic messages API support to the Google provider through Google vertex [#63282](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63282)
- adding deepseek and lang specific mixtral for completions ab experiment [#63283](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63283)
- Wraps up syntactic usages in resolvers [#63285](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63285)
- fix(cody-gateway): Disable flagging Google requests [#63295](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63295)
- Svelte: fix sidebar icon alignment [#63296](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63296)
- fix/graphql/database: make count of failed user permissions syncs ignore soft deleted users [#63297](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63297)
  - The failed user permission sync count on the permission dashboard now properly ignores syncs from deleted users (which is the expected behavior).
- fix/graphql/database: fix repo permission sync count to ignore soft deleted repositories [#63298](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63298)
  - The failed repository permission sync count on the permission dashboard now properly ignores syncs from deleted repository (which is the expected behavior).
- feature/internal/database: add test to ensure that not found errors fulfiill errcode.NotFound [#63299](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63299)
  - Added unit tests to ensure that the database userNotFound and RepositoryNotFound error types fulfuill the errcode.NotFound interface.
- Context: simplify file chunk conversion [#63301](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63301)
- fix/frontend/graphql: log and add trace events for all non-not-found errors that occur when fetching permission syncs [#63302](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63302)
  - Our graphqlAPI now logs and traces any non-not-found errors that occur when fetching permission sync jobs (as opposed to being silently swallowed).
- feat(cody gateway): code completion support for Google Gemini Flash models [#63303](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63303)feat(cody gateway): code completion support for Google Gemini Flash models
- fix(cody-gateway): Fix Google flagging configuration [#63305](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63305)
- fix(cody-gateway): streaming google endpoint [#63306](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63306)
- syntax-highlighter: Use camino to make handling utf8 paths nicer [#63311](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63311)
- Retry 404 errors from Triton [#63315](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63315)
- Minor: update license wording [#63318](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63318)
- Svelte: repo header followups [#63319](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63319)
- dotcom: Remove on-demand cloning of repositories [#63321](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63321)Dotcom no longer clones repos on demand.
- Chore: remove search console [#63322](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63322)
- wip: Introduce `cody-gateway-config` tool for generating model configuration [#63324](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63324)NA, this is an initial step. A later PR will elaborate on the exciting new feature this is enabling.
- V2-telemetry: Simplify sensitive metadata allowlist to accept feature only [#63325](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63325)
- Search: surface pattern type in query input [#63326](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63326)
- code monitors: respect default pattern type [#63333](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63333)
- Use math/rand/v2 [#63346](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63346)
- Cody pro icon was squashed in the upgrade banner [#63356](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63356)
- Refactor the 'getModel' callbacks into their own file [#63359](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63359)NA
- fix/msp/postgresqlroles: wait for databases to be provisioned [#63362](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63362)
  - MSP Cloud SQL: Fix race condition between database creation and role grants for the read-only operator access user
- skip highlighting large lockfiles on all instances, not just dotcom [#63366](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63366)
  - Syntax highlighting is disabled on lockfiles (such as `package-lock.json`) because it is CPU-intensive on these large files and very rarely desirable.
- allow repo access by default on dotcom [#63367](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63367)
- clearer access tokens allow check on dotcom [#63368](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63368)
- nix: use go1.22.4 [#63372](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63372)
- remove extraneous Cody onboarding steps [#63373](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63373)
- Publish images from patch release branches [#63379](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63379)
- plg: Make page headers the same style [#63380](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63380)
- Improve InviteUsers interface [#63383](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63383)
- Cody Gateway: New Claude 3.5 Sonnet model [#63395](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63395)feature(plg): new Claude 3.5 Sonnet model support for Cody Pro users
- Search: expose path matches on FileMatch [#63396](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63396)
  - Exposed the matched ranges of a file path via the GraphQL API
- Svelte: Make the byline in the fuzzy finder items bigger [#63398](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63398)
- msp: add `GetFloat` to runtime `Env` [#63399](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63399)
- fix(cody-gateway): model id for claude 3.5 sonnet [#63400](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63400)
- fix(cody-gateway): getAPIURL before transformBody [#63406](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63406)
- Search: always respect default pattern type [#63410](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63410)
- feat(cody-gateway): add support for Gemini models with context cache [#63413](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63413)
- Rename intent API (add chat reference, make the name more idiomatic) [#63416](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63416)
- Add language ID to private metadata for v2 codeintel events (for in p… [#63421](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63421)
- lib: downgrade GORM to 1.25.6 [#63427](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63427)
- "Cody" in navbar not "Cody AI" [#63429](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63429)
  - In the navbar, Cody is now just "Cody" not "Cody AI".
- remove Cody "upsells"—and all Cody links if Cody is disabled [#63430](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63430)
  - When Cody is disabled in site config (with `"cody.enabled": false`), all links and UI elements about Cody are hidden from all users. Previously, when Cody was disabled, users would see some links informing them about Cody.
- remove disabled web UI code for embeddings [#63432](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63432)
- remove rule warning about React props spreading [#63433](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63433)
- support fast, simple `sg start single-program-experimental-blame-sqs` for local dev [#63435](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63435)
- config: Various fixes and updating the naming rules for ModelConfig resource IDs [#63436](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63436)
- remove unused CODY_APP esbuild config and entrypoint [#63438](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63438)
- remove old and unused Cody search page [#63439](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63439)
- remove Code Search upsell from Cody page [#63440](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63440)
- scip-syntax: adds strict SCIP symbol parsing and formatting [#63443](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63443)
- fix(code hosts): Use more deterministic API endpoints for GitHub code host connections [#63445](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63445)
  - The `"internal"` repositoryQuery for GitHub code host connections now use a more deterministic API that's less susceptible to missing repositories
  - The `"public"` repositoryQuery for GitHub code host connections now make additional requests to fetch missing repository details, like topics. This fixes an issue where repos added by the `"public"` repositoryQuery would have missing repo details
- add back /post-sign-up [#63456](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63456)
- Add v2 telemetry infrastructure to browser extensions and native inte… [#63458](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63458)
- allow more models to be used in Cody Free [#63459](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63459)
- Gateway: forward X-Fireworks-Genie header from client [#63460](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63460)
- Search-based usages for new codenav API [#63464](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63464)
- chore(code-search): disable codemonitoring dotcom (jscontext) [#63465](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63465)
- notebooks: store default pattern type per notebook [#63472](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63472)
- Chore: refactoring occurrence indexing [#63473](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63473)
- Update free tier limits [#63474](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63474)
- Svelte: add debug view for code intel occurrences [#63475](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63475)
- Chore: fix repo stars alignment [#63476](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63476)
- omit go:embed of big assets from `sg start single-program-experimental-blame-sqs` [#63477](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63477)
- fix chopped-off tooltips in code monitor query input [#63478](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63478)
  - Fixed an issue when creating or editing a code monitor that obscured helpful tooltips in the query editor.
- add React key to fragments in code monitoring logs [#63479](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63479)
- remove beta labels for code monitoring Slack notifs & logs [#63480](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63480)
  - Code monitoring Slack notifications, previously in beta, are now GA. This feature lets you post matching code changes to a Slack channel.
  - Code monitoring logs, previously in beta, are now GA. This feature lets you see the status of and activity related to code monitors to troubleshoot issues with finding results and performing configured actions.
- shorter PR template [#63481](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63481)
- cloud: add feature flags to show no edit warning [#63484](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63484)
- saved searches: use default pattern type [#63487](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63487)
- search: fix regexp toggle if regexp is default [#63489](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63489)
- Fix azure completions api [#63491](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63491)
- Enable new Cody Web by default [#63493](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63493)
- msp: split contract into JobContract and ServiceContract [#63494](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63494)
- Svelte: improve contrast for file tree guide line [#63495](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63495)
- fix/internal/observation: make ErrCollector type threadsafe [#63496](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63496)
  - Fixed a threadsafety issue in the internal/observation.ErrCollector type
- Fix initial context for Cody Web on the repository page [#63497](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63497)
- Cody Web: Fix Cody page for signed out users [#63498](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63498)
- cloud: update feature flag warning severity [#63499](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63499)n/a
- Svelte: rev picker design updates and addition to commits page [#63506](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63506)
- oops, fix Cody Web enablement [#63508](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63508)
- fix Cody nav link for unauthed dotcom users [#63510](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63510)
- looser eslint rules [#63511](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63511)
- remove unused CTAs [#63512](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63512)
- misc wording and UI tweaks to search contexts pages [#63513](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63513)
- make Cody and Code Search global navbar items one-click [#63514](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63514)
  - Code Search and Cody now are one-click links in the global navbar. Other features are in the new "Tools" menu: search contexts, code monitors, search jobs, and notebooks. Your Cody dashboard is linked from your user menu (in the top right).
- Bump `cody-web-experimental` package version [#63525](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63525)
- sg: generate github action subscription matrix dynamically [#63526](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63526)
- backend: Introduce a basic utils package for appliance sourcegraph upgrades [#63529](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63529)
- link to Cody chat on the web from the Cody manage page [#63530](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63530)
- feature: Data types for encoding LLM Model config via Sourcegraph site config [#63533](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63533)
- release: resource def jaeger [#63534](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63534)
- release: resource def grafana [#63535](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63535)
- scip-syntax: implements parallel processing for workspace and tar commands [#63536](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63536)
- add LazyQueryInputFormControl, remove duplicated common pattern [#63537](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63537)
- fetch User.id to suppress GraphQL cache warning [#63538](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63538)
- fix(sg/bazel-do): use ci.sourcegraph.bazelrc with bazel-do [#63545](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63545)
  - sg - ensure bazel-do invocations use the ci sourcegraph bazelrc
- (chore)analytics: consistent naming of web code copied events [#63550](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63550)
- update config for workflows 5.10 [#63554](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63554)
- chore(search) VSCode Search extension: Update README and CHANGELOG [#63562](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63562)
- perf(scip-syntax): uses the same parse tree for globals and locals [#63564](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63564)
- make `<Label>` element focus & select at end to match native label behavior [#63568](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63568)
- fix bug preventing site admins from directly adding org members when email.smtp was set [#63569](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63569)
  - Fixed a bug where site admins could not directly add users to an organization if (1) email sending was configured for the instance and (2) the user had no verified email address.
- cosmetic improvements to OrgSettingsMemberPage, UserEmail [#63570](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63570)
  - Minor cosmetic improvements to the pages for managing organization members and user email addresses.
- narrow NamespaceProps type [#63571](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63571)
- suppress ResizeObserver type error [#63572](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63572)
- Marks search-based usages as definitions or references [#63576](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63576)
- insights: persist patternType in db [#63579](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63579)
- Syntactic indexing produce scip files [#63580](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63580)
- Chore: Calendar Updates [#63583](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63583)
  - chore(release): Update calendar events until September
  - chore(release): Remove branch cut automation from `calendar.go`
- Cody context: fix an issue with anchoring repo names [#63585](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63585)
  - Fixes a bug that caused context to be fetched for Cody from irrelevant repos
- feature: migrate maintenance from sourcegraph-operator-ui [#63586](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63586)
- Search: restore snippets to filters sidebar [#63587](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63587)
  - Restores search snippets in the search sidebar
- clean up FilteredConnection filter types and code [#63590](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63590)
- Add a better Cody client server-sent configuration mechanism [#63591](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63591)
- fetch NamespaceSelector namespaces from GraphQL (`viewer { affiliatedNamespaces }`) [#63592](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63592)
- Implement UI for Github Apps - Batch Changes integration [#63597](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63597)
- Trivial additions [#63601](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63601)NA
- fix/cody-gateway: use keepalive/idle timeout options for Enterprise Portal [#63605](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63605)
- security: Auto-update package lockfiles for Sourcegraph base images [#63606](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63606)
- remove autocomplete limit from Cody dashboard page [#63609](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63609)
- Adds a test for search-based usages [#63610](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63610)
- fix(perforce) Fix support for p4breaker workaround scripts [#63611](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63611)
  - Fixed an issue where Sourcegraph would no longer be able to decode Perforce permissions if `p4broker` is used, provided that the filter script gets adjusted as well.
- vsce: patch release v2.2.17 [#63617](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63617)
- Add SourcegraphModelConfig.AccessToken [#63619](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63619)NA
- Svelte: add mutation observer to `sizeToFit` [#63620](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63620)
- Pick up CompletionsConfig.User for the AzureOpenAI API Provider [#63621](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63621)NA
- Fix annoying consistency [#63623](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63623)NA
- fix/client/dev: update proxy overwrite to respect authProviders [#63624](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63624)
- codygateway: Use only one redis pool and make REDIS_ENDPOINT a clear requirement in config [#63625](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63625)
- Add GenericProviderConfig.ServiceName [#63626](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63626)NA
- Documents that usages are first bucketed by provenance [#63629](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63629)
- Fix the scheduling interval for syntactic indexing [#63634](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63634)
- Adds Option for codeintel [#63637](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63637)
- docs: Fix inaccuracies in RangeInput GraphQL docs [#63640](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63640)
- Add ModelRef.APIVersionID() [#63643](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63643)NA
- rcache: Explicitly pass redis pool to use [#63644](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63644)
- Remove old cache cleanup method [#63645](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63645)
- Remove unused package [#63646](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63646)
- Unexport some externally irrelevant symbols from uploadstore [#63647](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63647)
- add new "modelConfiguration" schema to site config [#63654](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63654)Changelog entry will come later with proper docs link, when we are ready for customers to use this.
- Convert Appliance Maintenance UI to Bazel [#63661](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63661)
- notebooks: set default pattern type to keyword [#63662](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63662)
- remove long-unused UI routes [#63670](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63670)
- add database.NotFoundError helper type [#63671](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63671)
- improve FilteredConnection filter types [#63672](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63672)
- Bump code-web-experimental version to 0.2.0 [#63675](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63675)
- scheduler: Simplify query for uncloned repos [#63681](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63681)
- phabricator: Move syncer to worker [#63682](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63682)
- React app: bump cody web to 0.2.1 [#63694](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63694)
- Svelte: encode path components in file header [#63695](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63695)
- site config: minor fixes, make modelConfiguration enable new backend models API, initial self-hosted model config [#63697](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63697)N/A
- searcher: Modernize entrypoint and gRPC server [#63700](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63700)
- adding deepseek-v2 and deepseek fine-tuned model trained on symbol graph context [#63702](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63702)
- modelconfig: handle converting site config JSON -> internal data types [#63706](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63706)Has no effect on users unless they opt into the early-access `"modelConfiguration"` site config feature.
- symbols: Minor code cleanup [#63708](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63708)
- sg: when in CI we do not need to prompt for an identity [#63712](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63712)
- update changelog: Keyword search GA [#63715](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63715)
- keyword search: remove beta badge [#63720](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63720)
- Cody Web: bump cody web to 0.2.3 [#63723](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63723)
- Backend: add line index [#63726](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63726)
- squirrel: Correctly use request context [#63729](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63729)
- Several refactoring to prepare for rolling out modelconfig [#63731](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63731)NA
- symbols: Make symbols specific code internal [#63736](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63736)
- Chore: remove gorilla/schema [#63738](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63738)
- pass ModelConfigInfo down to client.Get() for self-hosted-models [#63739](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63739)N/A
- Bump cody-web-experimental to 0.2.4 [#63742](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63742)
- feat(sg/cloud): trigger build on cloud-ephemeral pipeline [#63748](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63748)
  - `sg cloud eph` will now trigger builds on the `cloud-ephemeral` pipeline
- chore(security) : upgrade src-cli version to address CVE [#63750](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63750)Upgrade src-cli version to 5.4.0 to address CVE-2024-24790 , CVE-2023-45288

# v5.4.7765

{/* RSS={"version":"v5.4.7765", "releasedAt": "2024-06-20"} */}

### Reverts

### Uncategorized

- [63131](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63131) [Backport 5.4.5099] scim: Fix random suffix added to every user on resync
- [63148](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63148) [Backport 5.4.5099] fix(release): remove generate-notes from github r…
  - remove `generate-notes` cli flag when promoting releases
  - push only a single tag
  - fix token name used in changelog generation
  - Tag creation on release is idempotent, even in environments that cache the git repository (e.g. buildkite runners)
- [63152](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63152) [Backport 5.4.5099] chore(release): remind releasers of tag pipeline
  - Remind releasers of tag pipeline as final step. Backport 2be933cda9ac893f44d3da308052cce8be70cb7c from #63150
- [63178](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63178) [Backport 5.4.5099] release: never use build number in image family Backport 8bb0ab54ebbf4c7d356397dc0da29cb98ea3e14f from #63157
- [63392](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63392) [Backport 5.4.5099] chore(tooling): bump Go version to 1.22.4
  - Bumped version of Go used to build to 1.22.4
 Backport bb178ba729d160d834bf7fcbb4414f0f95e4d0df from #63124

# v5.4.5099

{/* RSS={"version":"v5.4.5099", "releasedAt": "2024-06-06"} */}

### Chore

- [61969](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61969) bazel: enable rules_esbuild sandbox with object-inspect workaround
- [62089](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62089) rel: fix tests not waiting for push prod
- [62511](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62511) rel: bump minor for stitch graph + add support invalidating migrations repo rule
- [62522](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62522) Rename function to reduce confusion
- [62527](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62527) Fix function name in comment
- [62529](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62529) Document post-condition for upload matching
- [62530](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62530) Rename locals id -> uploadID, dump -> upload
- [62532](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62532) fix typos
- [62537](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62537) Inline method at single usage site
- [62539](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62539) remove overridden repository cache flag from bazelrc
- [62540](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62540) Make receiver names consistent in codenav/service.go
- [62542](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62542) Add missing interface assertion for codenav Resolver
- [62543](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62543) Move helper function to database package
- [62544](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62544) ci: Remove dead boards
- [62573](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62573) Refactor codeintel middleware code
- [62587](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62587) Expose ParsePersonalAccessToken publicly for src-cli
- [62593](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62593) Use SRC_ACCESS_TOKEN for uploading indexes
- [62595](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62595) Stop uploading indexes to k8s.sgdev.org
- [62623](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62623) ci: bump backcompat target to 5.4.0
- [62658](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62658) ci: remove backcompat mitigation
- [62680](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62680) localenv: disable `tsc` declaration files
- [62714](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62714) Move cmd/searcher/protocol to internal/searcher/protocol
- [62718](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62718) ci: rules_buf 1.31
- [62719](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62719) process: add structure guide for PRs
- [62753](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62753) Bump autoindexing image SHAs
- [62755](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62755) Simplify extsvc config in integration tests
- [62762](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62762) licenses: fix khroma and elkjs
- [62768](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62768) Factor out logic for modifying site config
- [62780](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62780) Document how to load test highlighter
- [62789](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62789) Remove client construction from SignUp/In funcs
- [62820](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62820) skip failing tests
- [62853](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62853) Pull in latest http-server-stabilizer version
- [62857](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62857) gha: link to how-to when license check fail
- [62878](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62878) rel: plug automatic changelog generation (RFC912)
- [62902](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62902) release: add changelog section to pr template
  - Added instructions to guide teamates into writing changelog entries directly in their PR descriptions.
- [62921](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62921) Bump Rust version 1.73.0 -> 1.78.0
- [62922](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62922) Delete old Dockerfile and build scripts
- [62925](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62925) sg: cloud ephemeral - account for conclusion field
- [62938](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62938) release: quick fix latest version after release
  - Bump latest version reported by dotcom
- [62943](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62943) local: catch bazel-do issues before push
  - Prevent pushing Bazel commands/flags that would end up being rejected by the CI due to the allow list.
- [62959](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62959) appliance: scaffolding for embeddings service
  - Add config scaffolding for embeddings service.
- [62962](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62962) dev: shorten test plan in PR template
  - Test plan has been in place for a long time, so we can get rid of the detailed instructions.
- [62988](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62988) sg: cloud ephemeral fix instance check
  - fix cloud ephemeral deployment check
- [62992](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62992) Add tests documenting error invariants
- [62996](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62996) Remove unused code in errors package
- [62998](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62998) ci: fix PR template's changelog type list
- [62999](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62999) appliance: fix race condition in tests
  - Fix a race condition in one package's tests.
- [63001](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63001) bazel: update ownership tags to increase coverage
- [63020](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63020) productsubscription: add metric tracking usage
- [63025](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63025) Enable traces for uploads
  - Tracing is enabled for all SCIP index uploads by default
- [63027](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63027) Remove unused code for precise defs by symbol
- [63029](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63029) Use new cmp package to simplify comparisons
- [63030](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63030) Remove unused codeintel utils code
- [63040](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63040) Simplify RequestState/PositionalRequestArgs o11y code
- [63045](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63045) enterpriseportal: add instrumentation for RPC handlers
- [63046](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63046) Temporarily disable syntactic indexing worker job
- [63047](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63047) Replace errors.As with generic As and AsInterface
- [63052](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63052) msp: blindly retry Notion page deletion
- [63056](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63056) Make GetDefinitions API consistent with GetReferences etc.
- [63059](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63059) codeintel: usagesForSymbol - make start/end non-optional for now
- [63060](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63060) codeintel: Document prepareCandidateUploads function
- [63061](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63061) codeintel: Simplify map[T]struct{} logic to use Set
- [63062](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63062) Rename Contains to IsSupersetOf
- [63070](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63070) pnpm: add telemetry package
  - Add missing telemetry package to pnpm lock file
- [63085](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63085) upgrade to latest rules_oci 1.x-
- [63094](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63094) sg: move `registry list` cmd to `release list`
- [63103](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63103) graph: Add changelog entry for Python scip-ctags fix

### CI

- [62823](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62823) fix test issues on main

### Feat

- [60761](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60761) make display limit configurable from user settings
- [62268](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62268) introduce new workflow to restrict image sizes for docs
- [62452](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62452) popover to configure editor
- [62531](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62531) Add new GraphQL API for getting occurrences
- [62704](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62704) msp: do not use tfvars file outside of deploy-type 'subscription'
- [62708](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62708) ci: docker-images runtype
- [62756](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62756) incomplete datapoints can now resolve the affected repositories
- [62772](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62772) sg: handle interrupts more gracefully
- [62802](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62802) cody: new site config for smart context
- [62877](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62877) bazel: `//cmd/{frontend,server}` targets that don't include client bundle for backend integration tests
- [62883](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62883) sg: add 'sg sams' commands 'create-client-token' and 'introspect-token'
- [62912](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62912) enterprise: make per-subscription model allowlists no-op
- [62945](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62945) local: add cloud ephemeral dashboard command
  - `cloud eph dashboard/dash` opens up the cloud ephemeral dashboard
  - `cloud eph ops [--name <instance>]` opens up the ops page for the deployment of the current branch or for the instance specified as a flag
- [62961](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62961) search: Add inline file search to Svelte app
  - Refactored the existing CodeMirror extension to allow UI customization
  - Moved utility functions around to avoid loading all of wildcard into the prototype (which lead to build errors)
  - Tweaked the new icon component to better align within buttons (I missed that in #62908 because I didn't test it within buttons)
  - Noticed that button group styles didn't apply correctly and the reason seemed to be that we were mixing sveltekit and react styles. So I copied the button styles into the sveltekit app.
  - Added a switch component, following [https://web.dev/articles/building/a-switch-component](https://web.dev/articles/building/a-switch-component) .2024-05-29_12-58
- [62964](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62964) appliance: deploy worker
  - Deploys the Worker service.
- [62965](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62965) codeintel: If SignatureDocumentation is present in SCIP, use it for hover text
  - The backend now respects the SCIP [signature_documentation](https://github.com/sourcegraph/scip/blob/main/scip.proto#L409-L415) field, and if available, uses that to create the initial part of the hover text. SCIP indexers should not repeat the text in signature_documentation inside the documentation field.
- [62970](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62970) sg: add version=auto for `sg release cut`
  - Add `--version=auto` to `sg release cut`
- [62985](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62985) ci: add GHA to report when Bazel test ownership drops below 70% threshold
- [62994](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62994) msp: use pgxpool instead of pgx.Conn
  - The MSP runtime `lib/managedservicesplatform/contract.Contract`'s `ConnectToDatabase(...)` has been renamed to `GetConnectionPool(...)`, and now returns a `*pgxpool.Pool` instead of a `*pgx.Conn`
  - The MSP runtime `lib/managedservicesplatform/cloudsql` helper library's `Connect(...)` has been renamed to `GetConnectionPool(...)`, and now returns a `*pgxpool.Pool` instead of a `*pgx.Conn`
- [63011](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63011) msp: add link to ops page in Slack channel description
  - MSP-provisioned alerts Slack channels now include a link to the service's generated operational docs for a service (go/msp-ops) in the channel description.
- [63033](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63033) release: rename code freeze event to `branch cut` event
  - Rename the calendar event `Code Freeze:` to `Branch Cut:`
- [63034](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63034) release: allow creation of multiple patch release events
  - Multiple patch events can now be created with the `sg release cal` command
- [63042](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63042) appliance: deploy codeinsights-dbAdd optional diff extra args to compare-helmI wanted this to do `diff --side-by-side`, may as well commit it as a
feature.feat(appliance): deploy codeinsights-dbReady for review, but draft until base branch merged.
- [63069](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63069) sg: respect the context when executing interrupt hooks
  - Hard exit sg when 5 intterupt hooks are received
  - Respect the context while executing interrupt hooks to ensure we still exit if some hook is misbehaving
- [63071](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63071) sg: add `list-build` subcommand to ci
  - add `list-builds` subcommand to sg to list builds in various states
- [63089](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63089) msp: update handbook link in alerts dashboard, sort custom alerts first

### Fix

- [62415](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62415) Correctly filter uploads with commit and path existence checks
- [62505](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62505) deprecation in pkg call
- [62758](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62758) update links for dev docs
- [62779](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62779) Show full info for highlighter errors
- [62788](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62788) backporting
- [62817](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62817) Make most syntaxHighlighting config fields optional
- [62928](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62928) local: panic in sg ci preview
- [62947](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62947) sg: fix error condition for cloud eph deployment that already exists
  - Deny creating a deployment if a deployment with that name already exists
- [62949](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62949) telemetry: fix dotcom-mode sensitive metadata removal
- [62960](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62960) Initialize operation for UsagesForSymbol
  - Fixed a bug in stub implementation of UsagesForSymbol
- [62963](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62963) Icon auto-import in Bazel
- [62969](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62969) msp: test for cron interval changes based on time, add more restrictions
  - Fixed an issue with output of `sg msp generate` for MSP jobs with particular schedules changing throughout the week
  - MSP jobs schedules now must be between 15 minutes at the most frequent, and every week at the least frequent
- [62989](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62989) sg: cloud eph - do not fail just because we cannot parse reason
  - gracefully handle when we can't parse the reason in cloud ephemeral
- [63017](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63017) msp: make deadlineSeconds job-level configuration, apply in timeout
  - MSP jobs: `schedule.deadline` is deprecated, use the top-level `deadlineSeconds` instead. Configured deadlines are now correctly applied as the Cloud Run job execution timeout as well.
- [63058](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63058) enterpriseportal: fix registration of connectRPC handler options
- [63084](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63084) msp: flatten custom alert promQL query for GCP
- [63109](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63109) gateway: update Google model names in allowed custom chat models

### Reverts

- [#62684](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62684) Revert "Svelte [RepoPopover]: Instantiate the RepoPopover result across the web-app

### Uncategorized

- [61808](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61808) v2t: add v2t to src/teams
- [61968](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61968) Create a shared Cody Ignore dataset
- [61989](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61989) Svelte [RepoPopover]: Instantiate the RepoPopover result across the web-app
- [62107](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62107) gitserver: Implement Stat and ReadDir in gRPC API
- [62136](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62136) lib: upgrade `Routine` interface with context and errors
- [62252](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62252) gitserver: grpc: port DiffSymbols from client as new GitBackend.ChangedFiles() func
- [62262](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62262) gitserver: grpc: create changed files RPC implementation for gRPC server
- [62263](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62263) lib: initial service API for RFC 885
- [62322](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62322) Migrate "New Cody Subscription" page
- [62354](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62354) gitserver: grpc: add new ChangedFiles method to gitserver client
- [62355](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62355) symbols: replace usage of gitserver client's DiffSymbols method with new ChangedFiles method
- [62358](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62358) searcher: replace usage of gitserver.DiffSymbols with new gitserver.ChangedFiles client method
- [62359](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62359) worker: embeddings: replace usage of old gitserver.DiffSymbols client method with new gitserver.ChangedFiles method
- [62360](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62360) gitserver: grpc: remove now unused DiffSymbols func
- [62363](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62363) searcher: remove unused diff.ParseGitDiffNameStatus package
- [62364](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62364) v2t: add v2t to client/branded
- [62413](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62413) SG-61976 - Run a test to remove steps from the new user signup flow
- [62453](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62453) SSC: Teams and Invites: Create "Manage team" page
- [62456](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62456) sg: cloud ephemeral check if deployment exists already
- [62457](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62457) svelte: Reduce imported global CSS
- [62472](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62472) Add access request enabled check in backend redirect
- [62473](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62473) Svelte: implement symbol redesign
- [62474](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62474) Svelte: fix badge centering
- [62476](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62476) sg: skip honey event duration if event is nil
- [62485](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62485) Syntactic indexing: enqueuer and scheduler
- [62487](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62487) always add patch number when cutting branch
- [62489](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62489) sg+ci: cloud ephemeral annotation
- [62491](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62491) Cody PLG: Change fine-tuned model identifier for completions
- [62494](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62494) svelte: First pass on fuzzy finder
- [62498](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62498) Svelte: Implement and instantiate FilePopover
- [62501](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62501) telemetry: improve logging on RecordEvents errors
- [62502](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62502) appliance: deploy redis services
- [62503](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62503) Fix panic on startup
- [62504](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62504) gomod: Bump zoekt for UseKeywordScoring rename
- [62508](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62508) msp: add infra and runtime support for job checkins
- [62510](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62510) Rockskip: simplify ruler function
- [62512](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62512) appliance: add pgsql service definition
- [62513](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62513) gitserver: Implement CommitsUniqueToBranch using Commits
- [62514](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62514) gitserver: Move CommitsUniqueToBranch to callsite
- [62518](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62518) gitserver: Implement CommitLog using Commits
- [62519](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62519) gitserver: Always use Commits in HasCommitAfter
- [62520](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62520) gitserver: Move implementation of HasCommitAfter to caller
- [62521](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62521) dev: add support for project modifier
- [62523](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62523) Auto-update package lockfiles for Sourcegraph base images
- [62524](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62524) msp: export Cloud SQL conection internals for direct usage
- [62525](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62525) enterprise-portal: initialize service with dotcom DB connection
- [62526](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62526) gitserver: Add basic tests for repositoryservice
- [62533](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62533) sg: cloud ephemeral - add build and upgrade commands
- [62534](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62534) Svelte: Visual updates to diff summary
- [62536](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62536) Svelte: Styling updates to search filters
- [62538](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62538) svelte: Fix file tree behavior
- [62541](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62541) release: return an error when promoting a dev release
- [62545](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62545) Cody Ignore: use "cache-and-network" fetch policy for context filters query
- [62548](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62548) Gitserver: add `StatusTypeChanged` to supported statuses in `ChangedFiles`
- [62549](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62549) Rockskip: test getHops function
- [62552](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62552) release: pass in `IS_DEVELOPMENT_RELEASE` flag to buildkite
- [62555](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62555) sg gen buf: fix completions
- [62557](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62557) Rockskip: refactor metrics registration
- [62559](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62559) msp: grant 'sso' team read access to MSP workspaces
- [62561](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62561) gitserver: grpc: fixup and add tests for GetCommit RPC
- [62562](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62562) release(5.4.0): update changelog
- [62563](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62563) gitserver: client: grpc: add tests for GetObject
- [62564](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62564) gitserver: grpc: create proto roundtrip tests for GetObject[Request/Response]
- [62565](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62565) sg msp tfc sync: support applying to all services
- [62566](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62566) sg+release: push releases to the cloud ephemeral registry too
- [62567](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62567) rockskip: ruler function is just bits.TrailingZeros
- [62568](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62568) sg: cloud - remove wip notice for ephemeral commands
- [62569](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62569) sg: cloud - move all cloud ephemeral commands to a sub command `ephemeral`
- [62570](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62570) appliance: deploy syntect-server
- [62574](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62574) [Svelte]: Hide suggestion UI after query was submitted
- [62576](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62576) PR feedback followup
- [62580](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62580) msp: add option to respect existing run mode
- [62581](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62581) Rockskip: add search tests
- [62583](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62583) Render Jupyter notebooks
- [62585](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62585) Svelte: First run on file tree visual update
- [62586](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62586) v2t: add v2 telemetry to the client/shared folder
- [62588](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62588) PLG-590 - Add 16px margin between the "$9/month" and CTA
- [62592](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62592) Move syntactic indexing toggle to site config
- [62594](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62594) conf: redact `scim.authToken` in site config UI
- [62596](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62596) sg: add cloud deploy pubsub notifications
- [62598](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62598) build-tracker: emit agent state-change webhook events to BigQuery
- [62602](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62602) gitserver: Make ReadDir return an iterator on client side
- [62603](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62603) gitserver: Fix duration reported for ChangedFiles
- [62604](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62604) msp: centralize and expose locations configuration
- [62605](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62605) Web: small style fix for jupyter notebooks
- [62606](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62606) gitserver: Add CommitLog API to replace client-side Commits
- [62607](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62607) msp: add incident response starter guide, Notion-specific formatting
- [62608](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62608) Fixup parseDirectoryChildren replacement
- [62609](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62609) gitserver: Add API to enumerate repos on disk
- [62610](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62610) gitserver: Move repo timestamp updates to caller
- [62611](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62611) gitserver: Implement LatestCommitTimestamp in backend
- [62612](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62612) gitserver: Implement RefHash in backend
- [62613](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62613) gitserver: Use the same GitBackendSource for all code paths
- [62614](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62614) gitserver: Move removal of stray tmp pack files to janitor
- [62615](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62615) gitserver: Reduce number of git config invocations
- [62616](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62616) gitserver: Move spec arg safety check into git layer
- [62620](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62620) gitserver: Fixup error codes for ReadDir
- [62624](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62624) appliance: deploy precise-code-intel
- [62625](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62625) Remove SCIP upload to dogfood host
- [62627](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62627) build-tracker: use repeated type for agent queues + deref strings
- [62632](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62632) build-tracker: fix handling of agent webhooks
- [62636](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62636) sg: upgrade sentry
- [62637](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62637) Python notebooks: fix anchor offset
- [62638](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62638) Update broken link for our Development docs in the README file
- [62639](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62639) LLM Models: add GPT-4o support
- [62641](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62641) msp: fix bad formatting
- [62642](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62642) URL Path Escape Model Name
- [62643](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62643) Context: more precise chunk sizing
- [62644](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62644) msp: use new in-terraform custom target provisioning
- [62646](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62646) dev: add /-/healthz endpoint
- [62650](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62650) msp: upgrade to 1.7.5
- [62659](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62659) sg: fix typo in exernal_health_check description
- [62660](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62660) appliance: fix panic on reconcile
- [62664](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62664) bazel: transcribe test ownership to bazel tags
- [62665](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62665) web: Cycle through in-file search results when pressing the numpad enter key
- [62667](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62667) Update HubSpot contacts integration
- [62668](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62668) appliance: default storageclass is nil
- [62669](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62669) Bump zoekt for iterator optimization
- [62670](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62670) build-tracker: include timestamp in agent state change events
- [62672](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62672) inference: Add missing defer
- [62675](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62675) sg msp: add category flag for 'tfc sync'
- [62678](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62678) Web: add mermaid diagram rendering
- [62679](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62679) Docs: update integration test instructions
- [62681](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62681) Svelte: follow up on display limit TODO
- [62682](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62682) Svelte: update navigation bar for dotcom deployment
- [62688](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62688) Auto-update package lockfiles for Sourcegraph base images
- [62690](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62690) Cody Ignore: set lower client version constraint to enable clients testing
- [62694](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62694) SSC: Refactor team management
- [62700](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62700) Bump minimum src-cli version required
- [62701](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62701) fix/telemetry(auth): return authenticated context from session.SetActorFromUser
- [62702](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62702) sg: add repo annotation to delivery pipeline
- [62703](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62703) sg: clarify `repository` annotation meaning in delivery pipeline
- [62705](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62705) gitserver: Allow multiple ranges to be passed to Commits
- [62706](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62706) feat/enterprise-portal: DB layer for \{Get/List\}CodyGatewayAccess
- [62709](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62709) gitserver: Use git-diff-tree to simplify validation and improve security
- [62710](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62710) observability: Fix error checks in ErrorsFilter
- [62711](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62711) inference: Fix regression for non-absolute commit ID
- [62712](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62712) gitserver: Adjust buckets for cleanup timing
- [62715](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62715) Add Cody Pro REST API client library
- [62716](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62716) Cody Ignore: lower version constraint fot test mode
- [62717](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62717) docs: Add CHANGELOG entry for SRC_ACCESS_TOKEN
- [62720](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62720) Client Compatible Bedrock ARN handling
- [62724](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62724) Svelte: Increase search suggestions font size
- [62726](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62726) svelte: Fix various z-index/layering issues
- [62727](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62727) sg: fix `CustomTargetType` reference in `Target` definition
- [62728](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62728) docs: Add link to Entitle permission
- [62729](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62729) svelte: Show correct keyboard shortcut on Linux in "search files" button
- [62730](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62730) appliance: split reconciler package into subpackage
- [62731](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62731) appliance: initial smoke testing harness
- [62732](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62732) appliance: fix test flakiness when container env vars are specified
- [62734](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62734) rockskip: Replace second long-running process with gRPC API
- [62735](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62735) feat(sg/repoferee): add security command with `repo-report` subcommand to fetch latest repoferee report
- [62736](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62736) sg msp: only generate skaffold assets if last stage of rollouts
- [62738](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62738) Fix issue in SAMS account disambiguation
- [62742](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62742) msp: add commit attribute to rollout
- [62743](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62743) gitserver: Remove and deprecate no_timeout option from exec
- [62744](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62744) Svelte: unrevert `RepoPopover`
- [62745](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62745) gitserver: Fix Diff generation
- [62746](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62746) feat/sg-msp: add more stats to 'fleet' command
- [62748](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62748) Chore: add changelog entries
- [62749](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62749) security: Auto-update package lockfiles for Sourcegraph base images
- [62754](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62754) PLG: migrate subscription management page
- [62757](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62757) Change chat defaults to Sonnet and autocomplete defaults to StarCoder or Haiku
- [62759](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62759) authz: Fix panic when auth provider is missing
- [62761](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62761) Fix up "Manage team" page UI
- [62763](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62763) Fix a condition I negated by accident
- [62764](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62764) fix(sg/eph): handle nil regex
- [62769](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62769) bazel: Cleanup oci_deps.bzl
- [62771](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62771) feat/enterprise-portal: ConnectRPC layer for \{Get/List\}CodyGatewayAccess
- [62773](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62773) gitserver: Deprecate Exec and remove localGit
- [62775](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62775) gitserver: Switch corruption logs to use separate file
- [62776](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62776) gitserver: Made git GC recloning less dependent on time
- [62778](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62778) repoupdater: Add retry policy to repositoryservice
- [62782](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62782) gitserver: Remove unnecessary redaction
- [62787](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62787) gitserver: Clean up some errors from improper API usage
- [62790](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62790) Make SSC base url dynamic
- [62794](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62794) Change "Remove" button to a regular button
- [62795](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62795) sg: cloud ephemeral - handle empty times better and santizes name better
- [62797](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62797) Add missing API types
- [62798](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62798) Fix auth-related error in the SSC REST API client hook
- [62800](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62800) gitserver: Fix postrepoactions for repos with many refs
- [62816](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62816) Update changelog for 5.4.2198
- [62818](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62818) SSC: Three small fixes for Teams & invites
- [62819](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62819) Chore: add changelog entry for #62597
- [62822](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62822) svelte: Preserve current revision in repo search input
- [62825](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62825) gitserver: Add observability to chunked messages
- [62828](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62828) gitserver: Fix CommitLog on some git versions
- [62829](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62829) Svelte: add default badge to default branch
- [62830](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62830) Update sensitive metadata allowlist to filter on keys
- [62831](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62831) Remove misleading logic to add credentials to clone URL
- [62832](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62832) svelte: Add tailling space to default repo search input
- [62834](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62834) Svelte: remove site-admin-only data from repo popover
- [62835](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62835) Fix woes related to undefined frontendCodyProConfig.sscBaseUrl
- [62837](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62837) syncer: Fix issues causing excessive fetches
- [62838](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62838) adding finetuned model setup
- [62839](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62839) Add default values for CG config so it starts
- [62841](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62841) svelte: Show correct byline when commit has author and committer
- [62842](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62842) svelte: Improve commit page loading state
- [62843](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62843) sg: cloud ephemeral - only push one tag
- [62844](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62844) sg: cloud ephemeral - various small fixes
- [62845](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62845) appliance: fix syntect service account name
- [62852](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62852) Make the URL dynamic, now with a fallback
- [62854](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62854) sg: remove debugging printlns
- [62858](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62858) SSC: Fix invite date formatting
- [62859](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62859) Update missing changelog element for 5.4.2198
- [62860](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62860) SSC: Fix notification colors
- [62862](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62862) Svelte: linkify and wrap dir entries
- [62864](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62864) worker: Reduce frequency of very frequently run jobs
- [62865](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62865) Svelte: add repo popovers to repo name in header and in dynamic filters
- [62866](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62866) svelte: Fix failing/skipped playwright tests
- [62867](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62867) Svelte: add copy button and reduce spacing
- [62868](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62868) gitserver: Implement Perforce changelist ID mapper as standalone job
- [62869](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62869) Refresh SAMS access tokens as needed
- [62870](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62870) codeintel-service-def
- [62871](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62871) perforce: Add fallback logic for changelist mapper
- [62872](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62872) fix/msp/spec: validate against LivenessInterval that is too high
- [62874](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62874) bazel: bump to latest aspect_rules_js, rules_nodejs, aspect_bazel_lib, aspect_rules_ts, aspect_rules_swc
- [62875](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62875) sg: cloud eph - api now requires env during list
- [62876](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62876) appliance: deploy prometheus
- [62881](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62881) sg: cloud use new status reason format
- [62882](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62882) Update blobstore package to remove unused port + ssl properties
- [62884](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62884) Embeddings: silence worker log warnings
- [62885](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62885) sg: support for super-simple alerts on custom metrics
- [62887](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62887) Update release calendar
- [62888](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62888) SSC: Handle "Accept invite" calls
- [62890](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62890) Pings: Update hardcoded latest release strings
- [62891](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62891) repo-updater: Hydrate schedule on startup
- [62893](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62893) bazel: Add container test for s3proxy
- [62894](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62894) Log all prompts from specific users
- [62896](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62896) svelte: Fix GraphQL error on contributors page
- [62897](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62897) docs: Add tips for highlighter queries and test cases
- [62898](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62898) sg: fix init prompts breaking when encountering whitespace
- [62899](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62899) svelte: Add link to code-graph page to repo navigation
- [62900](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62900) svelte: Format code
- [62901](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62901) svelte: Allow closing the diff and commit view from the history panel
- [62903](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62903) appliance: move storage elements to standard feature
- [62906](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62906) SSC: Handle `team=1` input on checkout form
- [62907](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62907) s3proxy: Fix permissions on s3proxy package binary
- [62908](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62908) svelte: Add lucide icons and new icon API
- [62909](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62909) feat/cody-gateway: support wildcard models
- [62911](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62911) feat/cody-gateway: use wildcard for enterprise allowlists
- [62913](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62913) lib: `CombineRoutine.Start` should not wait
- [62914](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62914) gitserver: grpc: change gitserver ReadFileRequest.Path type to bytes from string
- [62915](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62915) gitserver: grpc: change FileNotFoundPayload path field from string to bytes
- [62916](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62916) gitserver: grpc: Change BlameRequest Path field from string to bytes
- [62917](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62917) gitserver: grpc: relax BlameAuthor name field to allow arbitrary byte sequences
- [62918](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62918) gitserver: grpc: add comment to Stat implementation explaining why we cast the Path field to []byte
- [62920](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62920) privateApp to set `first_source_url` contact property on HubSpot
- [62926](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62926) codeintel: Add stub implementation for usagesForSymbol API
- [62927](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62927) Support Google Gemini through AI Studio
- [62929](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62929) sg: cloud ephemeral - handle multiple job reasons
- [62930](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62930) bazel: add utility macro for wrapping single-file tools
- [62931](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62931) uploads: Fixup nested code intel uploads
- [62932](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62932) feat/enterprise-portal: subscriptions.ListEnterpriseSubscriptionLicenses
- [62936](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62936) SSC: Add "Welcome to Cody Pro" banner
- [62939](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62939) PLG: use react-query for async state management
- [62940](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62940) Fix request blocking in Cody Gateway
- [62941](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62941) schema: Document perf scaling for occurrences(...)
- [62942](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62942) appliance: deploy cadvisor
- [62948](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62948) Rename smartContext to smartContextWindow
- [62950](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62950)  Adding the User param to the site config so that it can be supported by Azure as an extra param
- [62953](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62953) feat/sg/enterprise-portal: use externalSecret to configure SAMS client secret
- [62954](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62954) chore/msp-example: refactor to align with service structure best practices
- [62955](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62955) feature: Use custom Stripe checkout
  - Added Stripe Custom Checkout for Cody PLG
- [62957](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62957) gomod: bump Zoekt for filename boost
- [62958](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62958) Batch changes: remove structural search example
- [62966](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62966) feat/enterprise-portal: explicit opt-in to serve non-dev/non-internal data
- [62967](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62967) Update titles for and references to the Analytics > Extensions page t…
- [62968](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62968) feat/enterpriseportal/codyaccess: add subscription display name
- [62971](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62971) fix typo on feature name
- [62972](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62972) feat/msp/spec: require notionPageID if a production env is provisioned
  - MSP services with production environments now must provide a `service.notionPageID` for go/msp-ops
- [62973](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62973) feat/sg/msp: add 'sg msp validate' for validating service specifications
  - `sg msp validate` can now be used to get quick feedback on whether MSP service specifications are valid.
- [62974](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62974) Svelte: QoL fixes for hover popovers
- [62975](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62975) chores: remove AMI automation
  - move AMI automation to helm repo
- [62976](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62976) Context: detect symbol names in query
- [62977](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62977) cmd: frontend: add note that clarifies that your code host needs to be accessible over the network to test connection button
- [62978](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62978) Svelte: simplify and grow last commit
- [62979](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62979) Svelte: remove go to repository root button
- [62980](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62980) feat/enterprise-portal: only do dotcomdb connection check on-demand
- [62981](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62981) Svelte: add lines to directory groups
- [62982](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62982) sg: fix nil `domain` and `EnvironmentDomainTypeNone` in diagram gen
- [62983](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62983) Remove external accounts modal feature flag
- [62986](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62986) insights: Fix overview page
- [62990](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62990) bug: update version strings in upgradeReadiness
- [62991](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62991) Svelte: make search header primary
- [62993](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62993) Cody PLG: add support for Google Gemini modelsIn your sg local instant, look for the gemini models in the license page.Verify you are not seeing the following error when running the curl command listed in [https://sourcegraph.slack.com/archives/C05AGQYD528/p1717105626504719?thread_ts=1717011825.198899&cid=C05AGQYD528:](https://sourcegraph.slack.com/archives/C05AGQYD528/p1717105626504719?thread_ts=1717011825.198899&cid=C05AGQYD528:) `{"error":"model \"google/gemini-1.5-flash-latest\" is not allowed, allowed: []"}`
- [62997](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62997) Svelte: Paper cuts for 5.5 release
- [63002](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63002) fix(scip-syntax): Fixes a couple CLI annoyancesInternal change. Implements QoL changes to the `scip-syntax` CLI
- [63003](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63003) PLG: extract Cody Pro routes to a separate file
- [63004](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63004) Remove echo test alert
- [63005](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63005) build: bump to rules_esbuild 0.16.0
- [63008](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63008) chore/enterprise-portal: enable MSP rollouts
- [63009](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63009) Svelte: clean up file tree
- [63010](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63010) feat/lib/background: mark goroutine names as safe for Sentry
- [63012](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63012) build: bump to aspect_bazel_lib 2.7.7
- [63013](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63013) feat(cody-gateway): Add FLAGGED_MODEL_NAMES checkAdd a FLAGGED_MODEL_NAMES env var for Cody Gateway. Any requests using a supplied model will be flagged.
- [63014](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63014) Embeddings: hide site admin references
- [63016](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63016) msp: add Job runtime
- [63022](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63022) build: upgrade to rules_js 2.0 RC
- [63026](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63026) gitserver: Add observability for repo service
- [63028](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63028) gitserver: Remove IsCloneable check from clone path
- [63031](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63031) Publish sourcegraph-dev image
- [63032](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63032) sg: speed up interrupt execution
- [63041](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63041) Svelte: Add telemetry v2 to svelte client
- [63043](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63043) gitserver: Increase default GitLongCommandTimeout
- [63044](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63044) Use anyhow context, bail, and ensure instead of panicking
- [63048](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63048) GRAPH-646: scip syntax java package namespace fix
- [63049](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63049) chore/msp/runtime: disable telemetry on Google Monitoring/Trace APIs
- [63050](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63050) chore/msp/spec: tidy up custom alerts spec
- [63051](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63051) worker: add SAMS notifications subscriber
- [63053](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63053) Cody Gateway: Add Gemini models to PLG and Enterprise usersAdded support for Google as an LLM provider for Cody, with the following models available through Cody Gateway: Gemini Pro (`gemini-pro-latest`), Gemini 1.5 Flash (`gemini-1.5-flash-latest`), and Gemini 1.5 Pro (`gemini-1.5-pro-latest`).
- [63054](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63054) Chore: remove plausible scripts
- [63055](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63055) Cody Gateway: remove feature flag requirement for Gemini modelsYou should be able to use the gemini model without the `"cody-pro-gemini-enabled"` feature flag enabled for your account for Pro users.
- [63063](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63063) gitserver: Fix some cases of RevNotFound in CommitLog
- [63065](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63065) build-tracker: remove old links
- [63066](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63066) gitserver: Remove caching of cloned state
- [63073](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63073) Change JetBrains IDE statuses from Beta to Stablechore(cody): Set JetBrains labels from Beta to Stable
- [63079](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63079) sg: add command to fetch versions from release registry
  - add `sg release registry list` to list versions from the release registry
- [63080](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63080) Svelte: fix editor button styling
- [63082](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63082) Svelte: collapse path when too long
- [63086](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63086) repoupdater: Prevent race condition of schedule preloading
- [63087](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63087) chore/msp/runtime: add args as trace attributes, clean up tracing code
- [63095](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63095) bazel: rules_js rc3 and remove deprecated "exclude_declarations" option
  - remove deprecated option `exclude_declarations_from_npm_packages` from local.bazelrc
  - update to rc3 of rules_js
- [63096](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63096) Fix Cody onboarding redirect problemfix(cody): redirect Cody client requests to the access token creation page in all cases
- [63099](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63099) Initialise authProviders array in Go code
- [63101](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63101) cleanup: fix typo: scretTokenKey --> secretTokenKey
- [63104](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63104) security: Auto-update package lockfiles for Sourcegraph base images
- [63108](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/63108) msp: add 'author' and 'commit_message' annotations

### Untracked

The following PRs were merged onto the previous release branch but could not be automatically mapped to a corresponding commit in this release:
- [62490](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62490) rel: bump minor for stitch graph + add support invalidating migrations repo rule
- [62493](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62493) rel: remove broken annotation code
- [62551](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62551) release: pass in `IS_DEVELOPMENT_RELEASE` flag to buildkite
  - `IS_DEVELOPMENT` is now correctly passed to release tooling, allowing to skip certain steps.
- [62553](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62553) release: execute gh via bazel
  - Removes implicit dependency on CI agents having `gh` installed.
- [62556](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62556) release: remove slack webhook requirement
- [62767](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62767) security: Auto-update package lockfiles for Sourcegraph base images
- [62793](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62793) Backport: Client Compatible Bedrock ARN handling (#62720)
- [62905](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62905) security: Auto-update package lockfiles for Sourcegraph base images

# v5.4.2198

{/* RSS={"version":"v5.4.2198", "releasedAt": "2024-05-20"} */}

### Added

### Changed

### Fixed

- Fix a bug that caused Bedrock Provisioned Throughput model names to fail [#62695](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62695) ~~[#62642](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62642)~~
- Fixed an issue where usernames were too eagerly suffixed with a random ID to prevent duplicates which could cause issues with Bitbucket Server permissions syncing where exact username matches are required. [#62747](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62747)
- Fixed an issue where code graph configuration policies would miscategorize lightweight tags as branches. [#62671](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62671)
- Fixed a bug in batch changes scheduling that could cause excessive CPU usage. [#62597](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62597)
- Cody ignore: update version constraint error message [#62654](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62654)

# v5.4.0

### Added

- Added rate and latency instrumentation for git / package repository syncing operations. These are visible in the gitserver dashboards (VCS "Clone/Fetch/IsCloneable" Metrics). [#61708](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61708)
- Added syntax highlighting for the [Pkl](https://pkl-lang.org/) configuration language. [#61478](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61478)
- New `rev:at.time()` search filter that allows you to search a branch at a point in time. [#61513](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61513)
- "cody.contextFilters" field to the site config. Admins can set include and exclude rules to define which repositories Cody can use as context in its requests to third-party LLMs. [#61101](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61101), [#61641](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61641)
- Added whether "cody.contextFilters" field is configured in the site config to pings. [#62080](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62080)
- Added exhaustive logging for all gRPC requests sent to gitserver. This feature is off by default, and can be enabled by setting the `SRC_GITSERVER_EXHAUSTIVE_LOGGING_ENABLED` environment variable to `true`. [#61270](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61270)
- Added an `internal` option for the `repositoryQuery` field for GitHub Enterprise code host connections. This will mirror all internal repositories on the code host. [#61924](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61924)

### Changed

- Improved syntax highlighting for Dart. [#58480](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58480)
- The default noop Event type in the honey package has been replaced with a new type that aggregates fields in memory for testing and logging purposes. [#61854](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61854)
- Improved the performance of Language Stats Insights by 50-70% by increasing the concurrent requests from the frontend to the gitserver from 1 to 4. You can override the concurrency with the `GET_INVENTORY_GIT_SERVER_CONCURRENCY` environment variable. [#62011](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62011)
- Raised the backend timeout for Language Stats Insights from 3 minutes to 5 minutes. You can override this with the `GET_INVENTORY_TIMEOUT` environment variable. [#62011](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62011)
- Code insights drilldown behavior has been changed from a diff search to a point-in-time search with the new `rev:at.time()`. [#61953](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61953)
- The `FirstEverCommit` gitserver client method has been changed to use a new bespoke gRPC endpoint instead of the legacy `exec` endpoint. [#62173](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62173)
- The `GetBehindAhead` gitserver client method has been changed to use a new bespoke gRPC endpoint instead of the legacy `exec` endpoint. [#62217](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62217)
- All uses of the `DiffSymbols` gitserver client method have been replaced with the new `ChangedFiles` method. As such, the `DiffSymbos` method has been removed [#62355](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62355)

### Fixed

- Updated the Docker-in-Docker image to 26.0.0 to resolve several vulnerabilities. [#61735](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61735)
- The GetCommit() RPC in the gitserver service now uses the correct protobuf type that allows for non-utf8 byte sequences in commit messages, author names, and author emails. [#61940](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61940)
- The ArchiveReader() RPC in the gitserver service now uses the correct protobuf type that allows for non-utf8 byte sequences in file paths. [#61970](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61970)
- Pinned code intel popovers and popovers opened via the keyboard are properly shown again. [#61966](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61966)
- Syntax highlighting works correctly for JSX files. [#62027](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62027)
- Changesets with a skipped CI check now have their CI status correctly displayed in the Batch Changes UI. [#62204](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62204)
- Fixed the Sourcegraph login page auto-redirecting to the single auth provider when request access is enabled. [#62376](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62376)

# v5.3.12303

### Added

- Indexed-search now supports draining a replica of indexes to support zero-downtime reduction in cluster size. [#62005](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62005)

### Fixed

- Rust binaries are now built in release mode to avoid unnecessary debug checks. [#61740](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61740)
- Fixed how scip-ctags reports errors to avoid failing search indexing on non-fatal errors. [#61712](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61712)
- Fixed a bug in Enterprise Cody context for queries containing only stopwords. [#61848](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61848), [#62026](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/62026)
- Fixed the instance dropdown on the zoekt grafana dashboard. [#61836](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61836)

# v5.3.11625

### Changed

- Notices configured in the site config now allow for specifying a style or color. [#61338](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61338)
- Reduce spamming error logs when canceling symbols indexing or canceling a syntax highlighting request. [#61880](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61880), [#61719](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61719), [#61732](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61732)

### Fixed

- Fixed a bug where the `src batch preview` command could fail due to an incorrect file-not-found error. [#61984](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61984)
- Fixed a bug where the Roles page in the Site Admin view was inaccessible. [#61738](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61738)
- Fixed a panic in Cody Attribution in sourcegraph-frontend when reporting an error. [#60439](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/60439)

# v5.3.9104

### Added

- GitHub app installations can now be refreshed from the Batch Changes Site Admin page. [#60125](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60125)
- The SAML auth provider configuration now supports a `usernameAttributeNames` field that can be used to specify a list of SAML attribute that should be used as the username. [#60603](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60603)
- Added the GraphQL query `User.evaluateFeatureFlag` to show if a feature flag is enabled or disabled for a user. [#60828](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60828)
- Search Jobs now supports diff, commit and path searches. Before, only file searches were supported. [#60883](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60883)
- Auth providers now support a `noSignIn` option that, when set to true, will hide the auth provider from the sign in page, but still allow users to connect the external account from their Account Security page for permissions syncing. [#60722](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60722)
- Added a "Commits" button to the folders in repos that shows commits for the items in that folder. [#60909](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60909)
- The frontend Grafana dashboard has a new Prometheus metric that tracks the rate of requests that Sourcegraph issues to external services. [#61348](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61348)
- Added support for the `gitURLType` setting for Gerrit, Sourcegraph now supports cloning from Gerrit via SSH. Note: Not on Cloud yet, like for all code hosts. [#61537](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61537)
- Support for OpenAI chat models for enterprise customers. [#61539](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61539)
- Added support for explicitly enumerating repositories to sync from Bitbucket Cloud. Previously, Sourcegraph would automatically sync all repositories from a Bitbucket Cloud workspace. [#61536](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61536)

### Changed

- GitHub apps installation records will only be deleted from the database if the GitHub App has been uninstalled or if the GitHub app has been deleted. [#60460](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60460)
- The Anthropic provider for Cody has been updated to use the messages API which includes support for Claude 3 models. This is applicable to both BYOK and Cody Gateway users. The messages API does not support model identifiers which only set a major model version such as: `claude-2`, `claude-instant-v1` and `claude-instant-1`. Default values have been updated to `claude-2.0` and `claude-instant-1.2`, any legacy models identifiers in the site config will be set to the corresponding default previously mentioned. [#60953](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60953) [#61324](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61324)
- The AWS Bedrock provider for Cody has been updated to use Anthropic's Messages API, bringing support for Claude 3 models. [#61347](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61347)
- Notices configured in the site config now allow for specifying a style or color. [#61338](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61338)

### Fixed

- Code Monitors now properly ignores monitors associated with soft-deleted users, which previously would have led to an error on the overview page. [#60405](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60405)
- Fixed a bug where clicking "Exclude Repo" on Azure DevOps or Gerrit repositories would not work. [#60509](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60509)
- Links in codeintel popovers respect the revision from the URL. [#60545](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60545)
- Fixed an issue where repositories with a name ending in `.git` failed to clone. [#60627](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60627)
- Fixed an issue where Sourcegraph could lose track of repositories on gitserver, leaving behind unnecessary data and inconsistent clone status in the UI. [#60627](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60627)
- The "Commits" button in repository and folder pages links to commits in the current revision instead of in the default branch. [#61408](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61408)
- Fixed an issue where code insights queries would fail if there are more than 65535 restricted repositories and regular expressions. [#61580](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61580)
- The "Commits" button in repository and folder pages uses Perforce language and links to `/-/changelists` for Perforce depots when the experimental feature `perforceChangelistMapping` is enabled. [#61408](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61408)
- Selecting "View blame prior to this change" on a file that was moved will now correctly navigate to the old file location at the specified commit. [#61577](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61577)
- Git blame performance on large files with a large number of commits has been drastically improved. [#61577](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61577)
- Code Insights now properly ignores search API alerts, which previously would have led to a code insight error. [#61431](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61431)

# v5.3.3

### Added

### Changed

- Changed the Azure OpenAI Cody provider to use the stable 2023-05-15 api version, due to the retirement of previous preview api versions. [61005](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61005)

### Fixed

- Fixed an issue in our build process that broke tooltips and validation in the settings editors. [#60808](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60808)

- Fixes a bug where the reference panel would not show any definitions or references for Protocol Buffers (and other languages where the name contained a space). [#60987](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60987)

- Fixed a bug where permission syncs could be scheduled for repositories or users even when a sync is already scheduled or in progress, leading to significant delays in the permissions sync system as a whole. [#61024](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61024)

- Fixed a bug in gitserver where it was possible to use expired Github App authorization tokens when syncing a large repository. Now, gitserver will use the latest tokens for each step of the syncing process (and refresh them if necessary). [#61179](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/61179/)

### Removed

# v5.3.2

### Fixed

- A bug in search that could trigger a panic
- An unintentional change to the search results when using the LineMatch API which would include surrounding lines with no matches
- Autoupgrade only looks for open db connections from the Sourcegraph application services, and disregards other applications connected to the postgres instance. [#60771](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60771)
- Fixes a bug where hovers would not show up in C++ headers with the `.hxx` extension. [#60662](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60662)

# v5.3.1

### Fixed

- Updated container images to fix CVE-2023-4408, CVE-2023-50387, CVE-2023-50868, CVE-2023-5517, CVE-2023-5679, CVE-2023-6516


# v5.3.0

### Added

- The search bar now supports keyword search by default, which ANDs terms together instead of searching literally as before. The behavior can be disabled through a toggle on the search results page. [#58815](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/58815)
- The `has.topic` filter now supports filtering by Gitlab topics. [#57649](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57649)
- Batch Changes now allows changesets to be exported in CSV and JSON format. [#56721](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56721)
- Supports custom ChatCompletion models in Cody clients for dotcom users. [#58158](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58158)
- Topics synced from GitHub and GitLab are now displayed for repository matches in the search results and on the repository tree page. [#58927](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58927)
- Added a new column "Repository metadata JSON" to the CSV export of repository search results, which includes the JSON encoded object of metadata key-value pairs. [#59334](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59334)
- Expiry to access tokens. Users can now select a maximum timespan for which a token is valid. Tokens will automatically lose access after this period. Default timeframes and an override to disable access tokens without expiration can be configured in the `auth.accessTokens` section of the site configuration. [#59565](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59565)
- Gerrit code host connections now support an 'exclude' field that prevents repos in this list from being synced. [#59739](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59739)
- Limit the number of active access tokens for a user. By default users are able to have 25 active access tokens. This limit can be configured using the `maxTokensPerUser` setting in the `auth.accessTokens` section of the site configuration. [#59731](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59731)
- Add experimental support for .cody/ignore when retrieving remote context. To enable it, set `experimentalFeatures.codyContextIgnore: true` in the site configuration. [#59836](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59836), [#59907](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59907)
- Site admin, link to the Cody Analytics service. [#60371](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60371)
- Added a reimagined filter panel to the search result page, facilitating a workflow centered around iterative refinement.
- Search results were treated to a design refresh, improving information density of results. [#59834](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59834)
- Added a preview pane to file search results so you can view the full file without navigating away from the search results. [#58311](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58311)

### Changed

- `cody.restrictUsersFeatureFlag` has been deprecated and replaced by role based access control instead. Until the old configuration value is removed from your site config, it will be respected just as before but with a warning displayed at the top of Sourcegraph. Once removed, the old feature flag will not be respected and instead the Cody access will be managed via role based access controls, see [the docs](/cody/overview/enable-cody-enterprise#enable-cody-only-for-some-users) for more information. [#58831](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58831)
- The setting `experimentalFeatures.searchQueryInput` now refers to the new query input as `v2` (not `experimental`).
- Search-based code intel doesn't include the currently selected search context anymore. It was possible to get into a situation where search-based code intel wouldn't find any information due to being restricted by the current search context. [#58010](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58010)
- The last commit which changed a file/directory is now shown in the files panel on the repo and file pages. To avoid duplicating information and confusion, the commits panel was removed. [58328](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58328)
- Clicking on a search result now opens the blob view at the same commit as the search result. Before, blob views were opened at the tip of the default branch, which sometimes caused inconsistencies in line numbers if the index was out of date. [#58381](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58381)
- The `exclude` configuration for code host configuration has been updated to allow chaining multiple conditions together and filtering GitHub repositories based on their size or number of GitHub stars. [#58377](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58377) and [#58405](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58405)
  - Multiple attributes on _a single_ `exclude` entry now have to be all true for a repository to be excluded. Example: `{"exclude": [{"name": "github.com/example/example"}, {"id": "my-id"}]}` will _only_ exclude repositories that have the name _and_ the id mentioned.
  - GitHub code host connections can exclude by size and stars now: `{"exclude": [{"name": "github.com/example/example"}, {"stars": "< 100", "size": ">= 1GB"}]}`
  - For `size` and `stars` the supported operators are `<`, `>`, `<=`, `>=`.
  - For `size` the supported units are `B`, `b`, `kB`, `KB`, `kiB`, `KiB`, `MiB`, `MB`, `GiB`, `GB`. No decimals points are supported.
- Structural Search is now disabled by default. To enable it, set `experimentalFeatures.structuralSearch: "enabled"` in the site configuration. [#57584](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57584)
- Search Jobs switches the format of downloaded results from CSV to JSON. [#59619](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59619)
- [Search Jobs](/code_search/how-to/search-jobs) is now in beta and enabled by default. It can be disabled in the site configuration by setting `experimentalFeatures.searchJobs: false`.
- The search input on the search homepage is now automatically focused when the page loads.
- gRPC is now the only method for our internal APIs, and can not be disabled. All of corresponding the REST implementations have been removed. The vast majority of customers upgrading to 5.3 don't need to take any action - the change should be invisible. However, if you have restrictions on Sourcegraph’s internal (service to service) traffic, some firewall or security configurations may be necessary. You can downgrade to Sourcegraph 5.2 and disable gRPC while you troubleshoot / reach out to our customer support team. See [https://sourcegraph.com/docs/admin/updates/grpc](https://sourcegraph.com/docs/admin/updates/grpc) for more details. [#59093](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59093)
- The default `count:` for search has been increased to 10000, significantly increasing the number of searches that are exhaustive by default. [#60114](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60114)

### Fixed

- Site configuration edit history no longer breaks when the user that made the edit is deleted. [#57656](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57656)
- Drilling down into an insights query no longer mangles `content:` fields in your query. [#57679](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57679)
- The blame column now shows correct blame information when a hunk starts in a folded code section. [#58042](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58042)
- Fixed a bug where typing in the GraphQL editor in the Site Admin API console could cause the cursor to jump to the start of the editor. [#57862](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57862)
- The blame column no longer ignores whitespace-only changes by default. [#58134](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58134)
- Long lines now wrap correctly in the diff view. [#58138](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58138)
- Fixed an issue in the search input where pressing Enter after selecting a suggestion would sometimes insert another suggestions instead of submitting the query. [#58186](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58186)
- Fixed an issue where having sub-repo permissions enabled could cause repositories with a large number of files in directories to become unviewable. [#59420](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59420)
- On the search context, code monitoring, code insights, saved searches or notebook pages, when selecting a repository or file suggestion in the query input with Enter the suggestion is now properly appended to the query instead of navigating away to the corresponding repository or file page. [#59941](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59941)
- Perforce email matching for user permissions is now case insensitive, matching Perforce behavior. [#60252](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60252)
- A bug with syncing GitHub App installations that caused installations to be truncated after the first 30 orgs. [#60383](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/60383)
- Various significant performance optimizations in the search and code navigation user flows.

### Removed

- The experimental GraphQL query `User.invitableCollaborators`.
- The following experimental settings in site-configuration are now deprecated and will not be read anymore: `maxReorderQueueSize`, `maxQueueMatchCount`, `maxReorderDurationMS`. [#57468](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57468)
- The feature-flag `search-ranking`, which allowed to disable the improved ranking introduced in 5.1, is now deprecated and will not be read anymore. [#57468](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57468)
- The GitHub Proxy service is no longer required and has been removed from deployment options. [#55290](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/55290)
- The VSCode search extension "Sourcegraph for VS Code" has been sunset and removed from Sourcegraph
  repository. [#58023](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58023)
- The `rateLimit` configuration for Perforce code host connections has been removed to avoid confusion, it was unused. [#58188](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58188)
- The feature flag `search-ranking` is now completely removed. [#58156](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58156)
- The notepad UI, notebook creation feature. [#58217](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58217)
- The experimental `indexRepositoryName` option for the rust packages code host connection has been removed. [#59176](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59176)
- The column "Repository metadata" in the CSV export of repository search results is now deprecated and will be removed in a future release. Use "Repository metadata JSON" instead [#59334](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59334)
- Remote embeddings as context source for Cody has been removed. [#59493](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59493)

# v5.2.7

### Added

### Fixed

- The reference panel correctly shows definition and reference information instead of a "Could not find token" error for MATLAB. [#59636](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59636)
- The auto-index configuration page correctly shows any auto-inference errors instead of a nil pointer exception. [#59756](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59756)

### Removed

### Changed

# v5.2.6

### Added

- Implement adding automatic retry support for idempotent gRPC methods [#59404](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59404)

### Fixed

- Fix executors auth header `installSrc` [#59391](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/59391)
- Avoid constantly rerunning failed embeddings jobs. [#58980](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58980)

# v5.2.5

### Added

- Added Cody providers data to pings. [#58848](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58848)
- Added the ability to proxy authentication requests when using the Azure OpenAI Cody provider. [#58862](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58862)

### Fixed

- Fixed an issue where updating a generic git code host would cause it to become unrestricted if permissions user mapping is enabled. [#58772](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58772)
- Fail embeddings jobs immediately if the rate limit is exceeded. [#58869](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58869)

### Changed

- Improved the admin page for search indexing. [#58866](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58866)

### Removed

# v5.2.4

### Added

- Added the ability to use Workload Identity, Managed Identity and Environmental credentials when using the Azure OpenAI completions and embeddings providers [#58289](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58289)
- Added support for cloning via SSH from Azure DevOps. [#58655](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58655)

### Fixed

- Fixed two issues in Zoekt that could cause out of memory errors during search indexing. [sourcegraph/zoekt#686](https://github.com/sourcegraph/zoekt/pull/686), [sourcegraph/zoekt#689](https://github.com/sourcegraph/zoekt/pull/689)
- Fixed performance issue with embeddings job scheduling. (#58651)[https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58651]

# v5.2.3

### Added

- Added configurable GraphQL query cost limitations to prevent unintended resource exhaustion. Default values are now provided and enforced, replacing the previously unlimited behaviour. For more information, please refer to: [GraphQL Cost Limits Documentation](/api/graphql#cost-limits). See details at [#58346](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58346).
- Sourcegraph now supports connecting to Bitbucket Cloud using Workspace Access Tokens. [#58465](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58465).

### Fixed

- Defining file filters for embeddings jobs no longer causes all files to be skipped if `MaxFileSizeBytes` isn't defined. [#58262](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58262)

# v5.2.2

### Added

- Added a new authorization configuration options to GitLab code host connections: "markInternalReposAsPublic". Setting "markInternalReposAsPublic" to true is useful for organizations that have a large amount of internal repositories that everyone on the instance should be able to access, removing the need to have permissions to access these repositories. Additionally, when configuring a GitLab auth provider, you can specify "syncInternalRepoPermissions": false, which will remove the need to sync permissions for these internal repositories. [#57858](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57858)
- Experimental support for OpenAI powered autocomplete has been added. [#57872](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57872)

### Fixed

- Updated the endpoint used by the AWS Bedrock Claude provider. [#58028](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/58028)

# v5.2.1

### Added

- Added two new authorization configuration options to GitHub code host connections: "markInternalReposAsPublic" and "syncInternalRepoPermissions". Setting "markInternalReposAsPublic" to true is useful for organizations that have a large amount of internal repositories that everyone on the instance should be able to access, removing the need to have permissions to access these repositories. Setting "syncInternalRepoPermissions" to true adds an additional step to user permission syncs that explicitly checks for internal repositories. However, this could lead to longer user permission sync times. [#56677](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56677)
- Fixed an issue with Code Monitors that could cause users to be notified multiple times for the same commit [#57546](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57546)
- Fixed an issue with Code Monitors that could prevent a new code monitor from being created if it targeted multiple repos [#57546](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57546)
- Sourcegraph instances will now emit a limited set of [telemetry events](/admin/telemetry) in the background by default ([#57605](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57605)). Enablement will be based on the following conditions:
  - Customers with a license key created after October 3, 2023, or do not have a valid license key configured, will export all telemetry events recorded in the new system.
  - Customers with a license key created before October 3, 2023 will export only Cody-related events recorded in the new system, as covered by the [Cody Usage and Privacy Notice](https://about.sourcegraph.com/terms/cody-notice).
  - If you have a previous agreement regarding telemetry sharing, you account representative will reach out with more details.

### Fixed

- Fixed a user's Permissions page being inaccessible if the user has had no permission syncs with an external account connected. [#57372](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57372)
- Fixed a bug where site admins could not view a user's permissions if they didn't have access to all of the repositories the user has. Admins still won't be able to see repositories they don't have access to, but they will now be able to view the rest of the user's repository permissions. [#57375](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57375)
- Fixed a bug where gitserver statistics would not be properly decoded / reported when using REST (i.e. `experimentalFeatures.enableGRPC = false` in site configuration). [#57318](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57318)
- Updated the `curl` and `libcurl` dependencies to `8.4.0-r0` to fix [CVE-2023-38545](https://curl.se/docs/CVE-2023-38545.html). [#57533](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57533)
- Fixed a bug where commit signing failed when creating a changeset if `batchChanges.enforceFork` is set to true. [#57520](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/57520)
- Fixed a regression in ranking of Go struct and interface in search results. [zoekt#655](https://github.com/sourcegraph/zoekt/pull/655)

# v5.2.0

### Added

- Experimental support for AWS Bedrock Claude for the completions provider has been added. [#56321](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56321)
- Recorded command logs can now be viewed for Git operations performed by Sourcegraph. This provides auditing and debugging capabilities. [#54997](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/54997)
- Disk usage metrics for gitservers are now displayed on the site admin Git Servers page, showing free/total disk space. This helps site admins monitor storage capacity on GitServers. [#55958](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/55958)
- Overhauled Admin Onboarding UI for enhanced user experience, introducing a license key modal with validation, automated navigation to Site Configuration Page, an interactive onboarding checklist button, and direct documentation links for SMTP and user authentication setup. [56366](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56366)
- New experimental feature "Search Jobs". Search Jobs allows you to run search queries across your organization's codebase (all repositories, branches, and revisions) at scale. It enhances the existing Sourcegraph's search capabilities, enabling you to run searches without query timeouts or incomplete results. Please refer to the [documentation](/code_search/how-to/search-jobs) for more information.

### Changed

- OpenTelemetry Collector has been upgraded to v0.81, and OpenTelemetry packages have been upgraded to v1.16. [#54969](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54969), [#54999](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54999)
- Bitbucket Cloud code host connections no longer automatically syncs the repository of the username used. The appropriate workspace name will have to be added to the `teams` list if repositories for that account need to be synced. [#55095](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55095)
- Newly created access tokens are now hidden by default in the Sourcegraph UI. To view a token, click "show" button next to the token. [#56481](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56481)
- The GitHub proxy service has been removed and is no longer required. You can safely remove it from your deployment. [#55290](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/55290)
- On startup, Zoekt indexserver will now delete the `<DATA_DIR>/.indexserver.tmp` directory to remove leftover repository clones, possibly causing a brief delay. Due to a bug, this directory wasn't previously cleaned up and could cause unnecessary disk usage. [zoekt#646](https://github.com/sourcegraph/zoekt/pull/646).
- gRPC is now used by default for all internal (service to service) communication. This change should be invisible to most customers. However, if you're running in an environment that places restrictions on Sourcegraph's internal traffic, some prior configuration might be required. See the ["Sourcegraph 5.2 gRPC Configuration Guide"](/admin/updates/grpc) for more information. [#56738](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56738)

### Fixed

- Language detection for code highlighting now uses `go-enry` for all files by default, which fixes highlighting for MATLAB files. [#56559](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56559)

### Removed

- indexed-search has removed the deprecated environment variable ZOEKT_ENABLE_LAZY_DOC_SECTIONS [zoekt#620](https://github.com/sourcegraph/zoekt/pull/620)
- The federation feature that could redirect users from their own Sourcegraph instance to public repositories on Sourcegraph.com has been removed. It allowed users to open a repository URL on their own Sourcegraph instance and, if the repository wasn't found on that instance, the user would be redirect to the repository on Sourcegraph.com, where it was possibly found. The feature has been broken for over a year though and we don't know that it was used. If you want to use it, please open a feature-request issue and tag the `@sourcegraph/source` team. [#55161](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55161)
- The `applySearchQuerySuggestionOnEnter` experimental feature flag in user settings was removed, and this behavior is now always enabled. Previously, this behavior was on by default, but it was possible to disable it.
- The feature-flag `search-hybrid`, which allowed to disable the performance improvements for unindexed search in 4.3, is now deprecated and will not be read anymore. [#56470](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56470)

# v5.1.9

### Added

- Enable "Test connection" for Perforce code hosts. The "Test connection" button in the code host page UI now works for Perforce code hosts. [#56697](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56697)

### Changed

- User access to Perforce depots is sometimes denied unintentionally when using `"authorization"/"subRepoPermissions": true` in the code host config and the protects file contains exclusionary entries with the Host field filled out. Ignoring those rules (that use anything other than the wildcard (`*`) in the Host field) is now toggle-able by adding `"authorization"/"ignoreRulesWithHost"` to the code host config and setting the value to `true`. [#56450](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56450)

### Fixed

- Fixed an issue where the "gitLabProjectVisibilityExperimental" feature flag would not be respected by the permissions syncer. This meant that users on Sourcegraph that have signed in with GitLab would not see GitLab internal repositories that should be accessible to everyone on the GitLab instance, even though the feature flag was enabled [#56492](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56492)
- Fixed a bug when syncing repository lists from GitHub that could lead to 404 errors showing up when running into GitHub rate limits [#56478](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56478)

# v5.1.8

### Added

- Added experimental autocomplete support for Azure OpenAI [#56063](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56063)

### Changed

- Improved stability of gRPC connections [#56314](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56314), [#56302](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56302), [#56298](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56298), [#56217](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/56217)

# v5.1.7

### Changed

- Pressing `Mod-f` will always select the input value in the file view search [#55546](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55546)
- Caddy has been updated to version 2.7.3 resolving a number of vulnerabilities. [#55606](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55606)
- The commit message defined in a batch spec will now be passed to `git commit` on stdin using `--file=-` instead of being included inline with `git commit -m` to improve how the message is interpreted by `git` in certain edge cases, such as when the commit message begins with a dash, and to prevent extra quotes being added to the message. This may mean that previous escaping strategies will behave differently.

### Fixed

- Fixed a bug in the `deploy-sourcegraph-helm` deployment of Sourcegraph, for sufficiantly large scip indexes uploads will fail when the precise-code-intel worker attempts to write to `/tmp` and doesn't have a volume mounted for this purpose. See kubernetes release notes for more details [#342](https://github.com/sourcegraph/deploy-sourcegraph-helm/pull/343)

# v5.1.6

### Added

- New Prometheus metrics have been added to track the response / request sizes of gRPC calls. [#55381](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55381)
- A new embeddings site configuration setting `excludeChunkOnError` allows embedding jobs to complete job execution despite chunks of code or text that fail. When enabled the chunks are skipped after failed retries but the index can continue being populated. When disabled the entire job fails and the index is not saved. This setting is enabled by default. Embedding job statistics now capture `code_chunks_excluded` and `text_chunks_excluded` for successfully completed jobs. Total excluded chunks and file names for excluded chunks are logged as warnings. [#55180](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55180)
- Experimental support for Azure OpenAI for the completions and embeddings provider has been added. [#55178](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55178)
- Added a feature flag for alternate GitLab project visibility resolution. This may solve some weird cases with not being able to see GitLab internal projects. [#54426](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54426)
  - To use this feature flag, create a Boolean feature flag named "gitLabProjectVisibilityExperimental" and set the value to True.
- It is now possible to add annotations to pods spawned by jobs created by the Kubernetes executor. [#55361](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55361)

### Changed

- Updated all packages in container images to latest versions
- Updated Docker-in-Docker image from 23.0.1 to 23.0.6
- The gRPC implementation for the Symbol service's `LocalCodeIntel` endpoint has been changed to stream its results. [#55242](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55242)
- When using OpenAI or Azure OpenAI for Cody completions, code completions will be disabled - chat will continue to work. This is because we currently don't support code completions with OpenAI. [#55624](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55624)

### Fixed

- Fixed a bug where user account requests could not be approved even though the license would permit user creation otherwise. [#55482](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55482)
- Fixed a bug where the background scheduler for embedding jobs based on policies would not schedule jobs for private repositories. [#55698](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55698)
- Fixed a source of inconsistency in precise code navigation, affecting implementations and prototypes especially. [#54410](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54410)

### Removed

# v5.1.5

### Known Issues

- Standard and multi-version upgrades are not currently working from Sourcegraph versions 5.0.X to 5.1.5. As a temporary workaround, please upgrade 5.0.X to 5.1.0, then 5.1.0 to 5.1.5.

### Fixed

- Fixed an embeddings job scheduler bug where if we cannot resolve one of the repositories or its default branch then all repositories submitted will not have their respective embeddings job enqueued. Embeddings job scheduler will now continue to schedule jobs for subsequent repositories in the submitted repositories set. [#54701](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54701)
- Creation of GitHub Apps will now respect system certificate authorities when specifying certificates for the tls.external site configuration. [#55084](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55084)
- Passing multi-line Coursier credentials in JVM packages configuration should now work correctly. [#55113](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55113)
- SCIP indexes are now ingested in a streaming fashion, eliminating out-of-memory errors in most cases, even when uploading very large indexes (1GB+ uncompressed). [#53828](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53828)
- Moved the license checks to worker service. We make sure to run only 1 instance of license checks this way. [54854](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54854)
- Updated base images to resolve issues in curl, OpenSSL, and OpenSSL. [55310](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55310)
- The default message size limit for gRPC clients has been raised from 4MB to 90MB. [#55209](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55209)
- The message printing feature for the custom gRPC internal error interceptor now supports logging all internal error types, instead of just non-utf 8 errors. [#55130](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55130)
- Fixed an issue where GitHub Apps could not be set up using Firefox. [#55305](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55305)
- Fixed nil panic on certain GraphQL fields when listing users. [#55322](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55322)

### Changed

- The "Files" tab of the fuzzy finder now allows you to navigate directly to a line number by appending `:NUMBER`. For example, the fuzzy query `main.ts:100` opens line 100 in the file `main.ts`. [#55064](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55064)
- The gRPC implementation for the Symbol service's `LocalCodeIntel` endpoint has been changed to stream its results. [#55242](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/55242)
- GitLab auth providers now support an `ssoURL` option that facilitates scenarios where a GitLab group requires SAML/SSO. [#54957](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54957)

### Added

### Removed

# v5.1.4

### Fixed

- A bug where we would temporarily use much more memory than needed during embeddings fetching. [#54972](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54972)

### Changed

- The UI for license keys now displays more information about license validity. [#54990](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54990)
- Sourcegraph now supports more than one auth provider per URL. [#54289](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54289)
- Site-admins can now list, view and edit all code monitors. [#54981](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54981)

# v5.1.3

### Changed

- Cody source code (for the VS Code extension, CLI, and client shared libraries) has been moved to the [sourcegraph/cody repository](https://github.com/sourcegraph/cody).
- `golang.org/x/net/trace` instrumentation, previously available under `/debug/requests` and `/debug/events`, has been removed entirely from core Sourcegraph services. It remains available for Zoekt. [#53795](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53795)

### Fixed

- Fixed an embeddings job scheduler bug where if we cannot resolve one of the repositories or its default branch then all repositories submitted will not have their respective embeddings job enqueued. Embeddings job scheduler will now continue to schedule jobs for subsequent repositories in the submitted repositories set. [#54701](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54701)

# v5.1.2

### Fixed

- Fixes a crash when uploading indexes with malformed source ranges (this was a bug in scip-go). [#54304](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54304)
- Fixed validation of Bitbucket Cloud configuration in site-admin create/update form. [#54494](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54494)
- Fixed race condition with grpc `server.send` message. [#54500](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54500)
- Fixed a configuration initialization issue that broke the outbound request in the site admin page. [#54745](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54745)
- Fixed Postgres DSN construction edge-case. [#54858](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54858)

# v5.1.1

### Fixed

- Fixed the default behaviour when the explicit permissions API is enabled. Repositories are no longer marked as unrestricted by default. [#54419](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54419)

# v5.1.0

> **Note**: As of 5.1.0, the limited OSS subset of Sourcegraph has been removed, and code search OSS code has been relicensed going forward. See https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/53528#issuecomment-1594967818 for more information (blog post coming soon).

> **Note**: As of 5.1.0, the `rsa-sha` signature algorithm is no longer supported when connecting to code hosts over SSH. If you encounter the error `sign_and_send_pubkey: no mutual signature supported` when syncing repositories, see [Repository authentication](/admin/repo/auth#error-sign_and_send_pubkey-no-mutual-signature-supported) for more information and steps to resolve the issue.

### Known issues

- There is an issue with Sourcegraph instances configured to use explicit permissions using permissions.userMapping in Site configuration, where repository permissions are not enforced. Customers using the explicit permissions API are advised to upgrade to v5.1.1 directly.
- There is an issue with creating and updating existing Bitbucket.org (Cloud) code host connections due to problem with JSON schema validation which prevents the JSON editor from loading and surfaces as an error in the UI.

### Added

- Executors natively support Kubernetes environments. [#49236](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/49236)
- Documentation for GitHub fine-grained access tokens. [#50274](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50274)
- Code Insight dashboards retain size and order of the cards. [#50301](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50301)
- The LLM completions endpoint is now exposed through a GraphQL query in addition to the streaming endpoint [#50455](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50455)
- Permissions center statistics pane is added. Stats include numbers of queued jobs, users/repos with failed jobs, no permissions, and outdated permissions. [#50535](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50535)
- SCIM user provisioning support for Deactivate/Reactivation of users. [#50533](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50533)
- Login form can now be configured with ordering and limit of auth providers. [See docs](/admin/auth/login_form). [#50586](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50586), [50284](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50284) and [#50705](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50705)
- OOM reaper events affecting `p4-fusion` jobs on `gitserver` are better detected and handled. Error (non-zero) exit status is used, and the resource (CPU, memory) usage of the job process is appended to the job output so that admins can infer possible OOM activity and take steps to address it. [#51284](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51284)
- When creating a new batch change, spaces are automatically replaced with dashes in the name field. [#50825](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50825) and [51071](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51071)
- Support for custom HTML injection behind an environment variable (`ENABLE_INJECT_HTML`). This allows users to enable or disable HTML customization as needed, which is now disabled by default. [#51400](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51400)
- Added the ability to block auto-indexing scheduling and inference via the `codeintel_autoindexing_exceptions` Postgres table. [#51578](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51578)
- When an admin has configured rollout windows for Batch Changes changesets, the configuration details are now visible to all users on the Batch Changes settings page. [#50479](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50479)
- Added support for regular expressions in`exclude` repositories for GitLab code host connections. [#51862](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51862)
- Branches created by Batch Changes will now be automatically deleted on the code host upon merging or closing a changeset if the new `batchChanges.autoDeleteBranch` site setting is enabled. [#52055](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52055)
- Repository metadata now generally available for everyone [#50567](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50567), [#50607](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50607), [#50857](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50857), [#50908](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50908), [#972](https://github.com/sourcegraph/src-cli/pull/972), [#51031](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51031), [#977](https://github.com/sourcegraph/src-cli/pull/977), [#50821](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50821), [#51258](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51258), [#52078](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52078), [#51985](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51985), [#52150](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52150), [#52249](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52249), [#51982](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51982), [#51248](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51248), [#51921](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51921), [#52301](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52301)
- Batch Changes for Gerrit Code Hosts [#52647](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52647).
- Batch Changes now supports per-batch-change control for pushing to a fork of the upstream repository when the property `changesetTemplate.fork` is specified in the batch spec. [#51572](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51572)
- Executors can now be configured to process multiple queues. [#52016](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52016)
- Added `isCodyEnabled` as a new GraphQL field to `Site`. [#52941](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52941)
- Enabled improved search ranking by default. This feature can be disabled through the `search-ranking` feature flag.[#53031](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53031)
- Added token callback route for Cody in VS Code and VS Code insiders. [#53313](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53313)
- Latest repository clone/sync output is surfaced in the "Mirroring and cloning" page (`{REPO}/-/settings/mirror`). Added primarily to enable easier debugging of issues with Perforce depots, it can also be useful for other code hosts. [#51598](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51598)
- New `file:has.contributor(...)` predicate for filtering files based on contributors. [#53206](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53206)
- Added multi-repo scope selector for Cody on the web supporting unified context generation API which uses combination of embeddings search and keyword search as fallback for context generation. [53046](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53046)
- Batch Changes can now sign commits for changesets published on GitHub code hosts via GitHub Apps. [#52333](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52333)
- Added history of changes to the site configuration page. Site admins can now see information about changes made to the site configuration, by whom and when. [#49842](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/49842)
- For Perforce depots, users will now see the changelist ID (CL) instead of Git commit SHAs when visiting a depot or the view changelists page [#51195](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51195)
- Visiting a specific CL will now use the CL ID in the URL instead of the commit SHA. Other areas affected by this change are browsing files at a specific CL, viewing a specific file changed as part of a specific CL. To enable this behaviour, site admins should set `"perforceChangelistMapping": "enabled"` under experimentalFeatures in the site configuration. Note that currently we process only one perforce depot at a time to map the commit SHAs to their CL IDs in the backend. In a subsequent release we will add support to process multiple depots in parallel. Other areas where currently commit SHAs are used will be updated in future releases. [#53253](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53253) [#53608](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53608) [#54051](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54051)
- Added autoupgrading to automatically perform multi-version upgrades, without manual `migrator` invocations, through the `frontend` deployment. Please see the [documentation](/admin/updates/automatic) for details. [#52242](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52242) [#53196](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53196)

### Changed

- Access tokens now begin with the prefix `sgp_` to make them identifiable as secrets. You can also prepend `sgp_` to previously generated access tokens, although they will continue to work as-is without that prefix.
- The commit message defined in a batch spec will now be quoted when git is invoked, i.e. `git commit -m "commit message"`, to improve how the message is interpreted by the shell in certain edge cases, such as when the commit message begins with a dash. This may mean that previous escaping strategies will behave differently.
- 429 errors from external services Sourcegraph talks to are only retried automatically if the Retry-After header doesn't indicate that a retry would be useless. The time grace period can be configured using `SRC_HTTP_CLI_EXTERNAL_RETRY_AFTER_MAX_DURATION` and `SRC_HTTP_CLI_INTERNAL_RETRY_AFTER_MAX_DURATION`. [#51743](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51743)
- Security Events NO LONGER write to database by default - instead, they will be written in the [audit log format](/admin/audit_log) to console. There is a new site config setting `log.securityEventLogs` that can be used to configure security event logs to write to database if the old behaviour is desired. This new default will significantly improve performance for large instances. In addition, the old environment variable `SRC_DISABLE_LOG_PRIVATE_REPO_ACCESS` no longer does anything. [#51686](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51686)
- Audit Logs & Security Events are written with the same severity level as `SRC_LOG_LEVEL`. This prevents a misconfiguration
  issue when `log.AuditLogs.SeverityLevel` was set below the overall instance log level. `log.AuditLogs.SeverityLevel` has
  been marked as deprecated and will be removed in a future release [#52566](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52566)
- Update minimum supported Redis version to 6.2 [#52248](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52248)
- The batch spec properties [`transformChanges`](/batch-changes/batch-spec-yaml-reference#transformchanges) and [`workspaces`](/batch-changes/batch-spec-yaml-reference#workspaces) are now generally available.
- Cody feature flags have been simplified [#52919](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52919) See [the docs page for complete setup details](/cody/explanations/enabling_cody_enterprise)
  - `cody.enabled` in site-config now controls whether Cody is on/off, default `false`.
  - When `cody.enabled` is set and no specific configuration for `completions` and `embeddings` are given, Cody will by default talk to the `sourcegraph` provider, Sourcegraphs Cody Gateway which allows access to chat completions and embeddings.
  - Enabling Cody now requires `cody.enabled` set to `true` and `completions` to be set.
  - `cody.restrictUsersFeatureFlag` replaces `experimentalFeatures.CodyRestrictUsersFeatureFlag` in site-config, default `false`.
  - `completions.enabled` has been deprecated, replaced by `cody.enabled`.
  - The feature flags for Cody in web features have been removed and the single source of truth is now `cody.enabled`.
  - The embeddings configuration now requires a `provider` field to be set.
  - Ping data now reflects whether `cody.enabled` and `completions` are set.
- If a Sourcegraph request is traced, its trace ID and span ID are now set to the `X-Trace` and `X-Trace-Span` response headers respectively. The trace URL (if a template is configured in `observability.tracing.urlTemplate`) is now set to `X-Trace-URL` - previously, the URL was set to `X-Trace`. [#53259](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53259)
- For users using the single-container server image with the default built-in database, the database must be reindexed. This process can take up to a few hours on systems with large datasets. See [Migrating to Sourcegraph 5.1.x](/admin/migration/5_1) for full details. [#53256](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53256)
- [Sourcegraph Own](/own) is now available as a beta enterprise feature. `search-ownership` feature flag is removed and doesn't need to be used.
- Update Jaeger to 1.45.0, and Opentelemetry-Collector to 0.75.0 [#54000](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54000)
- Switched container OS to Wolfi for hardened containers [#47182](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47182), [#47368](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47368)
- Batches changes now supports for CODEOWNERS for Github. Pull requests requiring CODEOWNERS approval, will no longer show as approved unless explicitly approved by a CODEOWNER. https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53601
- The insecure `rsa-sha` signature algorithm is no longer supported when connecting to code hosts over SSH. See the [Repository authentication](/admin/repo/auth#error-sign_and_send_pubkey-no-mutual-signature-supported) page for further details.

### Fixed

- GitHub `repositoryQuery` searches now respect date ranges and use API requests more efficiently. #[49969](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/49969)
- Fixed an issue where search based references were not displayed in the references panel. [#50157](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50157)
- Symbol suggestions only insert `type:symbol` filters when necessary. [#50183](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50183)
- Removed an incorrect beta label on the Search Context creation page [#51188](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51188)
- Multi-version upgrades to version `5.0.2` in a fully airgapped environment will not work without the command `--skip-drift-check`. [#51164](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51164)
- Could not set "permissions.syncOldestUsers" or "permissions.syncOldestRepos" to zero. [#51255](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51255)
- GitLab code host connections will disable repo-centric repository permission syncs when the authentication provider is set as "oauth". This prevents repo-centric permission sync from getting incorrect data. [#51452](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51452)
- Code intelligence background jobs did not correctly use an internal context, causing SCIP data to sometimes be prematurely deleted. [#51591](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51591)
- Slow request logs now have the correct trace and span IDs attached if a trace is present on the request. [#51826](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51826)
- The braindot menu on the blob view no longer fetches data eagerly to prevent performance issues for larger monorepo users. [#53039](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53039)
- Fixed an issue where commenting out redacted site-config secrets would re-add the secrets. [#53152](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53152)
- Fixed an issue where SCIP packages would sometimes not be written to the database, breaking cross-repository jump to definition. [#53763](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53763)
- Fixed an issue when adding a new user external account was not scheduling a new permission sync for the user. [#54144](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54144)
- Adding a new user account now correctly schedules a permission sync for the user. [#54258](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54258)
- Users/repos without an existing sync job in the permission_sync_jobs table are now scheduled properly. [#54278](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/54278)

### Removed

- User tags are removed in favor of the newer feature flags functionality. [#49318](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/49318)
- Previously deprecated site config `experimentalFeatures.bitbucketServerFastPerm` has been removed. [#50707](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50707)
- Unused site-config field `api.rateLimit` has been removed. [#51087](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51087)
- Legacy (table-based) blob viewer. [#50915](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50915)

# v5.0.6

### Fixed

- SAML assertions to get user display name are now compared case insensitively and we do not always return an error. [#52992](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52992)
- Fixed an issue where `type:diff` search would not work when sub-repo permissions are enabled. [#53210](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/53210)

# v5.0.5

### Added

- Organization members can now administer batch changes created by other members in their organization's namespace if the setting `orgs.allMembersBatchChangesAdmin` is enabled for that organization. [#50724](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50724)
- Allow instance public access mode based on `auth.public` site config and `allow-anonymous-usage` license tag [#52440](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52440)
- The endpoint configuration field for completions is now supported by the OpenAI provider [#52530](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52530)

### Fixed

- MAU calculation in product analytics and pings use the same condition and UTC at all times. [#52306](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52306) [#52579](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52579) [#52581](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52581)
- Bitbucket native integration: fix code-intel popovers on the pull request pages. [#52609](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52609)
- `id` column of `user_repo_permissions` table was switched to `bigint` to avoid `int` overflow. [#52299](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52299)
- In some circumstances filenames containing `..` either could not be read or would return a diff when viewed. We now always correctly read those files. [#52605](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52605)
- Syntax highlighting for several languages including Python, Java, C++, Ruby, TypeScript, and JavaScript is now working again when using the single Docker container deployment option. Other deployment options were not affected.

# v5.0.4

### Fixed

- Git blame lookups of repositories synced through `src serve-git` or code hosts using a custom `repositoryPathPattern` will now use the correct URL when streaming git blame is enabled. [#51525](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51525)
- Code Insights scoped to a static list of repository names would fail to resolve repositories with permissions enabled, resulting in insights that would not process. [#51657](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51657)
- Batches: Resolved an issue with GitHub webhooks where CI check updates fail due to the removal of a field from the GitHub webhook payload. [#52035](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/52035)

# v5.0.3

### Added

- Cody aggregated pings. [#50835](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50835)

### Fixed

- Bitbucket Server adding an error log if there is no account match for the user. #[51030](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51030)
- Editing search context with special characters such as `/` resulted in http 404 error. [#51196](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51196)
- Significantly improved performance and reduced memory usage of the embeeddings service. [#50953](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50953), [#51372](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51372)
- Fixed an issue where a Code Insights query with structural search type received 0 search results for the latest commit of any matching repo. [#51076](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/51076)

# v5.0.2

### Added

- An experimental site config setting to restrict cody to users by the cody-experimental feature flag [#50668](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50668)

### Changed

- Use the Alpine 3.17 releases of cURL and Git

### Fixed

- For Cody, explicitly detect some cases where context is needed to avoid failed responses. [#50541](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50541)
- Code Insights that are run over zero repositories will finish processing and show `"No data to display"`. #[50561](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50561)
- DNS timeouts on calls to host.docker.internal from every html page load for docker-compose air-gapped instances. No more DNS lookups in jscontext.go anymore. #[50638](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50638)
- Improved the speed of the embedding index by significantly decreasing the calls to Gitserver. [#50410](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50410)

### Removed

-

# v5.0.1

### Added

- The ability to exclude certain file path patterns from embeddings.
- Added a modal to show warnings and errors when exporting search results. [#50348](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50348)

### Changed

### Fixed

- Fixed CVE-2023-0464 in container images
- Fixed CVE-2023-24532 in container images
- Fixed an issue where Slack code monitoring notifications failed when the message was too long. [#50083](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50083)
- Fixed an edge case issue with usage statistics calculations that cross over month and year boundaries.
- Fixed the "Last incremental sync" value in user/repo permissions from displaying a wrong date if no sync had been completed yet.
- Fixed an issue that caused search context creation to fail with error "you must provide a first or last value to properly paginate" when defining the repositories and revisions with a JSON configuration.
- Fixed an issue where the incorrect actor was provided when searching an embeddings index.
- Fixed multiple requests downloading the embeddings index concurrently on an empty cache leading to an out-of-memory error.
- Fixed the encoding of embeddings indexes which caused out-of-memory errors for large indexes when uploading them from the worker service.
- Fixed git blame decorations styles
- CODEOWNERS rules with consecutive slashes (`//`) will no longer fail ownership searches
- Granting pending permissions to users when experimentalFeatures.unifiedPermissions is turned ON [#50059](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50059)
- The unified permissions out of band migration reported as unfinished if there were users with no permissions [#50147](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50147)
- Filenames with special characters are correctly handled in Cody's embedding service [#50023](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50023)
- Structural search correctly cleans up when done preventing a goroutine leak [#50034](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50034)
- Fetch search based definitions in the reference panel if no precise definitions were found [#50179](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/50179)

### Removed

# v5.0.0

### Added

- The environment variable `TELEMETRY_HTTP_PROXY` can be set on the `sourcegraph-frontend` service, to use an HTTP proxy for telemetry and update check requests. [#47466](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47466)
- Kubernetes Deployments: Introduced a new Kubernetes deployment option ([deploy-sourcegraph-k8s](https://github.com/sourcegraph/deploy-sourcegraph-k8s)) to deploy Sourcegraph with Kustomize. [#46755](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/46755)
- Kubernetes Deployments: The new Kustomize deployment ([deploy-sourcegraph-k8s](https://github.com/sourcegraph/deploy-sourcegraph-k8s)) introduces a new base cluster that runs all Sourcegraph services as non-root users with limited privileges and eliminates the need to create RBAC resources. [#4213](https://github.com/sourcegraph/deploy-sourcegraph/pull/4213)
- Added the `other.exclude` setting to [Other external service config](/admin/code_hosts/other#configuration). It can be configured to exclude mirroring of repositories matching a pattern similar to other external services. This is useful when you want to exclude repositories discovered via `src serve-git`. [#48168](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48168)
- The **Site admin > Updates** page displays the upgrade readiness information about schema drift and out-of-band migrations. [#48046](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48046)
- Pings now contain ownership search and file-view activity counts. [#47062](https://github.com/sourcegraph/sourcegraph-public-snapshot/47062)
- Greatly improves keyboard handling and accessibility of the files and symbol tree on the repository pages. [#12916](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/12916)
- The file tree on the repository page now automatically expands into single-child directories. [#47117](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47117)
- When encountering GitHub rate limits, Sourcegraph will now wait the recommended amount of time and retry the request. This prevents sync jobs from failing prematurely due to external rate limits. [#48423](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48423)
- Added a dashboard with information about user and repository background permissions sync jobs. [#46317](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/46317)
- When encountering GitHub or GitLab rate limits, Sourcegraph will now wait the recommended amount of time and retry the request. This prevents sync jobs from failing prematurely due to external rate limits. [#48423](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48423), [#48616](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48616)
- Switching between code editor, files and symbols trees using keyboard shortcuts (currently under the experimental feature flag: `blob-page-switch-areas-shortcuts`). [#46829](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46829).
- Added "SCIM" badges for SCIM-controlled users on the User admin page. [#48727](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48727)
- Added Azure DevOps Services as a Tier 1 Code Host, including: repository syncing, permissions syncing, and Batch Changes support. [#46265](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/46265)
- Added feature to disable some fields on user profiles for SCIM-controlled users. [#48816](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48816)
- Native support for ingesting and searching GitHub topics with `repo:has.topic()` [#48875](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48875)
- [Role- Access Control](/admin/access_control) is now available as an enterprise feature (in Beta). It is currently only supported for Batch Changes functionality. [#43276](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/43276)
- Site admins can now [restrict creation of batch changes to certain u[sers](/admin/access_control/batch_changes) by tailoring their roles and the permissions granted to those )roles. [#34491](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/34491)
- Site admins can now [configure outgoing webh[ooks](/admin/config/webhooks/outgoing) for Batch Changes to inform external tools of events related to Sourceg)raph batch changes and their changesets. [#38278](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/38278)
- [Sourcegraph[ Own](/own) is now available as an experimental enterprise feature. Enable the `search-ownership` fe)ature flag to use it.
- Gitserver supports a new `COURSIER_CACHE_DIR` env var to configure the cache location for coursier JVM package repos.
- Pings now emit a histogram of repository sizes cloned by Sourcegraph [48211](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48211).
- The search input has been redesigned to greatly improve usability. New contextual suggestions help users learn the Sourcegraph query language as they search. Suggestions have been unified across contexts and filters, and the history mode has been integrated into the input. Improved and expanded keyboard shortcuts also make navigation much easier. This functionality is in beta, and can be disabled in the user menu.

### Changed

- Experimental GraphQL query, `permissionsSyncJobs` is substituted with new non-experimental query which provides full information about permissions sync jobs stored in the database. [#47933](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47933)
- Renders `readme.txt` files in the repository page. [#47944](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47944)
- Renders GitHub pull request references in all places where a commit message is referenced. [#48183](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48183)
- CodeMirror blob view (default) uses selection-driven code navigation. [#48066](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48066)
- Older Code Insights data points will now be automatically archived as configured by the site configuration setting `insights.maximumSampleSize`, set to 30 by default. All points can be exported. This behaviour can be disabled using the experimental setting `insightsDataRetention`. [#48259](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48259)
- The admin debug GraphQL endpoint for Code Insights will now include the series metadata in the response. [#49473](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/49473)
- Usage telemetry has been streamlined; there are no longer two categories (critical and non-critical), and telemetry will be streamlined and reviewed/reduced further in upcoming releases. The site admin flag `disableNonCriticalTelemetry` currently still remains but has no effect.

### Fixed

- The symbols service `CACHE_DIR` and `MAX_TOTAL_PATHS_LENGTH` were renamed to have a `SYMBOLS_` prefix in the last version of Sourcegraph; this version fixes a bug where the old names without the `SYMBOLS_` prefix were not respected correctly. Both names now work.
- Fixed issues with propagating tracing configuration throughout the application. [#47428](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47428)
- Enable `auto gc` on fetch when `SRC_ENABLE_GC_AUTO` is set to `true`. [#47852](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47852)
- Fixes syntax highlighting and line number issues in the code preview rendered inside the references panel. [#48107](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48107)
- The ordering of code host sync error messages in the notifications menu will now be persistent. Previously the order was not guaranteed on a refresh of the status messages, which would make the code host sync error messages jump positions, giving a false sense of change to the site admins. [#48722](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48722)
- Fixed Detect & Track Code Insights running over all repositories when during creation a search was used to specify the repositories for the insight. [#49633](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/49633)

### Removed

- The LSIF upload endpoint is no longer supported and has been replaced by a diagnostic error page. src-cli v4.5+ will translate all local LSIF files to SCIP prior to upload. [#47547](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47547)
- The experimental setting `authz.syncJobsRecordsLimit` has been removed. [#47933](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47933)
- Storing permissions sync jobs statuses in Redis has been removed as now all permissions sync related data is stored in a database. [#47933](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47933)
- The key `shared_steps` has been removed from auto-indexing configuration descriptions. If you have a custom JSON auto-indexing configuration set for a repository that defines this key, you should inline the content into each index job's `steps` array. [#48770](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48770)

# v4.5.1

### Changed

- Updated git to version 2.39.2 to address [reported security vulnerabilities](https://github.blog/2023-02-14-git-security-vulnerabilities-announced-3/) [#47892](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47892/files)
- Updated curl to 7.88.1 to address [reported security vulnerabilities](https://curl.se/docs/CVE-2022-42915.html) [#48144](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/48144)

# v4.5.0

### Added

- Endpoint environment variables (`SEARCHER_URL`, `SYMBOLS_URL`, `INDEXED_SEARCH_SERVERS`, `SRC_GIT_SERVERS`) now can be set to replica count values in Kubernetes, Kustomize, Helm and Docker Compose environments. This avoids the need to use service discovery or generating the respective list of addresses in those environments. [#45862](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45862)
- The default author and email for changesets will now be pulled from user account details when possible. [#46385](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46385)
- Code Insights has a new display option: "Max number of series points to display". This setting controls the number of data points you see per series on an insight. [#46653](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46653)
- Added out-of-band migration that will migrate all existing data from LSIF to SCIP (see additional [migration documenta[tion](/admin/how-to/lsif_scip_migration)). [#45106](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45106))
- Code Insights has a new search-powered repositories field that allows you to select repositories with Sourcegraph search syntax. [#45687](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45687)
- You can now export all data for a Code Insight from the card menu or the standalone page. [#46795](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46795), [#46694](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46694)
- Added Gerrit as an officially supported code host with permissions syncing. [#46763](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46763)
- Markdown files now support `<picture>` and `<video>` elements in the rendered view. [#47074](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47074)
- Batch Changes: Log outputs from execution steps are now paginated in the web interface. [#46335](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46335)
- Monitoring: the searcher dashboard now contains more detailed request metrics as well as information on interactions with the local cache (via gitserver). [#47654](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47654)
- Renders GitHub pull request references in the commit list. [#47593](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47593)
- Added a new background permissions syncer & scheduler which is backed by database, unlike the old one that was based on an in-memory processing queue. The new system is enabled by default, but can be disabled. Revert to the in-memory processing queue by setting the feature flag `database-permission-sync-worker` to `false`. [#47783](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47783)
- Zoekt introduces a new opt-in feature, "shard merging". Shard merging consolidates small index files into larger ones, which reduces Zoekt-webserver's memory footprint [documenta[tion](/code_search/explanations/search_details#shard-merging))
- Blob viewer is now backed by the CodeMirror editor. Previous table-based blob viewer can be re-enabled by setting `experimentalFeatures.enableCodeMirrorFileView` to `false`. [#47563](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47563)
- Code folding support for the CodeMirror blob viewer. [#47266](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47266)
- CodeMirror blob keyboard navigation as experimental feature. Can be enabled in settings by setting `experimentalFeatures.codeNavigation` to `selection-driven`. [#44698](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44698)

### Changed

- Archived and deleted changesets are no longer counted towards the completion percentage shown in the Batch Changes UI. [#46831](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46831)
- Code Insights has a new UI for the "Add or remove insights" view, which now allows you to search code insights by series label in addition to insight title. [#46538](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46538)
- When SMTP is configured, users created by site admins via the "Create user" page will no longer have their email verified by default - users must verify their emails by using the "Set password" link they get sent, or have their emails verified by a site admin via the "Emails" tab in user settings or the `setUserEmailVerified` mutation. The `createUser` mutation retains the old behaviour of automatically marking emails as verified. To learn more, refer to the [SMTP and email deli[very](/admin/config/email) documentation. [#46187](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46187))
- Connection checks for code host connections have been changed to talk to code host APIs directly via HTTP instead of doing DNS lookup and TCP dial. That makes them more resistant in environments where proxies are used. [#46918](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46918)
- Expiration of licenses is now handled differently. When a license is expired promotion to site-admin is disabled, license-specific features are disabled (exceptions being SSO & permission syncing), grace period has been replaced with a 7-day-before-expiration warning. [#47251](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47251)
- Searcher will now timeout searches in 2 hours instead of 10 minutes. This timeout was raised for batch use cases (such as code insights) searching old revisions in very large repositories. This limit can be tuned with the environment variable `PROCESSING_TIMEOUT`. [#47469](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47469)
- Zoekt now bypasses the regex engine for queries that are common in the context of search-based code intelligence, such as `\bLITERAL\b case:yes`. This can lead to a significant speed-up for "Find references" and "Find implementations" if precise code intelligence is not available. [zoekt#526](https://github.com/sourcegraph/zoekt/pull/526)
- The Sourcegraph Free license has undergone a number of changes. Please contact support@sourcegraph.com with any questions or concerns. [#46504](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46504)
  - The Free license allows for only a single private repository on the instance.
  - The Free license does not support SSO of any kind.
  - The Free license does not offer mirroring of code host user permissions.
- Expired Sourcegraph licenses no longer allow continued use of the product. [#47251](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47251)
  - Licensed features are disabled once a license expires.
  - Users can no longer be promoted to Site Admins once a license expires.

### Fixed

- Resolved issue which would prevent Batch Changes from being able to update changesets on forks of repositories on Bitbucket Server created prior to version 4.2. [#47397](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47397)
- Fixed a bug where changesets created on forks of repositories in a personal user's namespace on GitHub could not be updated after creation. [#47397](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47397)
- Fixed a bug where saving default Sort & Limit filters in Code Insights did not persist [#46653](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46653)
- Restored the old syntax for `repo:contains` filters that was previously removed in version 4.0.0. For now, both the old and new syntaxes are supported to allow for smooth upgrades. Users are encouraged to switch to the new syntax, since the old one may still be removed in a future version.
- Fixed a bug where removing an auth provider would render a user's Account Security page inaccessible if they still had an external account associated with the removed auth provider. [#47092](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47092)
- Fixed a bug where the `repo:has.description()` parameter now correctly shows description of a repository synced from a Bitbucket server code host connection, while previously it used to show the repository name instead [#46752](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46752)
- Fixed a bug where permissions syncs consumed more rate limit tokens than required. This should lead to speed-ups in permission syncs, as well as other possible cases where a process runs in repo-updater. [#47374](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47374)
- Fixes UI bug where folders with single child were appearing as child folders themselves. [#46628](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46628)
- Performance issue with the Outbound requests page. [#47544](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47544)

### Removed

- The Code insights "run over all repositories" mode has been replaced with search-powered repositories filed syntax. [#45687](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45687)
- The settings `search.repositoryGroups`, `codeInsightsGqlApi`, `codeInsightsAllRepos`, `experimentalFeatures.copyQueryButton`,, `experimentalFeatures.showRepogroupHomepage`, `experimentalFeatures.showOnboardingTour`, `experimentalFeatures.showSearchContextManagement` and `codeIntelligence.autoIndexRepositoryGroups` have been removed as they were deprecated and unsued. [#47481](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47481)
- The site config `enableLegacyExtensions` setting was removed. It is no longer possible to enable legacy Sourcegraph extension API functionality in this version.

# v4.4.2

### Changed

- Expiration of licenses is now handled differently. When a license is expired promotion to site-admin is disabled, license-specific features are disabled (exceptions being SSO & permission syncing), grace period has been replaced with a 7-day-before-expiration warning. [#47251](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/47251)

# v4.4.1

### Changed

- Connection checks for code host connections have been changed to talk to code host APIs directly via HTTP instead of doing DNS lookup and TCP dial. That makes them more resistant in environments where proxies are used. [#46918](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46918)
- The search query input overflow behavior on search home page has been fixed. [#46922](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46922)

# v4.4.0

### Added

- Added a button "Reindex now" to the index status page. Admins can now force an immediate reindex of a repository. [#45533](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45533)
- Added an option "Unlock user" to the actions dropdown on the Site Admin Users page. Admins can unlock user accounts that wer locked after too many sign-in attempts. [#45650](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45650)
- Templates for certain emails sent by Sourcegraph are now configurable via `email.templates` in site configuration. [#45671](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45671), [#46085](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46085)
- Keyboard navigation for search results is now enabled by default. Use Arrow Up/Down keys to navigate between search results, Arrow Left/Right to collapse and expand file matches, Enter to open the search result in the current tab, Ctrl/Cmd+Enter to open the result in a separate tab, / to refocus the search input, and Ctrl/Cmd+Arrow Down to jump from the search input to the first result. Arrow Left/Down/Up/Right in previous examples can be substituted with h/j/k/l for Vim-style bindings. Keyboard navigation can be disabled by creating the `search-results-keyboard-navigation` feature flag and setting it to false. [#45890](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45890)
- Added support for receiving GitLab webhook `push` events. [#45856](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45856)
- Added support for receiving Bitbucket Server / Datacenter webhook `push` events. [#45909](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45909)
- Monitoring: Indexed-Search's dashboard now has new graphs for search request durations and "in-flight" search request workloads [#45966](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45966)
- The GraphQL API now supports listing single-file commit history across renames (with `GitCommit.ancestors(follow: true, path: "<some-path>")`). [#45882](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45882)
- Added support for receiving Bitbucket Cloud webhook `push` events. [#45960](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45960)
- Added a way to test code host connection from the `Manage code hosts` page. [#45972](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45972)
- Updates to the site configuration from the site admin panel will now also record the user id of the author in the database in the `critical_and_site_config.author_user_id` column. [#46150](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46150)
- When setting and resetting passwords, if the user's primary email address is not yet verified, using the password reset link sent via email will now also verify the email address. [#46307](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46307)
- Added new code host details and updated edit code host pages in site admin area. [#46327](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46327)
- If the experimental setting `insightsDataRetention` is enabled, the number of Code Insights data points that can be viewed will be limited by the site configuration setting `insights.maximumSampleSize`, set to 30 by default. Older points beyond that number will be periodically archived. [#46206](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46206), [#46440](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46440)
- Bitbucket Cloud can now be added as an authentication provider on Sourcegraph. [#46309](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46309)
- Bitbucket Cloud code host connections now support permissions syncing. [#46312](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46312)
- Keep a log of corruption events that happen on repositories as they are detected. The Admin repositories page will now show when a repository has been detected as being corrupt and they'll also be able to see a history log of the corruption for that repository. [#46004](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46004)
- Added corrupted statistic as part of the global repositories statistics. [46412](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46412)
- Added a `Corrupted` status filter on the Admin repositories page, allowing Administrators to filter the list of repositories to only those that have been detected as corrupt. [#46415](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46415)
- Added “Background job dashboard” admin feature [#44901](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44901)

### Changed

- Code Insights no longer uses a custom index of commits to compress historical backfill and instead queries the repository log directly. This allows the compression algorithm to span any arbitrary time frame, and should improve the reliability of the compression in general. [#45644](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45644)
- GitHub code host configuration: The error message for non-existent organizations has been clarified to indicate that the organization is one that the user manually specified in their code host configuration. [#45918](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45918)
- Git blame view got a user-interface overhaul and now shows data in a more structured way with additional visual hints. [#44397](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/44397)
- User emails marked as unverified will no longer receive code monitors and account update emails - unverified emails can be verified from the user settings page to continue receiving these emails. [#46184](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46184)
- Zoekt by default eagerly unmarshals the symbol index into memory. Previously we would unmarshal on every request for the purposes of symbol searches or ranking. This lead to pressure on the Go garbage collector. On sourcegraph.com we have noticed time spent in the garbage collector halved. In the unlikely event this leads to more OOMs in zoekt-webserver, you can disable by setting the environment variable `ZOEKT_ENABLE_LAZY_DOC_SECTIONS=t`. [zoekt#503](https://github.com/sourcegraph/zoekt/pull/503)
- Removes the right side action sidebar that is shown on the code view page and moves the icons into the top nav. [#46339](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46339)
- The `sourcegraph/prometheus` image no longer starts with `--web.enable-lifecycle --web.enable-admin-api` by default - these flags can be re-enabled by configuring `PROMETHEUS_ADDITIONAL_FLAGS` on the container. [#46393](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46393)
- The experimental setting `authz.syncJobsRecordsTTL` has been changed to `authz.syncJobsRecordsLimit` - records are no longer retained based on age, but based on this size cap. [#46676](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46676)
- Renders GitHub pull request references in git blame view. [#46409](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46409)

### Fixed

- Made search results export use the same results list as the search results page. [#45702](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45702)
- Code insights with more than 1 year of history will correctly show 12 data points instead of 11. [#45644](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45644)
- Hourly code insights will now behave correctly and will no longer truncate to midnight UTC on the calendar date the insight was created. [#45644](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45644)
- Code Insights: fixed an issue where filtering by a search context that included multiple repositories would exclude data. [#45574](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45574)
- Ignore null JSON objects returned from GitHub API when listing public repositories. [#45969](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45969)
- Fixed issue where emails that have never been verified before would be unable to receive resent verification emails. [#46185](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46185)
- Resolved issue preventing LSIF uploads larger than 2GiB (gzipped) from uploading successfully. [#46209](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46209)
- Local vars in Typescript are now detected as symbols which will positively impact ranking of search results. [go-ctags#10](https://github.com/sourcegraph/go-ctags/pull/10)
- Fix issue in Gitlab OAuth in which user group membership is set too wide - adds `min_access_level=10` to `/groups` request. [#46480](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46480)

### Removed

- The extension registry no longer supports browsing, creating, or updating legacy extensions. Existing extensions may still be enabled or disabled in user settings and may be listed via the API. (The extension API was deprecated in 2022-09 but is still available if the `enableLegacyExtensions` site config experimental features flag is enabled.)
- User and organization auto-defined search contexts have been permanently removed along with the `autoDefinedSearchContexts` GraphQL query. The only auto-defined context now is the `global` context. [#46083](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46083)
- The settings `experimentalFeatures.showSearchContext`, `experimentalFeatures.showSearchNotebook`, and `experimentalFeatures.codeMonitoring` have been removed and these features are now permanently enabled when available. [#46086](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46086)
- The legacy panels on the homepage (recent searches, etc) which were turned off by default but could still be re-enabled by setting `experimentalFeatures.showEnterpriseHomePanels` to true, are permanently removed now. [#45705](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45705)
- The `site { monitoringStatistics { alerts } }` GraphQL query has been deprecated and will no longer return any data. The query will be removed entirely in a future release. [#46299](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46299)
- The Monaco version of the search query input and the corresponding feature flag (`experimentalFeatures.editor`) have been permanently removed. [#46249](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46249)

# v4.3.1

### Changed

- A bug that broke the site-admin page when no repositories have been added to the Sourcegraph instance has been fixed. [#46123](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/46123)

# v4.3.0

### Added

- A "copy path" button has been added to file content, path, and symbol search results on hover or focus, next to the file path. The button copies the relative path of the file in the repo, in the same way as the "copy path" button in the file and repo pages. [#42721](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42721)
- Unindexed search now use the index for files that have not changed between the unindexed commit and the indexed commit. The result is faster unindexed search in general. If you are noticing issues you can disable by setting the feature flag `search-hybrid` to false. [#37112](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/37112)
- The number of commits listed in the History tab can now be customized for all users by site admins under Configuration -> Global Settings from the site admin page by using the config `history.defaultPageSize`. Individual users may also set `history.defaultPagesize` from their user settings page to override the value set under the Global Settings. [#44651](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44651)
- Batch Changes: Mounted files can be accessed via the UI on the executions page. [#43180](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43180)
- Added "Outbound request log" feature for site admins [#44286](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44286)
- Code Insights: the data series API now provides information about incomplete datapoints during processing
- Added a best-effort migration such that existing Code Insights will display zero results instead of missing points at the start and end of a graph. [#44928](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44928)
- More complete stack traces for Outbound request log [#45151](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45151)
- A new status message now reports how many repositories have already been indexed for search. [#45246](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45246)
- Search contexts can now be starred (favorited) in the search context management page. Starred search contexts will appear before other contexts in the context dropdown menu next to the search box. [#45230](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45230)
- Search contexts now let you set a context as your default. The default will be selected every time you open Sourcegraph and will appear near the top in the context dropdown menu next to the search box. [#45387](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45387)
- [search.largeF[iles](/admin/config/site_config#search-largeFiles) accepts an optional prefix `!` to negate a pattern. The o)rder of the patterns within search.largeFiles is honored such that the last pattern matching overrides preceding patterns. For patterns that begin with a literal `!` prefix with a backslash, for example, `\!fileNameStartsWithExcl!.txt`. Previously indexed files that become excluded due to this change will remain in the index until the next reindex [#45318](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45318)
- [Webh[ooks](/admin/config/webhooks/incoming) have been overhauled completely and can now be found under **Site admin >) Repositories > Incoming webhooks**. Webhooks that were added via code host configuration are [deprec[ated](/admin/config/webhooks/incoming#deprecation-notice) and will be removed in 5.1.0.
- Added support fo)r receiving webhook `push` events from GitHub which will trigger Sourcegraph to fetch the latest commit rather than relying on polling.
- Added support for private container registries in Sourcegraph executors. [Using private registries](/admin/executors/deploy_executors#using-private-registries)

### Changed

- Batch Change: When one or more changesets are selected, we now display all bulk operations but disable the ones that aren't applicable to the changesets. [#44617](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44617)
- Gitserver's repository purge worker now runs on a regular interval instead of just on weekends, configurable by the `repoPurgeWorker` site configuration. [#44753](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44753)
- Editing the presentation metadata (title, line color, line label) or the default filters of a scoped Code Insight will no longer trigger insight recalculation. [#44769](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44769), [#44797](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44797)
- Indexed Search's `memory_map_areas_percentage_used` alert has been modified to alert earlier than it used to. It now issues a warning at 60% (previously 70%) and issues a critical alert at 80% (previously 90%).
- Saving a new view of a scoped Code Insight will no longer trigger insight recalculation. [#44679](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44679)

### Fixed

- The Code Insights commit indexer no longer errors when fetching commits from empty repositories when sub-repo permissions are enabled. [#44558](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44558)
- Unintended newline characters that could appear in diff view rendering have been fixed. [#44805](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44805)
- Signing out doesn't immediately log the user back in when there's only one OAuth provider enabled. It now redirects the user to the Sourcegraph login page. [#44803](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44803)
- An issue causing certain kinds of queries to behave inconsistently in Code Insights. [#44917](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44917)
- When the setting `batchChanges.enforceForks` is enabled, Batch Changes will now prefix the name of the fork repo it creates with the original repo's namespace name in order to prevent repo name collisions. [#43681](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43681), [#44458](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44458), [#44548](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44548), [#44924](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44924)
- Code Insights: fixed an issue where certain queries matching sequential whitespace characters would overcount. [#44969](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44969)
- GitHub fine-grained Personal Access Tokens can now clone repositories correctly, but are not yet officially supported. [#45137](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45137)
- Detect-and-track Code Insights will now return data for repositories without sub-repo permissions even when sub-repo permissions are enabled on the instance. [#45631](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45361)

### Removed

- Removed legacy GraphQL field `dirtyMetadata` on an insight series. `insightViewDebug` can be used as an alternative. [#44416](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44416)
- Removed `search.index.enabled` site configuration setting. Search indexing is now always enabled.
- Removed the experimental feature setting `showSearchContextManagement`. The search context management page is now available to all users with access to search contexts. [#45230](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45230)
- Removed the experimental feature setting `showComputeComponent`. Any notebooks that made use of the compute component will no longer render the block. The block will be deleted from the databse the next time a notebook that uses it is saved. [#45360](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45360)

# v4.2.1

- `minio` has been replaced with `blobstore`. Please see the update notes [here](/admin/how-to/blobstore_update_notes)

# v4.2.0

### Added

- Creating access tokens is now tracked in the security events. [#43226](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43226)
- Added `codeIntelAutoIndexing.indexerMap` to site-config that allows users to update the indexers used when inferring precise code intelligence auto-indexing jobs (without having to overwrite the entire inference scripts). For example, `"codeIntelAutoIndexing.indexerMap": {"go": "my.registry/sourcegraph/lsif-go"}` will cause Go projects to use the specified container (in a alternative Docker registry). [#43199](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43199)
- Code Insights data points that do not contain any results will display zero instead of being omitted from the visualization. Only applies to insight data created after 4.2. [#43166](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43166)
- Sourcegraph ships with node-exporter, a Prometheus tool that provides hardware / OS metrics that helps Sourcegraph scale your deployment. See your deployment update for more information:
  - [Kubernetes](/admin/updates/kubernetes)
  - [Docker Compose](/admin/updates/docker_compose)
- A structural search diagnostic to warn users when a language filter is not set. [#43835](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43835)
- GitHub/GitLab OAuth success/fail attempts are now a part of the audit log. [#43886](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43886)
- When rendering a file which is backed by Git LFS, we show a page informing the file is LFS and linking to the file on the codehost. Previously we rendered the LFS pointer. [#43686](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43686)
- Batch changes run server-side now support secrets. [#27926](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/27926)
- OIDC success/fail login attempts are now a part of the audit log. [#44467](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44467)
- A new experimental GraphQL query, `permissionsSyncJobs`, that lists the states of recently completed permissions sync jobs and the state of each provider. The TTL of entries retrained can be configured with `authz.syncJobsRecordsTTL`. [#44387](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44387), [#44258](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44258)
- The search input has a new search history button and allows cycling through recent searches via up/down arrow keys. [#44544](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44544)
- Repositories can now be ordered by size on the repo admin page. [#44360](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44360)
- The search bar contains a new Smart Search toggle. If a search returns no results, Smart Search attempts alternative queries based on a fixed set of rules, and shows their results (if there are any). Smart Search is enabled by default. It can be disabled by default with `"search.defaultMode": "precise"` in settings. [#44385](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44395)
- Repositories in the site-admin area can now be filtered, so that only indexed repositories are displayed [#45288](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/45288)

### Changed

- Updated minimum required version of `git` to 2.38.1 in `gitserver` and `server` Docker image. This addresses: https://github.blog/2022-04-12-git-security-vulnerability-announced/ and https://lore.kernel.org/git/d1d460f6-e70f-b17f-73a5-e56d604dd9d5@github.com/. [#43615](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43615)
- When a `content:` filter is used in a query, only file contents will be searched (previously any of file contents, paths, or repos were searched). However, as before, if `type:` is also set, the `content:` filter will search for results of the specified `type:`. [#43442](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43442)
- Updated [p4-fusion](https://github.com/salesforce/p4-fusion) from `1.11` to `1.12`.

### Fixed

- Fixed a bug where path matches on files in the root directory of a repository were not highlighted. [#43275](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43275)
- Fixed a bug where a search query wouldn't be validated after the query type has changed. [#43849](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43849)
- Fixed an issue with insights where a single erroring insight would block access to all insights. This is a breaking change for users of the insights GraphQL api as the `InsightViewConnection.nodes` list may now contain `null`. [#44491](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44491)
- Fixed a bug where Open in Editor didn't work well with `"repositoryPathPattern" = "{nameWithOwner}"` [#43839](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/44475)

### Removed

- Remove the older `log.gitserver.accessLogs` site config setting. The setting is succeeded by `log.auditLog.gitserverAccess`. [#43174](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43174)
- Remove `LOG_ALL_GRAPHQL_REQUESTS` env var. The setting is succeeded by `log.auditLog.graphQL`. [#43181](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43181)
- Removed support for setting `SRC_ENDPOINTS_CONSISTENT_HASH`. This was an environment variable to support the transition to a new consistent hashing scheme introduced in 3.31.0. [#43528](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43528)
- Removed legacy environment variable `ENABLE_CODE_INSIGHTS_SETTINGS_STORAGE` used in old versions of Code Insights to fall back to JSON settings based storage. All data was previously migrated in version 3.35 and this is no longer supported.

# v4.1.3

### Fixed

- Fixed a bug that caused the Phabricator native extension to not load the right CSS assets. [#43868](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43868)
- Fixed a bug that prevented search result exports to load. [#43344](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43344)

# v4.1.2

### Fixed

- Fix code navigation on OSS when CodeIntel is unavailable. [#43458](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43458)

### Removed

- Removed the onboarding checklist for new users that showed up in the top navigation bar, on user profiles, and in the site-admin overview page. After changes to the underlying user statistics system, the checklist caused severe performance issues for customers with large and heavily-used instances. [#43591](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43591)

# v4.1.1

### Fixed

- Fixed a bug with normalizing the `published` draft value for `changeset_specs`. [#43390](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43390)

# v4.1.0

### Added

- Outdated executors now show a warning from the admin page. [#40916](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40916)
- Added support for better Slack link previews for private instances. Link previews are currently feature-flagged, and site admins can turn them on by creating the `enable-link-previews` feature flag on the `/site-admin/feature-flags` page. [#41843](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41843)
- Added a new button in the repository settings, under "Mirroring", to delete a repository from disk and reclone it. [#42177](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42177)
- Batch changes run on the server can now be created within organisations. [#36536](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/36536)
- GraphQL request logs are now compliant with the audit logging format. The old GraphQl logging based on `LOG_ALL_GRAPHQL_REQUESTS` env var is now deprecated and scheduled for removal. [#42550](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42550)
- Mounting files now works when running batch changes server side. [#31792](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/31792)
- Added mini dashboard of total batch change metrics to the top of the batch changes list page. [#42046](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42046)
- Added repository sync counters to the code host details page. [#43039](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/43039)

### Changed

- Git server access logs are now compliant with the audit logging format. Breaking change: The 'actor' field is now nested under 'audit' field. [#41865](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41865)
- All Perforce rules are now stored together in one column and evaluated on a "last rule takes precedence" basis. [#41785](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41785)
- Security events are now a part of the audit log. [#42653](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42653)
- "GC AUTO" is now the default garbage collection job. We disable sg maintenance, which had previously replace "GC AUTO", after repeated reports about repo corruption. [#42856](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42856)
- Security events (audit log) can now optionally omit the internal actor actions (internal traffic). [#42946](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42946)
- To use the optional `customGitFetch` feature, the `ENABLE_CUSTOM_GIT_FETCH` env var must be set on `gitserver`. [#42704](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42704)

### Fixed

- WIP changesets in Gitlab >= 14.0 are now prefixed with `Draft:` instead of `WIP:` to accomodate for the [breaking change in Gitlab 14.0](https://docs.gitlab.com/ee/update/removals.html#wip-merge-requests-renamed-draft-merge-requests). [#42024](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42024)
- When updating the site configuration, the provided Last ID is now used to prevent race conditions when simultaneous config updates occur. [#42691](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42691)
- When multiple auth providers of the same external service type is set up, there are now separate entries in the user's Account Security settings. [#42865](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42865)
- Fixed a bug with GitHub code hosts that did not label archived repos correctly when using the "public" repositoryQuery keyword. [#41461](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41461)
- Fixed a bug that would display the blank batch spec that a batch change is initialized with in the batch specs executions tab. [#42914](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42914)
- Fixed a bug that would cause menu dropdowns to not open appropriately. [#42779](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42779)

### Removed

-

# v4.0.1

### Fixed

- Fixed a panic that can be caused by some tracing configurations. [#42027](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42027)
- Fixed broken code navigation for Javascript. [#42055](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/42055)
- Fixed issue with empty code navigation popovers. [#41958](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41958)

# v4.0.0

### Added

- A new look for Sourcegraph, previously in beta as "Simple UI", is now permanently enabled. [#41021](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41021)
- A new [multi-version upgrade](/admin/updates#multi-version-upgrades) process now allows Sourcegraph instances to upgrade more than a single minor version. Instances at version 3.20 or later can now jump directly to 4.0. [#40628](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40628)
- Matching ranges in file paths are now highlighted for path results and content results. Matching paths in repository names are now highlighted for repository results. [#41296](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41296) [#41385](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41385) [#41470](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41470)
- Aggregations by repository, file, author, and capture group are now provided for search results. [#39643](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/39643)
- Blob views and search results are now lazily syntax highlighted for better performance. [#39563](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/39563) [#40263](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40263)
- File links in both the search results and the blob sidebar and now prefetched on hover or focus. [#40354](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40354) [#41420](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41420)
- Negation support for the search predicates `-repo:has.path()` and `-repo:has.content()`. [#40283](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40283)
- Experimental clientside OpenTelemetry can now be enabled with `"observability.client": { "openTelemetry": "/-/debug/otlp" }`, which sends OpenTelemetry to the new [bundled OpenTelemetry Collector](/admin/observability/opentelemetry). [#37907](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/37907)
- File diff stats are now characterized by 2 figures: lines added and lines removed. Previously, a 3rd figure for lines modified was also used. This is represented by the fields on the `DiffStat` type on the GraphQL API. [#40454](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40454)

### Changed
- [Sourcegraph with Kubernetes (without Helm)](/admin/deploy/kubernetes): The `jaeger-agent` sidecar has been replaced by an [OpenTelemetry Collector](/admin/observability/opentelemetry) DaemonSet + Deployment configuration. The bundled Jaeger instance is now disabled by default, instead of enabled. [#40456](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/40456)
- [Sourcegraph with Docker Compose](/admin/deploy/docker-compose): The `jaeger` service has been replaced by an [OpenTelemetry Collector](/admin/observability/opentelemetry) service. The bundled Jaeger instance is now disabled by default, instead of enabled. [#40455](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/40455)
- `"observability.tracing": { "type": "opentelemetry" }` is now the default tracer type. To revert to existing behaviour, set `"type": "jaeger"` instead. The legacy values `"type": "opentracing"` and `"type": "datadog"` have been removed. [#41242](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41242)
- `"observability.tracing": { "urlTemplate": "" }` is now the default, and if `"urlTemplate"` is left empty, no trace URLs are generated. To revert to existing behaviour, set `"urlTemplate": "{{ .ExternalURL }}/-/debug/jaeger/trace/{{ .TraceID }}"` instead. [#41242](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41242)
- Code host connection tokens are no longer supported as a fallback method for syncing changesets in Batch Changes. [#25394](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/25394)
- **IMPORTANT:** `repo:contains(file:foo content:bar)` has been renamed to `repo:contains.file(path:foo content:bar)`. `repo:contains.file(foo)` has been renamed to `repo:contains.path(foo)`. `repo:contains()` **is no longer a valid predicate. Saved searches using** `repo:contains()` **will need to be updated to use the new syntax.** [#40389](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40389)

### Fixed

- Fixed support for bare repositories using the src-cli and other codehost type. This requires the latest version of src-cli. [#40863](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40863)
- The recommended [src-cli](https://github.com/sourcegraph/src-cli) version is now reported consistently. [#39468](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/39468)
- A performance issue affecting structural search causing results to not stream. It is much faster now. [#40872](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40872)
- An issue where the saved search input box reports an invalid pattern type for `standard`, which is now valid. [#41068](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41068)
- Git will now respect system certificate authorities when specifying `certificates` for the `tls.external` site configuration. [#38128](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/38128)
- Fixed a bug where setting `"observability.tracing": {}` would disable tracing, when the intended behaviour is to default to tracing with `"sampling": "selective"` enabled by default. [#41242](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41242)
- The performance, stability, and latency of search predicates like `repo:has.file()`, `repo:has.content()`, and `file:has.content()` have been dramatically improved. [#418](https://github.com/sourcegraph/zoekt/pull/418), [#40239](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40239), [#38988](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/38988), [#39501](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/39501)
- A search query issue where quoted patterns inside parenthesized expressions would be interpreted incorrectly. [#41455](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41455)

### Removed

- `CACHE_DIR` has been removed from the `sourcegraph-frontend` deployment. This required ephemeral storage which will no longer be needed. This variable (and corresponding filesystem mount) has been unused for many releases. [#38934](https://github.com/sourcegraph/sourcegraph-public-snapshot/issues/38934)
- Quick links will no longer be shown on the homepage or search sidebar. The `quicklink` setting is now marked as deprecated. [#40750](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40750)
- Quick links will no longer be shown on the homepage or search sidebar if the "Simple UI" toggle is enabled and will be removed entirely in a future release. The `quicklink` setting is now marked as deprecated. [#40750](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/40750)
- `file:contains()` has been removed from the list of valid predicates. `file:has.content()` and `file:contains.content()` remain, both of which work the same as `file:contains()` and are valid aliases of each other.
- The single-container `sourcegraph/server` deployment no longer bundles a Jaeger instance. [#41244](https://github.com/sourcegraph/sourcegraph-public-snapshot/pull/41244)
- The following previously-deprecated fields have been removed from the Batch Changes GraphQL API: `GitBranchChangesetDescription.headRepository`, `BatchChange.initialApplier`, `BatchChange.specCreator`, `Changeset.publicationState`, `Changeset.reconcilerState`, `Changeset.externalState`.

## Older versions

For older versions of Sourcegraph, see the [CHANGELOG](https://github.com/sourcegraph/sourcegraph-public-snapshot/blob/main/CHANGELOG.md) on GitHub.
