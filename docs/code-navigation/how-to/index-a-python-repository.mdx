# Index a Python repository

<p className="subtitle">
	This page describes how you can use [scip-python](https://github.com/sourcegraph/scip-python) and [src-cli](https://github.com/sourcegraph/src-cli) to enable precise indexing for Python codebases.
</p>

<Callout type="note">
	scip-python is a Sourcegraph fork of [Pyright](https://github.com/microsoft/pyright) focused on generating SCIP for Python projects. It requires Python 3.10+ and Node v16 or newer.
</Callout>

## CI/CD Integrations and Local Indexing

For integration with CI/CD systems, or to test precise indexing of an individual repository, the following instructions can be used
to install and run `scip-python` and `src-cli`.

<Callout type="info">
	For general CI patterns (sub-projects, custom build environments, and upload frequency), see [Adding precise code navigation to CI/CD workflows](/code-navigation/how-to/adding-scip-to-workflows).
</Callout>

### Setup

1. Install the [Python SCIP indexer](https://github.com/sourcegraph/scip-python):

```shell
npm install -g @sourcegraph/scip-python
```

2. Install the [Sourcegraph CLI](https://github.com/sourcegraph/src-cli):

```shell
 curl -L https://sourcegraph.com/.api/src-cli/src_linux_amd64 -o /usr/local/bin/src
 chmod +x /usr/local/bin/src
```

-   **macOS**: Replace `linux` with `darwin` in the URL and choose the appropriate architecture: M1/M2 chips - `arm64`, Intel chips - `amd64`.
-   **Windows**: Visit [the CLI repo](https://github.com/sourcegraph/src-cli) for further instructions.

### Indexing

1. `cd` into your Python project's root and run:

```shell
scip-python index . --project-name=$MY_PROJECT
```

<Callout type="note">
	Make sure to activate your virtual environment before running scip-python. If you hit out-of-memory errors, set `NODE_OPTIONS="--max-old-space-size=8192"` before running the command.
</Callout>

You can optionally pass `--target-only=src/subdir` to index only a specific directory, or `--environment=path/to/env.json` to supply a packages list instead of relying on pip detection.

2. Upload the data to a Sourcegraph instance with:

```shell
export SRC_ENDPOINT="YOUR_SOURCEGRAPH_URL"
export SRC_ACCESS_TOKEN="YOUR_SOURCEGRAPH_API_TOKEN"

cd path/to/index.scip
src code-intel upload
```

The upload command will provide a URL you can visit to see the upload status.

## Auto-indexing

Sourcegraph can automatically index your Python repository. To configure auto-indexing, use the following configuration:

```json
{
    "index_jobs": [{
        "indexer": "sourcegraph/scip-python:autoindex",
        "local_steps": ["pip install . || true"],
        "indexer_args": ["scip-python", "index", ".", "--project-name", "<your name here>", "--project-version", "_"],
        "steps": [],
        "outfile": "",
        "root": ""
    }],
    "shared_steps": []
}
```
