# Index a Ruby repository

<p className="subtitle">
	This page describes how you can use [scip-ruby](https://github.com/sourcegraph/scip-ruby) and [src-cli](https://github.com/sourcegraph/src-cli) to enable precise indexing for Ruby codebases.
</p>

<Callout type="note">
	scip-ruby is built on top of [Sorbet](https://sorbet.org). Projects with higher Sorbet adoption (more files marked `# typed: true`) will have better code navigation results. Files marked `# typed: false` or without a sigil are indexed on a best-effort basis.
</Callout>

## CI/CD Integrations and Local Indexing

For integration with CI/CD systems, or to test precise indexing of an individual repository, the following instructions can be used
to install and run `scip-ruby` and `src-cli`.

<Callout type="info">
	For general CI patterns (sub-projects, custom build environments, and upload frequency), see [Adding precise code navigation to CI/CD workflows](/code-navigation/how-to/adding-scip-to-workflows).
</Callout>

### Setup

1. Install the [Ruby SCIP indexer](https://github.com/sourcegraph/scip-ruby) as a gem:

**Using a Gemfile:**

```ruby
gem 'scip-ruby', require: false, group: :development
```

Then run:

```shell
bundle install
```

Alternatively, download a pre-built binary from the [releases page](https://github.com/sourcegraph/scip-ruby/releases):

```shell
curl -L "https://github.com/sourcegraph/scip-ruby/releases/latest/download/scip-ruby-$(uname -m)-$(uname -s | tr '[:upper:]' '[:lower:]')" -o scip-ruby
chmod +x scip-ruby
```

2. Install the [Sourcegraph CLI](https://github.com/sourcegraph/src-cli):

```shell
 curl -L https://sourcegraph.com/.api/src-cli/src_linux_amd64 -o /usr/local/bin/src
 chmod +x /usr/local/bin/src
```

-   **macOS**: Replace `linux` with `darwin` in the URL and choose the appropriate architecture: M1/M2 chips - `arm64`, Intel chips - `amd64`.
-   **Windows**: Visit [the CLI repo](https://github.com/sourcegraph/src-cli) for further instructions.

### Indexing

1. `cd` into your Ruby project's root and run:

```shell
 bundle exec scip-ruby # generates a file named index.scip
```

Or with the standalone binary:

```shell
 ./scip-ruby # generates a file named index.scip
```

<Callout type="note">
	If your project has a `sorbet/config` file, scip-ruby automatically detects which files to index. Otherwise, pass a path argument: `scip-ruby .`
</Callout>

2. Upload the data to a Sourcegraph instance with:

```shell
export SRC_ENDPOINT="YOUR_SOURCEGRAPH_URL"
export SRC_ACCESS_TOKEN="YOUR_SOURCEGRAPH_API_TOKEN"

cd path/to/index.scip
src code-intel upload
```

The upload command will provide a URL you can visit to see the upload status.
