# Administration FAQ

## How does Sourcegraph store repositories on disk?

Sourcegraph stores bare Git repositories (without a working tree), which is a complete mirror of the repository on your code host.

## Does Sourcegraph support SVN?

For Subversion and other non-Git code hosts, the recommended way to make these accessible in
Sourcegraph is through [`src-expose`](/admin/code_hosts/other#experimental-src-expose).

Alternatively, you can use [`git-svn`](https://git-scm.com/docs/git-svn) or
[`svg2git`](https://github.com/svn-all-fast-export/svn2git) to convert Subversion repositories to
Git repositories. Unlike `src-expose`, this will preserve commit history, but is generally much
slower.

## How do I access Sourcegraph if my authentication provider experiences an outage?

If you are using an external authentication provider and the provider experiences an outage, users
will be unable to sign into Sourcegraph. A site administrator can configure an alternate sign-in
method by modifying the `auth.providers` field in site configuration. However, the site
administrator may themselves be unable to sign in. If this is the case, then a site administrator
can update the configuration if they have direct `docker exec` or `kubectl exec` access to the
Sourcegraph instance. Follow the [instructions to update the site config if the web UI is
inaccessible](/admin/config/site_config#editing-your-site-configuration-if-you-cannot-access-the-web-ui).

## How do I set up redirect URLs in Sourcegraph?

Sometimes URLs in Sourcegraph may change. For example, if a code host configuration is
updated to use a different `repositoryPathPattern`, this will change the repository URLs on
Sourcegraph. Users may wish to preserve links to the old URLs, and this requires adding redirects.

We recommend configuring redirects in a reverse proxy. If you are running Sourcegraph as a single
Docker image, you can deploy a reverse proxy such as [Caddy](https://caddyserver.com/) or
[NGINX](https://www.nginx.com) in front of it. Refer to the
[Caddy](https://github.com/caddyserver/caddy/wiki/v2:-Documentation#rewrite) or
[NGINX](https://www.nginx.com/blog/creating-nginx-rewrite-rules/) documentation for URL rewrites.

If you are running Sourcegraph as a Kubernetes cluster, you have two additional options:

1. If you are using NGINX ingress (`kubectl get ingress | grep sourcegraph-frontend`), modify
   [`sourcegraph-frontend.Ingress.yaml`](https://github.com/sourcegraph/deploy-sourcegraph-k8s/blob/main/base/sourcegraph/frontend/sourcegraph-frontend.Ingress.yaml)
   by [adding a rewrite rule](https://kubernetes.github.io/ingress-nginx/examples/rewrite/). You can also refer to the [ingress configuration examples](https://github.com/sourcegraph/deploy-sourcegraph-k8s/tree/main/examples/ingress-controller).

## What external HTTP checks are configured?

We leave the choice of which external HTTP check monitor up to our users. What we provide out-of-the-box is extensive metrics monitoring through Prometheus and Grafana, with builtin alert thresholds and dashboards, and Kubernetes/Docker HTTP health checks which verify that the server is running. Sourcegraph's frontend has a default health check at
https://$SOURCEGRAPH_BASE_URL/healthz. Some users choose to set up their own external HTTP health checker which tests if the homepage loads, a repository page loads, and if a search GraphQL request returns successfully.

## Monitoring

Please visit our [Observability Docs](/admin/observability) for more in-depth information about observability in Sourcegraph.

### What should I look at when my instance is having performance issues?

Sourcegraph comes with built-in monitoring in the form of [Grafana](/admin/observability/metrics#grafana), connected to [Prometheus](/admin/observability/metrics#prometheus) for metrics and alerting.

Generally, Grafana should be the first stop you make when experiencing a system performance issue. From there you can look for system alerts or metrics that would provide you with more insights on what’s causing the performance issue. You can learn more about [accessing Grafana here](/admin/observability/metrics#grafana).

### What are the key values/alerts to look for when looking at the Grafana Dashboard?

Please refer to the [Dashboards](/admin/observability/metrics#dashboards) guide for more on how to use our Grafana dashboards.

Please refer to [Understanding alerts](/admin/observability/alerting#understanding-alerts) for examples and suggested actions for alerts.

### How do I know when more resources are needed for a specified service?

All resource dashboards contain a section called `Provisioning indicators` that provide information about the current resource usage of containers. These can be used to determine if a scale-up is needed ([example panel](/admin/observability/dashboards#frontend-provisioning-container-cpu-usage-long-term)).

More information on each available panel in the dashboards is available in the [Dashboards reference](/admin/observability/dashboards).

### What does this `<ALERT-MESSAGE>` mean?

See [Alert solutions](/admin/observability/alerts) to learn about each alert and their possible solutions.

### What’s the threshold for each resource?

All resources dashboards contain a section called `Container monitoring` that indicate thresholds at which alerts will fire for each resource ([example alert](/admin/observability/alerts#frontend-container-cpu-usage)).

More information on each available panel in the dashboards is available in the [Dashboards reference](/admin/observability/dashboards).

### How much resources should I add after receiving alerts about running out of resources?

You should make the decision based on the metrics from the relevant Grafana dashboard linked in each alert.

### What are some of the important alerts that I should be aware of?

We recommend paying closer attention to [critical alerts](/admin/observability/alerting#understanding-alerts).

### How do I set up alerts?

Please refer to our guide on [setting up alerting](/admin/observability/alerting#setting-up-alerting).

### How do I create a custom alert?

Creating a custom alert is not recommended and currently not supported by Sourcegraph. However, please provide feedback on the monitoring dashboards and alerts if you find anything could be improved via our issue tracker.

More advanced users can also refer to [our FAQ item about custom consumption of Sourcegraph metrics](#can-i-consume-sourcegraph-s-metrics-in-my-own-monitoring-system-datadog-new-relic-etc).

### Can I consume Sourcegraph's metrics in my own monitoring system (Datadog, New Relic, etc.)?

Sourcegraph provides [high-level alerting metrics](/admin/observability/metrics#high-level-alerting-metrics) which you can integrate into your own monitoring system—see the [alerting custom consumption guide](/admin/observability/alerting_custom_consumption) for more details.

While it is technically possible to consume all of Sourcegraph's metrics in an external system, our recommendation is to utilize the builtin monitoring tools and configure Sourcegraph to [send alerts to your own PagerDuty, Slack, email, etc.](/admin/observability/alerting). Metrics and thresholds can change with each release, therefore manually defining the alerts required to monitor Sourcegraph's health is not recommended. Sourcegraph automatically updates the dashboards and alerts on each release to ensure the displayed information is up-to-date.

Other monitoring systems that support Prometheus scraping (for example, Datadog and New Relic) or [Prometheus federation](https://prometheus.io/docs/prometheus/latest/federation/) can be configured to federate Sourcegraph's [high-level alerting metrics](/admin/observability/metrics#high-level-alerting-metrics). For information on how to configure those systems, please check your provider's documentation.

The `/-/debug/grafana` endpoint is specifically designed for the built-in Grafana instance that comes with Sourcegraph. When using an external Grafana instance, this endpoint won't automatically redirect to your custom Grafana URL.

To properly integrate your external Grafana and Prometheus instances with Sourcegraph, you'll want to:
Ensure your configuration in values.yaml is correct:

```
frontend:
  env:
    GRAFANA_SERVER_URL:
      value: https://grafana.mycompany.com
    PROMETHEUS_URL:
      value: http://prometheus.mycompany.com
```

You can then access your dashboards directly through your Grafana instance URL.

### I am getting "Error: Cluster information not available" in the Instrumentation page, what should I do?

This error is expected if your instance was not [deployed with Kubernetes](/admin/deploy/kubernetes/). The Instrumentation page is currently only available for Kubernetes instances.

## Sourcegraph is making unauthorized requests to the git server

This is normal and happens whenever git is used over HTTP. To avoid unnecessarily sending a password over HTTP, git first
makes a request without the password included. If a 401 Unauthorized is returned, git sends the request with the password.

More information can be found [here](https://confluence.atlassian.com/bitbucketserverkb/two-401-responses-for-every-git-opperation-938854756.html).

If this behaviour is undesired, the `gitURLType` in the [external service configuration](/admin/code_hosts/github#configuration)
should be set to `ssh` instead of `http`. This will also require [ssh keys to be set up](/admin/repo/auth#repositories-that-need-http-s-or-ssh-authentication).

## Sourcegraph is not returning results from a repository unless "repo:" is included

If you can get repository results when you explicitly include `repo:{your repository}` in your search, but don't see any results from that repository when you don't, there are a few possible causes:

-   The repository is a fork repository (excluded from search results by default) and `fork:yes` is not specified in the search query.
-   The repository is an archived repository (excluded from search results by default) and `archived:yes` is not specified in the search query.
-   There is an issue indexing the repository: check the logs of worker and/or search-indexer.
-   The search index is unavailable for some reason: try the search query `repo:<the_repository> index:only`. If it returns no results, the repository has not been indexed.
