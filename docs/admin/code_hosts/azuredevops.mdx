# Azure DevOps

<TierCallout>
  Supported on [Enterprise](/pricing/enterprise) plans.
  <user>
    Available via the Web app.
  </user>
</TierCallout>

Site admins can sync Git repositories hosted on [Azure DevOps](https://dev.azure.com) with Sourcegraph so that users can search and navigate the repositories.

To connect Azure DevOps to Sourcegraph, create a personal access token from your user settings page by following the below steps:

1. Navigate to the `Personal Access Tokens` page from the user settings.

![Visit the Personal Access Tokens page](https://storage.googleapis.com/sourcegraph-assets/docs/images/admin/config/azure-devops-personal-access-token-step-1.png)

2. Click on `New Token`.

![Click on New Token](https://storage.googleapis.com/sourcegraph-assets/docs/images/admin/config/azure-devops-personal-access-token-step-2.png)

3. Under the `Organization` menu, select `All accessible organizations` to allow access to all organizations. This is required to be able to perform connection checks from the code host page and to sync repositories from multiple organizations. Alternatively, site admins may also create a unique user that has access to only the selective organizations that they would like to sync with Sourcegraph. However the token being created **must** have access to `All accessible organizations` as shown below.

![Select All accessible organizations](https://storage.googleapis.com/sourcegraph-assets/docs/images/admin/config/azure-devops-personal-access-token-step-3.png)

4. Select the following scopes:

   - Code (Read)
   - Project and Team
   - User Profile

Next, configure the code host connection by following the next steps:

1. Go to **Site admin > Manage code hosts > Add repositories**.
1. Select **Azure DevOps**.
1. Provide a [configuration](#configuration) for the Azure DevOps code host connection. Here is an example configuration:

   ```json
   {
     "url": "https://dev.azure.com/",
     "username": "<admin username>",
     "token": "<admin token>",
     "projects": ["org1/project1"],
     "orgs": ["org2"]
   }
   ```

1. Select **Add repositories**.

## Repository syncing

Currently, all repositories belonging to the configured organizations/projects will be synced.

In addition, you may exclude one or more repositories by setting the [`exclude`](/admin/code_hosts/azuredevops#configuration) field in the code host connection.

### HTTPS cloning

Sourcegraph clones repositories from Azure DevOps via HTTP(S), using the [`username`](/admin/code_hosts/azuredevops#configuration) and [`token`](/admin/code_hosts/azuredevops#configuration) required fields you provide in the configuration.

## Configuration

Azure DevOps connections support the following configuration options, which are specified in the JSON editor in the site admin "Manage code hosts" area.

{/* <div markdown-func=jsonschemadoc jsonschemadoc:path="admin/code_hosts/azuredevops.schema.json">[View page on our docs](/admin/code_hosts/azuredevops) to see rendered content.</div> */}

### admin/code_hosts/azuredevops.schema.json

{/* SCHEMA_SYNC_START: admin/code_hosts/azuredevops.schema.json */}
{/* WARNING: This section is auto-generated during releases. Do not edit manually. */}
{/* Last updated: 2025-07-01T19:22:26Z via sourcegraph/sourcegraph@v6.5.1211 */}
```json
{
	"$id": "azuredevops.schema.json#",
	"$schema": "http://json-schema.org/draft-07/schema#",
	"additionalProperties": false,
	"allowComments": true,
	"description": "Configuration for a connection to Azure DevOps.",
	"oneOf": [
		{
			"properties": {
				"windowsPassword": {
					"type": "null"
				}
			},
			"required": [
				"token"
			]
		},
		{
			"properties": {
				"token": {
					"type": "null"
				}
			},
			"required": [
				"windowsPassword"
			]
		}
	],
	"properties": {
		"enforcePermissions": {
			"default": false,
			"description": "A flag to enforce Azure DevOps repository access permissions",
			"type": "boolean"
		},
		"exclude": {
			"description": "A list of repositories to never mirror from Azure DevOps Services.",
			"examples": [
				[
					{
						"name": "myorg/myproject/myrepo"
					}
				],
				[
					{
						"name": "myorg/myproject/myrepo"
					},
					{
						"name": "myorg/myproject/myotherrepo"
					},
					{
						"pattern": "^topsecretproject/.*"
					}
				]
			],
			"items": {
				"additionalProperties": false,
				"anyOf": [
					{
						"required": [
							"name"
						]
					},
					{
						"required": [
							"id"
						]
					},
					{
						"required": [
							"pattern"
						]
					}
				],
				"properties": {
					"name": {
						"description": "The name of an Azure DevOps Services organization, project, and repository (\"orgName/projectName/repositoryName\") to exclude from mirroring.",
						"pattern": "^[\\w./ -]*?$",
						"type": "string"
					},
					"pattern": {
						"description": "Regular expression which matches against the name of an Azure DevOps Services repo.",
						"format": "regex",
						"type": "string"
					}
				},
				"title": "ExcludedAzureDevOpsServerRepo",
				"type": "object"
			},
			"minItems": 1,
			"type": "array"
		},
		"gitSSHCipher": {
			"$ref": "git.schema.json#/definitions/gitSSHCipher",
			"description": "SSH cipher to use when cloning via SSH. Must be a valid choice from `ssh -Q cipher`."
		},
		"gitSSHCredential": {
			"$ref": "git.schema.json#/definitions/gitSSHCredential",
			"description": "SSH keys to use when cloning Git repo."
		},
		"gitURLType": {
			"default": "http",
			"description": "The type of Git URLs to use for cloning and fetching Git repositories.\n\nIf \"http\", Sourcegraph will access repositories using Git URLs of the form http(s)://dev.azure.com/myrepo.git.\n\nIf \"ssh\", Sourcegraph will access repositories using Git URLs of the form git@ssh.dev.azure.com:v3/myrepo. See the documentation for how to provide SSH private keys and known_hosts: https://sourcegraph.com/docs/admin/repo/auth.",
			"enum": [
				"http",
				"ssh"
			],
			"type": "string"
		},
		"maxDeletions": {
			"default": 0,
			"description": "The maximum number of repos that will be deleted per sync. A value of 0 or less indicates no maximum.",
			"type": "integer"
		},
		"orgs": {
			"description": "An array of organization names identifying Azure DevOps organizations whose repositories should be mirrored on Sourcegraph.",
			"examples": [
				[
					"name"
				],
				[
					"kubernetes",
					"golang",
					"facebook"
				]
			],
			"items": {
				"pattern": "^[\\w-]+$",
				"type": "string"
			},
			"type": "array"
		},
		"projects": {
			"description": "An array of projects \"org/project\" strings specifying which Azure DevOps projects' repositories should be mirrored on Sourcegraph.",
			"examples": [
				[
					"org/project"
				]
			],
			"items": {
				"pattern": "^[\\w-]+/[\\w.-]+([ ]*[\\w.-]+)*$",
				"type": "string"
			},
			"type": "array"
		},
		"rateLimit": {
			"default": {
				"enabled": false,
				"requestsPerHour": 0
			},
			"description": "Rate limit applied when making background API requests.",
			"properties": {
				"enabled": {
					"default": false,
					"description": "true if rate limiting is enabled.",
					"type": "boolean"
				},
				"requestsPerHour": {
					"description": "Requests per hour permitted. This is an average, calculated per second. Internally, the burst limit is set to 100, which implies that for a requests per hour limit as low as 1, users will continue to be able to send a maximum of 100 requests immediately, provided that the complexity cost of each request is 1.",
					"minimum": 0,
					"type": "number"
				}
			},
			"required": [
				"enabled",
				"requestsPerHour"
			],
			"title": "AzureDevOpsRateLimit",
			"type": "object"
		},
		"repositoryPathPattern": {
			"default": "{host}/{orgName}/{projectName}/{repositoryName}",
			"description": "The pattern used to generate the corresponding Sourcegraph repository name for a Azure DevOps repository.\n\n - \"{host}\" is replaced with the Azure DevOps URL's host (such as dev.azure.com)\n - \"{orgName}\" is replaced with the repository's parent projects owning organization (or collection on DevOps server)\n - \"{projectName}\" is replaced with the repository's parent project\n - \"{repositoryName}\" is replaced with the repository's name.\n\nFor example, if your Azure DevOps is https://dev.azure.com and your Sourcegraph is https://src.example.com, then a repositoryPathPattern of \"{host}/{orgName}/{projectName}/{repositoryName}\" would mean that a Azure DevOps repository at https://dev.azure.com/MYORG/MYPROJECT/MYREPO is available on Sourcegraph at https://src.example.com/dev.azure.com/MYORG/MYPROJECT/MYREPO.\n\nIt is important that the Sourcegraph repository name generated with this pattern be unique to this code host. If different code hosts generate repository names that collide, Sourcegraph's behavior is undefined.",
			"examples": [
				"{projectName}/{repositoryName}"
			],
			"type": "string"
		},
		"token": {
			"description": "The Personal Access Token associated with the Azure DevOps username used for authentication.",
			"minLength": 1,
			"type": "string"
		},
		"url": {
			"!go": {
				"typeName": "NormalizedURL"
			},
			"description": "URL for Azure DevOps Services, set to https://dev.azure.com.",
			"examples": [
				"https://dev.azure.com"
			],
			"format": "uri",
			"not": {
				"pattern": "example\\.com",
				"type": "string"
			},
			"pattern": "^https?://",
			"type": "string"
		},
		"username": {
			"description": "A username for authentication with the Azure DevOps code host. Typically an email address when connect to Azure DevOps Services (cloud) and a domain\\username when connecting to Azure DevOp Server (onPrem)",
			"minLength": 1,
			"type": "string"
		},
		"windowsPassword": {
			"description": "Windows account password (Azure Devops Server OnPrem Only): This is needed to clone the repo, the Token will be used for REST API calls",
			"minLength": 1,
			"type": "string"
		}
	},
	"required": [
		"url",
		"username"
	],
	"title": "AzureDevOpsConnection",
	"type": "object"
}
```
{/* SCHEMA_SYNC_END: admin/code_hosts/azuredevops.schema.json */}
## Configuration Notes

### Token Requirements
- Personal Access Token must have **All accessible organizations** scope to support connection checks and multi-organization syncing
- Required scopes: Code (Read), Project and Team, User Profile
- Consider creating a dedicated service account with minimal required permissions for production deployments

### Organization Access
Azure DevOps connections support both organization-level and project-level syncing:
- Use `"orgs": ["org1", "org2"]` to sync all repositories from specific organizations
- Use `"projects": ["org1/project1", "org2/project2"]` for granular project-level control
- Both options can be combined in a single configuration

### Repository Exclusion
The `exclude` configuration supports both exact name matching and pattern-based exclusion:
- Exact match: `{"name": "myorg/myproject/myrepo"}`
- Pattern match: `{"pattern": "^topsecretproject/.*"}`

## Security Considerations

### Access Control
- **Permissions Enforcement**: Set `"enforcePermissions": true` to sync user-level access controls from Azure DevOps
- **OAuth Configuration**: Required for permission syncing - users must authenticate with Azure DevOps OAuth
- **Third-party OAuth**: Must be enabled in Azure DevOps organization settings under Security → Policies

### Credential Management
- Store Personal Access Tokens securely using Sourcegraph's secret management
- Regularly rotate tokens according to your organization's security policies
- Use dedicated service accounts rather than personal user accounts for production

### Network Security
- Ensure HTTPS-only communication by using `"gitURLType": "http"` with HTTPS URLs
- For SSH access, properly manage SSH keys and known_hosts configuration
- Configure firewall rules to allow Sourcegraph access to Azure DevOPS endpoints

## Common Examples

### Basic Organization Sync
```json
{
  "url": "https://dev.azure.com/",
  "username": "service-account",
  "token": "your-personal-access-token",
  "orgs": ["your-organization"],
  "gitURLType": "http"
}
```

### Multi-Project Configuration
```json
{
  "url": "https://dev.azure.com/",
  "username": "service-account", 
  "token": "your-personal-access-token",
  "projects": [
    "org1/frontend-project",
    "org1/backend-project",
    "org2/shared-libraries"
  ],
  "exclude": [
    {"name": "org1/legacy-project"},
    {"pattern": "^.*/archived-.*"}
  ]
}
```

### SSH Configuration
```json
{
  "url": "https://dev.azure.com/",
  "username": "service-account",
  "token": "your-personal-access-token",
  "orgs": ["your-organization"],
  "gitURLType": "ssh"
}
```

### Permissions-Enabled Setup
```json
{
  "url": "https://dev.azure.com/",
  "username": "service-account",
  "token": "your-personal-access-token",
  "orgs": ["your-organization"],
  "enforcePermissions": true
}
```

## Best Practices

### Performance Optimization
- **Selective Syncing**: Use `projects` instead of `orgs` when you only need specific repositories
- **Exclude Patterns**: Use exclusion patterns to avoid syncing unnecessary repositories like archived projects
- **Rate Limit Awareness**: Sourcegraph automatically handles Azure DevOps rate limits, but consider the impact on large organizations

### Maintenance
- **Regular Token Rotation**: Implement a process for rotating Personal Access Tokens
- **Monitor Sync Status**: Regularly check repository sync status in the Site Admin interface
- **Permission Sync Monitoring**: For permission-enabled setups, monitor user permission sync completion

### Troubleshooting
- **Connection Issues**: Verify token permissions and organization access settings
- **Missing Repositories**: Check exclude patterns and ensure the token has access to all target organizations/projects  
- **Permission Problems**: Verify OAuth is properly configured and Third-party application access is enabled

## Webhooks

Please consult [this page](/admin/config/webhooks/incoming) in order to configure webhooks.

## Permissions syncing

[User-level permissions](/admin/permissions/syncing#permission-syncing) syncing is supported for Azure DevOps code host connections. Here is the list of prerequisites:

1. Configure Azure DevOps as an OAuth provider by consulting [this page](/admin/config/authorization_and_authentication#azure-devops-services)
2. Next verify that users can now sign up / login to your Sourcegraph instance with your Azure DevOps OAuth provider
3. Set the following in your Azure DevOps code host connection:

   ```json
   {
     // ...
     "enforcePermissions": true
   }
   ```

4. For each Azure DevOps organization that is part of the `orgs` or `projects` list in the code host configuration, enable **Third-party application access via OAuth** from **Organization settings > Security > Policies**

![Enable Third-party application access via OAuth](https://storage.googleapis.com/sourcegraph-assets/docs/images/admin/config/azure-devops-organization-enable-oauth-access.png)

> NOTE: We do not support preemptive permissions syncing at this point. Once a user signs up / logins to Sourcegraph with their Azure DevOps account, Sourcegraph uses the authenticated `access_token` to calculate permissions by listing the organizations and projects that the user has access to. As a result, immediately after signing up user level permissions may not be 100% up to date. Users are advised to wait for an initial permissions sync to complete, whose status they may check from the `Permissions` tab under their account settings page. Alternatively they may also trigger a permissions sync for their account from the same page.

Since permissions are already enforced by setting `enforcePermission` in the code host configuration, even though user permissions may not have synced completely, users will not have access to any repositories that they cannot access on Azure DevOps. As the user permissions sync progresses and eventually completes, they will be able to access the complete set of repositories on Sourcegraph that they can already access on Azure DevOps.

## Rate limits

When Sourcegraph hits a rate limit imposed by Azure DevOps, Sourcegraph waits the appropriate amount of time specified by the code host before retrying the request. You can read more about how Azure DevOps imposes rate limits [here](https://learn.microsoft.com/en-us/azure/devops/integrate/concepts/rate-limits).
