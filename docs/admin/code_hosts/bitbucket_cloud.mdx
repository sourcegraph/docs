# Bitbucket Cloud

<TierCallout>
  Supported on [Enterprise](/pricing/enterprise) plans.
  <user>
    Available via the Web app.
  </user>
</TierCallout>

Site admins can sync Git repositories hosted on [Bitbucket Cloud](https://bitbucket.org) with Sourcegraph so that users can search and navigate the repositories.

To connect Bitbucket Cloud to Sourcegraph:

1. Go to **Site admin > Manage code hosts > Add repositories**.
2. Select **Bitbucket.org**.
3. Configure the connection to Bitbucket Cloud using the action buttons above the text field. Additional fields can be added using <kbd>Cmd/Ctrl+Space</kbd> for auto-completion. See the [configuration documentation below](#configuration).
4. Press **Add repositories**.

## Repository syncing

Currently, all repositories belonging to the user configured will be synced.

In addition, there is one more field for configuring which repositories are mirrored:

- [`teams`](/admin/code_hosts/bitbucket_cloud#configuration)
  A list of teams (workspaces) that the configured user has access to whose repositories should be synced.
- [`exclude`](/admin/code_hosts/bitbucket_cloud#configuration)
  A list of repositories to exclude, which takes precedence over the `teams` field.

## Configuration options

Bitbucket Cloud code host connections can be configured with either a username and app password combination, or with workspace access tokens.

### Username and app password

1. Visit your [Bitbucket account settings page](https://bitbucket.org/account/settings).
2. Navigate to **App passwords**.
3. Select **Create app password**.
4. Give your app password a label.
5. Select the `Projects: Read` permission. `Repositories: Read` should automatically be selected.
6. Press **Create**.

Use the newly created app password and your username to configure the Bitbucket Cloud connection:

```json
{
  "url": "https://bitbucket.org",
  "username": "USERNAME",
  "appPassword": "<PASSWORD>",
  // ... other settings
}
```

### Workspace access token

1. Visit the Bitbucket Cloud workspace settings page of the workspace you want to create an access token for.
2. Navigate to **Security > Access tokens**.
3. Press **Create workspace access token**.
4. Give your access token a name.
5. Select the `Projects: Read` permission. `Repositories: Read` should automatically be selected.
6. Press **Create**.

Use the newly created access token to configure the Bitbucket Cloud connection:

```json
{
  "url": "https://bitbucket.org",
  "accessToken": "ACCESS_TOKEN",
  // ... other settings
}
```

### HTTPS cloning

Sourcegraph clones repositories from your Bitbucket Cloud via HTTP(S), using the [`username`](/admin/code_hosts/bitbucket_cloud#configuration) and [`appPassword`](/admin/code_hosts/bitbucket_cloud#configuration) required fields you provide in the configuration.

## Rate limits

Read about how Bitbucket Cloud applies rate limits [here](https://support.atlassian.com/bitbucket-cloud/docs/api-request-limits/).

When Sourcegraph encounters rate limits on Bitbucket Cloud, it will retry the request with exponential back-off, until 5 minutes have passed. If the connection is still being rate limited after 5 minutes, the request will be dropped.

### Internal rate limits

See [Internal rate limits](/admin/code_hosts/rate_limits#internal-rate-limits)

## User authentication

To configure Bitbucket Cloud as an authentication provider (which will enable sign-in via Bitbucket Cloud), see the
[authentication documentation](/admin/auth/#bitbucket-cloud).

## Repository permissions

Prerequisite: [Add Bitbucket Cloud as an authentication provider](#user-authentication).

Then, add or edit a Bitbucket Cloud connection as described above and include the `authorization` field:

```json
{
  // The URL used to set up the Bitbucket Cloud authentication provider must match this URL.
  "url": "https://bitbucket.com",
  "username": "horsten",
  "appPassword": "$APP_PASSWORD",
  // ...
  "authorization": {}
}
```

> NOTE: It can take some time to complete full cycle of repository permissions sync if you have a large number of users or repositories. [See sync duration time](/admin/permissions/syncing#sync-duration) for more information.

## Configuration

Bitbucket Cloud connections support the following configuration options, which are specified in the JSON editor in the site admin "Manage code hosts" area.

{/* <div markdown-func=jsonschemadoc jsonschemadoc:path="admin/code_hosts/bitbucket_cloud.schema.json">[View page on our docs](/admin/code_hosts/bitbucket_cloud) to see rendered content.</div> */}

### admin/code_hosts/bitbucket_cloud.schema.json

{/* SCHEMA_SYNC_START: admin/code_hosts/bitbucket_cloud.schema.json */}
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "bitbucket_cloud.schema.json#",
  "title": "BitbucketCloudConnection",
  "description": "Configuration for a connection to Bitbucket Cloud.",
  "allowComments": true,
  "type": "object",
  "additionalProperties": false,
  "required": ["url"],
  "oneOf": [
    {
      "allOf": [
        {
          "required": ["accessToken"]
        },
        {
          "not": { "required": ["username"] }
        },
        {
          "not": { "required": ["appPassword"] }
        },
        {
          "not": { "required": ["apiToken"] }
        }
      ]
    },
    {
      "allOf": [
        {
          "required": ["username", "appPassword"]
        },
        {
          "not": { "required": ["accessToken"] }
        },
        {
          "not": { "required": ["apiToken"] }
        }
      ]
    },
    {
      "allOf": [
        {
          "required": ["username", "apiToken"]
        },
        {
          "not": { "required": ["accessToken"] }
        },
        {
          "not": { "required": ["appPassword"] }
        }
      ]
    }
  ],
  "properties": {
    "url": {
      "description": "URL of Bitbucket Cloud, such as https://bitbucket.org. Generally, admin should not modify the value of this option because Bitbucket Cloud is a public hosting platform.",
      "type": "string",
      "not": {
        "type": "string",
        "pattern": "example\\.com"
      },
      "pattern": "^https?://",
      "format": "uri",
      "examples": ["https://bitbucket.org"],
      "!go": {
        "typeName": "NormalizedURL"
      }
    },
    "apiURL": {
      "description": "The API URL of Bitbucket Cloud, such as https://api.bitbucket.org. Generally, admin should not modify the value of this option because Bitbucket Cloud is a public hosting platform.",
      "type": "string",
      "not": {
        "type": "string",
        "pattern": "example\\.com"
      },
      "pattern": "^https?://",
      "format": "uri",
      "examples": ["https://api.bitbucket.org"]
    },
    "rateLimit": {
      "description": "Rate limit applied when making background API requests to Bitbucket Cloud.",
      "title": "BitbucketCloudRateLimit",
      "type": "object",
      "required": ["enabled", "requestsPerHour"],
      "properties": {
        "enabled": {
          "description": "true if rate limiting is enabled.",
          "type": "boolean",
          "default": true
        },
        "requestsPerHour": {
          "description": "Requests per hour permitted. This is an average, calculated per second. Internally, the burst limit is set to 500, which implies that for a requests per hour limit as low as 1, users will continue to be able to send a maximum of 500 requests immediately, provided that the complexity cost of each request is 1.",
          "type": "number",
          "default": 7200,
          "minimum": 0
        }
      },
      "default": {
        "enabled": true,
        "requestsPerHour": 7200
      }
    },
    "authorization": {
      "title": "BitbucketCloudAuthorization",
      "description": "If non-null, enforces Bitbucket Cloud repository permissions. This requires that there is an item in the [site configuration json](https://sourcegraph.com/docs/admin/config/site_config#auth-providers) `auth.providers` field, of type \"bitbucketcloud\" with the same `url` field as specified in this `BitbucketCloudConnection`.",
      "type": "object",
      "properties": {
        "identityProvider": {
          "description": "The identity provider to use for user information. If not set, the `url` field is used.",
          "type": "string"
        }
      }
    },
    "username": {
      "description": "The username to use when authenticating to the Bitbucket Cloud. Also set the corresponding \"appPassword\" field.",
      "type": "string"
    },
    "appPassword": {
      "description": "The app password to use when authenticating to the Bitbucket Cloud. Also set the corresponding \"username\" field.\nðŸš¨ NOTE ðŸš¨: Please use the \"apiToken\" field instead of this field, since Bitbucket Cloud is deprecating app passwords as of June 9, 2026. See https://www.atlassian.com/blog/bitbucket/bitbucket-cloud-transitions-to-api-tokens-enhancing-security-with-app-password-deprecation for more details.",
      "type": "string"
    },
    "accessToken": {
      "description": "The workspace access token to use when authenticating with Bitbucket Cloud.",
      "type": "string"
    },
    "apiToken": {
      "description": "The API token to use when authenticating with Bitbucket Cloud.",
      "type": "string"
    },
    "gitURLType": {
      "description": "The type of Git URLs to use for cloning and fetching Git repositories on this Bitbucket Cloud.\n\nIf \"http\", Sourcegraph will access Bitbucket Cloud repositories using Git URLs of the form https://bitbucket.org/myteam/myproject.git.\n\nIf \"ssh\", Sourcegraph will access Bitbucket Cloud repositories using Git URLs of the form git@bitbucket.org:myteam/myproject.git. See the documentation for how to provide SSH private keys and known_hosts: https://sourcegraph.com/docs/admin/repo/auth#repositories-that-need-http-s-or-ssh-authentication.",
      "type": "string",
      "enum": ["http", "ssh"],
      "default": "http",
      "examples": ["ssh"]
    },
    "gitSSHCredential": {
      "description": "SSH keys to use when cloning Git repo.",
      "$ref": "git.schema.json#/definitions/gitSSHCredential"
    },
    "gitSSHCipher": {
      "description": "SSH cipher to use when cloning via SSH. Must be a valid choice from `ssh -Q cipher`.",
      "$ref": "git.schema.json#/definitions/gitSSHCipher"
    },
    "repositoryPathPattern": {
      "description": "The pattern used to generate the corresponding Sourcegraph repository name for a Bitbucket Cloud repository.\n\n - \"{host}\" is replaced with the Bitbucket Cloud URL's host (such as bitbucket.org),  and \"{nameWithOwner}\" is replaced with the Bitbucket Cloud repository's \"owner/path\" (such as \"myorg/myrepo\").\n\nFor example, if your Bitbucket Cloud is https://bitbucket.org and your Sourcegraph is https://src.example.com, then a repositoryPathPattern of \"{host}/{nameWithOwner}\" would mean that a Bitbucket Cloud repository at https://bitbucket.org/alice/my-repo is available on Sourcegraph at https://src.example.com/bitbucket.org/alice/my-repo.\n\nIt is important that the Sourcegraph repository name generated with this pattern be unique to this code host. If different code hosts generate repository names that collide, Sourcegraph's behavior is undefined.",
      "type": "string",
      "default": "{host}/{nameWithOwner}"
    },
    "teams": {
      "description": "An array of team names identifying Bitbucket Cloud teams whose repositories should be mirrored on Sourcegraph.",
      "type": "array",
      "items": { "type": "string", "pattern": "^[\\w-]+$" },
      "examples": [["name"], ["kubernetes", "golang", "facebook"]]
    },
    "repos": {
      "description": "An array of repository \"projectKey/repositorySlug\" strings specifying repositories to mirror on Sourcegraph.",
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^~?[\\w-]+/[\\w.-]+$"
      },
      "examples": [["myproject/myrepo", "myproject/myotherrepo"]]
    },
    "exclude": {
      "description": "A list of repositories to never mirror from Bitbucket Cloud. Takes precedence over \"teams\" configuration.\n\nSupports excluding by name ({\"name\": \"myorg/myrepo\"}) or by UUID ({\"uuid\": \"{fceb73c7-cef6-4abe-956d-e471281126bd}\"}).",
      "type": "array",
      "items": {
        "type": "object",
        "title": "ExcludedBitbucketCloudRepo",
        "additionalProperties": false,
        "anyOf": [{ "required": ["name"] }, { "required": ["uuid"] }, { "required": ["pattern"] }],
        "properties": {
          "name": {
            "description": "The name of a Bitbucket Cloud repo (\"myorg/myrepo\") to exclude from mirroring.",
            "type": "string",
            "pattern": "^[\\w-]+/[\\w.-]+$"
          },
          "uuid": {
            "description": "The UUID of a Bitbucket Cloud repo (as returned by the Bitbucket Cloud's API) to exclude from mirroring.",
            "type": "string",
            "pattern": "^\\{[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\\}$"
          },
          "pattern": {
            "description": "Regular expression which matches against the name of a Bitbucket Cloud repo.",
            "type": "string",
            "format": "regex"
          }
        }
      },
      "examples": [
        [{ "name": "myorg/myrepo" }, { "uuid": "{fceb73c7-cef6-4abe-956d-e471281126bc}" }],
        [{ "name": "myorg/myrepo" }, { "name": "myorg/myotherrepo" }, { "pattern": "^topsecretproject/.*" }]
      ]
    },
    "webhookSecret": {
      "description": "A shared secret used to authenticate incoming webhooks (minimum 12 characters).",
      "deprecationMessage": "Deprecated in favour of first class webhooks. See https://sourcegraph.com/docs/admin/config/webhooks/incoming#deprecation-notice",
      "type": "string",
      "minLength": 12
    },
    "maxDeletions": {
      "description": "The maximum number of repos that will be deleted per sync. A value of 0 or less indicates no maximum.",
      "type": "integer",
      "default": 0
    }
  }
}
```
{/* SCHEMA_SYNC_END: admin/code_hosts/bitbucket_cloud.schema.json */}
## Webhooks

Using the `webhooks` property on the external service has been deprecated.

Please consult [this page](/admin/config/webhooks/incoming) in order to configure webhooks.
