# AWS One-Click Installation for Sourcegraph

This page describes how to launch a verified and pre-configured Sourcegraph instance in just ~10 minutes using our one-click CloudFormation template and standard AMIs.

Prefer manually installing on AWS yourself? See our [AMI](/self-hosted/deploy/machine-images/aws-ami) installation options.

## Prerequisites

-   An AWS account (most regions are supported, see our [Launcher](#deploy-sourcegraph) below for a complete list)
-   General familiarity with AWS
-   An [EC2 keypair](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/create-key-pairs.html) for SSH access
-   (optional) A Sourcegraph license to unlock features ([view plans](https://sourcegraph.com/pricing) or [learn how licenses work](/admin/licensing/))

## What will be created

Using our wizard, a single EC2 instance will be created with the following:

-   EBS root volume: 50GB
-   EBS data volume: 500GB - your Sourcegraph data (code and search indices.)
-   AWS Network Security Group
-   The latest version of Sourcegraph
-   (optional) DNS and TLS via AWS Load Balancer and AWS Certificate Manager

<Callout type="note">
	The instance will launch in the default VPC. If your AWS user does not have
	a default VPC, or the option `Auto-assign public IPv4 address` is not
	enabled for a subnet within that VPC, please see our [Manual
	AMI](/self-hosted/deploy/machine-images/aws-ami) instructions instead.
</Callout>

![aws-oneclick](https://storage.googleapis.com/sourcegraph-assets/Docs/aws-oneclick-diagram.png)

## Determine your instance size

The number of users and repositories you will use with Sourcegraph determines your instance size. If you fall between two sizes, choose the larger of the two.

Example: With 8,000 users with 80,000 repositories, your instance size would be **L**. If you have 1,000 users with 80,000 repositories, then size **M**.

|                      | **XS**      | **S**       | **M**       | **L**        | **XL**       |
| -------------------- | ----------- | ----------- | ----------- | ------------ | ------------ |
| **Users**            | `<= 500`    | `<= 1,000`  | `<= 5,000`  | `<= 10,000`  | `<= 20,000`  |
| **Repositories**     | `<= 5,000`  | `<= 10,000` | `<= 50,000` | `<= 100,000` | `<= 250,000` |
| **Recommended Type** | m6a.2xlarge | m6a.4xlarge | m6a.8xlarge | m6a.12xlarge | m6a.24xlarge |
| **Minimum Type**     | m6a.2xlarge | m6a.2xlarge | m6a.4xlarge | m6a.8xlarge  | m6a.12xlarge |

## Deploy Sourcegraph ðŸŽ‰

<Callout type="note">
	For security, please follow [Amazon best
	practices](https://docs.aws.amazon.com/accounts/latest/reference/best-practices-root-user.html)
	and _do not deploy Sourcegraph using your AWS account root user.
</Callout>

### IAM permissions required

To deploy Sourcegraph using the CloudFormation template, you will need an IAM user or role with the following permissions. Following the [principle of least privilege](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege), only grant the minimum permissions required for deployment and operation.

**Required IAM policy for CloudFormation deployment:**

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "CloudFormationStackManagement",
      "Effect": "Allow",
      "Action": [
        "cloudformation:CreateStack",
        "cloudformation:DescribeStacks",
        "cloudformation:DescribeStackEvents",
        "cloudformation:DescribeStackResources",
        "cloudformation:UpdateStack",
        "cloudformation:DeleteStack",
        "cloudformation:GetTemplate"
      ],
      "Resource": "arn:aws:cloudformation:*:*:stack/sourcegraph-*/*"
    },
    {
      "Sid": "EC2ResourceCreation",
      "Effect": "Allow",
      "Action": [
        "ec2:RunInstances",
        "ec2:DescribeInstances",
        "ec2:DescribeInstanceStatus",
        "ec2:DescribeInstanceAttribute",
        "ec2:TerminateInstances",
        "ec2:StartInstances",
        "ec2:StopInstances",
        "ec2:DescribeImages",
        "ec2:DescribeImageAttribute",
        "ec2:CreateSecurityGroup",
        "ec2:DescribeSecurityGroups",
        "ec2:AuthorizeSecurityGroupIngress",
        "ec2:RevokeSecurityGroupIngress",
        "ec2:DeleteSecurityGroup",
        "ec2:CreateVolume",
        "ec2:DescribeVolumes",
        "ec2:AttachVolume",
        "ec2:DetachVolume",
        "ec2:CreateSnapshot",
        "ec2:DescribeSnapshots",
        "ec2:CreateTags",
        "ec2:DescribeKeyPairs",
        "ec2:DescribeVpcs",
        "ec2:DescribeSubnets"
      ],
      "Resource": "*"
    },
    {
      "Sid": "IAMPassRole",
      "Effect": "Allow",
      "Action": "iam:PassRole",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "iam:PassedToService": "ec2.amazonaws.com"
        }
      }
    }
  ]
}
```

**Purpose of each permission set:**

- **CloudFormationStackManagement**: Allows CloudFormation to create, update, and manage infrastructure stacks that provision all necessary AWS resources for Sourcegraph automatically. Scoped to stacks named `sourcegraph-*` for security.

- **EC2ResourceCreation**: Enables CloudFormation to create and configure all EC2-related resources including instances, security groups, EBS volumes, and network components required for the Sourcegraph deployment.

- **IAMPassRole**: Permits CloudFormation to assign IAM roles to EC2 instances, enabling Sourcegraph to access other AWS services (S3, RDS) securely without hardcoded credentials. Restricted to EC2 service for security.

**Optional permissions for advanced features:**

If you plan to configure HTTPS/TLS using AWS Load Balancer and Certificate Manager, add these permissions:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "LoadBalancerManagement",
      "Effect": "Allow",
      "Action": [
        "elasticloadbalancing:CreateLoadBalancer",
        "elasticloadbalancing:DescribeLoadBalancers",
        "elasticloadbalancing:DeleteLoadBalancer",
        "elasticloadbalancing:CreateTargetGroup",
        "elasticloadbalancing:DescribeTargetGroups",
        "elasticloadbalancing:RegisterTargets",
        "elasticloadbalancing:CreateListener",
        "elasticloadbalancing:DescribeListeners",
        "elasticloadbalancing:ModifyLoadBalancerAttributes"
      ],
      "Resource": "*"
    },
    {
      "Sid": "CertificateManagement",
      "Effect": "Allow",
      "Action": [
        "acm:RequestCertificate",
        "acm:DescribeCertificate",
        "acm:ListCertificates"
      ],
      "Resource": "*"
    }
  ]
}
```

**Purpose of each permission set:**

- **LoadBalancerManagement**: Enables creation and management of Application Load Balancers for HTTPS/TLS termination, providing secure encrypted connections to Sourcegraph and distributing traffic for high availability.

- **CertificateManagement**: Allows requesting and managing SSL/TLS certificates through AWS Certificate Manager for securing your Sourcegraph instance with HTTPS, eliminating the need to manually manage certificates.

**IAM role for the EC2 instance (recommended):**

The CloudFormation template can optionally create an IAM role for the EC2 instance. This is recommended when using:

- [External S3 storage](/self-hosted/external-services/object-storage) for code intelligence uploads
- [AWS RDS for PostgreSQL](/self-hosted/external-services/postgres#usage-with-aws-rds-iam-auth) with IAM authentication

The EC2 instance role should only include permissions for the specific AWS services that Sourcegraph will access (e.g., S3 buckets, RDS databases).

---

## Network Configuration and Data Encryption

For production deployments, see the comprehensive guides:

- [Network Configuration](/self-hosted/deploy/docker-compose/aws#network-configuration) - VPCs, subnets, security groups, Network ACLs, and route tables
- [Data Encryption](/self-hosted/deploy/docker-compose/aws#data-encryption) - EBS encryption, S3 encryption, and LUKS setup

---

<Callout type="note">
	By default the CloudFormation template will create standard EBS volumes. If
	you have special EBS volume encryption requirements, please see the [AWS EBS
	Encryption
	guide](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html)
	and install Sourcegraph using our [Manual
	AMI](/self-hosted/deploy/machine-images/aws-ami) instructions instead.
</Callout>

Choose an AWS Region in the launcher below and click **Launch Stack**. When prompted, choose your **SSH Keypair** and **Sourcegraph Instance Size** per the chart above, then **Create Stack**.

<AWSOneClickLaunchForm />

### Confirm you can access Sourcegraph

Find the URL of your Sourcegraph instance in the **Outputs** section of the AWS Stack. On first launch, Sourcegraph may take ~5 minutes to start and may display a `404 not found` page temporarily.

### Executors

Executors are supported using [native kubernetes executors](/self-hosted/executors/deploy-executors-kubernetes).

Executors support [auto-indexing](/code-navigation/auto-indexing) and [server-side batch changes](/batch-changes/server-side).

To enable executors you must do the following:

1. Connect to the AMI instance using `ssh`
2. Run `cd /home/ec2-user/deploy/install/`
3. Replace the placeholder `executor.frontendPassword` in `override.yaml`
4. Run the following command to update the executor

```curl
helm upgrade -i -f ./override.yaml --version "$(cat /home/ec2-user/.sourcegraph-version)" executor sourcegraph/sourcegraph-executor-k8s
```

1. Adding the following to the site-admin config using the password you chose previously

```curl
"executors.accessToken": "<exector.frontendPassword>",
"executors.frontendURL": "http://sourcegraph-frontend:30080",
"codeIntelAutoIndexing.enabled": true
```

1. Check `Site-Admin > Executors > Instances` to verify the executor connected successfully. If it does not appear try reboot the instance

To use server-side batch changes, see the [server-side batch changes documentation](/batch-changes/server-side).

### Secure your instance

By default Sourcegraph will be available over HTTP on the public internet. To secure it you should now perform the following:

1. [Configure DNS and HTTPS/TLS](/self-hosted/deploy/machine-images/aws-ami#networking) using an AWS Load Balancer and AWS Certificate Manager.
2. [Configure user authentication](/admin/auth/) (SSO, SAML, OpenID Connect, etc.)
3. [Review the new Network Security Group](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html) to prevent access from the public internet and follow the principle of least privilege.

## Managing Sourcegraph

### Backup and restore

We strongly recommend you taking [snapshots of the entire Sourcegraph data EBS volume](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-creating-snapshot.html) on an [automatic, scheduled basis](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/snapshot-lifecycle.html). Only the Sourcegraph data volume (500G) needs to be backed up.

To restore from a backup, simply follow our [upgrade instructions](/self-hosted/deploy/machine-images/aws-ami#upgrade) and skip directly to **Step 2: Launch a new instance** - choosing your desired Sourcegraph version and your backed up data volume.

### Upgrading your Sourcegraph instance

Updates are released every month, and upgrading is a simple process: backup your instance, detach the Sourcegraph data volume, and start a new instance using the latest AMI with your data volume attached. For step-by-step instructions [see here](/self-hosted/deploy/machine-images/aws-ami#upgrade).

### Monitoring & alerting

Sourcegraph comes with extensive built-in monitoring dashboards & the ability to configure alerts. Please see our [monitoring guide](/self-hosted/how-to/monitoring-guide) for more information.

### Get Support

Feel free to reach out to `support@sourcegraph.com` if you have any questions.

Business support, training, Slack support, SLAs, and dedicated Technical Advisors are all available through [Business and Enterprise plans](https://sourcegraph.com/pricing).
